<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>cookie-session-token</title>
    <url>/2021/11/30/cookie%EF%BC%8Csession%EF%BC%8Ctoken/</url>
    <content><![CDATA[<h1 id="1-cookie"><a href="#1-cookie" class="headerlink" title="1.cookie"></a>1.cookie</h1><p>​        在浏览器发展初期，为了适应用户的需求技术上推出了各种保持 Web 浏览状态的手段，其中就包括了 Cookie 技术。Cookie 在计算机中是个存储在浏览器目录中的文本文件，当浏览器运行时，存储在 RAM 中发挥作用 （此种 Cookies 称作 Session Cookies），一旦用户从该网站或服务器退出，Cookie 可存储在用户本地的硬盘上 （此种 Cookies 称作 Persistent Cookies）。</p>
<h2 id="Cookie时效性："><a href="#Cookie时效性：" class="headerlink" title="Cookie时效性："></a><strong>Cookie时效性：</strong></h2><p>目前有些 Cookie 是临时的，有些则是持续的。临时的 Cookie 只在浏览器上保存一段规定的时间，一旦超过规定的时间，该 Cookie 就会被系统清除。</p>
<h2 id="Cookie使用限制："><a href="#Cookie使用限制：" class="headerlink" title="Cookie使用限制："></a><strong>Cookie使用限制：</strong></h2><p>Cookie 必须在 HTML 文件的内容输出之前设置；不同的浏览器 (Netscape Navigator、Internet Explorer) 对 Cookie 的处理不一致，使用时一定要考虑；客户端用户如果设置禁止 Cookie，则 Cookie 不能建立。 并且在客户端，一个浏览器能创建的 Cookie 数量最多为 300 个，并且每个不能超过 4KB，每个 Web 站点能设置的 Cookie 总数不能超过 20 个。</p>
<h2 id="执行流程："><a href="#执行流程：" class="headerlink" title="执行流程："></a><strong>执行流程：</strong></h2><p>A：首先，客户端会发送一个http请求到服务器端；</p>
<p>B： 服务器端接受客户端请求后，发送一个http响应到客户端，这个响应头，其中就包含Set-Cookie头部；</p>
<p>C：在客户端发起的第二次请求（注意：如果服务器需要我们带上Cookie，我们就需要在B步骤上面拿到这个Cookie然后作为请求头一起发起第二次请求），提供给了服务器端可以用来唯一标识客户端身份的信息。这时，服务器端也就可以判断客户端是否启用了cookies。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//cookie常用于存储用户的登录信息。</span></span><br><span class="line">Cookie c = <span class="keyword">new</span> Cookie(“username”,“john”);</span><br><span class="line"><span class="comment">//设置有效期：设置时间为0，则销毁cookie</span></span><br><span class="line">c.setMaxAge(<span class="number">3600</span>);</span><br><span class="line">response.addCookie；</span><br><span class="line"></span><br><span class="line">Cookie[] c = request.getCookies();</span><br><span class="line"><span class="keyword">if</span>(c != <span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; c.length;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(“username”.equals(c.getName()))</span><br><span class="line">out.println(c.getValue());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取cookie的代码：</span></span><br><span class="line"></span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br></pre></td></tr></table></figure>



<h1 id="2-session"><a href="#2-session" class="headerlink" title="2.session"></a>2.session</h1><p>​        Cookie 虽然很方便，但是使用 Cookie 有一个很大的弊端，Cookie 中的所有数据在客户端就可以被修改，数据非常容易被伪造，那么一些重要的数据就不能存放在 Cookie 中了，而且如果 Cookie 中数据字段太多会影响传输效率。为了解决这些问题，就产生了 Session，<strong>Session 中的数据是保留在服务器端的</strong>。</p>
<p>​        Session是服务器在和客户端建立连接时添加客户端连接标志，最终会在服务器软件（Apache、Tomcat、JBoss）转化为一个临时Cookie发送给给客户端，当客户端第一请求时服务器会检查是否携带了这个Session（临时Cookie），如果没有则会添加Session，如果有就拿出这个Session来做相关操作。</p>
<p>Session 的运作通过一个session_id来进行。session_id通常是存放在客户端的 Cookie 中</p>
<h2 id="Session-可以存放在："><a href="#Session-可以存放在：" class="headerlink" title="Session 可以存放在："></a><strong>Session 可以存放在：</strong></h2><blockquote>
<p>1）内存；</p>
<p>2）Cookie本身；</p>
<p>3）redis 或 memcached 等缓存中；</p>
<p>4）数据库中</p>
</blockquote>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/sessiondemo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionDemo</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF=8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;孤傲苍狼&quot;</span>);</span><br><span class="line">        String sessionId = session.getId();</span><br><span class="line">        <span class="keyword">if</span> (session.isNew()) &#123;</span><br><span class="line">            response.getWriter().print(<span class="string">&quot;session创建成功，session的id是：&quot;</span>+sessionId);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            response.getWriter().print(<span class="string">&quot;服务器已经存在session，session的id是：&quot;</span>+sessionId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="3-Token"><a href="#3-Token" class="headerlink" title="3.Token"></a>3.Token</h1><p>​        token是用户身份的验证方式，我们通常叫它：令牌。最简单的token组成:uid(用户唯一的身份标识)、time(当前时间的时间戳)、sign(签名，由token的前几位+盐以哈希算法压缩成一定长的十六进制字符串，可以防止恶意第三方拼接token请求服务器)。还可以把不变的参数也放进token，避免多次查库。</p>
<h2 id="Token的使用流程："><a href="#Token的使用流程：" class="headerlink" title="Token的使用流程："></a><strong>Token的使用流程：</strong></h2><p><strong>A：</strong>当用户首次登录成功（注册也是一种可以适用的场景）之后, 服务器端就会生成一个 token 值，这个值，会在服务器保存token值(保存在数据库中)，再将这个token值返回给客户端；</p>
<p><strong>B：</strong>客户端拿到 token 值之后,进行本地保存。（SP存储是大家能够比较支持和易于理解操作的存储）；</p>
<p><strong>C：</strong>当客户端再次发送网络请求(一般不是登录请求)的时候,就会将这个 token 值附带到参数中发送给服务器；</p>
<p><strong>D：</strong>服务器接收到客户端的请求之后,会取出token值与保存在本地(数据库)中的token值做对比。</p>
<h2 id="Token的身份认证逻辑："><a href="#Token的身份认证逻辑：" class="headerlink" title="Token的身份认证逻辑："></a><strong>Token的身份认证逻辑：</strong></h2><p>对比一：如果两个 token 值相同， 说明用户登录成功过!当前用户处于登录状态！</p>
<p>对比二：如果没有这个 token 值, 则说明没有登录成功；</p>
<p>对比三：如果 token 值不同: 说明原来的登录信息已经失效,让用户重新登录。</p>
<h2 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h2><h3 id="1-生成token"><a href="#1-生成token" class="headerlink" title="1.生成token"></a>1.生成token</h3><p><img src="/../img/image-20210820085115539.png" alt="image-20210820085115539"></p>
<h2 id="2-从request-headers取出token"><a href="#2-从request-headers取出token" class="headerlink" title="2.从request headers取出token"></a>2.从request headers取出token</h2><p><img src="/../img/image-20210820085347348.png" alt="image-20210820085347348"></p>
<h2 id="3-swagger从headers中取出测试token"><a href="#3-swagger从headers中取出测试token" class="headerlink" title="3.swagger从headers中取出测试token"></a>3.swagger从headers中取出测试token</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ParameterBuilder tokenPar = <span class="keyword">new</span> ParameterBuilder();</span><br><span class="line">List&lt;Parameter&gt; pars = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">tokenPar.name(<span class="string">&quot;Authorization&quot;</span>).description(<span class="string">&quot;令牌&quot;</span>).modelRef(<span class="keyword">new</span> ModelRef(<span class="string">&quot;string&quot;</span>)).parameterType(<span class="string">&quot;header&quot;</span>).required(<span class="keyword">false</span>).build();</span><br><span class="line">pars.add(tokenPar.build());</span><br></pre></td></tr></table></figure>

<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210820091403595.png" alt="image-20210820091403595"></p>
<h2 id="4-设置过滤器，保证每个请求都会判断token"><a href="#4-设置过滤器，保证每个请求都会判断token" class="headerlink" title="4.设置过滤器，保证每个请求都会判断token"></a>4.设置过滤器，保证每个请求都会判断token</h2><p><img src="/../img/image-20210820094546315.png" alt="image-20210820094546315"></p>
<p>这里把token存在header中了，而秒杀商城是存在cookie中</p>
<h2 id="5-前端里请求头中携带token"><a href="#5-前端里请求头中携带token" class="headerlink" title="5.前端里请求头中携带token"></a>5.前端里请求头中携带token</h2><p>前端接受后端传过来的token，设置进localStorage中</p>
<p>方法：localStorage.token=”data.token”</p>
<p><img src="/../img/image-20210820140949682.png" alt="image-20210820140949682"></p>
<h2 id="6-跨越问题"><a href="#6-跨越问题" class="headerlink" title="6.跨越问题"></a>6.跨越问题</h2><p><img src="/../img/image-20210820141216272.png" alt="image-20210820141216272"></p>
<h2 id="7-清楚token"><a href="#7-清楚token" class="headerlink" title="7.清楚token"></a>7.清楚token</h2><p>后端redis清楚</p>
<p>前端</p>
<p><img src="/../img/image-20210820141606908.png" alt="image-20210820141606908"></p>
<h1 id="4-Cookie和Session的区别小结"><a href="#4-Cookie和Session的区别小结" class="headerlink" title="4.Cookie和Session的区别小结"></a>4.Cookie和Session的区别小结</h1><p>1）cookie数据存放在客户的浏览器上，session数据放在服务器上；</p>
<p>2）cookie不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗,考虑到安全应当使用session；</p>
<p>3）session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能,考虑到减轻服务器性能方面，应当使用cookie；</p>
<p>4）单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。</p>
<p><strong>所以个人建议：</strong></p>
<p>将登陆信息等重要信息存放为session；</p>
<p>其他信息如果需要保留，可以放在cookie中。</p>
<h1 id="5-Token-和-Session-的区别小结"><a href="#5-Token-和-Session-的区别小结" class="headerlink" title="5.Token 和 Session 的区别小结"></a>5.Token 和 Session 的区别小结</h1><p>​        Session和 token并不矛盾，作为身份认证token安全性比Session好，因为每个请求都有签名还能防止监听以及重放攻击，而Session就必须靠链路层来保障通讯安全了。如上所说，如果你需要实现有状态的会话，仍然可以增加session来在服务器端保存一些状态</p>
<p>​        Token就是令牌，比如你授权（登录）一个程序时，他就是个依据，判断你是否已经授权该软件；cookie就是写在客户端的一个txt文件，里面包括你登录信息之类的，这样你下次在登录某个网站，就会自动调用cookie自动登录用户名；session和cookie差不多，只是Session是写在服务器端的文件，也需要在客户端写入cookie文件，但是文件里是你的浏览器编号。Session的状态是存储在服务器端，客户端只有Session id；而Token的状态是存储在客户端。</p>
<h2 id><a href="#" class="headerlink" title></a></h2><h1 id="6-自己的秒杀项目"><a href="#6-自己的秒杀项目" class="headerlink" title="6.自己的秒杀项目"></a>6.自己的秒杀项目</h1><p><img src="/../img/image-20210824102942986.png" alt="image-20210824102942986"></p>
<p>首先通过uuid生成一个随机sessionid，存到redis和cookie中</p>
<p><img src="/../img/image-20210824103051506.png" alt="image-20210824103051506"></p>
<p>以后的请求，会得到cookie中名字为token的sessionid，在通过方法getUserForToken判断redis中是否有次数据</p>
<p><img src="/../img/image-20210824103150109.png" alt="image-20210824103150109"></p>
<p>redis中存的key为token，value为user对象，不为空重置时间</p>
<h1 id="token项目中"><a href="#token项目中" class="headerlink" title="token项目中"></a>token项目中</h1><p>1.登录方法uuid生成唯一token保存在redis，并普通json发送给客户端</p>
<p>2.客户端接受保存到浏览器本地，可能是localStorage，每次请求前端设置请求头里</p>
<p>3.后端接受请求，通过过滤器判断请求头中的token与本地redis中token是否一致，一致放行，不一致返回错误信息，比如404,</p>
<p>4.前端接受，如果是404，跳转到登录页面，重新发送登录方法</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>cookie-session-token</tag>
      </tags>
  </entry>
  <entry>
    <title>CAS单点登录</title>
    <url>/2021/11/30/CAS%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/</url>
    <content><![CDATA[<p><img src="/../img/image-20220210141403511.png" alt="image-20220210141403511"></p>
<h1 id="1-搭建tomcat的HTTPS支持"><a href="#1-搭建tomcat的HTTPS支持" class="headerlink" title="1.搭建tomcat的HTTPS支持"></a>1.搭建tomcat的HTTPS支持</h1><h2 id="1-下载安装tomcat9"><a href="#1-下载安装tomcat9" class="headerlink" title="1.下载安装tomcat9"></a>1.下载安装tomcat9</h2><p><a href="https://blog.csdn.net/ELaXiaoSi/article/details/84190648?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164445787016780265450662%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164445787016780265450662&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-84190648.first_rank_v2_pc_rank_v29&amp;utm_term=tomcat9%E4%B8%8B%E8%BD%BD&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/ELaXiaoSi/article/details/84190648?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164445787016780265450662%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164445787016780265450662&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-84190648.first_rank_v2_pc_rank_v29&amp;utm_term=tomcat9%E4%B8%8B%E8%BD%BD&amp;spm=1018.2226.3001.4187</a></p>
<h2 id="2-生成秘钥库"><a href="#2-生成秘钥库" class="headerlink" title="2.生成秘钥库"></a>2.生成秘钥库</h2><p>采用java自带的keytool工具</p>
<p>别名jiang 存储路径D:\CAS\keystore</p>
<p>keytool -genkey -v -alias jiangcas -keyalg RSA  -keystore D:\CAS\keystore\jiangcas.keystore</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-genkey 生成密钥</span><br><span class="line">-keyalg 指定密钥算法，这时指定RSA,</span><br><span class="line">-keysize 指定密钥长度，默认是1024位,这里指定2048，长一点，比较难破解,</span><br><span class="line">-validity 指定证书有效期，这里指定36500天.</span><br><span class="line">-alias 指定别名，这里是wolfcode</span><br><span class="line">-keystore 指定密钥库存储位置，这里存在 D:\CAS\keystore目录下</span><br><span class="line">注意：您的名字与姓氏www.sso.com是CAS服务器使用的域名,不是随便乱定的，其他的随意.</span><br></pre></td></tr></table></figure>

<p>密钥库口令：jiangcas</p>
<p><img src="/../img/image-20220210100933281.png" alt="image-20220210100933281"></p>
<h2 id="3-导出证书"><a href="#3-导出证书" class="headerlink" title="3.导出证书"></a>3.导出证书</h2><p>keytool -export -trustcacerts -alias jiangcas -storepass jiangcas -file D:/CAS/keystore/jiangcas.cer -keystore D:/CAS/keystore/jiangcas.keystore</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-alias指定别名为wolfcode ;</span><br><span class="line">-storepass指定私钥为123456;</span><br><span class="line">-file指定导出证书的文件名为wolfcode.cer;</span><br><span class="line">-keystore指定之前生成的密钥文件的文件名。</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20220210101357591.png" alt="image-20220210101357591"></p>
<h2 id="3-导入证书导入到jdk信任库"><a href="#3-导入证书导入到jdk信任库" class="headerlink" title="3.导入证书导入到jdk信任库"></a>3.导入证书导入到jdk信任库</h2><p>keytool -import -trustcacerts -alias jiangcas -keystore “D:/javajdk/jdk1.8.0_131/jre/lib/security/cacerts” -file D:/CAS/keystore/jiangcas.cer</p>
<p>jdk证书库密码： changeit</p>
<p><img src="/../img/image-20220210101845118.png" alt="image-20220210101845118"></p>
<h2 id="4-配置https支持"><a href="#4-配置https支持" class="headerlink" title="4.配置https支持"></a>4.配置https支持</h2><p>修改<img src="/../img/image-20220210102011138.png" alt="image-20220210102011138"></p>
<p>添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot;</span><br><span class="line">               maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot; scheme=&quot;https&quot; secure=&quot;true&quot; </span><br><span class="line">clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; keystoreFile=&quot;D:\CAS\keystore\jiangcas.keystore&quot; keystorePass=&quot;jiangcas&quot;			   </span><br><span class="line">               /&gt;</span><br></pre></td></tr></table></figure>

<p>启动tomcat乱码</p>
<p><img src="/../img/image-20220210102613324.png" alt="image-20220210102613324"></p>
<p>找到第51行把UTF-8改为GBK</p>
<p>java.util.logging.ConsoleHandler.encoding = GBK</p>
<p>启动start.bat</p>
<p>访问http的<a href="http://localhost:8080/">http://localhost:8080</a></p>
<p>https的<a href="https://localhost:8443/">https://localhost:8443/</a></p>
<h1 id="2-下载cas服务端包"><a href="#2-下载cas服务端包" class="headerlink" title="2.下载cas服务端包"></a>2.下载cas服务端包</h1><p><a href="https://repo1.maven.org/maven2/org/apereo/cas/cas-server-webapp-tomcat/5.3.14/">https://repo1.maven.org/maven2/org/apereo/cas/cas-server-webapp-tomcat/5.3.14/</a></p>
<p>下载这个包cas-server-webapp-tomcat-5.3.14.war </p>
<h1 id="3-cas的war包发布到tomcat下"><a href="#3-cas的war包发布到tomcat下" class="headerlink" title="3.cas的war包发布到tomcat下"></a>3.cas的war包发布到tomcat下</h1><p><img src="/../img/image-20220210103038596.png" alt="image-20220210103038596"></p>
<p>启动tomcat自动解压</p>
<p>删除war包，修改名称为cas</p>
<p>再次启动tomcat访问<a href="https://localhost:8443/cas">https://localhost:8443/cas</a></p>
<p><img src="/../img/image-20220210103423069.png" alt="image-20220210103423069"></p>
<p>默认用户名密码</p>
<p><img src="/../img/image-20220210103633290.png" alt="image-20220210103633290"></p>
<p><img src="/../img/image-20220210103624560.png" alt="image-20220210103624560"></p>
<p>修改日志位置</p>
<p><img src="/../img/image-20220210103759606.png" alt="image-20220210103759606"></p>
<p><img src="/../img/image-20220210103807366.png" alt="image-20220210103807366"></p>
<p>改为D:\CAS\log</p>
<h1 id="4-修改域名方便访问"><a href="#4-修改域名方便访问" class="headerlink" title="4.修改域名方便访问"></a>4.修改域名方便访问</h1><p>C:\Windows\System32\drivers\etc下的hosts文件</p>
<p>添加127.0.0.1 <a href="http://www.jiangcas.com/">www.jiangcas.com</a></p>
<p>就可以通过域名访问，首先找本地hosts然后才是dns解析</p>
<h1 id="5-配置数据源"><a href="#5-配置数据源" class="headerlink" title="5.配置数据源"></a>5.配置数据源</h1><p><strong>第一步：新建数据和表：</strong></p>
<p>CREATE DATABASE /<em>!32312 IF NOT EXISTS</em>/<code>db_sso</code> /*!40100 DEFAULT CHARACTER SET utf8 */;</p>
<p>USE <code>db_sso</code>;</p>
<p>/*Table structure for table <code>t_cas</code> */</p>
<p>DROP TABLE IF EXISTS <code>t_cas</code>;</p>
<p>CREATE TABLE <code>t_cas</code> (</p>
<p> <code>id</code> int(11) NOT NULL AUTO_INCREMENT,</p>
<p> <code>username</code> varchar(30) DEFAULT NULL,</p>
<p> <code>password</code> varchar(100) DEFAULT NULL,</p>
<p> PRIMARY KEY (<code>id</code>)</p>
<p>) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;</p>
<p>/*Data for the table <code>t_cas</code> */</p>
<p>insert into <code>t_cas</code>(<code>id</code>,<code>username</code>,<code>password</code>) values (1,’java1234’,’123456’);</p>
<p><strong>第二步：修改application.properties配置文件</strong> </p>
<p>注释掉写死的认证用户</p>
<p>加上jdbc数据源配置</p>
<p># cas.authn.accept.users=casuser::Mellon</p>
<p># cas.authn.jdbc.query[0].dialect=org.hibernate.dialect.MySQL5Dialect</p>
<p>cas.authn.jdbc.query[0].url=jdbc:mysql://localhost:3306/school?serverTimezone=GMT</p>
<p>cas.authn.jdbc.query[0].user=root</p>
<p>cas.authn.jdbc.query[0].password=root</p>
<p>cas.authn.jdbc.query[0].sql=select * from t_cas where username=?</p>
<p>cas.authn.jdbc.query[0].fieldPassword=password</p>
<p>cas.authn.jdbc.query[0].driverClass=com.mysql.jdbc.Driver</p>
<p><strong>第三步：加上jdbc驱动包以及支持jar</strong></p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAW4AAACyCAYAAABiKSVvAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABNRSURBVHhe7d3PiybHfcfxOer/yWnBh0Cuvirgi60E5ubFEHIyLBgC2hyUAV0iFB9EfLH2YIO82FkMgkA8JHiXCIsQ9hJieSUvsaVgZK+1q5Vo97e6q7u+1d/60f08z85T87wHXuw83dVV1dVdn+l5dp7usy+++KIDroM//+u/NZcDrfjf33xmLo8R3LgWvvL1v+n+8rv/2n397//ZXA+0gODGyfjK177Z/dU//qR79T9+271+/+Pun35yaZYDjh3BjZPwF9/4Vnf7ncvup7/6Q/fj//m0+9mjP3Q///WT7t8+fGKWB44ZwQ0AjSG4AaAxBDcANOZAwf1+99orr3d3HlnrIo/e7W6+8u3uq6+83V32ry/f+Hb32n2jHADAKQf34+7OrdfXBLeEtgSx7eY7j125D955fVw2BLbb1oV48BoAsPDBbwvBLVl669264PZhbF4xjxV9oJbLTwUf1PL9MuiFD3sAQDm4JYslN4vB7UJ7DObLN6K3Se6/Pa0blqVCenm1zVsnAKDlg3t416MquLVhQwlcCd6vvvG+UcaX82H9fncneBvFXWWbV+kAcNpywe3y81blFXcs+7aJJ1fi7kpbX6FPwR2WBQA4jz5+ai4Xl++821sZ3O4K24WxbQ7kx92dN97uXnPvcfdX3nJlLUHeX50Pwd1fgd/ibRIAiH34yZ7e4/aB7S/RrTJyhe3XzeE8v1Xi3zaZr7hlWeWfFQLAifj1/6evuEV1cHtz6Brrg+C+7K+2L6e/Khn+s9JfXas6xv/YnOoAgBP3f797Zi73NgV3/PZISIe6D+5lHcnwB4AT9/GnBwjuZOgGV9yDKLjl6noMeN7bBgDbJ7/fc3ADAA7rd08+N5fHCG4AOBK//yPBDQBNefL0ubk8RnADwJH47BnBDQBNefY5wQ0ATXn+3F4eI7gBoDEENwA0huAGgMYQ3ADQGIIbABpDcANAYwhuAGgMwQ0AjSG4AaAxBDcANKY6uF999dUqb775prk9AGA/VgX348f/XSTB/fLLL5t1AAB2tyq4a74kuOWL8AaAwzhIcEtoe1ZduGYeXnQ3zm50Fw+NdeLueXd246J76F4/7C5unHXnd6My10VpLIA9WB3c8m/JSy+91N2/f5/gPhVXGNx3z8+6s7PA1E7sbnc+lTvv7pplRtLfvlyyj25/z7obFw8T6whuHMhH97rbN29uC+6zsze77sGfuX8tEtzyRXBfB3sI2gMHtxmgirQ5h7UL+/O7URlfTsL/vDtP9lHK3Ohu9OvL7QL79F731u173Uf995uDO4fgvk6uQ3BHVH8s6T4+vOhDu29vU7vAnmwK7tyX/GVJXXCHv7oGk2D8NdQvDyePTBq/vPTrbrpsot1pso7rx6uucHK6OqcJX1tPOiDMPrr9D/qrXkd1j+YxKq0Xep0em7jvfUiFZVP7Evd50Ua47fo+5gJSv1US9iGtHLq+j9Fy2c9xP5J1mMdv7mPyWGXOEyC2Q3Cfdd/pTzj/5b+tC+7hZF2e+P3JfB6cwO69xnESLMIhI1lW2g3ffwwn6PC9mvzJK8WV9VhSfTQnvn+d6GP1emPcS9urfUtQfRzaCMu7cI3GcVUfK+kfrBHXR2m3sC+Otc96WV1w99ukzmdrHIBKm4Pbhbbov9y3479VwS0ncOYKw75aHib02eI/fvzycF2irJs4vuxsmIDWZJV6xjrCCbmpHl+u0Ec18ePXVt3hssJ6c9xXbO9eG/sSj03chlq2pY/CGkOrTGrdTP8gsSz76M7J4H3x6ivunn0+W+MA1NnprRJ1xf2d/qTs7RTc7qQPJoQxCfwJn568oahsMhSEPZH8BJXJN/VrQz1pUR/jfVavrbrDZYX1Zr9lvR/LUv0JYR+tNtSyLX2sVRfc5XJxH4fXc/gG4v/kDMfCfZ86nyvGFTC899bGvyqRcM6pfatkPmnvdhdyckeTdrhSmSfBRTSRkid9smzcrgRzYSLJZHPvd4cTfUM9sVQf3eSe21JjMJYLw2Ld+qHf6kpxTahOyyKuz7qNufzYp6iNUh/n7cdzYyyr9WWjq+CpnXAc5fu4PavcuL5mn9UVd9yW35fc+VwzroDyUXfv9s3u9r2P1ge3hHIN+cr+56Q7wfuJ5uiT2V/N3OjDcA6EcWL6bYKJaEmWVe0uA2Y5kZZB46yuZynVx2GCD8v1GIx198um7YLxKa8XQzBmt4/6PvUnCCElDCshgTXV3wfahfHDIddH89xICNsK++fqiH8AGnWqckPf5nID61hWBXdUn3ksK84TwHnvre7mzZvO6uBe85UNbmxQmuxXFAYqrE4cY4EXYFVwP3jwYBWCe9+OM7jVWw8njrHAi1Ad3BLCW1h1YasjC+7pbQquMBkLvEjVwQ0AOA4ENwA0huAGgMYQ3ADQGIIbABpTHdzy54A1eFgwABzWquC2Pt4e42HBAHBYq4K75ouHBQPAYR0kuPkAzolR9/swqJstXdHH8rPk/i2Z/u9DaYzW2nd9x+7U9rdgdXDLvyVykykeFnxCCO6yxoJb3QBNJD/GH960rPCp0fHTpclj7/YpuHnXYh3BzcOCUWkPQXt0wR334RDBve/9fLHjpu5+mCR9msPahb15186h7zyEeVc8LBjV9hAYBPcevNhxqwvuiDrOlvQ+yM25pL1N7Z6gTcGd+5K/LKkL7vBXrOBgjb8u+eXhQU7eU9mQLptodzqpxvU8LLjv+/E/LDh5viTHMeqb65cs64Nb7hvul6srx1R/ltsN64w2CmM01Wnuz/r6lue81U+/fkm/VRLWlVYOXX/so+WyL+P5kawj3l9znER8Dvvz7nrZIbh5WHB1PZZUH80T1L9O9LF6vTHupe3VviWoPg5thOVdCETjuKqPSX1dteeLMY5zH4c2p7B2Zf3xzR3r3HZRG8YYrTr/19ZnjKndzzJ9wRJxdcnx1MfcFo/7clldcJfHaX59PW0Obh4WvLYeX67QR3WCxq+tusNlhfXmuK/Y3r029iUem7gNtWxLH4U1hoPtv7mM68LjPK0fX2ePdWa7uI3SGAXs839tfWH5XD/T4zqLt7fpH9CWaB96bl+D326qr7h7VeN0Te30VgkPC9ZlB2tPnKiP8T6r11bd4bLC+uQE92NZqj8h7KPVhlq2pY8JufNl1TgWgjvZnz0Hd25/VtcX9iXXzxp1wV0uF+3D+HoO34B6q6oX7u+acbqGeFhwj4cFh2Nu9b1if1yfdRtz+bFPURulPs7bZx4WXDhfSuMYtpEOttyxzm0XtZEdo4rzv6K+9HHN9dPSl4+ugqe6wnGV7+PjaJUb1y/2waCuuOO2/P6uGadrhYcFT+vmA5w64GOf4vZW17OU6uNwIg7LeVhw3P/QUJevJz5f0uMY71Mh2JLHOr+daiMeI3MfK/fHqi97XAv7ZwmPYXjcXbvGPsZtqnJ6vzxrjlQFd3achnU18685PCy4VaWT8opO2kWIAHvGOaasCm7rgcA5BPe+HWdwu6uu8KoM2DPOMa06uCWEt7DqwlZHFtzTr9NcCeFAOMdM1cENADgOBDcANIbgBoDGmMH97PPn3b/cf9T9ww/+q7v1vf8EABwRM7h/ePnL7sc//1X3yadPuy+//BIAcETM4P677/+i++zpc7VM/hywBg8LBoDDMoNbLsUl1cNlEsrWx9tjPCwYAA5rVXDXfPGwYAA4rIMENx/AOTHqvhQGdVOgA39ISLVlKPX1FDEmzVkd3PJvidxkiocFnxCCexV1czGR7G9446jCJwfHTxgmx9Xtd3ADp8U6grsJuYcFl4JbnivJw4JPxR6C9piC+wioO+AlyTjNYe3C3rwj5jCePIj3FBQeFlwT3DkE93VCcO9bXXBHivuVHle5QZO0t6ldHKVNwZ37kr8sqQtuff/g6YQaf6Xzy8MTMXnvX0O6bKLd6cQf1/Ow4L7vDTwseE1bsnzq67BuX8d3zbmp3yrJl/XKoev7FS2X/R37mKzDPOfmPibPr2ms8KLtENw8LLi6Hkuqj+Yk8q8Tfaxeb4x7aXu1bwmqj0MbYXkXVNE4rupj0oa2wr7u6/imjmUF/cMi4uqVtgrj74R9tJfVBXe/zYk/iLcFm4ObhwWvrceXK/QxDoF4UmUnZ2G9Oe4rtnevjX2JxyZuQy3b0kdhtLulLTWe+z6+0bG0+jytC8uk1s30DyTLsl9uHgXvi1dfcffsOWjtO67CTm+V8LBgXXaw9uSO+hjvs3pt1R0uK6w3+y3r/ViW6k8I+2i1oZZt6WPClrai8d3v8R3W1Z2bXl1wl8vF/fJ9MZiP4RvHxH2fmoO5fceLknxYcCm4JZxzat8qmU8AHhY8beMmytyWGoOx3PL5lLXrh35Pk1KUgq5mf1yfdRtz+bFPURulPs7bZx4WXNmW6rvq6/h61+ObOpZ+vdLXHV0FT/0Nj718H4+RVW5cX253/iHlXsdt+THJzcGKNnBIhYcF54JbQrmGfGX/c9KdLP1J6+gTw18ZxA9LdSe53yY4qS3Jsqrd8CRMnZRjn+L2VtezlOrjMFmG5eaDUPtl03bB+JTXiyGUsttHfZ/6E0xoJZz4Qib/VH8fDgd7WHCvpq1wf+K+jmV2Pb5rzk3V53BMXZtzIIfngRoHVW7s/1RuYJ1/VcEd1XcyD+JtQelhwbngXvOVDW5sUJo4VzSx1MRHczh+zVkV3NYDgXMI7n07zuBWv8ajORy/9lQHt4TwFmEd2NWRBff0Kz9Xa03i+DWrOrgBAMfBDO7bd37Rffrk2WI5AODqmcH9o3//oLv34EP3FBy58gYAHA8zuP/49PPuBz/7pXuEmbxtAgA4HmZwAwCOV3Vwy58D1uBhwQBwWKuC2/p4e4yHBQPAYa0K7povHhYMAId1kOA+7g/gyL06+MCBSd0D49QVPsy0ZawYX+zJ6uCWf0vkJlPH+7BggjvpCoJF3ZxJ5D56PX7SL/vJULcPc32qbG7dAsGNI5R7WLBFAtkHtzxXst2HBV+H4L6ae5IcgrpjXdKwv/kH4or+2C7utueP9XBXxGnbYohenzHGdVF4WLAlDu4cgvvQTi24vbX7LeV9OMtxD4M6fh0juHG8NgV37kv+sqQc3OOkuTv/6uomSHCf4mEyD5NHTWwpM15VJe9XPF5dzet605VYTXDr7ef243rjNvt9kvtBm9ul1i3rza+70H1Q+xUsV33zITSWSb0doa5Q/eu5ziHElsdE3V3O3CZNv1VSOi5rw1T2d65z7qdxXi1EYxbvz+JqPnd8rW38a6Pu2uOFk7VDcO/+sODphPSB7W9AH57gQVDLOpno7gSPJ8FkqDuc3C4cpjpkvbWdN2y/nHjGctfvcPLG++Cv6Err/PciDKdUX+IAK/VtKF8MRjWm/Taph8aqYxL2JbNNhfLtReP9zltezftxqBiLqWxQLtwfNVa54xuoHV+rbSCwObh3eljwIqxyr+Pvo8kSTxAVKtYyq46gHmt7YS4PgyTsp19n7UO0zk1Y34eZC5xUX1S7vWLfovKOse8qWAb2bzXB/qzaxi8LxyIUj1PM2g+b+2GtnkQT1a3C1eqb1VawTO133G8pZ+xH9VjV7ydO005vlWx+WPDiRM+/lpNbgsyd5GoyiuEkzwavWiZ168mjpMIyGY6+n7nJm1mXak8k10UTu9i3qHxKGCzu++CKNQodfzXrj81cJr1NWTxOsbr9WIZ2zxij5RV5yGorWKb2LXfsA+E22bGqPF44ScmHBVvC4JZwztl3cLuTOn6ga7+s7oHAw7p50sr6XJjE2/uH1Q7L1URXYRD1WU3e0jo9SecH06b6Ek/sUt/i8glheERBN1wZBuNmHZPSNgt9v4OAdYHrt3d9CcdMGPuhyg3rzTBe1Lccd22oK/wBoPYnHCtXV1i3bDu+DtsNt8mOVeXxwokpPCzY4oNbQrmGfO0tuHtqUofL+snnhFdYMin8cqlHPUBW6s6FSc9NML99WFa29cutdWGfg8mbXddT7VnBtGxvmOj9MrVfcx26b5VBEAbLuI2vL35w87ReXdmWtjGExyo8vq4vfox0vZ7bn7CcOu7ePM7TmI3y4zGOWeqhxmqsMsc37F/1+I5tE9wIlR4WbAnfIqn9Sgf3evlfawuiqxskqGDB3jG+2JNVwW09EDhnb8G96wlPcFdxV6SM08EwvtiX6uCWEN7CqmsN/3bITr82Etx501sMXA0eBOOLPasObgDAcSC4AaAxBDcANIbgBoDGENwA0BiCGwAaQ3ADQGMIbgBoDMENAI0huAGgMQQ3ADSG4AaAxhDcANAYghsAGkNwA0BjCG4AaAzBDQCNIbgBoDEENwA0huAGgMYQ3ADQGIIbABpDcANAYwhuAGgMwQ0AjSG4AaAxBDcANIbgBoDGENwA0BiCGwAaQ3ADQGMIbgBoDMENAI0huAGgMQQ3ADSG4AaAxhDcANAYghsAGkNwA0BjCG4AaAzBDQCNIbgBoDEENwA0huAGgMYQ3ADQGIIbABpDcANAYwhuAGgMwQ0AjSG4AaAxBDcANIbgBoDGENwA0BiCGwAaQ3ADQGMIbgBoDMENAI0huAGgMQQ3ADSG4AaAxhDcANAYghsAGkNwA0BjCG4AaAzBDQBN+aL7E2KwvAG3LK5yAAAAAElFTkSuQmCC" alt="graphic"></p>
<p>从网盘下载jar包</p>
<p>移动到这个lib下</p>
<p><img src="/../img/image-20220210115615285.png" alt="image-20220210115615285"></p>
<p><strong>第四步：测试OK</strong></p>
<h1 id="6-md5加密"><a href="#6-md5加密" class="headerlink" title="6.md5加密"></a>6.md5加密</h1><p><strong>第一步：数据库生成下md5密码</strong></p>
<p>SELECT MD5(‘jiang’);</p>
<p><strong>第二步：修改application.properties配置文件</strong></p>
<p>cas.authn.jdbc.query[0].passwordEncoder.type=DEFAULT</p>
<p>cas.authn.jdbc.query[0].passwordEncoder.characterEncoding=UTF-8</p>
<p>#MD5加密策略</p>
<p>cas.authn.jdbc.query[0].passwordEncoder.encodingAlgorithm=MD5</p>
<p><strong>第三步：测试OK</strong></p>
<h1 id="7-客户端-springboot整合"><a href="#7-客户端-springboot整合" class="headerlink" title="7.客户端+springboot整合"></a>7.客户端+springboot整合</h1><p>pom</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.jasig.cas.client/cas-client-core --&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;org.jasig.cas.client&lt;/groupId&gt;</span><br><span class="line"></span><br><span class="line">  &lt;artifactId&gt;cas-client-core&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">  &lt;version&gt;3.6.1&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>去webapps\cas\WEB-INF\classes\services\HTTPSandIMAPS-10000001</p>
<p>添加http</p>
<p><img src="/../img/image-20220210140934201.png" alt="image-20220210140934201"></p>
<p>在application中添加下两行</p>
<p>cas.tgc.secure=false</p>
<p>cas.serviceRegistry.initFromJson=true</p>
<p><img src="/../img/image-20220210141010649.png" alt="image-20220210141010649"></p>
<h1 id="8-获取用户名"><a href="#8-获取用户名" class="headerlink" title="8.获取用户名"></a>8.获取用户名</h1><p>源码里，session.<em>const_cas_assertion</em>.principal.name</p>
<p><img src="/../img/image-20220210141527789.png" alt="image-20220210141527789"></p>
<h1 id="9-cas服务端初始化页面修改"><a href="#9-cas服务端初始化页面修改" class="headerlink" title="9.cas服务端初始化页面修改"></a>9.cas服务端初始化页面修改</h1><p>前端知识，不看了</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>CAS单点登录</tag>
      </tags>
  </entry>
  <entry>
    <title>docker</title>
    <url>/2021/11/30/docker/</url>
    <content><![CDATA[<p> <a href="........%5CDocker%5C40%E3%80%81%E7%8B%82%E7%A5%9E%E8%AF%B4Docker.pdf">40、狂神说Docker.pdf</a> </p>
<h2 id="4-安装docker"><a href="#4-安装docker" class="headerlink" title="4.安装docker"></a>4.安装docker</h2><p><a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<h3 id="1-卸载原来的版本"><a href="#1-卸载原来的版本" class="headerlink" title="1.卸载原来的版本"></a>1.卸载原来的版本</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<p>设置开机自启</p>
<p>sudo systemctl enable docker</p>
<p>配置阿里云镜像加速</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211018175932703.png" alt="image-20211018175932703"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">依次粘贴运行</span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://llk223hu.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="2-docker安装mysql"><a href="#2-docker安装mysql" class="headerlink" title="2.docker安装mysql"></a>2.docker安装mysql</h3><p>sudo docker pull mysql:5.7</p>
<p>切换root用户</p>
<p>注意\前有空格，-d后台运行</p>
<p>run是启动一个容器，容器与容器互相隔离</p>
<p>-v 前面是虚拟机地址，：后面是容器地址  地址映射</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mysql \</span><br><span class="line">-v /mydata/mysql/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></table></figure>

<p>docker ps 查看运行的容器</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211018190050273.png" alt="image-20211018190050273"></p>
<p>进入容器命令</p>
<p>docker exec -it mysql /bin/bash</p>
<p>查看目录结构</p>
<p>ls -a</p>
<p>查看跟mysql相关的文件在哪</p>
<p>whereis mysql</p>
<p>exit退出容器</p>
<h4 id="mysql配置"><a href="#mysql配置" class="headerlink" title="mysql配置"></a>mysql配置</h4><p>退出容器</p>
<p>cd /mydata/mysql/conf</p>
<p>vi my.cnf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">init_connect=&#x27;SET collation_connection=utf8_unicode_ci&#x27;</span><br><span class="line">init_connect=&#x27;SET NAMES utf8&#x27;</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure>

<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211018191351060.png" alt="image-20211018191351060"></p>
<p>重启mysql</p>
<p>docker restart mysql</p>
<h3 id="3-docker安装redis"><a href="#3-docker安装redis" class="headerlink" title="3.docker安装redis"></a>3.docker安装redis</h3><h4 id="1-下载"><a href="#1-下载" class="headerlink" title="1.下载"></a>1.下载</h4><p>最新redis</p>
<p>docker pull redis</p>
<h4 id="2-创建实例并启动"><a href="#2-创建实例并启动" class="headerlink" title="2.创建实例并启动"></a>2.创建实例并启动</h4><p>mkdir -p /mydata/redis/conf</p>
<p>touch /mydata/redis/conf/redis.conf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -p 6379:6379 --name redis \</span><br><span class="line">-v /mydata/redis/data:/data \</span><br><span class="line">-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">redis-server /etc/redis/redis.conf意思是，redis启动以容器内的/etc/redis/redis.conf这个配置文件启动</span><br></pre></td></tr></table></figure>

<h4 id="3-使用redis镜像执行redis-cli命令连接"><a href="#3-使用redis镜像执行redis-cli命令连接" class="headerlink" title="3.使用redis镜像执行redis-cli命令连接"></a>3.使用redis镜像执行redis-cli命令连接</h4><p>docker exec -it redis redis-cli</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211018192313612.png" alt="image-20211018192313612"></p>
<p>默认redis是在内存中，无法持久化的,需要配置</p>
<p>exit退出redis</p>
<p>cd /mydata/redis/conf</p>
<p>vi redis.conf</p>
<p>i</p>
<p>appendonly yes</p>
<p>esc</p>
<p>:wq</p>
<p>docker restart redis</p>
<h4 id="4-redis-conf可以配置的地方"><a href="#4-redis-conf可以配置的地方" class="headerlink" title="4.redis.conf可以配置的地方"></a>4.redis.conf可以配置的地方</h4><p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211018193024647.png" alt="image-20211018193024647"></p>
<h4 id="5-docker里的容器自启动"><a href="#5-docker里的容器自启动" class="headerlink" title="5.docker里的容器自启动"></a>5.docker里的容器自启动</h4><p>docker update redis –restart=always</p>
<p>docker update mysql –restart=always</p>
<h4 id="6-相关"><a href="#6-相关" class="headerlink" title="6.相关"></a>6.相关</h4><p>linux环境部署的pdf下，使用命令之前都可以</p>
<p>mkdir -p /root/docker/redis/data</p>
<p> mkdir -p /root/docker/redis/conf</p>
<p><img src="/../hexo%E5%8D%9A%E5%AE%A2/blog/source/img/image-20210825180148791.png" alt="image-20210825180148791"></p>
<p>touch redis.conf</p>
<p><em>#bind 127.0.0.1 //允许远程连接</em> </p>
<p>protected-mode no</p>
<p>appendonly yes</p>
<p>docker run -p 6379:6379 –name redis -v /root/docker/redis/data:/data -v /root/docker/redis/conf/redis.conf:/etc/redis/redis.conf -d redis:5 redis-server /etc/redis/redis.conf</p>
<p>docker exec -it redis redis-cli  进入容器</p>
<p><img src="/../hexo%E5%8D%9A%E5%AE%A2/blog/source/img/image-20210825160522906.png" alt="image-20210825160522906"></p>
<p>容器内查看ip</p>
<p>cat /etc/hosts</p>
<p>设置密码</p>
<p><img src="/../hexo%E5%8D%9A%E5%AE%A2/blog/source/img/image-20210825175943607.png" alt="image-20210825175943607"></p>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>git</title>
    <url>/2021/11/30/git/</url>
    <content><![CDATA[<h1 id="GIT"><a href="#GIT" class="headerlink" title="GIT"></a>GIT</h1><p><img src="/../img/image-20211126144703898.png" alt="image-20211126144703898"></p>
<h2 id="版本控制工具"><a href="#版本控制工具" class="headerlink" title="版本控制工具"></a>版本控制工具</h2><h3 id="集中式版本控制"><a href="#集中式版本控制" class="headerlink" title="集中式版本控制"></a>集中式版本控制</h3><p>SVN（subversion）</p>
<img src="https://img2018.cnblogs.com/blog/1460324/201902/1460324-20190218103211790-549550561.png" alt="img" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">集中式代码管理的核心是服务器，所有开发者在开始新一天的工作之前必须从服务器获取代码，然后开发，最后解决冲突，提交。所有的版本信息都放在服务器上。如果脱离了服务器，开发者基本上可以说是无法工作的。下面举例说明：</span><br><span class="line">开始新一天的工作：</span><br><span class="line">1、从服务器下载项目组最新代码。</span><br><span class="line">2、进入自己的分支，进行工作，每隔一个小时向服务器自己的分支提交一次代码（很多人都有这个习惯。因为有时候自己对代码改来改去，最后又想还原到前一个小时的版本，或者看看前一个小时自己修改了哪些代码，就需要这样做了）。</span><br><span class="line">3、下班时间快到了，把自己的分支合并到服务器主分支上，一天的工作完成，并反映给服务器。</span><br><span class="line"></span><br><span class="line">缺点:如果中央服务器故障一小时，那么所有人都无法提交了</span><br></pre></td></tr></table></figure>

<h3 id="分布式版本控制"><a href="#分布式版本控制" class="headerlink" title="分布式版本控制"></a>分布式版本控制</h3><p>git</p>
<p><img src="/../img/image-20211201092810923.png" alt="image-20211201092810923"></p>
<p>每台个人电脑就是一个本地库，在自己电脑做版本控制</p>
<h3 id="就是说svb不能在本地进行版本控制，而git可以"><a href="#就是说svb不能在本地进行版本控制，而git可以" class="headerlink" title="就是说svb不能在本地进行版本控制，而git可以"></a>就是说svb不能在本地进行版本控制，而git可以</h3><h2 id="工作机制"><a href="#工作机制" class="headerlink" title="工作机制"></a>工作机制</h2><p><img src="/../img/image-20211201111651132.png" alt="image-20211201111651132"> </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">工作区：代码存放的磁盘的目录的位置</span><br><span class="line">暂存区：需要让git追踪（知道）有这样一个代码需要进行版本控制，把工作区的代码添加到暂存区</span><br><span class="line">	   临时存储，是可以删掉的（一个命令），还没有生成历史版本</span><br><span class="line">本地库：暂存区，提交本地库，一旦提交了，就会生成对应的历史版本，一旦生成历史版本，代码就删不掉了</span><br><span class="line">	   除非删除代码，重新拉取</span><br></pre></td></tr></table></figure>

<h2 id="托管中心"><a href="#托管中心" class="headerlink" title="托管中心"></a>托管中心</h2><h3 id="局域网"><a href="#局域网" class="headerlink" title="局域网"></a>局域网</h3><p>gitlab</p>
<h3 id="互联网"><a href="#互联网" class="headerlink" title="互联网"></a>互联网</h3><p>github</p>
<p>gitee</p>
<h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><p>file:///D:/git/%E5%B0%9A%E7%A1%85%E8%B0%B7%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E5%88%97%E4%B9%8BGit%20V2.0.pdf</p>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global user.name 用户名 设置用户签名</span><br><span class="line">git config --global user.email 邮箱 设置用户签名</span><br><span class="line">git init 初始化本地库</span><br><span class="line">git status 查看本地库状态</span><br><span class="line">git add 文件名 添加到暂存区</span><br><span class="line">git commit -m &quot;日志信息&quot; 文件名 提交到本地库</span><br><span class="line">git reflog 查看历史记录</span><br><span class="line">git reset --hard 版本号 版本穿梭</span><br></pre></td></tr></table></figure>

<h3 id="设置全局用户签名"><a href="#设置全局用户签名" class="headerlink" title="设置全局用户签名"></a>设置全局用户签名</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;用户名&quot;</span><br><span class="line">git config --global user.email &quot;邮箱&quot;</span><br></pre></td></tr></table></figure>

<p><strong>注意：这里设置用户签名和将来登录 GitHub（或其他代码托管中心）的账号没有任 何关系。仅代表是本地客户端的用户签名</strong></p>
<p>在路径C:\Users\Administrator.gitconfig文件内</p>
<p><img src="/../img/image-20211201133237841.png" alt="image-20211201133237841"></p>
<h3 id="查看全局用户签名"><a href="#查看全局用户签名" class="headerlink" title="查看全局用户签名"></a>查看全局用户签名</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config user.name</span><br><span class="line">git config user.email</span><br></pre></td></tr></table></figure>

<h3 id="这只局部用户签名"><a href="#这只局部用户签名" class="headerlink" title="这只局部用户签名"></a>这只局部用户签名</h3><p>如果你的公司邮箱，github，gitee邮箱都不一致，需要拉取项目后，使用命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config  user.name &quot;用户名&quot;</span><br><span class="line">git config  user.email &quot;邮箱&quot;</span><br></pre></td></tr></table></figure>

<p>设置成注册github或者gitee时的邮箱</p>
<h2 id="初始化本地库"><a href="#初始化本地库" class="headerlink" title="初始化本地库"></a>初始化本地库</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<p>告诉git，获取这个目录的管理权</p>
<h2 id="查看本地库状态"><a href="#查看本地库状态" class="headerlink" title="查看本地库状态"></a>查看本地库状态</h2><p>git status</p>
<p><img src="/../img/image-20211201134228268.png" alt="image-20211201134228268"></p>
<p>第一行：在master分支</p>
<p>第二行：没有提交过任何</p>
<p>第三行：没有任何可以提交，暂存区为空</p>
<h4 id="新建hello-txt文件再次"><a href="#新建hello-txt文件再次" class="headerlink" title="新建hello.txt文件再次"></a>新建hello.txt文件再次</h4><p>gitstatus</p>
<p><img src="/../img/image-20211201134906698.png" alt="image-20211201134906698"></p>
<p>第三行：发现一个未被追踪（add）的文件，存在于工作区，使用git add追踪</p>
<h2 id="添加暂存区"><a href="#添加暂存区" class="headerlink" title="添加暂存区"></a>添加暂存区</h2><p>git add 文件名</p>
<p><img src="/../img/image-20211201135957361.png" alt="image-20211201135957361"></p>
<p>这个警告是转换了行末换行符</p>
<p>用LF（linux） 替换 CRLF（windows）</p>
<h3 id="再一次git-status"><a href="#再一次git-status" class="headerlink" title="再一次git status"></a>再一次git status</h3><p><img src="/../img/image-20211201140152942.png" alt="image-20211201140152942"></p>
<p>git追踪到了这个hello.txt文件，目前在暂存区里</p>
<h3 id="如果想删除暂存区里的hello-txt文件"><a href="#如果想删除暂存区里的hello-txt文件" class="headerlink" title="如果想删除暂存区里的hello.txt文件"></a>如果想删除暂存区里的hello.txt文件</h3><p>git rm –cached hello.txt</p>
<p><img src="/../img/image-20211201140332382.png" alt="image-20211201140332382"></p>
<p>仅删除暂存区，工作区（磁盘上的没有删除）</p>
<h2 id="提交本地库"><a href="#提交本地库" class="headerlink" title="提交本地库"></a>提交本地库</h2><p>git commit -m “日志信息” 文件名</p>
<p><img src="/../img/image-20211201140632161.png" alt="image-20211201140632161"></p>
<h3 id="再一次查看状态"><a href="#再一次查看状态" class="headerlink" title="再一次查看状态"></a>再一次查看状态</h3><p>git status</p>
<p><img src="/../img/image-20211201140644875.png" alt="image-20211201140644875"></p>
<h2 id="查看版本信息"><a href="#查看版本信息" class="headerlink" title="查看版本信息"></a>查看版本信息</h2><p>git reflog</p>
<p><img src="/../img/image-20211201140813139.png" alt="image-20211201140813139"></p>
<p>git log更详细</p>
<p><img src="/../img/image-20211201140834667.png" alt="image-20211201140834667"></p>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p>修改了hello.txt</p>
<p>再次git status</p>
<p><img src="/../img/image-20211201141219010.png" alt="image-20211201141219010"></p>
<p>这时需要再次追踪一下</p>
<p>git add hello.txt</p>
<p>在提交</p>
<p>git commit -m “second commit” hello.txt</p>
<h3 id="再次查看版本信息"><a href="#再次查看版本信息" class="headerlink" title="再次查看版本信息"></a>再次查看版本信息</h3><p>git reflog </p>
<p><img src="/../img/image-20211201141611951.png" alt="image-20211201141611951"></p>
<p>发现有两个版本，并且head指针指向第二个版本</p>
<h2 id="版本穿梭"><a href="#版本穿梭" class="headerlink" title="版本穿梭"></a>版本穿梭</h2><p>git reset –hard 版本号   不保存工作区内容</p>
<p><img src="/../img/image-20211201144449686.png" alt="image-20211201144449686"></p>
<p>穿越回第一次提交的版本</p>
<p>查看hello.txt发现第一行没有1234</p>
<h3 id="再次git-reflog"><a href="#再次git-reflog" class="headerlink" title="再次git reflog"></a>再次git reflog</h3><p><img src="/../img/image-20211201144538596.png" alt="image-20211201144538596"></p>
<p>发现指针指向了第一次提交的版本（第三行）</p>
<p>而第一行是日志，意思是指针指向了哪个版本号</p>
<h3 id="版本穿梭其他命令"><a href="#版本穿梭其他命令" class="headerlink" title="版本穿梭其他命令"></a>版本穿梭其他命令</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//仅仅只是撤销已提交的版本库和暂存区，不会修改工作区</span><br><span class="line">git reset --mixed 版本库ID</span><br><span class="line">//彻底将工作区、暂存区和版本库记录恢复到指定的版本库</span><br><span class="line">git reset --hard 版本库ID</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）如果你是在提交了后，对工作区的代码做了修改，并且想保留这些修改，那么可以使用git reset --mixed 版本库ID，注意这个版本库ID应该不是你刚刚提交的版本库ID，而是刚刚提交版本库的上一个版本库。</span><br><span class="line"></span><br><span class="line">（2）如果不想保留这些修改，可以直接使用彻底的恢复命令，git reset --hard 版本库ID</span><br></pre></td></tr></table></figure>



<h1 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git branch 分支名 创建分支</span><br><span class="line">git branch -v 查看分支</span><br><span class="line">git checkout 分支名 切换分支</span><br><span class="line">git merge 分支名 把指定的分支合并到当前分支上</span><br></pre></td></tr></table></figure>

<h2 id="查看分支"><a href="#查看分支" class="headerlink" title="查看分支"></a>查看分支</h2><p>git branch -v</p>
<h2 id="创建分支"><a href="#创建分支" class="headerlink" title="创建分支"></a>创建分支</h2><p>git branch 分支名</p>
<h2 id="切换分支"><a href="#切换分支" class="headerlink" title="切换分支"></a>切换分支</h2><p>git checkout 分支名</p>
<h2 id="合并分支"><a href="#合并分支" class="headerlink" title="合并分支"></a>合并分支</h2><p>git merge 分支名</p>
<p>把指定分支合并到当前分支</p>
<h3 id="正常合并"><a href="#正常合并" class="headerlink" title="正常合并"></a>正常合并</h3><p>master分支</p>
<p><img src="/../img/image-20211201151626602.png" alt="image-20211201151626602"></p>
<p>新建了一个a分支，内容没变之前也为</p>
<p><img src="/../img/image-20211201151644224.png" alt="image-20211201151644224"></p>
<p>现在a分支改变内容为</p>
<p><img src="/../img/image-20211201151739563.png" alt="image-20211201151739563"></p>
<p>add，commit以后</p>
<p><img src="/../img/image-20211201151852805.png" alt="image-20211201151852805"></p>
<p>合并，注意要站在master合并a，就要先去master，发现可以合并</p>
<p>因为master分支没有改动，只改动了a分支是没问题的</p>
<p><img src="/../img/image-20211201151944461.png" alt="image-20211201151944461"></p>
<h3 id="异常合并"><a href="#异常合并" class="headerlink" title="异常合并"></a>异常合并</h3><p>两个分支在同一个文件的同一个位置有两套完全不同的修改</p>
<p>就需要a改动，master分支也改动了，此时有异常</p>
<p>现在改动master内容</p>
<p><img src="/../img/image-20211201152218626.png" alt="image-20211201152218626"></p>
<p>add，commit以后，切换a分支</p>
<p><img src="/../img/image-20211201152549163.png" alt="image-20211201152549163"></p>
<p>add，commit以后，切换master分支</p>
<p>自动合并失败了，在hello.txt里有冲突</p>
<p><img src="/../img/image-20211201152710721.png" alt="image-20211201152710721"></p>
<p><img src="/../img/image-20211201152925624.png" alt="image-20211201152925624"></p>
<p>&lt;&lt;&lt;和==之间是当前分支的代码</p>
<p>&gt;&gt;&gt;和==之前是要合并的代码</p>
<p>就要手动删除不要的代码和符号</p>
<p><img src="/../img/image-20211201153303861.png" alt="image-20211201153303861"></p>
<p>删除以后，还要add，commit（不能带文件名了）</p>
<p><img src="/../img/image-20211201153243165.png" alt="image-20211201153243165"></p>
<p>在查看文件，发现合并成功了</p>
<p><img src="/../img/image-20211201153317524.png" alt="image-20211201153317524"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.开发代码时，先pull拉取，开发完代码，commit了以后，在拉取一次，看有无冲突，没有冲突在push提交</span><br><span class="line">2.push页面的就是最后版本的版本代码，以及之前的版本日志信息</span><br></pre></td></tr></table></figure>

<h1 id="Idea"><a href="#Idea" class="headerlink" title="Idea"></a>Idea</h1><h2 id="撤销指定commit"><a href="#撤销指定commit" class="headerlink" title="撤销指定commit"></a>撤销指定commit</h2><p><img src="/../img/image-20211015110906139.png" alt="image-20211015110906139"></p>
<p><img src="/../img/image-20211015110919733.png" alt="image-20211015110919733"></p>
<p>可以看到本地commit里有一个a</p>
<p>在version control里找到log，找到刚才提交的a的上一个</p>
<p><img src="/../img/image-20211015111009766.png" alt="image-20211015111009766"></p>
<p><img src="/../img/image-20211015111700760.png" alt="image-20211015111700760"></p>
<p>右键a下一个11111可以看到版本号，第一个copy版本号</p>
<p><img src="/../img/image-20211015111801700.png" alt="image-20211015111801700"></p>
<p><img src="/../img/image-20211015111040231.png" alt="image-20211015111040231"></p>
<p>找到terminal控制台</p>
<p>输入git reset 版本号</p>
<p><img src="/../img/image-20211015111814112.png" alt="image-20211015111814112"></p>
<p>出现表示成功撤销commit</p>
<p><img src="/../img/image-20211015111912140.png" alt="image-20211015111912140"></p>
<p>此时push里发现commit为空</p>
<p><img src="/../img/image-20211015111931107.png" alt="image-20211015111931107"></p>
<h2 id="git回滚版本（使用第二个）"><a href="#git回滚版本（使用第二个）" class="headerlink" title="git回滚版本（使用第二个）"></a>git回滚版本（使用第二个）</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">第一步：点击项目右键git-&gt;Show Histroy -&gt;选择需要回滚的版本，右键Copy Revision Number</span><br><span class="line">第二步：方法一：</span><br><span class="line">之后在TerMinal上输入命令git reset --hard XXXXX</span><br><span class="line">git push -f -u origin master.</span><br><span class="line">方法二：a.右击项目依次选中：git-&gt;Repository-&gt;Reset HEAD</span><br><span class="line">b. 选中Reset Type:Mixed, To Commit:08d537b4fdc74f880f572e948df9a1e87e2ea41f；然后点击Reset按钮</span><br><span class="line"></span><br><span class="line">方法一是会把回滚版本之后的全部抹杀掉，而方法二会重新设置一个版本号，不会把回滚版本之后的版本删除掉。</span><br><span class="line">团队合作的回滚版本最好是使用第二种方法</span><br></pre></td></tr></table></figure>



<p>回滚以后消失的commit版本，在回滚之前复制版本号，可以用同样方法回滚回来</p>
<h2 id="回滚版本与版本穿梭的区别"><a href="#回滚版本与版本穿梭的区别" class="headerlink" title="回滚版本与版本穿梭的区别"></a>回滚版本与版本穿梭的区别</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">版本穿梭，你没有commit的代码都会消失</span><br><span class="line"></span><br><span class="line">回滚版本，代码不会消失，可以重新commit</span><br></pre></td></tr></table></figure>



<h2 id="添加忽略自动add的文件"><a href="#添加忽略自动add的文件" class="headerlink" title="添加忽略自动add的文件"></a>添加忽略自动add的文件</h2><h3 id="第一种方法"><a href="#第一种方法" class="headerlink" title="第一种方法"></a>第一种方法</h3><p>setting==》editor==》file types</p>
<p><img src="/../img/image-20211201162537280.png" alt="image-20211201162537280"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*.hprof;*.iml;*.pyc;*.pyo;*.rbc;*.yarb;*~;.DS_Store;.git;.hg;.idea;.svn;CVS;__pycache__;_svn;data;logs;transaction-logs;vssver.scc;vssver2.scc;</span><br></pre></td></tr></table></figure>

<p>这里idea会不显示这些文件，并且git不会自动add</p>
<h3 id="第二种（第一种第二种可以一起来）"><a href="#第二种（第一种第二种可以一起来）" class="headerlink" title="第二种（第一种第二种可以一起来）"></a>第二种（第一种第二种可以一起来）</h3><p>new 一个忽略文件</p>
<p><img src="/../img/image-20211201163051769.png" alt="image-20211201163051769"></p>
<p>选择java模板</p>
<p><img src="/../img/image-20211201163152562.png" alt="image-20211201163152562"></p>
<p>点击add</p>
<p><img src="/../img/image-20211201163209937.png" alt="image-20211201163209937"></p>
<p>取消忽略文件的add</p>
<p><img src="/../img/image-20211201162851800.png" alt="image-20211201162851800"></p>
<p>想忽略什么可以自己添加</p>
<p><img src="/../img/image-20211201163442740.png" alt="image-20211201163442740"></p>
<h2 id="取消其他文件的add"><a href="#取消其他文件的add" class="headerlink" title="取消其他文件的add"></a>取消其他文件的add</h2><p>同取消忽略文件的add</p>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>excel操作</title>
    <url>/2021/11/30/excel%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="1-根据一定规则，截取前一列，生成新列"><a href="#1-根据一定规则，截取前一列，生成新列" class="headerlink" title="1.根据一定规则，截取前一列，生成新列"></a>1.根据一定规则，截取前一列，生成新列</h1><p>比如I列如下，J列想要I列额汉字，ctrl+c复制杭宁到J2行，在ctrl+E即可</p>
<p><img src="/../img/image-20211130212335916.png" alt="image-20211130212335916"></p>
<h1 id="2-筛选"><a href="#2-筛选" class="headerlink" title="2.筛选"></a>2.筛选</h1><p><img src="/../img/image-20211130212345388.png" alt="image-20211130212345388"></p>
<h1 id="3-去重复"><a href="#3-去重复" class="headerlink" title="3.去重复"></a>3.去重复</h1><p>把要去重的列单独复制到新sheet，点击第一行，然后去重</p>
<p><img src="/../img/image-20211130212354849.png" alt="image-20211130212354849"></p>
<h1 id="4-快速复制"><a href="#4-快速复制" class="headerlink" title="4.快速复制"></a>4.快速复制</h1><p><img src="/../img/image-20211130212400995.png" alt="image-20211130212400995"></p>
<p>复制两个竖格一样的，选中两格在下面格子双击右下角</p>
<h1 id="5-复制or序列递增"><a href="#5-复制or序列递增" class="headerlink" title="5.复制or序列递增"></a>5.复制or序列递增</h1><p>序列方式（0,1,2,3这样自动增加），也可以直接复制</p>
<p>双击右下角</p>
<p><img src="/../img/image-20211130212407585.png" alt="image-20211130212407585"></p>
<p>选择填充方式</p>
<p><img src="/../img/image-20211130212416233.png" alt="image-20211130212416233"></p>
<h1 id="6-粘贴内容转置"><a href="#6-粘贴内容转置" class="headerlink" title="6.粘贴内容转置"></a>6.粘贴内容转置</h1><p>先复制，右键选择性粘贴，粘贴内容转置</p>
<p><img src="/../img/image-20211130212420340.png" alt="image-20211130212420340"></p>
<p><img src="/../img/image-20211130212426558.png" alt="image-20211130212426558"></p>
<h1 id="7-清空内容"><a href="#7-清空内容" class="headerlink" title="7.清空内容"></a>7.清空内容</h1><p>右键清除内容</p>
<p><img src="/../img/image-20211130212439038.png" alt="image-20211130212439038"></p>
<h1 id="8-删除指定空行"><a href="#8-删除指定空行" class="headerlink" title="8.删除指定空行"></a>8.删除指定空行</h1><p>选中区域，ctrl+g，选择空值-定位，右键删除即可</p>
]]></content>
      <categories>
        <category>excel</category>
      </categories>
      <tags>
        <tag>excel</tag>
      </tags>
  </entry>
  <entry>
    <title>jmeter压力测试</title>
    <url>/2021/11/30/jmeter%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<p><a href="https://blog.csdn.net/lovesoo/article/details/78579547?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164151729616780274166864%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164151729616780274166864&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-78579547.first_rank_v2_pc_rank_v29&amp;utm_term=jmeter%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%AD%A5%E9%AA%A4&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/lovesoo/article/details/78579547?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164151729616780274166864%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164151729616780274166864&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-78579547.first_rank_v2_pc_rank_v29&amp;utm_term=jmeter%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%AD%A5%E9%AA%A4&amp;spm=1018.2226.3001.4187</a></p>
<h1 id="文件上传压力测试"><a href="#文件上传压力测试" class="headerlink" title="文件上传压力测试"></a>文件上传压力测试</h1><h2 id="常用的列表"><a href="#常用的列表" class="headerlink" title="常用的列表"></a>常用的列表</h2><p><img src="/../img/image-20220107143209751.png" alt="image-20220107143209751"></p>
<h3 id="1-线程组"><a href="#1-线程组" class="headerlink" title="1.线程组"></a>1.线程组</h3><p><img src="/../img/image-20220107143334909.png" alt="image-20220107143334909"></p>
<h3 id="2-http请求"><a href="#2-http请求" class="headerlink" title="2.http请求"></a>2.http请求</h3><p><img src="/../img/image-20220107143426613.png" alt="image-20220107143426613"></p>
<h3 id="3-请求头"><a href="#3-请求头" class="headerlink" title="3.请求头"></a>3.请求头</h3><p>正常来说还有一个Content-Type：multipart/form-data</p>
<p><img src="/../img/image-20220107143502682.png" alt="image-20220107143502682"></p>
<p>但是这里不能添加，添加了以后解析错误</p>
<h3 id="4-结果数和聚合报告"><a href="#4-结果数和聚合报告" class="headerlink" title="4.结果数和聚合报告"></a>4.结果数和聚合报告</h3><p><img src="/../img/image-20220107143608991.png" alt="image-20220107143608991"></p>
<h3 id="5-CSV文件"><a href="#5-CSV文件" class="headerlink" title="5.CSV文件"></a>5.CSV文件</h3><p><img src="/../img/image-20220107143657501.png" alt="image-20220107143657501"></p>
<p><img src="/../img/image-20220107143720365.png" alt="image-20220107143720365"></p>
<p><img src="/../img/image-20220107143747750.png" alt="image-20220107143747750"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>jmeter压力测试</tag>
      </tags>
  </entry>
  <entry>
    <title>linux命令</title>
    <url>/2021/11/30/linux%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>Linux相关命令的总结，包括网络、操作系统、文件、脚本、环境配置</p>
<p><a href="https://blog.csdn.net/weixin_44895651/article/details/105289038?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163832130116780264075127%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163832130116780264075127&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-105289038.first_rank_v2_pc_rank_v29&amp;utm_term=linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/weixin_44895651/article/details/105289038?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163832130116780264075127%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163832130116780264075127&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-105289038.first_rank_v2_pc_rank_v29&amp;utm_term=linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8&amp;spm=1018.2226.3001.4187</a></p>
<h1 id="网络相关"><a href="#网络相关" class="headerlink" title="网络相关"></a>网络相关</h1><ul>
<li>虚拟机网络配置模板</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 编辑正在使用的网卡，可以先进入到network-scripts目录下查看，ifconfig先看正在使用哪个网卡</span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line"># 文件模板</span><br><span class="line">TYPE=&quot;Ethernet&quot; # 不变</span><br><span class="line">BOOTPROTO=&quot;static&quot; # 静态的不用改</span><br><span class="line">NAME=&quot;ens33&quot; # 和文件名严格一致</span><br><span class="line">DEVICE=&quot;ens33&quot; # 和文件名严格一致</span><br><span class="line">ONBOOT=&quot;yes&quot; # 不用动</span><br><span class="line">IPADDR=&quot;192.168.25.160&quot; # 改成需要的ip，注意网段</span><br><span class="line">GATEWAY=&quot;192.168.25.2&quot; # 网关，可以先查下网关</span><br><span class="line">NETMASK=&quot;255.255.255.0&quot; # 不用动</span><br><span class="line">DNS1=&quot;114.114.114.114&quot; # dns自己配置能用的</span><br></pre></td></tr></table></figure>

<ul>
<li>查询正在使用的网关</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# ip route show</span><br><span class="line">default via 192.168.25.2 dev ens33 proto static metric 100</span><br><span class="line">192.168.25.0/24 dev ens33 proto kernel scope link src 192.168.25.160 metric 100</span><br><span class="line"></span><br><span class="line"># 很明确的可以看到网关用的是192.168.25.2</span><br></pre></td></tr></table></figure>

<ul>
<li>重启网络</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>

<ul>
<li>如果遇到主机无法解析问题，直接重启网络，因为可能是dns解析出问题了，重启刷新下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 一定要先重启NetworkManager，再重启network</span><br><span class="line"># NetworkManager服务是一个网络管理的守护线程</span><br><span class="line">systemctl restart  NetworkManager</span><br><span class="line">or</span><br><span class="line">解决方式：禁用NetworkManager</span><br><span class="line"></span><br><span class="line">1. systemctl stop NetworkManager</span><br><span class="line"></span><br><span class="line">2. systemctl disable NetworkManager</span><br><span class="line"></span><br><span class="line">最终</span><br><span class="line">systemctl restart  network</span><br></pre></td></tr></table></figure>

<h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">如果没有防火墙命令</span><br><span class="line">yum install firewalld</span><br><span class="line"># 开启防火墙</span><br><span class="line">systemctl start firewalld.service</span><br><span class="line"># 防火墙开机启动</span><br><span class="line">systemctl enable firewalld.service</span><br><span class="line">查看防火墙状态：systemctl status firewalld.service </span><br><span class="line">关闭防火墙：systemctl stop firewalld.service </span><br><span class="line">永久关闭：systemctl disable firewalld.service</span><br><span class="line">查看开启的端口</span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="开启指定端口"><a href="#开启指定端口" class="headerlink" title="开启指定端口"></a>开启指定端口</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">先开启防火墙：systemctl start firewalld.service</span><br><span class="line"></span><br><span class="line">再开放8080端口：firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">再开放22端口：firewall-cmd --zone=public --add-port=22/tcp --permanent</span><br><span class="line">			</span><br><span class="line">最后刷新配置：systemctl reload firewalld</span><br></pre></td></tr></table></figure>

<h4 id="添加单个单端口"><a href="#添加单个单端口" class="headerlink" title="添加单个单端口"></a>添加单个单端口</h4><p>firewall-cmd –permanent –zone=public –add-port=81/tcp</p>
<h4 id="添加多个端口"><a href="#添加多个端口" class="headerlink" title="添加多个端口"></a>添加多个端口</h4><p>firewall-cmd –permanent –zone=public –add-port=8080-8083/tcp</p>
<h4 id="删除某个端口"><a href="#删除某个端口" class="headerlink" title="删除某个端口"></a>删除某个端口</h4><p>firewall-cmd –permanent –zone=public –remove-port=81/tcp</p>
<h3 id="关闭指定进程号"><a href="#关闭指定进程号" class="headerlink" title="关闭指定进程号"></a>关闭指定进程号</h3><p>kill -9 进程号PID</p>
<h3 id="查看端口有没有被占用"><a href="#查看端口有没有被占用" class="headerlink" title="查看端口有没有被占用"></a>查看端口有没有被占用</h3><p>netstat -tunlp|grep 端口号，有的话kill掉，或者改用其他端口</p>
<p>netstat -lnp | grep 端口号</p>
<p>netstat -anp | grep :端口号   也可以，注意有冒号</p>
<h3 id="执行jar包，通用脚本文件"><a href="#执行jar包，通用脚本文件" class="headerlink" title="执行jar包，通用脚本文件"></a>执行jar包，通用脚本文件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">jar_pid=`ps -ef|grep -v grep | grep &#x27;example.jar&#x27;|awk &#x27;&#123; print $2 &#125;&#x27;`</span><br><span class="line">echo $jar_pid</span><br><span class="line">if [ ! -n &quot;$jar_pid&quot; ]; then</span><br><span class="line">echo &#x27;will redploy.&#x27;</span><br><span class="line"></span><br><span class="line">rm -rf nohup.out</span><br><span class="line">nohup java -Xms512m -Xmx2048m -Dspring.profiles.active=pro -jar example.jar &amp;</span><br><span class="line">echo &#x27;redploy success0.&#x27;</span><br><span class="line">else</span><br><span class="line">kill -9 $jar_pid</span><br><span class="line">echo &#x27;kill&#x27; $jar_pid</span><br><span class="line"></span><br><span class="line">rm -rf nohup.out</span><br><span class="line">nohup java -Xms512m -Xmx2048m -Dspring.profiles.active=pro -jar example.jar &amp;</span><br><span class="line">echo &#x27;redploy success1.&#x27;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h1 id="vim中命令"><a href="#vim中命令" class="headerlink" title="vim中命令"></a>vim中命令</h1><h2 id="复制粘贴"><a href="#复制粘贴" class="headerlink" title="复制粘贴"></a>复制粘贴</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">esc之后</span><br><span class="line">光标到要复制的行</span><br><span class="line">yy复制一行</span><br><span class="line">p粘贴1行</span><br><span class="line">5p粘贴5行</span><br></pre></td></tr></table></figure>

<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>dd删除一行</p>
<h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h2><p>/super  或者  ？super，  两者的区别是前者是从上往下搜索，后者是从下往上搜索。</p>
<p>通过 n  或  N 进行上一个或下一个的匹配</p>
<p>:nohl  取消高亮</p>
<h2 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h2><p>:%s/a/b/g 对所有行的内容进行替换,a替换为b。</p>
<h2 id="放弃修改"><a href="#放弃修改" class="headerlink" title="放弃修改"></a>放弃修改</h2><p>:e! -放弃所有修改，从上次保存文件开始再编辑</p>
<h2 id="回退"><a href="#回退" class="headerlink" title="回退"></a>回退</h2><p>u  撤销上一步的操作<br>Ctrl+r 恢复上一步被撤销的操作</p>
<h2 id="跳转到最后一行"><a href="#跳转到最后一行" class="headerlink" title="跳转到最后一行"></a>跳转到最后一行</h2><p>shift+g</p>
<h3 id="跳到行首"><a href="#跳到行首" class="headerlink" title="跳到行首"></a>跳到行首</h3><p>home</p>
<h3 id="跳到行尾"><a href="#跳到行尾" class="headerlink" title="跳到行尾"></a>跳到行尾</h3><p>end</p>
<h2 id="跳到下一行并插入"><a href="#跳到下一行并插入" class="headerlink" title="跳到下一行并插入"></a>跳到下一行并插入</h2><p>o</p>
<h1 id="重命名"><a href="#重命名" class="headerlink" title="重命名"></a>重命名</h1><p>把a移动到/home下并重名为b</p>
<p>mv a  /home/b </p>
<h1 id="创建和删除操作"><a href="#创建和删除操作" class="headerlink" title="创建和删除操作"></a>创建和删除操作</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch</span><br><span class="line">创建文件</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir</span><br><span class="line">创建一个新的目录</span><br><span class="line">-p	可以递归创建目录</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rm</span><br><span class="line">删除文件或目录</span><br><span class="line">使用 rm 命令要小心，因为文件删除后不能恢复</span><br><span class="line">-f	强制删除，忽略不存在的文件，无需提示</span><br><span class="line">-r	递归地删除目录下的内容，删除文件夹 时必须加此参数</span><br><span class="line"></span><br><span class="line">删除以a开头的所有文件</span><br><span class="line">rm -rf a*</span><br><span class="line"></span><br><span class="line">如果报错</span><br><span class="line">-bash: /usr/bin/rm: 参数列表过长</span><br><span class="line"></span><br><span class="line">1、rm * -rf 改为:</span><br><span class="line">find . -name &quot;*&quot; | xargs rm -rf &#x27;*&#x27; 就行了。</span><br><span class="line"></span><br><span class="line">2、rm test* -rf 改为:</span><br><span class="line">find . -name &quot;test*&quot; | xargs rm -rf &quot;test*&quot;</span><br></pre></td></tr></table></figure>

<h1 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h1><p>cp </p>
<p>-r  若给出的源文件是目录文件，则 cp 将递归复制该目录下的所有子目录和文件</p>
<h1 id="从u盘复制文件到linux中"><a href="#从u盘复制文件到linux中" class="headerlink" title="从u盘复制文件到linux中"></a>从u盘复制文件到linux中</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.插入U盘到计算机USB接口，这时候U盘的硬件名称为：sda1(不一定)</span><br><span class="line">2.在mnt目录下先建立一个usb的目录</span><br><span class="line">mkdir /mnt/usb</span><br><span class="line">3.挂载U盘，其中sda1是硬件名称</span><br><span class="line">mount -t vfat /dev/sda1 /mnt/usb</span><br><span class="line">4.复制文件到指定文件下</span><br><span class="line">cp -r ?? /opt/</span><br></pre></td></tr></table></figure>



<h1 id="查看服务对应的进程号"><a href="#查看服务对应的进程号" class="headerlink" title="查看服务对应的进程号"></a>查看服务对应的进程号</h1><p> ps -ef|grep redis</p>
<p>得到了进程号 xxxx</p>
<h2 id="查看文件位置"><a href="#查看文件位置" class="headerlink" title="查看文件位置"></a>查看文件位置</h2><p> 然后 ls -l /proc/xxxx/cwd</p>
<h1 id="修改主机名称"><a href="#修改主机名称" class="headerlink" title="修改主机名称"></a>修改主机名称</h1><h1 id="为sh文件增加可执行权限"><a href="#为sh文件增加可执行权限" class="headerlink" title="为sh文件增加可执行权限"></a>为sh文件增加可执行权限</h1><p>到sh所在的目录</p>
<p>chmod +x *.sh </p>
<p>chmod +x ./你的程序</p>
<p>或把所有权限都加上：<br>chmod +777 ./你的程序</p>
<h1 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h1><p>-C 解压到指定目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar xvfz nacos-server-2.0.1.tar.gz  -C  /opt/</span><br></pre></td></tr></table></figure>

<h1 id="查找文件命令"><a href="#查找文件命令" class="headerlink" title="查找文件命令"></a>查找文件命令</h1><p>find / -name “redis-trib.rb”</p>
<h1 id="配置任何环境变量"><a href="#配置任何环境变量" class="headerlink" title="配置任何环境变量"></a>配置任何环境变量</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line">#KAFKA_HOME</span><br><span class="line">export KAFKA_HOME=/opt/kafka/kafka_2.12-0.10.2.1</span><br><span class="line">export PATH=$PATH:$KAFKA_HOME/bin</span><br><span class="line"></span><br><span class="line">#JAVA_HOME</span><br><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_131</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line">#配置ZOOKEEPER环境变量</span><br><span class="line">export ZOOKEEPER_HOME=/opt/zookeeper/zookeeper-3.4.9</span><br><span class="line">export PATH=$PATH:$ZOOKEEPER_HOME/bin</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h1 id="查看分区"><a href="#查看分区" class="headerlink" title="查看分区"></a>查看分区</h1><p>fdisk -l</p>
<h2 id="查看分区使用情况"><a href="#查看分区使用情况" class="headerlink" title="查看分区使用情况"></a>查看分区使用情况</h2><p>df -lh</p>
<h1 id="yum指定安装位置"><a href="#yum指定安装位置" class="headerlink" title="yum指定安装位置"></a>yum指定安装位置</h1><p>yum -c /etc/yum.conf –installroot=/usr/local –releasever=/  install love<br>该命令简单解释如下：</p>
<p>-c /etc/yum.conf                  表示指定yum配置文件地址</p>
<p>–installroot=/usr/local        表示指定自定义的安装目录</p>
<h2 id="需要签名"><a href="#需要签名" class="headerlink" title="需要签名"></a>需要签名</h2><p>后面加上  –nogpgcheck</p>
<p>查看纽扣</p>
<h1 id="运行jar包sh文件"><a href="#运行jar包sh文件" class="headerlink" title="运行jar包sh文件"></a>运行jar包sh文件</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">jar_pid=`ps -ef|grep -v grep | grep &#x27;你的jar包.jar&#x27;|awk &#x27;&#123; print $2 &#125;&#x27;`</span><br><span class="line">echo $jar_pid</span><br><span class="line">if [ ! -n &quot;$jar_pid&quot; ]; then</span><br><span class="line">echo &#x27;will redploy.&#x27;</span><br><span class="line"></span><br><span class="line">rm -rf nohup.out</span><br><span class="line">nohup java -Xms512m -Xmx2048m -Dspring.profiles.active=dev -jar 你的jar包.jar &amp;</span><br><span class="line">echo &#x27;redploy success0.&#x27;</span><br><span class="line">else</span><br><span class="line">kill -9 $jar_pid</span><br><span class="line">echo &#x27;kill&#x27; $jar_pid</span><br><span class="line"></span><br><span class="line">rm -rf nohup.out</span><br><span class="line">nohup java -Xms512m -Xmx2048m -Dspring.profiles.active=dev -jar 你的jar包.jar &amp;</span><br><span class="line">echo &#x27;redploy success1.&#x27;</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输出500行</p>
<p>tail -f 500 nohup.out</p>
<h1 id="Linux-下通过-java-命令启动-jar-包的几种常见方式"><a href="#Linux-下通过-java-命令启动-jar-包的几种常见方式" class="headerlink" title="Linux 下通过 java 命令启动 jar 包的几种常见方式"></a><a href="https://so.csdn.net/so/search?from=pc_blog_highlight&q=Linux">Linux</a> 下通过 java 命令启动 jar 包的几种常见方式</h1><h2 id="方法一：直接启动-jar-包"><a href="#方法一：直接启动-jar-包" class="headerlink" title="方法一：直接启动 jar 包"></a><strong>方法一：直接启动 jar 包</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -jar XXX.jar</span><br><span class="line">当前ssh窗口会被锁定，不能再操作其他命令，如果需要执行其他命令，则需要打断进程，可按CTRL + C打断程序运行，或直接关闭窗口，程序也会退出。</span><br></pre></td></tr></table></figure>

<h2 id="方法二：后台启动-jar-包"><a href="#方法二：后台启动-jar-包" class="headerlink" title="方法二：后台启动 jar 包"></a><strong>方法二：后台启动 jar 包</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -jar XXX.jar &amp;</span><br><span class="line">当前ssh窗口不被锁定，但是当窗口关闭时，程序中止运行。</span><br></pre></td></tr></table></figure>

<h2 id="方法三：后台不挂断启动"><a href="#方法三：后台不挂断启动" class="headerlink" title="方法三：后台不挂断启动"></a>方法三：后台不挂断启动</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nohup java -jar XXX.jar &amp;</span><br></pre></td></tr></table></figure>

<p>用 nohub 命令启动 jar 包，是在后台不挂断运行，关闭终端窗口或者 CTRL + C 命令也不会终止程序。<br>当用 nohub命令启动 jar 包的时候，如果不指定日志输出文件，则所有的输出都会被重定向到 nohup.out 的文件中。</p>
<h2 id="方式四：指定日志输出的启动"><a href="#方式四：指定日志输出的启动" class="headerlink" title="方式四：指定日志输出的启动"></a>方式四：指定日志输出的启动</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nohup java -jar XXX.jar &gt;log.out &amp;</span><br></pre></td></tr></table></figure>


<p>通过 &gt;log.out 命令，将程序的日志输出重定向到 log.out 文件中。如果不指定日志输出文件，则会输出到 nohup 命令默认的输出文件，nohup.out 文件中。</p>
<h2 id="方式五：指定配置文件启动"><a href="#方式五：指定配置文件启动" class="headerlink" title="方式五：指定配置文件启动"></a><strong>方式五：指定配置文件启动</strong></h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nohup java -jar XXX.jar --spring.profiles.active=pro &gt;log.out &amp;</span><br></pre></td></tr></table></figure>

<p>通过 –spring profiles.active=pro 来指定，启动的的是application-pro.yml 或者 application-pro.properties 配置文件。</p>
<h2 id="方式六：指定配置文件，使用系统默认的log配置，不另行指定日志输入"><a href="#方式六：指定配置文件，使用系统默认的log配置，不另行指定日志输入" class="headerlink" title="方式六：指定配置文件，使用系统默认的log配置，不另行指定日志输入"></a>方式六：指定配置文件，使用系统默认的log配置，不另行指定日志输入</h2><p>启动/opt/a/目录下的 test.jar ,配置文件使用 pro，日志使用配置文件默认配置，不单独指定。</p>
<p>nohup java -jar /opt/a/a.jar –spring.profiles.active=pro &gt;/dev/null 2&gt;&amp;1 &amp;</p>
<p>常见的文件描述符有如下：</p>
<p>0 ：stdin（标准输入）<br>1 ：stdout（标准输出）<br>2 ：stderr（标准错误）<br>2&gt; /dev/null</p>
<blockquote>
<p>代表重定向操作。将标准错误重定向到/dev/null ，即不输出错误信息。<br>/dev/null 2&gt;&amp;1 &amp; : 等同于 1&gt;/dev/null 2&gt;&amp;1 &amp;， 即把标准输出重定向到/dev/null，并且把标准错误2重定向标准输出1，即标准输出和标准错误都输出到 /dev/null。</p>
</blockquote>
<h2 id="方式七：指定分配系统资源大小"><a href="#方式七：指定分配系统资源大小" class="headerlink" title="方式七：指定分配系统资源大小"></a>方式七：指定分配系统资源大小</h2><p>nohup java -Xms500m -Xmx500m -jar XXX.jar –spring.profiles.active=dev &gt;log.out &amp;</p>
<h1 id="解决window与linux换行符不一致的问题"><a href="#解决window与linux换行符不一致的问题" class="headerlink" title="解决window与linux换行符不一致的问题"></a>解决window与linux换行符不一致的问题</h1><p>sed -i ‘s/\r$//‘ *.sh</p>
<h1 id="定时任务添加"><a href="#定时任务添加" class="headerlink" title="定时任务添加"></a>定时任务添加</h1><p>1.准备执行脚本<br>2.编辑定时任务文件<br>crontab -e<br>先定一小时执行一次<br>*/60 * * * * cd /home/boco/nantong/TrafficCollector &amp;&amp; sh gantry_start.sh</p>
<p>3.到 cat  /var/spool/mail/root可以查看定时任务执行情况</p>
<p>4.如果报错java not found，在每一个.sh，如ping_start.sh上加上以下两行<br>#!/bin/bash<br>source /etc/profile</p>
<h1 id="rz-command-not-found"><a href="#rz-command-not-found" class="headerlink" title="rz: command not found"></a>rz: command not found</h1><p>yum install lrzsz -y</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux命令</tag>
      </tags>
  </entry>
  <entry>
    <title>maven</title>
    <url>/2021/11/30/maven/</url>
    <content><![CDATA[<h1 id="1-坐标属性"><a href="#1-坐标属性" class="headerlink" title="1.坐标属性"></a>1.坐标属性</h1><p><img src="/../img/image-20211229202337423.png" alt="image-20211229202337423"></p>
<h1 id="2-安装配置"><a href="#2-安装配置" class="headerlink" title="2.安装配置"></a>2.安装配置</h1><p>配置环境变量</p>
<p><img src="/../img/image-20211230193549500.png" alt="image-20211230193549500"></p>
<p>新建，值为maven的bin目录</p>
<p><img src="/../img/image-20211230193827252.png" alt="image-20211230193827252"></p>
<p>编辑PATH</p>
<p><img src="/../img/image-20211230193809757.png" alt="image-20211230193809757"></p>
<p>验证</p>
<p>mvn -v</p>
<p><img src="/../img/image-20211230193902894.png" alt="image-20211230193902894"></p>
<h1 id="3-maven的目录结构"><a href="#3-maven的目录结构" class="headerlink" title="3.maven的目录结构"></a>3.maven的目录结构</h1><p><img src="/../img/image-20211230194114945.png" alt="image-20211230194114945"></p>
<p><img src="/../img/image-20211230194459365.png" alt="image-20211230194459365"></p>
<h1 id="4-Setting-xml"><a href="#4-Setting-xml" class="headerlink" title="4.Setting.xml"></a>4.Setting.xml</h1><p>我们在编译项目时，会从maven仓库下载jar包</p>
<p>需要将中央仓库地址换位国内albaba镜像</p>
<p>会下载到本地仓库</p>
<p>所以要修改setting.xml配置文件</p>
<h1 id="5-maven命令执行main方法"><a href="#5-maven命令执行main方法" class="headerlink" title="5.maven命令执行main方法"></a>5.maven命令执行main方法</h1><p><img src="/../img/image-20211230195316345.png" alt="image-20211230195316345"></p>
<h1 id="6-maven命令"><a href="#6-maven命令" class="headerlink" title="6.maven命令"></a>6.maven命令</h1><p><img src="/../img/image-20211230195527505.png" alt="image-20211230195527505"></p>
<p><img src="/../img/image-20211230195755313.png" alt="image-20211230195755313"></p>
<p><img src="/../img/image-20211230195940846.png" alt="image-20211230195940846"></p>
<p><img src="/../img/image-20211230195946176.png" alt="image-20211230195946176"></p>
<h1 id="7-idea集成maven"><a href="#7-idea集成maven" class="headerlink" title="7.idea集成maven"></a>7.idea集成maven</h1><p><img src="/../img/image-20211230200242329.png" alt="image-20211230200242329"></p>
<p>settings：只在本项目中有效</p>
<p>Other Settings：idea全有效</p>
<p><img src="/../img/image-20211230200347538.png" alt="image-20211230200347538"></p>
<h1 id="8-创建maven项目"><a href="#8-创建maven项目" class="headerlink" title="8.创建maven项目"></a>8.创建maven项目</h1><p>如果没有生成resources目录，自己手动创建</p>
<p>src下的选Resources Root</p>
<p>test下的选Test Resources Root</p>
<p><img src="/../img/image-20211230200756011.png" alt="image-20211230200756011"></p>
<h1 id="9-maven仓库"><a href="#9-maven仓库" class="headerlink" title="9.maven仓库"></a>9.maven仓库</h1><p><img src="/../img/image-20211230201215493.png" alt="image-20211230201215493"></p>
<h2 id="中央仓库"><a href="#中央仓库" class="headerlink" title="中央仓库"></a>中央仓库</h2><p><img src="/../img/image-20211230201256147.png" alt="image-20211230201256147"></p>
<h2 id="私服"><a href="#私服" class="headerlink" title="私服"></a>私服</h2><p><img src="/../img/image-20211230201918689.png" alt="image-20211230201918689"></p>
<p><img src="/../img/image-20211230201924937.png" alt="image-20211230201924937"></p>
<h1 id="10-maven依赖"><a href="#10-maven依赖" class="headerlink" title="10.maven依赖"></a>10.maven依赖</h1><h2 id="1-控制台报错"><a href="#1-控制台报错" class="headerlink" title="1.控制台报错"></a>1.控制台报错</h2><p><img src="/../img/image-20211016102902390.png" alt="image-20211016102902390"></p>
<p>注释掉jdbc和mybatis</p>
<p><img src="/../img/image-20211016102924624.png" alt="image-20211016102924624"></p>
<h2 id="2-如果本项目，和父项目引用了同一个包不同版本，会报错？"><a href="#2-如果本项目，和父项目引用了同一个包不同版本，会报错？" class="headerlink" title="2.如果本项目，和父项目引用了同一个包不同版本，会报错？"></a>2.如果本项目，和父项目引用了同一个包不同版本，会报错？</h2><p>不会报错，本项目会使用本项目的版本</p>
<h2 id="3-同一个pom内引用了同一个包不同版本会报错？"><a href="#3-同一个pom内引用了同一个包不同版本会报错？" class="headerlink" title="3.同一个pom内引用了同一个包不同版本会报错？"></a>3.同一个pom内引用了同一个包不同版本会报错？</h2><p><img src="/../img/image-20211016103242673.png" alt="image-20211016103242673"></p>
<p>不会报错，会使用下面的版本</p>
<h2 id="4-当本项目依赖a和b项目，a项目web版-2-5-5-b项目web版本2-4-10，会报错？"><a href="#4-当本项目依赖a和b项目，a项目web版-2-5-5-b项目web版本2-4-10，会报错？" class="headerlink" title="4.当本项目依赖a和b项目，a项目web版 2.5.5,b项目web版本2.4.10，会报错？"></a>4.当本项目依赖a和b项目，a项目web版 2.5.5,b项目web版本2.4.10，会报错？</h2><p>不一定，看a的web与b的web如果版本不一致但是无冲突，就没事，有冲突那就出现冲突</p>
<p><img src="/../img/image-20211016164017206.png" alt="image-20211016164017206"></p>
<p><img src="/../img/image-20211016164040095.png" alt="image-20211016164040095"></p>
<h2 id="5-排除父工程的某个依赖"><a href="#5-排除父工程的某个依赖" class="headerlink" title="5.排除父工程的某个依赖"></a>5.排除父工程的某个依赖</h2><p>父项目有a，b，子项目默认会全部依赖</p>
<p>如果只想依赖a，并且父项目不可以改的话</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zyt<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>..<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>父项目可以改的话，加optional即可</p>
<p><img src="/../img/image-20211016110507992.png" alt="image-20211016110507992"></p>
<p><img src="/../img/image-20211016110537664.png" alt="image-20211016110537664"></p>
<p><img src="/../img/image-20211016110558557.png" alt="image-20211016110558557"></p>
<h2 id="6-scope"><a href="#6-scope" class="headerlink" title="6.scope"></a>6.scope</h2><h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><p><img src="/../img/image-20211016104222968.png" alt="image-20211016104222968"></p>
<p><strong>注意scope为test时，默认不自动依赖</strong></p>
<p><img src="/../img/image-20211016110744221.png" alt="image-20211016110744221"></p>
<h3 id="runtime"><a href="#runtime" class="headerlink" title="runtime"></a>runtime</h3><p><img src="/../img/image-20211016110209237.png" alt="image-20211016110209237"></p>
<h3 id="provided"><a href="#provided" class="headerlink" title="provided"></a>provided</h3><p>打包不会打这个依赖</p>
<h2 id="7-dependencies变灰色"><a href="#7-dependencies变灰色" class="headerlink" title="7.dependencies变灰色"></a>7.dependencies变灰色</h2><p><img src="/../img/image-20211016104537375.png" alt="image-20211016104537375"></p>
<p>灰色应该是父工程里的包scope是test</p>
<h2 id="8-依赖冲突愿意以及解决"><a href="#8-依赖冲突愿意以及解决" class="headerlink" title="8.依赖冲突愿意以及解决"></a>8.依赖冲突愿意以及解决</h2><p>原因：比如A依赖B，而B依赖一个名叫C版本1.0的包，并且C有一个get方法（）</p>
<p>A又导入了一个C版本2.0的包，并且2.0里没有get方法了，根据最短路径原则，会使用C2.0版本，</p>
<p>所以启动A的时候就会报错，因为A依赖B的里面不能在使用get方法了，此时就需降低到有get方法的版本</p>
<p><a href="https://blog.csdn.net/noaman_wgs/article/details/81137893?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=maven%E4%BE%9D%E8%B5%96%E5%86%B2%E7%AA%81&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-81137893.first_rank_v2_pc_rank_v29&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/noaman_wgs/article/details/81137893?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=maven%E4%BE%9D%E8%B5%96%E5%86%B2%E7%AA%81&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-81137893.first_rank_v2_pc_rank_v29&amp;spm=1018.2226.3001.4187</a></p>
<p><img src="/../img/image-20211016165350494.png" alt="image-20211016165350494"></p>
<p><img src="/../img/image-20211016165403502.png" alt="image-20211016165403502"></p>
<h3 id="优先例子"><a href="#优先例子" class="headerlink" title="优先例子"></a>优先例子</h3><p>在第4个问题里，路径是一样的，都是两层，而上面优先声明，所以使用上方的！！</p>
<h2 id="9-idea解决"><a href="#9-idea解决" class="headerlink" title="9.idea解决"></a>9.idea解决</h2><p>maven helper</p>
<p><a href="https://blog.csdn.net/fnwibwj/article/details/81709733?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163461551716780269819798%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163461551716780269819798&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-81709733.first_rank_v2_pc_rank_v29&amp;utm_term=idea+Maven%E4%BE%9D%E8%B5%96%E5%86%B2%E7%AA%81%E7%9A%84%E4%B8%A4%E7%A7%8D%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/fnwibwj/article/details/81709733?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163461551716780269819798%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163461551716780269819798&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-81709733.first_rank_v2_pc_rank_v29&amp;utm_term=idea+Maven%E4%BE%9D%E8%B5%96%E5%86%B2%E7%AA%81%E7%9A%84%E4%B8%A4%E7%A7%8D%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F&amp;spm=1018.2226.3001.4187</a></p>
<h1 id="11-optional"><a href="#11-optional" class="headerlink" title="11.optional"></a>11.optional</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">当project-A 依赖project-B,  project-B 依赖project-D时</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;sample.ProjectD&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;ProjectD&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">  &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">所以当project-B的&lt;optional&gt;true&lt;/optional&gt;时, project-A中如果没有显式的引入project-D, 则project-A不依赖project-D, 即project-A可以自己选择是否依赖project-D</span><br><span class="line">默认&lt;optional&gt;的值为false, 及子项目必须依赖</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="12-lib包的使用"><a href="#12-lib包的使用" class="headerlink" title="12.lib包的使用"></a>12.lib包的使用</h1><p>在项目根目录下创建lib包</p>
<p>把要使用的jar包移动进去</p>
<p>pom里，${basedir}/lib/你的.jar,默认打包时不会打这个jar包</p>
<p><img src="/../img/image-20220101172241427.png" alt="image-20220101172241427"></p>
<p>想打system的包添加插件</p>
<p><img src="/../img/image-20220101172711293.png" alt="image-20220101172711293"></p>
<h1 id="13-dependencyManagement"><a href="#13-dependencyManagement" class="headerlink" title="13.dependencyManagement"></a>13.dependencyManagement</h1><p>只有子类显示的引入了，才会引入，并且子类不用写版本号，由父工程统一管理</p>
<h1 id="14-插件maven-dependency-plugin"><a href="#14-插件maven-dependency-plugin" class="headerlink" title="14.插件maven-dependency-plugin"></a>14.插件maven-dependency-plugin</h1><p><a href="https://blog.csdn.net/u011781521/article/details/79055605?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164103054216780357287989%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=164103054216780357287989&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-79055605.pc_search_result_cache&amp;utm_term=maven-dependency-plugin&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/u011781521/article/details/79055605?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164103054216780357287989%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=164103054216780357287989&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-79055605.pc_search_result_cache&amp;utm_term=maven-dependency-plugin&amp;spm=1018.2226.3001.4187</a></p>
<h1 id="15-搭建私服"><a href="#15-搭建私服" class="headerlink" title="15.搭建私服"></a>15.搭建私服</h1><p><img src="/../img/image-20220101205619353.png" alt="image-20220101205619353"></p>
<p>Public Repositories不是一个仓库，但是访问此对应的路径可以访问到</p>
<p>画框左侧所有的仓库，可配置</p>
<p><a href="http://192.168.214.130:8081/nexus/content/groups/public/">http://192.168.214.130:8081/nexus/content/groups/public/</a></p>
<p><img src="/../img/image-20220101211833137.png" alt="image-20220101211833137"></p>
<h2 id="默认账号："><a href="#默认账号：" class="headerlink" title="默认账号："></a>默认账号：</h2><p>admin/admin123</p>
<p>deployment/deployment123</p>
<h2 id="nexus-仓库介绍"><a href="#nexus-仓库介绍" class="headerlink" title="nexus 仓库介绍"></a>nexus 仓库介绍</h2><h3 id="3rd-party：第三方仓库"><a href="#3rd-party：第三方仓库" class="headerlink" title="3rd party：第三方仓库"></a>3rd party：第三方仓库</h3><p>第三方包，既不是本地的，也不是maven官方的，比如另一个公司的包，可以放在这里</p>
<h3 id="Apache-Snapshots：apache-快照仓库"><a href="#Apache-Snapshots：apache-快照仓库" class="headerlink" title="Apache Snapshots：apache 快照仓库"></a>Apache Snapshots：apache 快照仓库</h3><h3 id="Central-maven-中央仓库"><a href="#Central-maven-中央仓库" class="headerlink" title="Central: maven 中央仓库"></a>Central: maven 中央仓库</h3><p>maven官方有的放在此项目下</p>
<h3 id="Releases：私有发布版本仓库"><a href="#Releases：私有发布版本仓库" class="headerlink" title="Releases：私有发布版本仓库"></a>Releases：私有发布版本仓库</h3><p>公司的框架包</p>
<h3 id="Snapshots：私有-快照版本仓库"><a href="#Snapshots：私有-快照版本仓库" class="headerlink" title="Snapshots：私有 快照版本仓库"></a>Snapshots：私有 快照版本仓库</h3><h2 id="settings"><a href="#settings" class="headerlink" title="settings"></a>settings</h2><p><a href="https://blog.csdn.net/weixin_43740223/article/details/114253461?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link&amp;utm_relevant_index=2">https://blog.csdn.net/weixin_43740223/article/details/114253461?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link&amp;utm_relevant_index=2</a></p>
<h3 id="servers"><a href="#servers" class="headerlink" title="servers"></a>servers</h3><p>deploy时，上传jar包需要权限</p>
<p><img src="/../img/image-20220101223057142.png" alt="image-20220101223057142"></p>
<p>版本为release结尾的，上传到releases库</p>
<p>版本为snapshot结尾的，上传到snapshots库</p>
]]></content>
      <categories>
        <category>maven</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql</title>
    <url>/2021/11/30/mysql/</url>
    <content><![CDATA[<h1 id="详细链接"><a href="#详细链接" class="headerlink" title="详细链接"></a>详细链接</h1><p><a href="https://blog.csdn.net/qq_34115899/article/details/81190461">https://blog.csdn.net/qq_34115899/article/details/81190461</a></p>
<h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><h2 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h2><p>插入一行<br>insert into student(<code>NAME</code>)VALUES(‘aa’)</p>
<p>插入多行<br>insert into student(<code>NAME</code>)VALUES(‘dd’),(‘bb’),(‘cc’)</p>
<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><p>update 表名 a set a=? where </p>
<h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><p>①delete from 表名 where id =1</p>
<p>注：不写条件的话删除整个表数据了    自增不归0</p>
<p>②truncate  完全清空一个表数据，列和索引的属性不会变</p>
<p>truncate  表名    自增会归0</p>
<p>③根据时间删除，需要给定前后两段时间</p>
<p>delete from NBD_STA_GANTRY_CABINET where SCAN_START_TIME&gt;=’2017-01-01 00:00:00’ AND SCAN_START_TIME&lt;=’2021-12-30 00:00:03’</p>
<h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h1><h2 id="生成一个伪列从1到查出的数据总数"><a href="#生成一个伪列从1到查出的数据总数" class="headerlink" title="生成一个伪列从1到查出的数据总数"></a>生成一个伪列从1到查出的数据总数</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	(@rownum := @rownum + 1) AS rownum,</span><br><span class="line">	b.*</span><br><span class="line">FROM</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			a.dic_key dicKey,</span><br><span class="line">			a.dic_value dicValue</span><br><span class="line">		FROM</span><br><span class="line">			NBD_RES_STANDARD_DIC a</span><br><span class="line">		WHERE</span><br><span class="line">			a.field_group = &#x27;eqp_object_class&#x27;</span><br><span class="line">		AND a.VALUE_GROUP IN (2, 3, 4)</span><br><span class="line">	) b,</span><br><span class="line">	(SELECT @rownum := 0) r</span><br></pre></td></tr></table></figure>


<h2 id="时间相关-转数字，转字符"><a href="#时间相关-转数字，转字符" class="headerlink" title="时间相关 转数字，转字符"></a>时间相关 转数字，转字符</h2><p><img src="/../img/image-20211202225020986.png" alt="image-20211202225020986"></p>
<h2 id="转数字，转字符"><a href="#转数字，转字符" class="headerlink" title="转数字，转字符"></a>转数字，转字符</h2><p> TO_CHAR():<br>CAST(123   AS   CHAR(3)) </p>
<p>select CAST(202 AS CHAR)  from dual</p>
<p>TO_NUMBER():<br>cast( ‘123 ‘   as   SIGNED   INTEGER) </p>
<h3 id="获取当前时间"><a href="#获取当前时间" class="headerlink" title="获取当前时间"></a>获取当前时间</h3><p>sysdate()==》 yyyy-MM-dd HH:mm:ss<br>CURRENT_TIME==》HH:mm:ss<br>current_date()==》   yyyy-MM-dd<br>now() ==》 yyyy-MM-dd HH:mm:ss</p>
<h3 id="时间戳换算成日期-yyyy-MM-dd-HH-mm-ss"><a href="#时间戳换算成日期-yyyy-MM-dd-HH-mm-ss" class="headerlink" title="时间戳换算成日期 yyyy-MM-dd HH:mm:ss"></a>时间戳换算成日期 yyyy-MM-dd HH:mm:ss</h3><p>FROM_UNIXTIME()</p>
<h3 id="代码中相关时间"><a href="#代码中相关时间" class="headerlink" title="代码中相关时间"></a>代码中相关时间</h3><p>@JsonFormat(pattern = “yyyy-MM-dd HH:mm:ss”)<br>private Date startTime;</p>
<p>mapper里直接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;if test=&quot;null != startTime&quot;&gt;</span><br><span class="line">    AND p.START_TIME &amp;gt; #&#123;startTime&#125;</span><br><span class="line">&lt;/if&gt;</span><br></pre></td></tr></table></figure>
<h3 id="获取年月日时分秒"><a href="#获取年月日时分秒" class="headerlink" title="获取年月日时分秒"></a>获取年月日时分秒</h3><p>DATE_FORMAT(a.date,’%Y-%m-%d %H:%m:%s’)<br>可以单独获取年or日等等</p>
<h2 id="ifnull空值转换"><a href="#ifnull空值转换" class="headerlink" title="ifnull空值转换"></a>ifnull空值转换</h2><h2 id="decode"><a href="#decode" class="headerlink" title="decode"></a>decode</h2><p><strong>decode(expression,value,result1,result2)</strong><br>如果expression=value，则输出result1，否则输出result2</p>
<p><strong>decode(expression,value1,result1,value2,result2,value3,result3……,default)</strong><br>expression=value1，则输出result1，expression=value2，输出reslut2，expression=value3，输出result3，若expression不等于所列出的所有value，则输出为default</p>
<h2 id="左连接"><a href="#左连接" class="headerlink" title="左连接"></a>左连接</h2><p>没有where条件，已a表为基准，查出来的数据条数是a的条数<br>如果有where条件，查出来的结果最终是where条件成立的条数<br>字典值等用此方法比较简单</p>
<h2 id="round-a-b"><a href="#round-a-b" class="headerlink" title="round(a,b)"></a>round(a,b)</h2><p>ROUND(1.323123,2)==》 1.32 四舍五入</p>
<h2 id="Concat-a-b-拼接"><a href="#Concat-a-b-拼接" class="headerlink" title="Concat(a,b)拼接"></a>Concat(a,b)拼接</h2><h2 id="pom与application"><a href="#pom与application" class="headerlink" title="pom与application"></a>pom与application</h2><h3 id="平时自己"><a href="#平时自己" class="headerlink" title="平时自己"></a>平时自己</h3><p>application</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">    url: jdbc:mysql://localhost:3306/school?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span><br><span class="line">	druid:</span><br><span class="line">      driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">      username: root</span><br><span class="line">      password: root</span><br><span class="line">      max-active: 100</span><br><span class="line">      min-idle: 10</span><br><span class="line">      initial-size: 5</span><br><span class="line">      max-wait: 5000</span><br><span class="line">	  </span><br></pre></td></tr></table></figure>
<p>pom</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--druid数据源--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.10&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;8.0.15&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h2><h4 id="ABS-8-–绝对值"><a href="#ABS-8-–绝对值" class="headerlink" title="ABS(-8) –绝对值"></a>ABS(-8) –绝对值</h4><h4 id="ceiling-9-4-–向上取整"><a href="#ceiling-9-4-–向上取整" class="headerlink" title="ceiling(9.4) –向上取整"></a>ceiling(9.4) –向上取整</h4><h4 id="floor（9-4）–向下取整"><a href="#floor（9-4）–向下取整" class="headerlink" title="floor（9.4）–向下取整"></a>floor（9.4）–向下取整</h4><h4 id="rand（）–返回【0-1）的随机数"><a href="#rand（）–返回【0-1）的随机数" class="headerlink" title="rand（）–返回【0,1）的随机数"></a>rand（）–返回【0,1）的随机数</h4><h4 id="RAND-m-n-n-返回-n-m-之间的数"><a href="#RAND-m-n-n-返回-n-m-之间的数" class="headerlink" title="RAND()*(m-n)+n:返回[n,m)之间的数"></a>RAND()*(m-n)+n:返回[n,m)之间的数</h4><h4 id="sign（num）num-0，返回0，num-正数，返回1，num-负数，返回-1"><a href="#sign（num）num-0，返回0，num-正数，返回1，num-负数，返回-1" class="headerlink" title="sign（num）num=0，返回0，num=正数，返回1，num=负数，返回-1"></a>sign（num）num=0，返回0，num=正数，返回1，num=负数，返回-1</h4><h4 id="char-length-str-–str长度"><a href="#char-length-str-–str长度" class="headerlink" title="char_length(str)–str长度"></a>char_length(str)–str长度</h4><h4 id="LOWER-Str-–小写"><a href="#LOWER-Str-–小写" class="headerlink" title="LOWER(Str)–小写"></a>LOWER(Str)–小写</h4><h4 id="UPPER-Str-–大写"><a href="#UPPER-Str-–大写" class="headerlink" title="UPPER(Str)–大写"></a>UPPER(Str)–大写</h4><h4 id="REPLACE-‘abcde’-’b’-’ee’-–把b替换成ee"><a href="#REPLACE-‘abcde’-’b’-’ee’-–把b替换成ee" class="headerlink" title="REPLACE(‘abcde’,’b’,’ee’)–把b替换成ee"></a>REPLACE(‘abcde’,’b’,’ee’)–把b替换成ee</h4><h4 id="select-ROUND-10-20-2-from-dual-除法"><a href="#select-ROUND-10-20-2-from-dual-除法" class="headerlink" title="select ROUND(10/20,2) from dual 除法"></a>select ROUND(10/20,2) from dual 除法</h4><h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><table>
<thead>
<tr>
<th>函数名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>count（）</td>
<td>计数</td>
</tr>
<tr>
<td>sum（）</td>
<td>求和</td>
</tr>
<tr>
<td>avg（）</td>
<td>平均</td>
</tr>
<tr>
<td>max（）</td>
<td>最大值</td>
</tr>
<tr>
<td>min（）</td>
<td>最小值</td>
</tr>
<tr>
<td>count(字段)）忽略null值</td>
<td></td>
</tr>
<tr>
<td>count(*)   不忽略null值  ,</td>
<td></td>
</tr>
<tr>
<td>count(1)   不忽略null值</td>
<td></td>
</tr>
<tr>
<td>group by 查的字段应该有聚合函数</td>
<td></td>
</tr>
</tbody></table>
<h2 id="case选择判断函数"><a href="#case选择判断函数" class="headerlink" title="case选择判断函数"></a>case选择判断函数</h2><p>第一种：CASE WHEN a.？=？THEN 1 ELSE 0 END</p>
<p>第二种 case a when 1 then ‘a’ when 2 then ‘b’ else ‘c’ end</p>
<h2 id="foreach用法"><a href="#foreach用法" class="headerlink" title="foreach用法"></a>foreach用法</h2><h3 id="批量插入"><a href="#批量插入" class="headerlink" title="批量插入"></a>批量插入</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;insert id=&quot;insertBatch&quot;&gt;</span><br><span class="line">        INSERT INTO t_user</span><br><span class="line">        (id, name, password)</span><br><span class="line">        VALUES</span><br><span class="line">        &lt;foreach collection =&quot;userList&quot; item=&quot;user&quot; separator =&quot;,&quot;&gt;</span><br><span class="line">            (#&#123;id&#125;, #&#123;name&#125;, #&#123;password&#125;)</span><br><span class="line">        &lt;/foreach &gt;</span><br><span class="line">    &lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<h3 id><a href="#" class="headerlink" title></a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;foreach collection=&quot;list&quot; item=&quot;item&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot; index=&quot;i&quot;&gt;</span><br><span class="line">	#&#123;item&#125;</span><br><span class="line">&lt;/foreach&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="也可以不用逗号分隔"><a href="#也可以不用逗号分隔" class="headerlink" title="也可以不用逗号分隔"></a>也可以不用逗号分隔</h3><p>separator=”or”</p>
<h2 id="想要控制台打印sql"><a href="#想要控制台打印sql" class="headerlink" title="想要控制台打印sql"></a>想要控制台打印sql</h2><p>pom</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.25&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>yml</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    root: info</span><br><span class="line">    com.jiang.mybatisplus.mapper: debug</span><br></pre></td></tr></table></figure>

<h2 id="数据库对应java类"><a href="#数据库对应java类" class="headerlink" title="数据库对应java类"></a>数据库对应java类</h2><table>
<thead>
<tr>
<th>数据库</th>
<th>代码</th>
</tr>
</thead>
<tbody><tr>
<td>bigint</td>
<td>Long</td>
</tr>
<tr>
<td>int</td>
<td>Integer</td>
</tr>
<tr>
<td>FLOAT</td>
<td>Double</td>
</tr>
</tbody></table>
<h2 id="长度"><a href="#长度" class="headerlink" title="长度"></a>长度</h2><p>数字型</p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>大小</strong></th>
<th><strong>范围（有符号）</strong></th>
<th><strong>范围（无符号）</strong></th>
<th><strong>用途</strong></th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1 字节</td>
<td>(-128,127)</td>
<td>(0,255)</td>
<td>小整数值</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2 字节</td>
<td>(-32768,32767)</td>
<td>(0,65535)</td>
<td>大整数值</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3 字节</td>
<td>(-8388608,8388607)</td>
<td>(0,16777215)</td>
<td>大整数值</td>
</tr>
<tr>
<td>INT或INTEGER</td>
<td>4 字节</td>
<td>(-2147483648,2147483647)</td>
<td>(0,4294967295)</td>
<td>大整数值</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8 字节</td>
<td>(-9223372036854775808，9223372036854775807)</td>
<td>(0,18446744073709551615)</td>
<td>极大整数值</td>
</tr>
<tr>
<td>FLOAT</td>
<td>4 字节</td>
<td></td>
<td></td>
<td>单精度 浮点数值</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8 字节</td>
<td></td>
<td></td>
<td>双精度 浮点数值</td>
</tr>
</tbody></table>
<p>字符类型</p>
<table>
<thead>
<tr>
<th>CHAR</th>
<th>0-255字节</th>
<th>定长字符串</th>
</tr>
</thead>
<tbody><tr>
<td>VARCHAR</td>
<td>0-255字节</td>
<td>变长字符串</td>
</tr>
<tr>
<td>TINYBLOB</td>
<td>0-255字节</td>
<td>不超过 255 个字符的二进制字符串</td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>0-255字节</td>
<td>短文本字符串</td>
</tr>
<tr>
<td>BLOB</td>
<td>0-65 535字节</td>
<td>二进制形式的长文本数据</td>
</tr>
<tr>
<td>TEXT</td>
<td>0-65 535字节</td>
<td>长文本数据</td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>0-16 777 215字节</td>
<td>二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>0-16 777 215字节</td>
<td>中等长度文本数据</td>
</tr>
<tr>
<td>LOGNGBLOB</td>
<td>0-4 294 967 295字节</td>
<td>二进制形式的极大文本数据</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>0-4 294 967 295字节</td>
<td>极大文本数据</td>
</tr>
</tbody></table>
<h2 id="根据不同条件拼接不同sql-重点"><a href="#根据不同条件拼接不同sql-重点" class="headerlink" title="根据不同条件拼接不同sql(重点)"></a>根据不同条件拼接不同sql(重点)</h2><h3 id="choose-or的关系"><a href="#choose-or的关系" class="headerlink" title="choose or的关系"></a>choose or的关系</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;where&gt;</span><br><span class="line">            &lt;choose&gt;</span><br><span class="line">                &lt;when test=&quot;isUpdate !=null &quot;&gt;</span><br><span class="line">                    AND u.is_update = #&#123;isUpdate, jdbcType=INTEGER&#125;</span><br><span class="line">                &lt;/when&gt;</span><br><span class="line">                &lt;when test=&quot;isDelete != null&quot;&gt;</span><br><span class="line">                    AND u.is_delete = #&#123;isDelete, jdbcType=INTEGER&#125;</span><br><span class="line">                &lt;/when&gt;</span><br><span class="line">                &lt;otherwise&gt;</span><br><span class="line">                &lt;/otherwise&gt;</span><br><span class="line">            &lt;/choose&gt;</span><br><span class="line">            &lt;if test=&quot;tableColumnId != null&quot;&gt;</span><br><span class="line">               AND table_column_id = #&#123;tableColumnId&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">        &lt;/where&gt;</span><br></pre></td></tr></table></figure>
<h3 id="like"><a href="#like" class="headerlink" title="like"></a>like</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;if test=&quot;thresholdQO.titel!=null and &#x27;&#x27; !=thresholdQO.titel&quot;&gt;</span><br><span class="line">            &lt;bind name=&quot;titel&quot; value=&quot;&#x27;%&#x27; + thresholdQO.titel + &#x27;%&#x27;&quot; /&gt;</span><br><span class="line">            AND a.title LIKE #&#123;titel&#125;</span><br><span class="line">        &lt;/if&gt;</span><br></pre></td></tr></table></figure>
<h2 id="字符串拆分"><a href="#字符串拆分" class="headerlink" title="字符串拆分"></a>字符串拆分</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">str = &#x27;www.baidu.com&#x27;;</span><br><span class="line"></span><br><span class="line">SELECT substring_index(&#x27;www.baidu.com&#x27;,&#x27;.&#x27;, 1);    #www</span><br><span class="line"></span><br><span class="line">SELECT substring_index(&#x27;www.baidu.com&#x27;,&#x27;.&#x27;, 2);    #www.baidu</span><br><span class="line"></span><br><span class="line">SELECT substring_index(&#x27;www.baidu.com&#x27;,&#x27;.&#x27;, -1);   #com</span><br><span class="line"></span><br><span class="line">SELECT substring_index(&#x27;www.baidu.com&#x27;,&#x27;.&#x27;, -2);   #baidu.com</span><br><span class="line"></span><br><span class="line">SELECT substring_index(substring_index(&#x27;www.baidu.com&#x27;,&#x27;.&#x27;, -2), &#x27;.&#x27;, 1);  #baidu</span><br></pre></td></tr></table></figure>
<h2 id="mapper的test里判断"><a href="#mapper的test里判断" class="headerlink" title="mapper的test里判断"></a>mapper的test里判断</h2><h3 id="是否包含"><a href="#是否包含" class="headerlink" title="是否包含"></a>是否包含</h3><if test="tableName.contains("monitor")">

<h3 id="是否等于，注意是-不是"><a href="#是否等于，注意是-不是" class="headerlink" title="是否等于，注意是==不是="></a>是否等于，注意是==不是=</h3><when test="name == 'alarm_level' ">

<h2 id="自增重新从1开始"><a href="#自增重新从1开始" class="headerlink" title="自增重新从1开始"></a>自增重新从1开始</h2><p>方法1</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 auto_increment<span class="operator">=</span><span class="number">1</span></span><br><span class="line"> #<span class="comment">--这种方法处理的好处就是 可以设置auto_increment 为任意值开始自增 #--提示：如果表列和数据很多，速度会很慢，如90多万条，会在10分钟以上, 所以注意使用场景</span></span><br></pre></td></tr></table></figure>

<p>方法2</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">truncate table 表名称</span><br><span class="line"><span class="comment">#--直接一句话搞定  好处就是简单，auto_increment值重新开始从1计数)</span></span><br></pre></td></tr></table></figure>

<p>重点注意 : 一般情况下我们使用第二个就可以了，记住以上情况都是彻底删除所有记录, 所以我们在设定之前要考虑周密，设计数据库表的时候也要考虑多方面因素!</p>
<h2 id="有时嵌套不好使"><a href="#有时嵌套不好使" class="headerlink" title="有时嵌套不好使"></a>有时嵌套不好使</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">delete from testaaa  where ID IN (</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">b.id</span><br><span class="line">FROM</span><br><span class="line">	NBD_RES_GANTRY_EQUIPMENT a,</span><br><span class="line">	testaaa b</span><br><span class="line">WHERE</span><br><span class="line">	a.GANTRY_INFO_ID = b.GANTRY_INFO_ID</span><br><span class="line">AND a.EQP_OBJECT_CLASS = b.EQP_OBJECT_CLASS</span><br><span class="line">AND a.IP = b.ip</span><br><span class="line"></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="需要在内层多加一层嵌套"><a href="#需要在内层多加一层嵌套" class="headerlink" title="需要在内层多加一层嵌套"></a>需要在内层多加一层嵌套</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">delete from testaaa  where ID IN (</span><br><span class="line"></span><br><span class="line">SELECT C.ID FROM (SELECT</span><br><span class="line">b.id</span><br><span class="line">FROM</span><br><span class="line">	NBD_RES_GANTRY_EQUIPMENT a,</span><br><span class="line">	testaaa b</span><br><span class="line">WHERE</span><br><span class="line">	a.GANTRY_INFO_ID = b.GANTRY_INFO_ID</span><br><span class="line">AND a.EQP_OBJECT_CLASS = b.EQP_OBJECT_CLASS</span><br><span class="line">AND a.IP = b.ip) C</span><br><span class="line"></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="查询字段长度大于4的"><a href="#查询字段长度大于4的" class="headerlink" title="查询字段长度大于4的"></a>查询字段长度大于4的</h2><p>select * from test where LENGTH(ip)&gt;4</p>
<h2 id="CONVERT"><a href="#CONVERT" class="headerlink" title="CONVERT()"></a><em>CONVERT</em>()</h2><p><em>CONVERT</em>() 函数是把日期转换为新数据类型的通用函数</p>
<h2 id="去重distinct"><a href="#去重distinct" class="headerlink" title="去重distinct"></a>去重distinct</h2><p>1、根据全部字段的去重查询：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<p>2、根据某些字段的去重查询（不考虑查询其他字段）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> c_name,c_year,c_month <span class="keyword">from</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<h1 id="代码中application"><a href="#代码中application" class="headerlink" title="代码中application"></a>代码中application</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    url: jdbc:mysql://10.12.1.50:3306/NBD_NT_RAILWAY?useSSL=false&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;serverTimezone=Asia/Shanghai</span><br><span class="line">    username: root</span><br><span class="line">    password: Boco.123</span><br><span class="line">    #type:</span><br><span class="line">    filters: stat</span><br><span class="line">    maxActive: 20</span><br><span class="line">    initialSize: 1</span><br><span class="line">    maxWait: 30000</span><br><span class="line">    minIdle: 1</span><br><span class="line">    timeBetweenEvictionRunsMillis: 60000</span><br><span class="line">    minEvictableIdleTimeMillis: 90000</span><br><span class="line">    validationQuery: SELECT 1 FROM DUAL</span><br><span class="line">    testWhileIdle: true</span><br><span class="line">    testOnBorrow: false</span><br><span class="line">    testOnReturn: false</span><br><span class="line">    poolPreparedStatements: true</span><br><span class="line">    maxOpenPreparedStatements: 20</span><br><span class="line">    connection-test-query: SELECT 1 FROM DUAL</span><br><span class="line">    #filters: stat,wall,log4j2</span><br><span class="line">    connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</span><br></pre></td></tr></table></figure>

<h1 id="＜-CDATA-＞"><a href="#＜-CDATA-＞" class="headerlink" title="＜![CDATA[ ]]＞"></a>＜![CDATA[ ]]＞</h1><p>直接放入符号即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">EVENT_TIME&lt;![CDATA[&gt;=]]&gt;#&#123;startTime&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&amp;gt;  替换   &gt;  </span><br><span class="line"></span><br><span class="line">&amp;lt;   替换  &lt;</span><br></pre></td></tr></table></figure>

<h1 id="数据库索引"><a href="#数据库索引" class="headerlink" title="数据库索引"></a>数据库索引</h1><p><a href="https://blog.csdn.net/qq_35190492/article/details/109257302?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164186154816781683935440%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164186154816781683935440&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-109257302.first_rank_v2_pc_rank_v29&amp;utm_term=mysql%E7%B4%A2%E5%BC%95&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/qq_35190492/article/details/109257302?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164186154816781683935440%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164186154816781683935440&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-109257302.first_rank_v2_pc_rank_v29&amp;utm_term=mysql%E7%B4%A2%E5%BC%95&amp;spm=1018.2226.3001.4187</a></p>
<h2 id="最左前缀匹配规则"><a href="#最左前缀匹配规则" class="headerlink" title="最左前缀匹配规则"></a>最左前缀匹配规则</h2><p>MySQL 建立联合索引的规则是这样的，它会首先根据联合索引中最左边的、也就是第一个字段进行排序，在第一个字段排序的基础上，再对联合索引中后面的第二个字段进行排序，依此类推。</p>
<p>综上，第一个字段是绝对有序的，从第二个字段开始是无序的，这就解释了为什么直接使用第二字段进行条件判断用不到索引了（从第二个字段开始，无序，无法走 B+ Tree 索引）！这也是 MySQL 在联合索引中强调最左前缀匹配原则的原因。</p>
<h3 id="explain-这个关键字"><a href="#explain-这个关键字" class="headerlink" title="explain 这个关键字"></a>explain 这个关键字</h3><p><img src="/../img/image-20220118165309899.png" alt="image-20220118165309899"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">注意我圈红的这仨字段，这是使用 explain 语句需要重点关注的字段</span><br><span class="line"></span><br><span class="line">type：访问类型，要是显示 ALL ，那你可要小心了，这是全表扫描的意思，性能最差，说明你的查询有很大的优化余地，如果显示的是 index ，说明会使用索引来优化查询。关于 type 的更多解释请参考这个文章 ：mysql中explain的type的解释</span><br><span class="line">key：具体使用的索引名，这里没有。</span><br><span class="line">rows：扫描的行数。</span><br><span class="line">Extra：index正在使用覆盖索引</span><br><span class="line">		where没有使用</span><br><span class="line"></span><br><span class="line">联合索引IDX(字段A,字段B,字段C,字段D)，当仅使用字段A查询时，索引IDX就会使用到；</span><br><span class="line"></span><br><span class="line">如果仅使用字段B或字段C或字段D查询，则索引IDX都不会用到。</span><br><span class="line"></span><br><span class="line">这个规则在oracle和mysql数据库中均成立。</span><br><span class="line"></span><br><span class="line">如果你经常要用到多个字段的多条件查询，可以考虑建立联合索引，一般是除第一个字段外的其它字段不经常用于条件筛选情况，比如说a,b 两个字段，如果你经常用a条件或者a+b条件去查询，而很少单独用b条件查询，那么可以建立a,b的联合索引。如果a和b都要分别经常独立的被用作查询条件，那还是建立多个单列索引。</span><br><span class="line"></span><br><span class="line">也就是说，如果建立了联合索引，那么就不用单独建立第一个字段的单独索引了</span><br></pre></td></tr></table></figure>

<h3 id="开始现在有一个表"><a href="#开始现在有一个表" class="headerlink" title="开始现在有一个表"></a>开始现在有一个表</h3><p><img src="/../img/image-20220118165357109.png" alt="image-20220118165357109"></p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p><img src="/../img/image-20220118165833401.png" alt="image-20220118165833401"></p>
<h3 id="因为第一个字段是age，所以无需建立age单独索引"><a href="#因为第一个字段是age，所以无需建立age单独索引" class="headerlink" title="因为第一个字段是age，所以无需建立age单独索引"></a>因为第一个字段是age，所以无需建立age单独索引</h3><p><img src="/../img/image-20220118170634138.png" alt="image-20220118170634138"></p>
<p><img src="/../img/image-20220118170610546.png" alt="image-20220118170610546"></p>
<h3 id="只要查询条件里有age，不管age在前还是在后，那么就会走这个索引"><a href="#只要查询条件里有age，不管age在前还是在后，那么就会走这个索引" class="headerlink" title="只要查询条件里有age，不管age在前还是在后，那么就会走这个索引"></a>只要查询条件里有age，不管age在前还是在后，那么就会走这个索引</h3><h2 id="索引覆盖"><a href="#索引覆盖" class="headerlink" title="索引覆盖"></a>索引覆盖</h2><p>如果在一个场景下，select id,name,sex from user where name =’zhangsan’;这个语句在业务上频繁使用到，而user表的其他字段使用频率远低于它，在这种情况下，如果我们在建立 name 字段的索引的时候，不是使用单一索引，而是使用联合索引（name，sex）这样的话再执行这个查询语句是不是根据辅助索引查询到的结果就可以获取当前语句的完整数据。这样就可以有效地避免了回表再获取sex的数据。</p>
<p>这里就是一个典型的使用覆盖索引的优化策略减少回表的情况。</p>
<p>如果要查询的列，有主键id，索引a，普通值b，这时候可以把索引改为联合索引（a,b）,这样就不用回表查询了。</p>
<h2 id="回表查询"><a href="#回表查询" class="headerlink" title="回表查询"></a>回表查询</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">不是主键的索引，保存索引字段对应的值和主键值，在根据主键值查其他值，叫做回表查询</span><br></pre></td></tr></table></figure>

</when></if>]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx与gateway</title>
    <url>/2021/11/30/nginx%E4%B8%8Egateway/</url>
    <content><![CDATA[<p>前端页面都放在nginx的html下，并且每一个前端项目都需要配置nginx</p>
<p><img src="/D:/hexo博客/blog/source/img/image-20211217175446376.png" alt="image-20211217175446376"></p>
<p>但是不一定每个项目都会配置网关</p>
<p>如果配置了</p>
<p>那么就不用改前端项目的environment.json，或者config.json</p>
<p>前端发的请求都是带上api的，走nacos的网关服务，从nacos找其他服务</p>
<p>如果没配置</p>
<p>需要改前端项目的environment.json，或者config.json</p>
<p>说明前端访问路径是不带api的</p>
<p>gateway具体操作请看alibaba-springcloud博客</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>nginx与gateway</tag>
      </tags>
  </entry>
  <entry>
    <title>oracle</title>
    <url>/2021/11/30/oracle/</url>
    <content><![CDATA[<h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h1><h2 id="生成一个伪列从1到查出的数据总数"><a href="#生成一个伪列从1到查出的数据总数" class="headerlink" title="生成一个伪列从1到查出的数据总数"></a>生成一个伪列从1到查出的数据总数</h2><p>SELECT rownum intId,’No.’||rownum rank</p>
<h2 id="拼接"><a href="#拼接" class="headerlink" title="拼接"></a>拼接</h2><p>||</p>
<h2 id="NVL空值转换"><a href="#NVL空值转换" class="headerlink" title="NVL空值转换"></a>NVL空值转换</h2><p>NVL(a,b),a不为空为a，a为空为b，a和b需要是同一种类型</p>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>oracle</tag>
      </tags>
  </entry>
  <entry>
    <title>servlet</title>
    <url>/2021/11/30/servlet/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>servlet</tag>
      </tags>
  </entry>
  <entry>
    <title>showDoc</title>
    <url>/2021/11/30/showDoc/</url>
    <content><![CDATA[<h1 id="docker安装showDoc"><a href="#docker安装showDoc" class="headerlink" title="docker安装showDoc"></a>docker安装showDoc</h1><h2 id="1-安装docker步骤略过"><a href="#1-安装docker步骤略过" class="headerlink" title="1.安装docker步骤略过"></a>1.安装docker步骤略过</h2><h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2.安装"></a>2.安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 中国大陆镜像安装命令（安装后记得执行docker tag命令以进行重命名）</span></span><br><span class="line">docker pull registry.cn-shenzhen.aliyuncs.com/star7th/showdoc</span><br><span class="line">docker tag registry.cn-shenzhen.aliyuncs.com/star7th/showdoc:latest star7th/showdoc:latest </span><br><span class="line"></span><br><span class="line"><span class="comment">##后续命令无论使用官方镜像还是加速镜像都需要执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#新建存放showdoc数据的目录</span></span><br><span class="line">mkdir -p /showdoc_data/html</span><br><span class="line">chmod  -R 777 /showdoc_data</span><br><span class="line"><span class="comment"># 如果你是想把数据挂载到其他目录，比如说/data1，那么，可以在/data1目录下新建一个showdoc_data/目录，</span></span><br><span class="line"><span class="comment"># 然后在根目录的新建一个软链接/showdoc_data到/data1/showdoc_data</span></span><br><span class="line"><span class="comment"># 这样既能保持跟官方教程推荐的路径一致，又能达到自定义存储的目的.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动showdoc容器</span></span><br><span class="line">docker run -d --name showdoc --user=root --privileged=<span class="literal">true</span> -p 4999:80 \</span><br><span class="line">-v /showdoc_data/html:/var/www/html/ star7th/showdoc</span><br></pre></td></tr></table></figure>

<p>根据以上命令操作的话，往后showdoc的数据都会存放在 /showdoc_data/html 目录下。<br>你可以打开 <a href="http://localhost:4999/">http://localhost:4999</a> 来访问showdoc (localhost可改为你的服务器域名或者IP)。账户密码是showdoc/123456，登录后你便可以看到右上方的管理后台入口。建议登录后修改密码。<br>对showdoc的问题或建议请至<a href="https://github.com/star7th/showdoc">https://github.com/star7th/showdoc</a> 出提issue。若觉得showdoc好用，不妨点个star。</p>
<p>如果报错</p>
<p><img src="/../img/image-20220118154934633.png" alt="image-20220118154934633"></p>
<p>重启docker</p>
<p>systemctl restart docker</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>showDoc</tag>
      </tags>
  </entry>
  <entry>
    <title>反射</title>
    <url>/2021/11/30/%E5%8F%8D%E5%B0%84/</url>
    <content><![CDATA[<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>通过包.类路径获取类对象</span><br><span class="line">       Class c1 <span class="operator">=</span> Class.forName(&quot;com.example.demo.demo.A&quot;);</span><br><span class="line">       Class c2 <span class="operator">=</span> Class.forName(&quot;com.example.demo.demo.A&quot;);</span><br><span class="line">       <span class="operator">/</span><span class="operator">/</span>一个类在内存中只有一个class对象</span><br><span class="line">       System.out.println(c1<span class="operator">=</span><span class="operator">=</span>c2);<span class="operator">/</span><span class="operator">/</span><span class="literal">true</span></span><br><span class="line">       <span class="operator">/</span><span class="operator">/</span>一个类被加载后，类的整个结构都会被封装在class对象中</span><br></pre></td></tr></table></figure>

<h1 id="1-获取Class类的方法"><a href="#1-获取Class类的方法" class="headerlink" title="1.获取Class类的方法"></a>1.获取Class类的方法</h1><p>Class clazz=Person.class;</p>
<p>Class clazz=person.getClass();</p>
<p>Class clazz=Class.forName(“包.类路径&quot;);</p>
<h1 id="2-类的加载过程"><a href="#2-类的加载过程" class="headerlink" title="2.类的加载过程"></a>2.类的加载过程</h1><p>类的加载：把class文件读入内存,并创建一个java.lang.class对象。此过程由类加载器完成</p>
<p>类的链接：将类的二进制数据合并jvm的运行状态</p>
<p>初始化：对类进行初始化</p>
<h1 id="3-反射调用方法"><a href="#3-反射调用方法" class="headerlink" title="3.反射调用方法"></a>3.反射调用方法</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//调用无参函数</span><br><span class="line">Object c  调用方法在哪个类的对象   User user那么c=user</span><br><span class="line">methodName要调用的方法名</span><br><span class="line">c.getClass().getMethod(methodName, null).invoke(c, null);</span><br><span class="line"></span><br><span class="line">Object obj 参数和参数类型</span><br><span class="line"></span><br><span class="line">c.getClass().getMethod(methodName, obj.getClass()).invoke(c, obj);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Service(&quot;jiang&quot;)</span><br><span class="line">public class testService &#123;</span><br><span class="line">    public String haha(int age,String name)&#123;</span><br><span class="line">        String a=age+&quot;&quot;;</span><br><span class="line">        return name+a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RequestMapping(&quot;/aaa&quot;)</span><br><span class="line">public String aaa() throws Exception&#123;</span><br><span class="line">    ApplicationContext appCtx = SpringContextUtil.getApplicationContext();</span><br><span class="line">    Object c = (testService)SpringContextUtil.getBean(&quot;jiang&quot;);</span><br><span class="line">    //Object str = c.getClass().getMethod(&quot;haha&quot;, String.class).invoke(c, &quot;nihaoa&quot;);</span><br><span class="line">    Object str = c.getClass().getMethod(&quot;haha&quot;, new Class[]&#123;int.class,String.class&#125;).invoke(c, 16,&quot;nihaoa&quot;);</span><br><span class="line">    return (String)str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-根据属性获取属性值"><a href="#4-根据属性获取属性值" class="headerlink" title="4.根据属性获取属性值"></a>4.根据属性获取属性值</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">         * 根据属性获取属性值</span><br><span class="line">         * @param fieldName</span><br><span class="line">         * @param object</span><br><span class="line">         * @return</span><br><span class="line">         */</span><br><span class="line">        public static Double getFieldValueByFieldName(String fieldName,Object object) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Field field = object.getClass().getDeclaredField(fieldName);</span><br><span class="line">                if(field!=null)&#123;</span><br><span class="line">                    //对private的属性的访问</span><br><span class="line">                    field.setAccessible(true);</span><br><span class="line">                    return (Double) field.get(object);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    return null;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>反射</tag>
      </tags>
  </entry>
  <entry>
    <title>拦截器与过滤器</title>
    <url>/2021/11/30/%E6%8B%A6%E6%88%AA%E5%99%A8%E4%B8%8E%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
    <content><![CDATA[<h1 id="1-拦截器Interceptor"><a href="#1-拦截器Interceptor" class="headerlink" title="1.拦截器Interceptor"></a>1.拦截器Interceptor</h1><h2 id="1-1新建config包"><a href="#1-1新建config包" class="headerlink" title="1.1新建config包"></a>1.1新建config包</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class SpringConfiguration implements WebMvcConfigurer &#123;</span><br><span class="line">	//自定义拦截器</span><br><span class="line">    @Autowired</span><br><span class="line">    LoginInterceptor  loginInterceptor ;</span><br><span class="line">    @Override</span><br><span class="line">    public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">        //注册拦截器，除了登陆与注册之外，因为登陆注册不需要登陆也可以访问</span><br><span class="line">        registry.addInterceptor(loginInterceptor ).addPathPatterns(&quot;/**&quot;).excludePathPatterns(&quot;/login&quot;, &quot;/register&quot;);;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-自定义拦截器"><a href="#1-2-自定义拦截器" class="headerlink" title="1.2.自定义拦截器"></a>1.2.自定义拦截器</h2><p>@Component<br>public class LoginInterceptor implements HandlerInterceptor {</p>
<pre><code>/**
     * @Description 在业务处理器处理请求之前被调用。预处理，可以进行编码、安全控制等处理；
     * @Date 2019/5/14 16:04
     * @Version  1.0
     */
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;
        System.out.println(request.getRequestURL()+&quot;===========preHandle===========&quot;);
        String token = request.getParameter(&quot;token&quot;);
        if(StringUtils.isNotEmpty(token))&#123;
            Subject subject = ShiroUtil.getSubject(token);
            if(subject != null &amp;&amp; subject.isAuthenticated())&#123;
                return true;
            &#125; else&#123;
                //返回校验token结果
                returnJson(response);
               // return false; 
            &#125;
        &#125;

        return true;
    &#125;
</code></pre>
<p>​<br>        @Override<br>        public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception {<br>            System.out.println(request.getContextPath()+”============postHandle==========”);<br>        }<br>        /**<br>         * @Description 在DispatcherServlet完全处理完请求后被调用，也就是说视图渲染已经完毕或者调用者已经拿到结果<br>         * @Date 2019/5/14 16:05<br>         * @Version  1.0<br>         */<br>        @Override<br>        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception {<br>            System.out.println(request.getContextPath()+”============afterCompletion==========”);<br>        }</p>
<pre><code>    private void returnJson(HttpServletResponse response)&#123;
        PrintWriter writer = null;
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        response.setContentType(&quot;application/json; charset=utf-8&quot;);
        try &#123;
            writer = response.getWriter();
            Map&lt;String, Object&gt; result = PackageReturnResult.returnJson(400, &quot;用户令牌token无效&quot;);
            result.put(&quot;data&quot;, null);
            writer.print(result);
        &#125; catch (IOException e)&#123;
            LoggerUtil.logError(ECInterceptor.class, &quot;拦截器输出流异常&quot;+e);
        &#125; finally &#123;
            if(writer != null)&#123;
                writer.close();
            &#125;
        &#125;
    &#125;
</code></pre>
<h3 id="这个感觉挺好"><a href="#这个感觉挺好" class="headerlink" title="这个感觉挺好"></a>这个感觉挺好</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class LoginInterceptor implements HandlerInterceptor &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private UserService userService;</span><br><span class="line">    @Value(&quot;$&#123;SSO_LOGIN_URL&#125;&quot;)</span><br><span class="line">    private String SSO_LOGIN_URL;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">            Object object) throws Exception &#123;</span><br><span class="line">        // 1、拦截请求url</span><br><span class="line">        // 2、从cookie中取token</span><br><span class="line">        // 3、如果没有toke跳转到登录页面。</span><br><span class="line">        // 4、取到token，需要调用sso系统的服务查询用户信息。</span><br><span class="line">        TbUser user = userService.getUserByToken(request, response);</span><br><span class="line">        // 5、如果用户session已经过期，跳转到登录页面</span><br><span class="line">        if (user == null) &#123;</span><br><span class="line">            response.sendRedirect(SSO_LOGIN_URL+&quot;?redirectURL=&quot;+request.getRequestURI());</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        //把用户对象放入request中</span><br><span class="line">        request.setAttribute(&quot;user&quot;, user);</span><br><span class="line">        // 6、如果没有过期，放行。</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void afterCompletion(HttpServletRequest arg0,</span><br><span class="line">            HttpServletResponse response, Object object, Exception exception)</span><br><span class="line">            throws Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void postHandle(HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">            Object object, ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="2-过滤器filter"><a href="#2-过滤器filter" class="headerlink" title="2.过滤器filter"></a>2.过滤器filter</h1><h3 id="过滤器实现方式"><a href="#过滤器实现方式" class="headerlink" title="过滤器实现方式"></a>过滤器实现方式</h3><p>自定义的过滤器都必须实现javax.Servlet.Filter接口，并重写接口中定义的三个方法：</p>
<p><strong>1.void init(FilterConfig config)</strong></p>
<p>用于完成Filter的初始化。</p>
<p><strong>2.void destory()</strong></p>
<p>用于Filter销毁前，完成某些资源的回收。</p>
<p><strong>3.void doFilter(ServletRequest request,ServletResponse response,FilterChain chain)</strong></p>
<p>实现过滤功能，即对每个请求及响应增加的额外的预处理和后处理。,执行该方法之前，即对用户请求进行预处理；执行该方法之后，即对服务器响应进行后处理。</p>
<p>值得注意的是，chain.doFilter()方法执行之前为预处理阶段，该方法执行结束即代表用户的请求已经得到控制器处理。因此，如果在doFilter中忘记调用chain.doFilter()方法，则用户的请求将得不到处理。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.filter.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @desc 自定义过滤器，可以在这里处理中文乱码等问题</span></span><br><span class="line"><span class="comment"> * @Author wangsh</span></span><br><span class="line"><span class="comment"> * @date 2018/5/6 15:44</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public class CharacterFilter implements Filter &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 服务启动,调用初始化方法</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @param filterConfig</span></span><br><span class="line"><span class="comment">    * @throws ServletException</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   @Override</span><br><span class="line">   public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line"></span><br><span class="line">      System.out.<span class="built_in">println</span>(<span class="string">&quot;服务启动,调用过滤器Filter初始化方法init()..........&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 请求时调用</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @param servletRequest</span></span><br><span class="line"><span class="comment">    * @param servletResponse</span></span><br><span class="line"><span class="comment">    * @param filterChain</span></span><br><span class="line"><span class="comment">    * @throws IOException</span></span><br><span class="line"><span class="comment">    * @throws ServletException</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   @Override</span><br><span class="line">   public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">      System.out.<span class="built_in">println</span>(<span class="string">&quot;发送请求时,调用过滤器Filter的doFilter()方法..........&quot;</span>);</span><br><span class="line">      <span class="comment">//放行通过</span></span><br><span class="line">      filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 销毁调用</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   @Override</span><br><span class="line">   public void destroy() &#123;</span><br><span class="line"></span><br><span class="line">      System.out.<span class="built_in">println</span>(<span class="string">&quot;服务关闭，调用过滤器Filter的销毁方法destroy()..........&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.springboot.filter.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springboot.filter.filter.CharacterFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 注册bean, 将自定义过滤器添加到过滤器链中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wangsh</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/5/6 15:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 注册过滤器,有两种方式：</span></span><br><span class="line"><span class="comment">    * 1) 使用 <span class="doctag">@Component</span> 注解&lt;br&gt;</span></span><br><span class="line"><span class="comment">    * 2) 添加到过滤器链中，此方式适用于使用第三方的过滤器。将过滤器写到 WebConfig 类中，如下：</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">filterRegistrationBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      FilterRegistrationBean registrationBean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line"></span><br><span class="line">      CharacterFilter filter = <span class="keyword">new</span> CharacterFilter();</span><br><span class="line">      registrationBean.setFilter(filter);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置过滤器拦截请求</span></span><br><span class="line">      List&lt;String&gt; urls = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      urls.add(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">      registrationBean.setUrlPatterns(urls);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> registrationBean;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>拦截器与过滤器</tag>
      </tags>
  </entry>
  <entry>
    <title>跨域问题</title>
    <url>/2021/11/30/%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">第一种方法</span><br><span class="line"><span class="keyword">package</span> com.jiang.websocket.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebMvcConfigurer</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String ORIGINS[]=<span class="keyword">new</span> String[] &#123;<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;PUT&quot;</span>,<span class="string">&quot;DELETE&quot;</span>&#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span></span>&#123;</span><br><span class="line">            registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                    .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                    .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">                    .allowedMethods(ORIGINS)</span><br><span class="line">                    .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>第二种</p>
<p>在controller的方法上+@CrossOrigin</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210830173643434.png" alt="image-20210830173643434"></p>
<p>第三种</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tulingxueyuan.mall.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.CorsFilter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局跨域配置</span></span><br><span class="line"><span class="comment"> * Created by macro on 2019/7/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 允许跨域调用的过滤器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        <span class="comment">//允许所有域名进行跨域调用</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//允许跨越发送cookie</span></span><br><span class="line">        config.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//放行全部原始头信息</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//允许所有请求方法跨域调用</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        UrlBasedCorsConfigurationSource source = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="谷粒商城项目"><a href="#谷粒商城项目" class="headerlink" title="谷粒商城项目"></a>谷粒商城项目</h1><h3 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h3><p>域名，端口，ip，有一个不一样即为跨域</p>
<p><strong>简单请求</strong>（get，post，head）</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211027095032025.png" alt="image-20211027095032025"></p>
<p><strong>非简单请求</strong></p>
<p>put，delete等</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211027095233337.png" alt="image-20211027095233337"></p>
<p>如果是非简单请求，会先发送一个options请求,如果允许跨域，才会发送真正的请求</p>
<h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211027095611534.png" alt="image-20211027095611534"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211027095636395.png" alt="image-20211027095636395"></p>
<p>用第二种，在网关里配置，统一解决跨域问题</p>
<p>创建config文件夹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class GulimallCorsConfiguration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">    public CorsWebFilter corsWebFilter()&#123;</span><br><span class="line">        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();</span><br><span class="line">        CorsConfiguration config=new CorsConfiguration();</span><br><span class="line">        //配置跨域</span><br><span class="line">        //允许所有域名进行跨域调用</span><br><span class="line">        config.addAllowedOrigin(&quot;*&quot;);</span><br><span class="line">        //允许跨越发送cookie</span><br><span class="line">        config.setAllowCredentials(true);</span><br><span class="line">        //放行全部原始头信息</span><br><span class="line">        config.addAllowedHeader(&quot;*&quot;);</span><br><span class="line">        //允许所有请求方法跨域调用</span><br><span class="line">        config.addAllowedMethod(&quot;*&quot;);</span><br><span class="line">        source.registerCorsConfiguration(&quot;/**&quot;,config);</span><br><span class="line">        return new CorsWebFilter(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>跨域问题</tag>
      </tags>
  </entry>
  <entry>
    <title>阿里巴巴开发手册</title>
    <url>/2021/11/30/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/</url>
    <content><![CDATA[<h1 id="命名风格"><a href="#命名风格" class="headerlink" title="命名风格"></a>命名风格</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3. 【参考】分层领域模型规约：</span><br><span class="line"> DO（Data Object）：与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。</span><br><span class="line"> DTO（Data Transfer Object）：数据传输对象，Service 或 Manager 向外传输的对象。</span><br><span class="line"> BO（Business Object）：业务对象。由 Service 层输出的封装业务逻辑的对象。</span><br><span class="line"> AO（Application Object）：应用对象。在 Web 层与 Service 层之间抽象的复用对象模型，</span><br><span class="line">极为贴近展示层，复用度不高。</span><br><span class="line"> VO（View Object）：显示层对象，通常是 Web 向模板渲染引擎层传输的对象。</span><br><span class="line"> Query：数据查询对象，各层接收上层的查询请求。注意超过 2 个参数的查询封装，禁止</span><br><span class="line">使用 Map 类来传输。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 【强制】类名使用 UpperCamelCase 风格，必须遵从驼峰形式，但以下情形例外：DO / BO /</span><br><span class="line">   DTO / VO / AO</span><br><span class="line">   正例：MarcoPolo / UserDO / XmlService / TcpUdpDeal / TaPromotion</span><br><span class="line">   反例：macroPolo / UserDo / XMLService / TCPUDPDeal / TAPromotion</span><br><span class="line">2. 【强制】POJO 类中布尔类型的变量，都不要加 is，否则部分框架解析会引起序列化错误。</span><br><span class="line">   反例：定义为基本数据类型 Boolean isDeleted；的属性，它的方法也是 isDeleted()，RPC</span><br><span class="line">   阿里巴巴 Java 开发手册</span><br><span class="line">    ——禁止用于商业用途，违者必究—— 2 /35</span><br><span class="line">   框架在反向解析的时候，“以为”对应的属性名称是 deleted，导致属性获取不到，进而抛出异</span><br><span class="line">   常。</span><br><span class="line">3. 【推荐】接口类中的方法和属性不要加任何修饰符号（public 也不要加），保持代码的简洁</span><br><span class="line">   性，并加上有效的 Javadoc 注释。尽量不要在接口里定义变量，如果一定要定义变量，肯定是</span><br><span class="line">   与接口方法相关，并且是整个应用的基础常量。</span><br><span class="line">   正例：接口方法签名：void f();</span><br><span class="line">    接口基础常量表示：String COMPANY = &quot;alibaba&quot;;</span><br><span class="line">   反例：接口方法定义：public abstract void f();</span><br><span class="line">   说明：JDK8 中接口允许有默认实现，那么这个 default 方法，是对所有实现类都有价值的默</span><br><span class="line">   认实现。</span><br><span class="line">4. 【参考】枚举类名建议带上 Enum 后缀，枚举成员名称需要全大写，单词间用下划线隔开。</span><br><span class="line">   说明：枚举其实就是特殊的常量类，且构造方法被默认强制是私有。</span><br><span class="line">   正例：枚举名字为 ProcessStatusEnum 的成员名称：SUCCESS / UNKOWN_REASON。</span><br><span class="line">5. 【参考】各层命名规约：</span><br><span class="line">   A) Service/DAO 层方法命名规约</span><br><span class="line">   1） 获取单个对象的方法用 get 做前缀。</span><br><span class="line">   2） 获取多个对象的方法用 list 做前缀。</span><br><span class="line">   3） 获取统计值的方法用 count 做前缀。</span><br><span class="line">   4） 插入的方法用 save/insert 做前缀。</span><br><span class="line">   5） 删除的方法用 remove/delete 做前缀。</span><br><span class="line">   6） 修改的方法用 update 做前缀。</span><br><span class="line">   B) 领域模型命名规约</span><br><span class="line">   1） 数据对象：xxxDO，xxx 即为数据表名。</span><br><span class="line">   2） 数据传输对象：xxxDTO，xxx 为业务领域相关的名称。</span><br><span class="line">   3） 展示对象：xxxVO，xxx 一般为网页名称。</span><br><span class="line">   4） POJO 是 DO/DTO/BO/VO 的统称，禁止命名成 xxxPOJO。</span><br></pre></td></tr></table></figure>

<h1 id="常量定义"><a href="#常量定义" class="headerlink" title="常量定义"></a>常量定义</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 【强制】不允许任何魔法值（即未经定义的常量）直接出现在代码中。</span><br><span class="line">反例：String key = &quot;Id#taobao_&quot; + tradeId;</span><br><span class="line"> cache.put(key, value);</span><br><span class="line"> </span><br><span class="line">2. 【强制】long 或者 Long 初始赋值时，使用大写的 L，不能是小写的 l，小写容易跟数字 1 混</span><br><span class="line">淆，造成误解。</span><br><span class="line">说明：Long a = 2l; 写的是数字的 21，还是 Long 型的 2?</span><br></pre></td></tr></table></figure>

<h1 id="代码格式"><a href="#代码格式" class="headerlink" title="代码格式"></a>代码格式</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 缩进 4 个空格</span></span><br><span class="line">    String say = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="comment">// 运算符的左右必须有一个空格</span></span><br><span class="line">    <span class="keyword">int</span> flag = <span class="number">0</span>; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关键词 if 与括号之间必须有一个空格，括号内的 f 与左括号，0 与右括号不需要空格</span></span><br><span class="line">    <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</span><br><span class="line">    	System.out.println(say);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 左大括号前加空格且不换行；左大括号后换行</span></span><br><span class="line">    <span class="keyword">if</span> (flag == <span class="number">1</span>) &#123;</span><br><span class="line">    	System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    <span class="comment">// 右大括号前换行，右大括号后有 else，不用换行</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    <span class="comment">// 在右大括号后直接结束，则必须换行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="number">6.</span> 【强制】注释的双斜线与注释内容之间有且仅有一个空格。</span><br><span class="line">正例：<span class="comment">// 注释内容，注意在//和注释内容之间有一个空格。</span></span><br><span class="line">    </span><br><span class="line"><span class="number">7.</span> 【强制】单行字符数限制不超过 <span class="number">120</span> 个，超出需要换行，换行时遵循如下原则：</span><br><span class="line"><span class="number">1</span>） 第二行相对第一行缩进 <span class="number">4</span> 个空格，从第三行开始，不再继续缩进，参考示例。</span><br><span class="line"><span class="number">2</span>） 运算符与下文一起换行。</span><br><span class="line"><span class="number">3</span>） 方法调用的点符号与下文一起换行。</span><br><span class="line"><span class="number">4</span>） 方法调用时，多个参数，需要换行时，在逗号后进行。</span><br><span class="line"><span class="number">5</span>） 在括号前不要换行，见反例。</span><br><span class="line">正例：</span><br><span class="line">StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"><span class="comment">// 超过 120 个字符的情况下，换行缩进 4 个空格，点号和方法名称一起换行</span></span><br><span class="line">sb.append(<span class="string">&quot;zi&quot;</span>).append(<span class="string">&quot;xin&quot;</span>)...</span><br><span class="line">.append(<span class="string">&quot;huang&quot;</span>)...</span><br><span class="line">.append(<span class="string">&quot;huang&quot;</span>)...</span><br><span class="line">.append(<span class="string">&quot;huang&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">8.</span> 【强制】方法参数在定义和传入时，多个参数逗号后边必须加空格。</span><br><span class="line">正例：下例中实参的<span class="string">&quot;a&quot;</span>,后边必须要有一个空格。</span><br><span class="line">method(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="number">9.</span> 【强制】IDE 的 text file encoding 设置为 UTF-<span class="number">8</span>; IDE 中文件的换行符使用 Unix 格式，不要使用 Windows 格式。</span><br></pre></td></tr></table></figure>

<h1 id="OOP-规约"><a href="#OOP-规约" class="headerlink" title="OOP 规约"></a>OOP 规约</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 【强制】避免通过一个类的对象引用访问此类的静态变量或静态方法，无谓增加编译器解析成</span><br><span class="line">本，直接用类名来访问即可。</span><br><span class="line"></span><br><span class="line">2. 【强制】所有的覆写方法，必须加@Override 注解。</span><br><span class="line">说明：getObject()与 get0bject()的问题。一个是字母的 O，一个是数字的 0，加@Override</span><br><span class="line">可以准确判断是否覆盖成功。另外，如果在抽象类中对方法签名进行修改，其实现类会马上编译报错。</span><br><span class="line"></span><br><span class="line">6. 【强制】Object 的 equals 方法容易抛空指针异常，应使用常量或确定有值的对象来调用</span><br><span class="line">equals。</span><br><span class="line">正例：&quot;test&quot;.equals(object);</span><br><span class="line">反例：object.equals(&quot;test&quot;);</span><br><span class="line"></span><br><span class="line">7. 【强制】所有的相同类型的包装类对象之间值的比较，全部使用 equals 方法比较。</span><br><span class="line"></span><br><span class="line">8. 关于基本数据类型与包装数据类型的使用标准如下：</span><br><span class="line">1） 【强制】所有的 POJO 类属性必须使用包装数据类型。</span><br><span class="line">2） 【强制】RPC 方法的返回值和参数必须使用包装数据类型。</span><br><span class="line">3） 【推荐】所有的局部变量使用基本数据类型。</span><br><span class="line"></span><br><span class="line">9. 【强制】定义 DO/DTO/VO 等 POJO 类时，不要设定任何属性默认值。</span><br><span class="line"></span><br><span class="line">10. 【强制】序列化类新增属性时，请不要修改 serialVersionUID 字段，避免反序列失败；如</span><br><span class="line">果完全不兼容升级，避免反序列化混乱，那么请修改 serialVersionUID 值。</span><br><span class="line">说明：注意 serialVersionUID 不一致会抛出序列化运行时异常。</span><br><span class="line"></span><br><span class="line">17. 【推荐】循环体内，字符串的连接方式，使用 StringBuilder 的 append 方法进行扩展。</span><br><span class="line">说明：反编译出的字节码文件显示每次循环都会 new 出一个 StringBuilder 对象，然后进行</span><br><span class="line">append 操作，最后通过 toString 方法返回 String 对象，造成内存资源浪费。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="集合处理"><a href="#集合处理" class="headerlink" title="集合处理"></a>集合处理</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 【强制】关于 hashCode 和 equals 的处理，遵循如下规则：</span><br><span class="line">1） 只要重写 equals，就必须重写 hashCode。</span><br><span class="line">2） 因为 Set 存储的是不重复的对象，依据 hashCode 和 equals 进行判断，所以 Set 存储的</span><br><span class="line">对象必须重写这两个方法。</span><br><span class="line">3） 如果自定义对象做为 Map 的键，那么必须重写 hashCode 和 equals。</span><br><span class="line">说明：String 重写了 hashCode 和 equals 方法，所以我们可以非常愉快地使用 String 对象</span><br><span class="line">作为 key 来使用。</span><br><span class="line"></span><br><span class="line">4. 【强制】使用集合转数组的方法，必须使用集合的 toArray(T[] array)，传入的是类型完全</span><br><span class="line">一样的数组，大小就是 list.size()。</span><br><span class="line">正例：</span><br><span class="line">List&lt;String&gt; list = new ArrayList&lt;String&gt;(2);</span><br><span class="line">list.add(&quot;guan&quot;);</span><br><span class="line">list.add(&quot;bao&quot;);</span><br><span class="line">String[] array = new String[list.size()];</span><br><span class="line">array = list.toArray(array); </span><br><span class="line"></span><br><span class="line">5. 【强制】使用工具类 Arrays.asList()把数组转换成集合时，不能使用其修改集合相关的方</span><br><span class="line">法，它的 add/remove/clear 方法会抛出 UnsupportedOperationException 异常。</span><br><span class="line">说明：asList 的返回对象是一个 Arrays 内部类，并没有实现集合的修改方法。Arrays.asList</span><br><span class="line">体现的是适配器模式，只是转换接口，后台的数据仍是数组。</span><br><span class="line"> String[] str = new String[] &#123; &quot;you&quot;, &quot;wu&quot; &#125;;</span><br><span class="line"> List list = Arrays.asList(str);</span><br><span class="line">第一种情况：list.add(&quot;yangguanbao&quot;); 运行时异常。</span><br><span class="line">第二种情况：str[0] = &quot;gujin&quot;; 那么 list.get(0)也会随之修改。</span><br><span class="line"></span><br><span class="line">7. 【强制】不要在 foreach 循环里进行元素的 remove/add 操作。remove 元素请使用 Iterator</span><br><span class="line">方式，如果并发操作，需要对 Iterator 对象加锁。</span><br><span class="line">正例：</span><br><span class="line">Iterator&lt;String&gt; iterator = list.iterator();</span><br><span class="line">while (iterator.hasNext()) &#123;</span><br><span class="line">String item = iterator.next();</span><br><span class="line">if (删除元素的条件) &#123;</span><br><span class="line">iterator.remove();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">9. 【推荐】集合初始化时，指定集合初始值大小。</span><br><span class="line"></span><br><span class="line">10. 【推荐】使用 entrySet 遍历 Map 类集合 KV，而不是 keySet 方式进行遍历。</span><br></pre></td></tr></table></figure>

<h1 id="并发处理"><a href="#并发处理" class="headerlink" title="并发处理"></a>并发处理</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3. 【强制】线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。</span><br><span class="line"></span><br><span class="line">4. 【强制】线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样</span><br><span class="line">的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 【强制】在一个 <span class="keyword">switch</span> 块内，每个 <span class="keyword">case</span> 要么通过 <span class="keyword">break</span>/<span class="keyword">return</span> 等来终止，要么注释说明程</span><br><span class="line">序将继续执行到哪一个 <span class="keyword">case</span> 为止；在一个 <span class="keyword">switch</span> 块内，都必须包含一个 <span class="keyword">default</span> 语句并且</span><br><span class="line">放在最后，即使它什么代码也没有。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 【强制】在 <span class="keyword">if</span>/<span class="keyword">else</span>/<span class="keyword">for</span>/<span class="keyword">while</span>/<span class="keyword">do</span> 语句中必须使用大括号。即使只有一行代码</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 【推荐】表达异常的分支时，少用 <span class="keyword">if</span>-<span class="keyword">else</span> 方式，这种方式可以改写成：</span><br><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接着写 else 的业务逻辑代码;</span></span><br><span class="line">说明：如果非得使用 <span class="keyword">if</span>()...<span class="function"><span class="keyword">else</span> <span class="title">if</span><span class="params">()</span>...<span class="keyword">else</span>...方式表达逻辑，【强制】避免后续代码维</span></span><br><span class="line"><span class="function">护困难，请勿超过 3 层。</span></span><br><span class="line"><span class="function">正例：超过 3 层的 <span class="keyword">if</span>-<span class="keyword">else</span> 的逻辑判断代码可以使用卫语句、策略模式、状态模式等来实现，</span></span><br><span class="line"><span class="function">其中卫语句示例如下：</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">today</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (isBusy()) &#123;</span><br><span class="line">System.out.println(“change time.”);</span><br><span class="line"> <span class="keyword">return</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span> (isFree()) &#123;</span><br><span class="line">System.out.println(“go to travel.”);</span><br><span class="line"> <span class="keyword">return</span>;</span><br><span class="line"> &#125;</span><br><span class="line">System.out.println(“stay at home to learn Alibaba Java Coding Guidelines.”);</span><br><span class="line"> <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 【推荐】除常用方法（如 getXxx/isXxx）等外，不要在条件判断中执行其它复杂的语句，将复</span><br><span class="line">杂逻辑判断的结果赋值给一个有意义的布尔变量名，以提高可读性。</span><br><span class="line">说明：很多 <span class="keyword">if</span> 语句内的逻辑相当复杂，阅读者需要分析条件表达式的最终结果，才能明确什么</span><br><span class="line">样的条件执行什么样的语句，那么，如果阅读者分析逻辑表达式错误呢？</span><br><span class="line">正例：</span><br><span class="line"><span class="comment">// 伪代码如下</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">boolean</span> existed = (file.open(fileName, <span class="string">&quot;w&quot;</span>) != <span class="keyword">null</span>) &amp;&amp; (...) || (...);</span><br><span class="line"><span class="keyword">if</span> (existed) &#123;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br><span class="line">反例：</span><br><span class="line"><span class="keyword">if</span> ((file.open(fileName, <span class="string">&quot;w&quot;</span>) != <span class="keyword">null</span>) &amp;&amp; (...) || (...)) &#123;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> 【推荐】循环体中的语句要考量性能，以下操作尽量移至循环体外处理，如定义对象、变量</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h1 id="注释规约"><a href="#注释规约" class="headerlink" title="注释规约"></a>注释规约</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 【强制】类、类属性、类方法的注释必须使用 Javadoc 规范，使用/**内容*/格式，不得使用</span><br><span class="line">// xxx 方式。</span><br><span class="line">说明：在 IDE 编辑窗口中，Javadoc 方式会提示相关注释，生成 Javadoc 可以正确输出相应注</span><br><span class="line">释；在 IDE 中，工程调用方法时，不进入方法即可悬浮提示方法、参数、返回值的意义，提高</span><br><span class="line">阅读效率。</span><br><span class="line"></span><br><span class="line">2. 【强制】所有的抽象方法（包括接口中的方法）必须要用 Javadoc 注释、除了返回值、参数、</span><br><span class="line">异常说明外，还必须指出该方法做什么事情，实现什么功能。</span><br><span class="line">说明：对子类的实现要求，或者调用注意事项，请一并说明。</span><br><span class="line"></span><br><span class="line">3. 【强制】所有的类都必须添加创建者和创建日期。</span><br><span class="line"></span><br><span class="line">4. 【强制】方法内部单行注释，在被注释语句上方另起一行，使用//注释。方法内部多行注释</span><br><span class="line">使用/* */注释，注意与代码对齐。</span><br></pre></td></tr></table></figure>

<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">5. 【强制】获取当前毫秒数 System.currentTimeMillis(); 而不是 new Date().getTime();</span><br></pre></td></tr></table></figure>

<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 【强制】Java 类库中定义的一类 RuntimeException 可以通过预先检查进行规避，而不应该</span><br><span class="line">通过 catch 来处理，比如：IndexOutOfBoundsException，NullPointerException 等等。</span><br><span class="line">说明：无法通过预检查的异常除外，如在解析一个外部传来的字符串形式数字时，通过 catch</span><br><span class="line">NumberFormatException 来实现。</span><br><span class="line">正例：if (obj != null) &#123;...&#125;</span><br><span class="line">反例：try &#123; obj.method() &#125; catch (NullPointerException e) &#123;...&#125;</span><br><span class="line"></span><br><span class="line">7. 【强制】不能在 finally 块中使用 return，finally 块中的 return 返回后方法结束执行，不</span><br><span class="line">会再执行 try 块中的 return 语句。</span><br></pre></td></tr></table></figure>

<h1 id="安全规约-！"><a href="#安全规约-！" class="headerlink" title="安全规约 ！"></a>安全规约 ！</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2. 【强制】用户敏感数据禁止直接展示，必须对展示数据进行脱敏。</span><br><span class="line">说明：查看个人手机号码会显示成:158****9119，隐藏中间 4 位，防止隐私泄露。</span><br><span class="line">3. 【强制】用户输入的 SQL 参数严格使用参数绑定或者 METADATA 字段值限定，防止 SQL 注入，</span><br><span class="line">禁止字符串拼接 SQL 访问数据库。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="MySQL-数据库"><a href="#MySQL-数据库" class="headerlink" title="MySQL 数据库"></a>MySQL 数据库</h1><h2 id="一-建表规约"><a href="#一-建表规约" class="headerlink" title="(一)建表规约"></a>(一)建表规约</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 【强制】表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint</span><br><span class="line">（ 1 表示是，0 表示否）。</span><br><span class="line">说明：任何字段如果为非负数，必须是 unsigned。</span><br><span class="line">正例：表达逻辑删除的字段名 is_deleted，1 表示删除，0 表示未删除。</span><br></pre></td></tr></table></figure>

<h2 id="SQL-语句"><a href="#SQL-语句" class="headerlink" title="SQL 语句"></a>SQL 语句</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 【强制】不要使用 count(列名)或 count(常量)来替代 count(*)，count(*)是 SQL92 定义的</span><br><span class="line">标准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关。</span><br><span class="line">说明：count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>阿里巴巴开发手册</tag>
      </tags>
  </entry>
  <entry>
    <title>io</title>
    <url>/2021/11/30/io%E6%B5%81/</url>
    <content><![CDATA[<h1 id="1-MultipartFile-转-File"><a href="#1-MultipartFile-转-File" class="headerlink" title="1.MultipartFile 转 File"></a>1.MultipartFile 转 File</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * MultipartFile 转 File</span><br><span class="line"> *</span><br><span class="line"> * @param file</span><br><span class="line"> * @throws Exception</span><br><span class="line"> */</span><br><span class="line">public static File multipartFileToFile(MultipartFile file) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">    File toFile = null;</span><br><span class="line">    if (&quot;&quot;.equals(file) || file.getSize() &lt;= 0) &#123;</span><br><span class="line">        file = null;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        InputStream ins = null;</span><br><span class="line">        ins = file.getInputStream();</span><br><span class="line">        toFile = new File(file.getOriginalFilename());</span><br><span class="line">        inputStreamToFile(ins, toFile);</span><br><span class="line">        ins.close();</span><br><span class="line">    &#125;</span><br><span class="line">    return toFile;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-获取json文件的内容"><a href="#2-获取json文件的内容" class="headerlink" title="2.获取json文件的内容"></a>2.获取json文件的内容</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取json文件的内容</span><br><span class="line"> *</span><br><span class="line"> * @param fileName</span><br><span class="line"> * @return</span><br><span class="line"> * @throws Exception</span><br><span class="line"> */</span><br><span class="line">public String readJsonFile(MultipartFile fileName) &#123;</span><br><span class="line">    String jsonStr = &quot;&quot;;</span><br><span class="line">    try &#123;</span><br><span class="line">        File file = multipartFileToFile(fileName);</span><br><span class="line">        FileReader fileReader = new FileReader(file);</span><br><span class="line">        Reader reader = new InputStreamReader(new FileInputStream(file), &quot;utf-8&quot;);</span><br><span class="line">        int ch = 0;</span><br><span class="line">        StringBuffer sb = new StringBuffer();</span><br><span class="line">        while ((ch = reader.read()) != -1) &#123;</span><br><span class="line">            sb.append((char) ch);</span><br><span class="line">        &#125;</span><br><span class="line">        fileReader.close();</span><br><span class="line">        reader.close();</span><br><span class="line">        jsonStr = sb.toString();</span><br><span class="line">        return jsonStr;</span><br><span class="line">    &#125; catch (IOException e) &#123;</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">        return null;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-in流和out流"><a href="#3-in流和out流" class="headerlink" title="3.in流和out流"></a>3.in流和out流</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">   InputStream inputStream = null;</span><br><span class="line">   OutputStream outputStream = null;</span><br><span class="line">   try &#123;</span><br><span class="line">      String path=&quot;D:&quot;+File.separator;</span><br><span class="line">      //获取file对象,不存在创建</span><br><span class="line">      File file = FileUtil.newFile(path+&quot;a.txt&quot;);</span><br><span class="line">      if(!FileUtil.exist(file))&#123;</span><br><span class="line">         file.createNewFile();</span><br><span class="line">      &#125;</span><br><span class="line">      inputStream = FileUtil.getInputStream(file);</span><br><span class="line">      byte[] buffer = new byte[inputStream.available()];</span><br><span class="line">      inputStream.read(buffer);</span><br><span class="line">      //无需显示的创建，自动会创建</span><br><span class="line">      File toFile = FileUtil.newFile(path+&quot;b.txt&quot;);</span><br><span class="line">      outputStream = FileUtil.getOutputStream(toFile);</span><br><span class="line">      outputStream.write(buffer);</span><br><span class="line">      outputStream.flush();</span><br><span class="line">   &#125; catch (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">   &#125; finally &#123;</span><br><span class="line">      if (outputStream != null) &#123;</span><br><span class="line">         try &#123;</span><br><span class="line">            outputStream.close();</span><br><span class="line">         &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      if (inputStream != null) &#123;</span><br><span class="line">         try &#123;</span><br><span class="line">            inputStream.close();</span><br><span class="line">         &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-json工具类"><a href="#4-json工具类" class="headerlink" title="4.json工具类"></a>4.json工具类</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.boco.nbd.upload.station.utils;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author:jiangjiaxu</span><br><span class="line"> * @date 2021/11/11  14:00</span><br><span class="line"> * @version:V1.0</span><br><span class="line"> * @description:生成json文件工具类</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class JsonUtil &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;res.path&#125;&quot;)</span><br><span class="line">    private String resPath;</span><br><span class="line"></span><br><span class="line">    private static final String SUFFIX = &quot;.json&quot;;</span><br><span class="line"></span><br><span class="line">    private static final int BYTE = 8192;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建.json格式文件</span><br><span class="line">     *</span><br><span class="line">     * @param jsonStr  json文件内容</span><br><span class="line">     * @param filePath json文件路径</span><br><span class="line">     */</span><br><span class="line">    public int createJsonFile(String jsonStr, String filePath) &#123;</span><br><span class="line">        Writer write = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            //格式化json字符串</span><br><span class="line">            String json = formatJson(jsonStr);</span><br><span class="line">            String code = &quot;702&quot;;</span><br><span class="line">            if (!code.equals(json)) &#123;</span><br><span class="line">                String fullPath = resPath + filePath + SUFFIX;</span><br><span class="line">                File file = new File(fullPath);</span><br><span class="line">                // 如果父目录不存在，创建父目录</span><br><span class="line">                if (!file.getParentFile().exists()) &#123;</span><br><span class="line">                    file.getParentFile().mkdirs();</span><br><span class="line">                &#125;</span><br><span class="line">                if (file.exists()) &#123;</span><br><span class="line">                    return 707;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line"></span><br><span class="line">                    file.createNewFile();</span><br><span class="line">                    write = new OutputStreamWriter(new FileOutputStream(file), &quot;UTF-8&quot;);</span><br><span class="line">                    write.write(json);</span><br><span class="line">                    log.info(&quot;File created successfully！:&quot; + fullPath);</span><br><span class="line">                    write.flush();</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return 702;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (write != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    write.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    log.error(e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回格式化的json字符串</span><br><span class="line">     *</span><br><span class="line">     * @param json</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static String formatJson(String json) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            JSONObject object = JSONObject.parseObject(json);</span><br><span class="line">            json = JSON.toJSONString(object, SerializerFeature.PrettyFormat, SerializerFeature.WriteMapNullValue, SerializerFeature.WriteDateUseDateFormat);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            return &quot;702&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取json文件的内容</span><br><span class="line">     *</span><br><span class="line">     * @param fileName</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    public String readJsonFile(MultipartFile fileName) &#123;</span><br><span class="line">        String jsonStr = &quot;&quot;;</span><br><span class="line">        try &#123;</span><br><span class="line">            File file = multipartFileToFile(fileName);</span><br><span class="line">            FileReader fileReader = new FileReader(file);</span><br><span class="line">            Reader reader = new InputStreamReader(new FileInputStream(file), &quot;utf-8&quot;);</span><br><span class="line">            int ch = 0;</span><br><span class="line">            StringBuffer sb = new StringBuffer();</span><br><span class="line">            while ((ch = reader.read()) != -1) &#123;</span><br><span class="line">                sb.append((char) ch);</span><br><span class="line">            &#125;</span><br><span class="line">            fileReader.close();</span><br><span class="line">            reader.close();</span><br><span class="line">            jsonStr = sb.toString();</span><br><span class="line">            return jsonStr;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            return null;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * MultipartFile 转 File</span><br><span class="line">     *</span><br><span class="line">     * @param file</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    public static File multipartFileToFile(MultipartFile file) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        File toFile = null;</span><br><span class="line">        if (&quot;&quot;.equals(file) || file.getSize() &lt;= 0) &#123;</span><br><span class="line">            file = null;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            InputStream ins = null;</span><br><span class="line">            ins = file.getInputStream();</span><br><span class="line">            toFile = new File(file.getOriginalFilename());</span><br><span class="line">            inputStreamToFile(ins, toFile);</span><br><span class="line">            ins.close();</span><br><span class="line">        &#125;</span><br><span class="line">        return toFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取文件io流</span><br><span class="line">     *</span><br><span class="line">     * @param ins</span><br><span class="line">     * @param file</span><br><span class="line">     */</span><br><span class="line">    private static void inputStreamToFile(InputStream ins, File file) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            OutputStream os = new FileOutputStream(file);</span><br><span class="line">            int bytesRead = 0;</span><br><span class="line">            byte[] buffer = new byte[BYTE];</span><br><span class="line">            while ((bytesRead = ins.read(buffer, 0, BYTE)) != -1) &#123;</span><br><span class="line">                os.write(buffer, 0, bytesRead);</span><br><span class="line">            &#125;</span><br><span class="line">            os.close();</span><br><span class="line">            ins.close();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Response 写入二进制流</span><br><span class="line">     *</span><br><span class="line">     * @param multipartFile 二进制文件</span><br><span class="line">     * @param response      响应内容</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static void setOutPutStream(MultipartFile multipartFile, HttpServletResponse response, String md5, String fileName) &#123;</span><br><span class="line">        InputStream inputStream = null;</span><br><span class="line">        OutputStream outputStream = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            File file = multipartFileToFile(multipartFile);</span><br><span class="line">            inputStream = new BufferedInputStream(new FileInputStream(file));</span><br><span class="line">            byte[] buffer = new byte[inputStream.available()];</span><br><span class="line">            inputStream.read(buffer);</span><br><span class="line">            response.reset();</span><br><span class="line">            response.addHeader(&quot;Content-Length&quot;, &quot;&quot; + file.length());</span><br><span class="line">            response.setHeader(&quot;binfile-md5&quot;, md5);</span><br><span class="line">            response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + fileName);</span><br><span class="line">            outputStream = new BufferedOutputStream(response.getOutputStream());</span><br><span class="line">            outputStream.write(buffer);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (outputStream != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    outputStream.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    log.error(e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (inputStream != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    inputStream.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    log.error(e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int len=0;</span><br><span class="line">byte []buf=new byte[1024];</span><br><span class="line">while((len=in.read(buf))!=-1)&#123;</span><br><span class="line">    os.write(buf, 0, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="服务之间传递流（文件，图片等）"><a href="#服务之间传递流（文件，图片等）" class="headerlink" title="服务之间传递流（文件，图片等）"></a>服务之间传递流（文件，图片等）</h1><p>服务B：被调用方</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RequestMapping(&quot;/download/&#123;name&#125;&quot;)</span><br><span class="line">public byte[] download(@PathVariable(&quot;name&quot;) String name) throws Exception&#123;</span><br><span class="line">    FileInputStream in=null;</span><br><span class="line">    try &#123;</span><br><span class="line">        in=new FileInputStream(new File(&quot;D:&quot;+File.separator+name));</span><br><span class="line"></span><br><span class="line">        BufferedInputStream bufferedInputStream =new BufferedInputStream(in);</span><br><span class="line">        ByteArrayOutputStream byteArrayOutputStream=new ByteArrayOutputStream();</span><br><span class="line">        byte[] buffer=null;</span><br><span class="line">        int len=0;</span><br><span class="line">        byte []buf=new byte[2048];</span><br><span class="line">        while((len=bufferedInputStream.read(buf))!=-1)&#123;</span><br><span class="line">            byteArrayOutputStream.write(buf, 0, len);</span><br><span class="line">        &#125;</span><br><span class="line">        byteArrayOutputStream.flush();</span><br><span class="line">        buffer=byteArrayOutputStream.toByteArray();</span><br><span class="line">        return buffer;</span><br><span class="line">    &#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    &#125;finally &#123;</span><br><span class="line">        if(in!=null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                in.close();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>服务A：调用方</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author:jiangjiaxu</span><br><span class="line"> * @date 2021/09/03  16:23</span><br><span class="line"> * @version:V1.0</span><br><span class="line"> * @description:</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">public class A &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line">//    private final String URL=&quot;http://localhost:8082/test1&quot;;</span><br><span class="line">    private final String URL2=&quot;http://localhost:8082/download&quot;;</span><br><span class="line">//    @RequestMapping(&quot;/test&quot;)</span><br><span class="line">//    public void test()&#123;</span><br><span class="line">//        String success = restTemplate.getForObject(URL, String.class);</span><br><span class="line">//        System.out.println(success);</span><br><span class="line">//    &#125;</span><br><span class="line">//    @RequestMapping(&quot;/test1&quot;)</span><br><span class="line">//    public String test1()&#123;</span><br><span class="line">//        return &quot;haha&quot;;</span><br><span class="line">//    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/accept/&#123;name&#125;&quot;)</span><br><span class="line">    public void accept(@PathVariable(&quot;name&quot;)String name) throws  Exception&#123;</span><br><span class="line">        byte[] bytes = restTemplate.getForObject(URL2 + &quot;/&quot; + name, byte[].class);</span><br><span class="line">        OutputStream os=new FileOutputStream(new File(&quot;D:\\b.jpg&quot;));</span><br><span class="line">        os.write(bytes);</span><br><span class="line">        os.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.conf;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author:jiangjiaxu</span><br><span class="line"> * @date 2021/09/03  16:28</span><br><span class="line"> * @version:V1.0</span><br><span class="line"> * @description:</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class config &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public RestTemplate getRestTemplate()&#123;</span><br><span class="line">        return new RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>文档很全</p>
<p><a href="https://blog.csdn.net/qq_44543508/article/details/102831084?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163117905816780269838127%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163117905816780269838127&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-102831084.first_rank_v2_pc_rank_v29&amp;utm_term=io%E6%B5%81&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/qq_44543508/article/details/102831084?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163117905816780269838127%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163117905816780269838127&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-102831084.first_rank_v2_pc_rank_v29&amp;utm_term=io%E6%B5%81&amp;spm=1018.2226.3001.4187</a></p>
<p><img src="/../img/image-20210910083736002.png" alt="image-20210910083736002"></p>
<p><img src="/../img/image-20210910085822905.png" alt="image-20210910085822905"></p>
<p>GBK是默认的，一般字母、数字都占一个，汉字两个。UTF-8数字、字母一个，汉字三<em>个字节</em>。</p>
<h1 id="字节流"><a href="#字节流" class="headerlink" title="字节流"></a>字节流</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void stream() throws Exception&#123;</span><br><span class="line">    File file = ResourceUtils.getFile(ResourceUtils.CLASSPATH_URL_PREFIX+&quot;static/a.txt&quot;);</span><br><span class="line">    InputStream in=new FileInputStream(file);</span><br><span class="line">    File file1 = new File(&quot;D:\\Idea\\workspace\\demo\\src\\main\\resources\\static\\b.txt&quot;);</span><br><span class="line">    OutputStream os=new FileOutputStream(file1);</span><br><span class="line">    //复制</span><br><span class="line">    int len=0;</span><br><span class="line">    byte []buf=new byte[1024];</span><br><span class="line">    while((len=in.read(buf))!=-1)&#123;</span><br><span class="line">        os.write(buf, 0, len);</span><br><span class="line">    &#125;</span><br><span class="line">    in.close();</span><br><span class="line">    os.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void stream1() throws Exception&#123;</span><br><span class="line">        File file = ResourceUtils.getFile(ResourceUtils.CLASSPATH_URL_PREFIX+&quot;static/a.txt&quot;);</span><br><span class="line">        InputStream in=new FileInputStream(file);</span><br><span class="line">        File file1 = new File(&quot;D:\\Idea\\workspace\\demo\\src\\main\\resources\\static\\b.txt&quot;);</span><br><span class="line">        OutputStream os=new FileOutputStream(file1);</span><br><span class="line">        //复制</span><br><span class="line">        int len=0;</span><br><span class="line">        while((len=in.read())!=-1)&#123;//从输入流读取数据的下一个字节</span><br><span class="line">            os.write(len);</span><br><span class="line">        &#125;</span><br><span class="line">        in.close();</span><br><span class="line">        os.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="字符流"><a href="#字符流" class="headerlink" title="字符流"></a>字符流</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void text() throws Exception&#123;</span><br><span class="line">    File file = ResourceUtils.getFile(ResourceUtils.CLASSPATH_URL_PREFIX+&quot;static/a.txt&quot;);</span><br><span class="line">    FileReader reader=new FileReader(file);</span><br><span class="line">    File file1 = new File(&quot;D:\\Idea\\workspace\\demo\\src\\main\\resources\\static\\b.txt&quot;);</span><br><span class="line">    FileWriter writer=new FileWriter(file1);</span><br><span class="line">    char chs[]=new char[1024];</span><br><span class="line">    int len=0;</span><br><span class="line">    while((len=reader.read(chs))!=-1) &#123;//读数据</span><br><span class="line">        writer.write(chs,0,len);//写数据</span><br><span class="line">    &#125;</span><br><span class="line">    //如果想输出文字但是继续使用流，就要用writer.flush();</span><br><span class="line">    writer.flush();</span><br><span class="line">    reader.close();</span><br><span class="line">    writer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>最后再次强调：<br>字符流，只能操作文本文件，不能操作图片，视频等非文本文件。当我们单纯读或者写文本文件时 使用字符流 其他情况使用字节流</strong></p>
<h1 id="缓冲流"><a href="#缓冲流" class="headerlink" title="缓冲流"></a>缓冲流</h1><h2 id="字节缓冲流"><a href="#字节缓冲流" class="headerlink" title="字节缓冲流"></a>字节缓冲流</h2><p>创建流对象时，会创建一个内置的默认大小的缓冲区数组，通过缓冲区读写，减少系统IO次数，从而提高读写的效率。</p>
<p><img src="/../img/image-20210910094428981.png" alt="image-20210910094428981"></p>
<p>缓冲流读写方法与基本的流是一致的，我们通过复制370多MB的大文件，测试它的效率。</p>
<p>基本流，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">// 记录开始时间</span></span><br><span class="line">      	<span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">		<span class="comment">// 创建流对象</span></span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">        	FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;py.exe&quot;</span>);<span class="comment">//exe文件够大</span></span><br><span class="line">        	FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;copyPy.exe&quot;</span>)</span><br><span class="line">        )&#123;</span><br><span class="line">        	<span class="comment">// 读写数据</span></span><br><span class="line">            <span class="keyword">int</span> b;</span><br><span class="line">            <span class="keyword">while</span> ((b = fis.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                fos.write(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// 记录结束时间</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;普通流复制时间:&quot;</span>+(end - start)+<span class="string">&quot; 毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">不好意思十分钟过去了还在玩命复制中...</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">缓冲流，代码如下：</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">// 记录开始时间</span></span><br><span class="line">      	<span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">		<span class="comment">// 创建流对象</span></span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">         BufferedInputStream bis = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;py.exe&quot;</span>));</span><br><span class="line">	     BufferedOutputStream bos = <span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;copyPy.exe&quot;</span>));</span><br><span class="line">        )&#123;</span><br><span class="line">        <span class="comment">// 读写数据</span></span><br><span class="line">            <span class="keyword">int</span> b;</span><br><span class="line">            <span class="keyword">while</span> ((b = bis.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bos.write(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// 记录结束时间</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;缓冲流复制时间:&quot;</span>+(end - start)+<span class="string">&quot; 毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">缓冲流复制时间:<span class="number">8016</span> 毫秒</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">想要更快可以使用数组的方式，代码如下：</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">      	<span class="comment">// 记录开始时间</span></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">		<span class="comment">// 创建流对象</span></span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">		 BufferedInputStream bis = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;py.exe&quot;</span>));</span><br><span class="line">		 BufferedOutputStream bos = <span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;copyPy.exe&quot;</span>));</span><br><span class="line">        )&#123;</span><br><span class="line">          	<span class="comment">// 读写数据</span></span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8</span>*<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((len = bis.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bos.write(bytes, <span class="number">0</span> , len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// 记录结束时间</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;缓冲流使用数组复制时间:&quot;</span>+(end - start)+<span class="string">&quot; 毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">缓冲流使用数组复制时间:<span class="number">521</span> 毫秒 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="字符缓冲流"><a href="#字符缓冲流" class="headerlink" title="字符缓冲流"></a>字符缓冲流</h2><p>字符缓冲流特有方法</p>
<p>BufferedReader：public String readLine(): 读一行数据。 读取到最后返回null<br>BufferedWriter：public void newLine(): 换行,由系统属性定义符号。<br>readLine方法演示代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">text1</span><span class="params">()</span> <span class="keyword">throws</span> IOException  </span>&#123;</span><br><span class="line">    <span class="comment">// 创建流对象</span></span><br><span class="line">    BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">&quot;D:\\Idea\\workspace\\demo\\src\\main\\resources\\static\\a.txt&quot;</span>));</span><br><span class="line">    BufferedWriter bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">&quot;D:\\Idea\\workspace\\demo\\src\\main\\resources\\static\\b.txt&quot;</span>));</span><br><span class="line">    <span class="comment">// 定义字符串,保存读取的一行文字</span></span><br><span class="line">    String line  = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 循环读取,读取到最后返回null</span></span><br><span class="line">    <span class="keyword">while</span> ((line = br.readLine())!=<span class="keyword">null</span>) &#123;</span><br><span class="line">        bw.write(line);</span><br><span class="line">        <span class="comment">// 写出换行</span></span><br><span class="line">        bw.newLine();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 释放资源</span></span><br><span class="line">    br.close();</span><br><span class="line">    bw.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="对象流"><a href="#对象流" class="headerlink" title="对象流"></a>对象流</h1><p>就是专门用来读各种各样的数据的，比如（int，char，long等）</p>
<p>包装类DataOutputStream、DataInputStream为我们提供了多种对文件的写入和读取方法，如writeBoolean(),writeUTF()，writeCharwriteByte()，writeDouble()等和对应的read方法，这些方法极大的方便了我们的写入和读取操作</p>
<h1 id="转换流"><a href="#转换流" class="headerlink" title="转换流"></a>转换流</h1><h2 id="InputStreamReader类—–-字节流到字符流的桥梁"><a href="#InputStreamReader类—–-字节流到字符流的桥梁" class="headerlink" title="InputStreamReader类—–(字节流到字符流的桥梁)"></a>InputStreamReader类—–(字节流到字符流的桥梁)</h2><p><img src="/../img/image-20210910100620970.png" alt="image-20210910100620970"></p>
<p><img src="/../img/image-20210910100631635.png" alt="image-20210910100631635"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">使用转换流解决编码问题</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReaderDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      	<span class="comment">// 定义文件路径,文件为gbk编码</span></span><br><span class="line">        String FileName = <span class="string">&quot;C:\\A.txt&quot;</span>;</span><br><span class="line">      	<span class="comment">// 创建流对象,默认UTF8编码</span></span><br><span class="line">        InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(FileName));</span><br><span class="line">      	<span class="comment">// 创建流对象,指定GBK编码</span></span><br><span class="line">        InputStreamReader isr2 = <span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(FileName) , <span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">		<span class="comment">// 定义变量,保存字符</span></span><br><span class="line">        <span class="keyword">int</span> read;</span><br><span class="line">      	<span class="comment">// 使用默认编码字符流读取,乱码</span></span><br><span class="line">        <span class="keyword">while</span> ((read = isr.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.print((<span class="keyword">char</span>)read); <span class="comment">// �����ʺ      </span></span><br><span class="line">        &#125;</span><br><span class="line">        isr.close();</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">      	<span class="comment">// 使用指定编码字符流读取,正常解析</span></span><br><span class="line">        <span class="keyword">while</span> ((read = isr2.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.print((<span class="keyword">char</span>)read);<span class="comment">// 哥敢摸屎</span></span><br><span class="line">        &#125;</span><br><span class="line">        isr2.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="OutputStreamWriter类—–-字符流到字节流的桥梁"><a href="#OutputStreamWriter类—–-字符流到字节流的桥梁" class="headerlink" title="OutputStreamWriter类—–(字符流到字节流的桥梁)"></a>OutputStreamWriter类—–(字符流到字节流的桥梁)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OutputDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      	<span class="comment">// 定义文件路径</span></span><br><span class="line">        String FileName = <span class="string">&quot;C:\\s.txt&quot;</span>;</span><br><span class="line">      	<span class="comment">// 创建流对象,默认UTF8编码</span></span><br><span class="line">        OutputStreamWriter osw = <span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(FileName));</span><br><span class="line">        <span class="comment">// 写出数据</span></span><br><span class="line">      	osw.write(<span class="string">&quot;哥敢&quot;</span>); <span class="comment">// 保存为6个字节</span></span><br><span class="line">        osw.close();</span><br><span class="line">      	</span><br><span class="line">		<span class="comment">// 定义文件路径</span></span><br><span class="line">		String FileName2 = <span class="string">&quot;D:\\A.txt&quot;</span>;</span><br><span class="line">     	<span class="comment">// 创建流对象,指定GBK编码</span></span><br><span class="line">        OutputStreamWriter osw2 = <span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(FileName2),<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">        <span class="comment">// 写出数据</span></span><br><span class="line">      	osw2.write(<span class="string">&quot;摸屎&quot;</span>);<span class="comment">// 保存为4个字节</span></span><br><span class="line">        osw2.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="序列化流"><a href="#序列化流" class="headerlink" title="序列化流"></a>序列化流</h1><p><img src="/../img/image-20210910101151089.png" alt="image-20210910101151089"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void xuliehua() throws IOException  &#123;</span><br><span class="line">    user user=new user();</span><br><span class="line">    user.setAge(15);</span><br><span class="line">    user.setName(&quot;aaa&quot;);</span><br><span class="line">    ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(&quot;D:\\Idea\\workspace\\demo\\src\\main\\resources\\static\\b.txt&quot;));</span><br><span class="line">    // 写出对象</span><br><span class="line">    out.writeObject(user);</span><br><span class="line">    // 释放资源</span><br><span class="line">    out.close();</span><br><span class="line">&#125;</span><br><span class="line">public void fanxuliehua() throws IOException, ClassNotFoundException &#123;</span><br><span class="line">    user user=null;</span><br><span class="line"></span><br><span class="line">    FileInputStream fileIn = new FileInputStream(&quot;D:\\Idea\\workspace\\demo\\src\\main\\resources\\static\\b.txt&quot;);</span><br><span class="line">    ObjectInputStream in = new ObjectInputStream(fileIn);// 写出对象</span><br><span class="line">    user = (user) in.readObject();</span><br><span class="line">    // 释放资源</span><br><span class="line">    in.close();</span><br><span class="line">    fileIn.close();</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>user类需要实现Serializable接口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class user implements Serializable &#123;</span><br><span class="line">    String name;</span><br><span class="line">    int age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="打印流"><a href="#打印流" class="headerlink" title="打印流"></a>打印流</h1><h2 id="字节输出打印流PrintStream复制文本文件"><a href="#字节输出打印流PrintStream复制文本文件" class="headerlink" title="字节输出打印流PrintStream复制文本文件"></a>字节输出打印流PrintStream复制文本文件</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.FileReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintStream;</span><br><span class="line"></span><br><span class="line">public class PrintStreamDemo &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        BufferedReader br=new BufferedReader(new FileReader(&quot;copy.txt&quot;));</span><br><span class="line">        PrintStream ps=new PrintStream(&quot;printcopy.txt&quot;);</span><br><span class="line">        String line;</span><br><span class="line">        while((line=br.readLine())!=null) &#123;</span><br><span class="line">            ps.println(line);</span><br><span class="line">        &#125;</span><br><span class="line">        br.close();</span><br><span class="line">        ps.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="字符输出打印流PrintWriter复制文本文件"><a href="#字符输出打印流PrintWriter复制文本文件" class="headerlink" title="字符输出打印流PrintWriter复制文本文件"></a>字符输出打印流PrintWriter复制文本文件</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.FileReader;</span><br><span class="line">import java.io.FileWriter;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">/**</span><br><span class="line"> * 使用打印流复制文本文件</span><br><span class="line"> */</span><br><span class="line">public class PrintWriterDemo &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        BufferedReader br=new BufferedReader(new FileReader(&quot;aa.txt&quot;));</span><br><span class="line">        PrintWriter pw=new PrintWriter(&quot;printcopyaa.txt&quot;);</span><br><span class="line">        String line;</span><br><span class="line">        while((line=br.readLine())!=null) &#123;</span><br><span class="line">            pw.println(line);</span><br><span class="line">        &#125;</span><br><span class="line">        br.close();</span><br><span class="line">        pw.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ProDemo &#123;</span><br><span class="line">    public static void main(String[] args) throws FileNotFoundException &#123;</span><br><span class="line">        // 创建属性集对象</span><br><span class="line">        Properties properties = new Properties();</span><br><span class="line">        // 添加键值对元素</span><br><span class="line">        properties.setProperty(&quot;filename&quot;, &quot;a.txt&quot;);</span><br><span class="line">        properties.setProperty(&quot;length&quot;, &quot;209385038&quot;);</span><br><span class="line">        properties.setProperty(&quot;location&quot;, &quot;D:\\a.txt&quot;);</span><br><span class="line">        // 打印属性集对象</span><br><span class="line">        System.out.println(properties);</span><br><span class="line">        // 通过键,获取属性值</span><br><span class="line">        System.out.println(properties.getProperty(&quot;filename&quot;));</span><br><span class="line">        System.out.println(properties.getProperty(&quot;length&quot;));</span><br><span class="line">        System.out.println(properties.getProperty(&quot;location&quot;));</span><br><span class="line"></span><br><span class="line">        // 遍历属性集,获取所有键的集合</span><br><span class="line">        Set&lt;String&gt; strings = properties.stringPropertyNames();</span><br><span class="line">        // 打印键值对</span><br><span class="line">        for (String key : strings ) &#123;</span><br><span class="line">          	System.out.println(key+&quot; -- &quot;+properties.getProperty(key));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">&#123;filename=a.txt, length=209385038, location=D:\a.txt&#125;</span><br><span class="line">a.txt</span><br><span class="line">209385038</span><br><span class="line">D:\a.txt</span><br><span class="line">filename -- a.txt</span><br><span class="line">length -- 209385038</span><br><span class="line">location -- D:\a.txt</span><br></pre></td></tr></table></figure>

<p>与流相关的方法<br>public void load(InputStream inStream)： 从字节输入流中读取键值对。</p>
<p>参数中使用了字节输入流，通过流对象，可以关联到某文件上，这样就能够加载文本中的数据了。现在文本数据格式如下:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">filename=Properties.txt</span><br><span class="line">length=123</span><br><span class="line">location=C:\Properties.txt</span><br></pre></td></tr></table></figure>

<p>加载代码演示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ProDemo &#123;</span><br><span class="line">    public static void main(String[] args) throws FileNotFoundException &#123;</span><br><span class="line">        // 创建属性集对象</span><br><span class="line">        Properties pro = new Properties();</span><br><span class="line">        // 加载文本中信息到属性集</span><br><span class="line">        pro.load(new FileInputStream(&quot;Properties.txt&quot;));</span><br><span class="line">        // 遍历集合并打印</span><br><span class="line">        Set&lt;String&gt; strings = pro.stringPropertyNames();</span><br><span class="line">        for (String key : strings ) &#123;</span><br><span class="line">          	System.out.println(key+&quot; -- &quot;+pro.getProperty(key));</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">filename -- Properties.txt</span><br><span class="line">length -- 123</span><br><span class="line">location -- C:\Properties.txt</span><br></pre></td></tr></table></figure>

<h1 id="常用转换"><a href="#常用转换" class="headerlink" title="常用转换"></a>常用转换</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//输入流</span><br><span class="line">		BufferedReader bufferedReader=new BufferedReader(new InputStreamReader(inputstream));</span><br><span class="line">		//打印流，注意并不是打印到控制台哦</span><br><span class="line">		PrintStream printStream=new PrintStream(outputStream);</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>io</tag>
      </tags>
  </entry>
  <entry>
    <title>java</title>
    <url>/2021/11/30/java/</url>
    <content><![CDATA[<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><h2 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符</h2><p>a &gt; b ? a : b</p>
<h2 id="下划线转驼峰"><a href="#下划线转驼峰" class="headerlink" title="下划线转驼峰"></a>下划线转驼峰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.boco.nbd.threshold.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/11/25  16:12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtil</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Pattern linePattern = Pattern.compile(<span class="string">&quot;_(\\w)&quot;</span>);</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Pattern humpPattern = Pattern.compile(<span class="string">&quot;[A-Z]&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 驼峰转下划线,最后转为大写</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">humpToLine</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">      Matcher matcher = humpPattern.matcher(str);</span><br><span class="line">      StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">      <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">         matcher.appendReplacement(sb, <span class="string">&quot;_&quot;</span> + matcher.group(<span class="number">0</span>).toUpperCase());</span><br><span class="line">      &#125;</span><br><span class="line">      matcher.appendTail(sb);</span><br><span class="line">      <span class="keyword">return</span> sb.toString().toUpperCase();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 下划线转驼峰,正常输出</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">lineToHump</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">      Matcher matcher = linePattern.matcher(str);</span><br><span class="line">      StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">      <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">         matcher.appendReplacement(sb, matcher.group(<span class="number">1</span>).toUpperCase());</span><br><span class="line">      &#125;</span><br><span class="line">      matcher.appendTail(sb);</span><br><span class="line">      <span class="keyword">return</span> sb.toString();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试类如何写"><a href="#测试类如何写" class="headerlink" title="测试类如何写"></a>测试类如何写</h2><p>pom</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--test--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>test</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@SpringBootTest(classes = 你的启动类.class, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line">@RunWith(SpringRunner.class)</span><br></pre></td></tr></table></figure>

<h2 id="jar包配置文件管理"><a href="#jar包配置文件管理" class="headerlink" title="jar包配置文件管理"></a>jar包配置文件管理</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">配置文件统一管理</span><br><span class="line"></span><br><span class="line">springboot核心配置文件</span><br><span class="line"></span><br><span class="line">Springboot读取核心配置文件（application.properties）的优先级为</span><br><span class="line"></span><br><span class="line">Jar包同级目录的config目录</span><br><span class="line"></span><br><span class="line">Jar包同级目录</span><br><span class="line"></span><br><span class="line">classPath(即resources目录)的config目录</span><br><span class="line"></span><br><span class="line">classpath目录</span><br><span class="line"></span><br><span class="line">上面是springboot默认去拿自己的核心配置文件的优先级，还有一种最高优先级的方式是项目启动时通过命令的方式指定项目加载核心配置文件，命令如下</span><br><span class="line"></span><br><span class="line">java –jar -Dspring.config.location=xxx/xxx/xxxx.properties xxxx.jar</span><br><span class="line"></span><br><span class="line">如果Spring Boot在优先级更高的位置找到了配置，那么它会无视优先级更低的配置</span><br></pre></td></tr></table></figure>

<h2 id="oss"><a href="#oss" class="headerlink" title="oss"></a>oss</h2><p>通过网络随时存储和调用包括文本、图片、音频和视频等在内的各种结构化或非结构化数据文件</p>
<p>阿里云 OSS 将数据文件以对象（object）的形式上传到存储空间（bucket）中</p>
<h2 id="ctrl-alt-L"><a href="#ctrl-alt-L" class="headerlink" title="ctrl+alt+L"></a>ctrl+alt+L</h2><p>idea  格式化java代码</p>
<h2 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h2><h3 id="crc64"><a href="#crc64" class="headerlink" title="crc64"></a>crc64</h3><p><img src="/../img/image-20211106175402945.png" alt="image-20211106175402945"></p>
<p>64位/8=8个字节，8字节长度为</p>
<p>（-9223372036854775808，9223372036854775807）</p>
<p>所以最终的值肯定在这个区间，永远都是a</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class CRC64 &#123;</span><br><span class="line">    static int crc_HashLimit = 64;</span><br><span class="line"></span><br><span class="line">    private CRC64() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void getCrc64id() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static CRC64.crcHash crcCalculate(String pStr, int len, CRC64.crcHash hv, CRC64.crcHash[] CrcXor) &#123;</span><br><span class="line">        int e = len;</span><br><span class="line">        int p = 0;</span><br><span class="line">        int s2;</span><br><span class="line">        int m;</span><br><span class="line">        int i;</span><br><span class="line">        if (crc_HashLimit &lt;= 32) &#123;</span><br><span class="line">            s2 = crc_HashLimit - 8;</span><br><span class="line">            m = -1 &gt;&gt;&gt; 32 - crc_HashLimit;</span><br><span class="line">            hv.h1 = 0;</span><br><span class="line"></span><br><span class="line">            for(hv.h2 &amp;= m; p &lt; e; ++p) &#123;</span><br><span class="line">                i = hv.h2 &gt;&gt;&gt; s2 &amp; 255;</span><br><span class="line">                hv.h2 = hv.h2 &lt;&lt; 8 &amp; m ^ pStr.charAt(p) ^ CrcXor[i].h2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (crc_HashLimit &lt; 40) &#123;</span><br><span class="line">            s2 = 40 - crc_HashLimit;</span><br><span class="line">            m = -1 &gt;&gt;&gt; 64 - crc_HashLimit;</span><br><span class="line"></span><br><span class="line">            for(hv.h1 &amp;= m; p &lt; e; ++p) &#123;</span><br><span class="line">                i = (hv.h1 &lt;&lt; s2 | hv.h2 &gt;&gt;&gt; 32 - s2) &amp; 255;</span><br><span class="line">                hv.h1 = (hv.h1 &lt;&lt; 8 ^ hv.h2 &gt;&gt;&gt; 24) &amp; m ^ CrcXor[i].h1;</span><br><span class="line">                hv.h2 = hv.h2 &lt;&lt; 8 ^ pStr.charAt(p) ^ CrcXor[i].h2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            s2 = crc_HashLimit - 40;</span><br><span class="line">            m = -1 &gt;&gt;&gt; 64 - crc_HashLimit;</span><br><span class="line"></span><br><span class="line">            for(hv.h1 &amp;= m; p &lt; e; ++p) &#123;</span><br><span class="line">                i = hv.h1;</span><br><span class="line">                int h2 = hv.h2;</span><br><span class="line">                int i = i &gt;&gt;&gt; s2 &amp; 255;</span><br><span class="line">                hv.h1 = i &lt;&lt; 8 &amp; m ^ h2 &gt;&gt;&gt; 24 &amp; 255 ^ CrcXor[i].h1;</span><br><span class="line">                hv.h2 = h2 &lt;&lt; 8 ^ pStr.charAt(p) ^ CrcXor[i].h2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return hv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static String getcrc64id(String source) &#123;</span><br><span class="line">        int h1 = false;</span><br><span class="line">        int h2 = false;</span><br><span class="line">        int high = false;</span><br><span class="line">        int low = false;</span><br><span class="line">        long a1 = 4294967296L;</span><br><span class="line">        int HINIT1 = -87805263;</span><br><span class="line">        int HINIT2 = 215344202;</span><br><span class="line">        int POLY1 = 6292288;</span><br><span class="line">        int POLY2 = 15783179;</span><br><span class="line">        CRC64.crcHash[] CrcXor = new CRC64.crcHash[256];</span><br><span class="line"></span><br><span class="line">        int i;</span><br><span class="line">        for(i = 0; i &lt; 256; ++i) &#123;</span><br><span class="line">            CrcXor[i] = new CRC64.crcHash();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CRC64.crcHash[] Poly = new CRC64.crcHash[65];</span><br><span class="line"></span><br><span class="line">        for(i = 0; i &lt; 65; ++i) &#123;</span><br><span class="line">            Poly[i] = new CRC64.crcHash();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Poly[64].h1 = POLY1;</span><br><span class="line">        Poly[64].h2 = POLY2;</span><br><span class="line"></span><br><span class="line">        for(i = 63; i &gt;= 16; --i) &#123;</span><br><span class="line">            Poly[i].h1 = Poly[i + 1].h1 &gt;&gt;&gt; 1;</span><br><span class="line">            Poly[i].h2 = Poly[i + 1].h2 &gt;&gt;&gt; 1 | (Poly[i + 1].h1 &amp; 1) &lt;&lt; 31 | 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for(i = 0; i &lt; 256; ++i) &#123;</span><br><span class="line">            int v = i;</span><br><span class="line">            CRC64.crcHash hv = new CRC64.crcHash(0, 0);</span><br><span class="line"></span><br><span class="line">            for(int j = 0; j &lt; 8; v &lt;&lt;= 1) &#123;</span><br><span class="line">                hv.h1 &lt;&lt;= 1;</span><br><span class="line">                if (((long)hv.h2 &amp; 2147483648L) != 0L) &#123;</span><br><span class="line">                    hv.h1 |= 1;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                hv.h2 &lt;&lt;= 1;</span><br><span class="line">                if ((v &amp; 128) != 0) &#123;</span><br><span class="line">                    hv.h1 ^= Poly[crc_HashLimit].h1;</span><br><span class="line">                    hv.h2 ^= Poly[crc_HashLimit].h2;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ++j;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            CrcXor[i] = hv;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CRC64.crcHash hv = new CRC64.crcHash(HINIT1, HINIT2);</span><br><span class="line">        CRC64.crcHash result_hash = crcCalculate(source, source.length(), hv, CrcXor);</span><br><span class="line">        int h1 = result_hash.h1;</span><br><span class="line">        int h2 = result_hash.h2;</span><br><span class="line">        int low;</span><br><span class="line">        if (h1 &gt; 2147483647) &#123;</span><br><span class="line">            low = -1 * (-1 - h1) - 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            low = h1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        int high;</span><br><span class="line">        if (h2 &gt; 2147483647) &#123;</span><br><span class="line">            high = -1 * (-1 - h2) - 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            high = h2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        long result = (long)high * a1 + (long)low;</span><br><span class="line">        return String.valueOf(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Long getCrc64id(String source) &#123;</span><br><span class="line">        return Long.valueOf(getcrc64id(source));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class crcHash &#123;</span><br><span class="line">        public int h1;</span><br><span class="line">        public int h2;</span><br><span class="line"></span><br><span class="line">        public crcHash() &#123;</span><br><span class="line">            this.h1 = 0;</span><br><span class="line">            this.h2 = 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public crcHash(int theH1, int theH2) &#123;</span><br><span class="line">            this.h1 = theH1;</span><br><span class="line">            this.h2 = theH2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="json集合和数组的区别"><a href="#json集合和数组的区别" class="headerlink" title="json集合和数组的区别"></a>json集合和数组的区别</h2><p><img src="/../img/image-20211112141659773.png" alt="image-20211112141659773"></p>
<h2 id="生成json文件，自定义内容"><a href="#生成json文件，自定义内容" class="headerlink" title="生成json文件，自定义内容"></a>生成json文件，自定义内容</h2><pre><code>package com.boco.nbd.upload.station.util;

import lombok.extern.slf4j.Slf4j;
    import org.springframework.util.ResourceUtils;
import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStreamWriter;
import java.io.Writer;
import java.util.*;

/**
 *  生成json文件工具类     by   xwd
 */

@Slf4j
public class JSONUtils &#123;

    //封装创建json文件的方法
    public static boolean createJSONFile(Object obj, String fileName)&#123;
        boolean flag = true;

        try &#123;
            //获取文件的绝对路径        根路径
            //String filePath = ResourceUtils.getURL(&quot;classpath:&quot;).getPath();
            String filePath = &quot;D:&quot;;
            String jsonString = com.alibaba.druid.support.json.JSONUtils.toJSONString(obj);
            // 拼接文件完整路径// 生成json格式文件
            String fullPath = filePath + File.separator + fileName + &quot;.json&quot;;
            // 保证创建一个新文件
            File file = new File(fullPath);
            if (!file.getParentFile().exists()) &#123; // 如果父目录不存在，创建父目录
                file.getParentFile().mkdirs();
            &#125;
            if (file.exists()) &#123; // 如果已存在,删除旧文件
                file.delete();
            &#125;
            file.createNewFile();//创建新文件

            if(jsonString.indexOf(&quot;&#39;&quot;)!=-1)&#123;
                //将单引号转义一下，因为JSON串中的字符串类型可以单引号引起来的
                jsonString = jsonString.replaceAll(&quot;&#39;&quot;, &quot;\\&#39;&quot;);
            &#125;
            if(jsonString.indexOf(&quot;\&quot;&quot;)!=-1)&#123;
                //将双引号转义一下，因为JSON串中的字符串类型可以单引号引起来的
                jsonString = jsonString.replaceAll(&quot;\&quot;&quot;, &quot;\\\&quot;&quot;);
            &#125;

            if(jsonString.indexOf(&quot;\r\n&quot;)!=-1)&#123;
                //将回车换行转换一下，因为JSON串中字符串不能出现显式的回车换行
                jsonString = jsonString.replaceAll(&quot;\r\n&quot;, &quot;\\u000d\\u000a&quot;);
            &#125;
            if(jsonString.indexOf(&quot;\n&quot;)!=-1)&#123;
                //将换行转换一下，因为JSON串中字符串不能出现显式的换行
                jsonString = jsonString.replaceAll(&quot;\n&quot;, &quot;\\u000a&quot;);
            &#125;
            // 将格式化后的字符串写入文件
            Writer write = new OutputStreamWriter(new FileOutputStream(file), &quot;UTF-8&quot;);
            log.info(&quot;json文件内容：&quot; + jsonString);
            write.write(jsonString);
            log.info(&quot;文件创建成功！&quot;);
            write.flush();
            write.close();
        &#125; catch (Exception e) &#123;
            flag = false;
            e.printStackTrace();
        &#125;
        return flag;
    &#125;
</code></pre>
<h2 id="枚举类用法"><a href="#枚举类用法" class="headerlink" title="枚举类用法"></a>枚举类用法</h2><p>初始化对象结构</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.boco.nbd.threshold.enums;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author:jiangjiaxu</span><br><span class="line"> * @date 2021/10/20  11:49</span><br><span class="line"> * @version:V1.0</span><br><span class="line"> * @description:**枚举类</span><br><span class="line"> */</span><br><span class="line">public enum DeviceMonitorEnum &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 动环</span><br><span class="line">     */</span><br><span class="line">    TEMP(&quot;动环&quot;, &quot;1&quot;, &quot;10&quot;),</span><br><span class="line">    /**</span><br><span class="line">     * 门架</span><br><span class="line">     */</span><br><span class="line">    GANTRY(&quot;门架&quot;, &quot;2&quot;, &quot;11&quot;),</span><br><span class="line">    /**</span><br><span class="line">     * 收费系统</span><br><span class="line">     */</span><br><span class="line">    LANE(&quot;收费系统&quot;, &quot;3&quot;, &quot;12&quot;),</span><br><span class="line">    /**</span><br><span class="line">     * 外场设备</span><br><span class="line">     */</span><br><span class="line">    MONITOR(&quot;外场设备&quot;, &quot;4&quot;, &quot;13&quot;);</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line">    private String id;</span><br><span class="line">    private String proId;</span><br><span class="line"></span><br><span class="line">    DeviceMonitorEnum(String name, String proId, String id) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.proId = proId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(String id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getProId() &#123;</span><br><span class="line">        return proId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setProId(String proId) &#123;</span><br><span class="line">        this.proId = proId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化创建</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static List&lt;ResourceBO&gt; create() &#123;</span><br><span class="line">        DeviceMonitorEnum[] enums = DeviceMonitorEnum.values();</span><br><span class="line">        List&lt;ResourceBO&gt; list = new ArrayList&lt;&gt;(10);</span><br><span class="line">        for (int i = 0; i &lt; enums.length; i++) &#123;</span><br><span class="line">            ResourceBO bo = new ResourceBO();</span><br><span class="line">            bo.setNo(i + 1);</span><br><span class="line">            bo.setId(enums[i].getId());</span><br><span class="line">            bo.setProId(enums[i].getProId());</span><br><span class="line">            bo.setName(enums[i].getName());</span><br><span class="line">            bo.setCount(0);</span><br><span class="line">            bo.setProCount(0);</span><br><span class="line">            if (&quot;1&quot;.equals(bo.getId())) &#123;</span><br><span class="line">                bo.setProCount(-1);</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(bo);</span><br><span class="line">        &#125;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.boco.nbd.threshold.enums;</span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.annotation.JsonIgnore;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.ToString;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author:jiangjiaxu</span><br><span class="line"> * @date 2021/10/20  11:49</span><br><span class="line"> * @version:V1.0</span><br><span class="line"> * @description:**枚举类</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@ToString</span><br><span class="line">public class ResourceBO &#123;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;序号&quot;)</span><br><span class="line">    private Integer no;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;标识&quot;)</span><br><span class="line">    private String id;</span><br><span class="line"></span><br><span class="line">    @JsonIgnore</span><br><span class="line">    @ApiModelProperty(&quot;故障标识&quot;)</span><br><span class="line">    private String proId;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;标签名称&quot;)</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;总数&quot;)</span><br><span class="line">    private Integer count;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(&quot;故障总数&quot;)</span><br><span class="line">    private Integer proCount;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="判断是否在cron表达式中"><a href="#判断是否在cron表达式中" class="headerlink" title="判断是否在cron表达式中"></a>判断是否在cron表达式中</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.boco.nbd.threshold.util;</span><br><span class="line"></span><br><span class="line">import net.logstash.logback.encoder.org.apache.commons.lang.ArrayUtils;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author:jiangjiaxu</span><br><span class="line"> * @date 2021/10/29  16:33</span><br><span class="line"> * @version:V1.0</span><br><span class="line"> * @description:</span><br><span class="line"> */</span><br><span class="line">public class Cron &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 判断date是否在cron表达式中,没有秒，周，年的粒度</span><br><span class="line">     * @param cron</span><br><span class="line">     * @param date1</span><br><span class="line">     */</span><br><span class="line">    public static boolean isInclude(String cron,Date date1)&#123;</span><br><span class="line">        String[] s = cron.split(&quot; &quot;);</span><br><span class="line">        String[] s1=new String[4];</span><br><span class="line">        s1[0]=s[1];</span><br><span class="line">        s1[1]=s[2];</span><br><span class="line">        s1[2]=s[3];</span><br><span class="line">        s1[3]=s[4];</span><br><span class="line">        SimpleDateFormat sdf=new SimpleDateFormat(&quot;mm-HH-dd-MM&quot;);</span><br><span class="line">        String date = sdf.format(date1);</span><br><span class="line">        String[] s2 = date.split(&quot;-&quot;);</span><br><span class="line">        boolean flag=true;</span><br><span class="line">        for(int i=0;i&lt;4;i++)&#123;</span><br><span class="line">            if(!isTrue(s1[i],s2[i]))&#123;</span><br><span class="line">                flag=false;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static boolean isTrue(String s1,String s2)&#123;</span><br><span class="line">        if(s1.contains(&quot;*&quot;))&#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        else if(s1.contains(&quot;,&quot;))&#123;</span><br><span class="line">            String[] split = s1.split(&quot;,&quot;);</span><br><span class="line">            return ArrayUtils.contains(split,s2);</span><br><span class="line">        &#125;</span><br><span class="line">        else if(s1.contains(&quot;-&quot;))&#123;</span><br><span class="line">            String[] split = s1.split(&quot;-&quot;);</span><br><span class="line">            int a = Integer.parseInt(split[0]);</span><br><span class="line">            int b = Integer.parseInt(split[1]);</span><br><span class="line">            int c = Integer.parseInt(s2);</span><br><span class="line">            if(c&gt;=a&amp;&amp;c&lt;=b)&#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //只有一个数字,需要相等</span><br><span class="line">        else&#123;</span><br><span class="line">            if(s1.equals(s2))&#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map遍历"><a href="#Map遍历" class="headerlink" title="Map遍历"></a>Map遍历</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;();</span><br><span class="line">        map.put(&quot;1&quot;,&quot;a&quot;);</span><br><span class="line">        map.put(&quot;2&quot;,&quot;b&quot;);</span><br><span class="line">        map.put(&quot;3&quot;,&quot;c&quot;);</span><br><span class="line">		System.out.println(map.keySet());</span><br><span class="line">//map.keySet()--&gt;[1,2,3],可以理解为map.keySet()遍历map里的key，然后通过map.get(key)取值，完成遍历</span><br><span class="line">        for(String key: map.keySet())&#123;</span><br><span class="line">            System.out.println(&quot;key=&quot;+key+&quot; and value = &quot;+map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        Set&lt;Map.Entry&lt;Integer,String&gt;&gt; entries=map.entrySet();</span><br><span class="line">    	System.out.println(entries);//[1=a, 2=b, 3=c]</span><br><span class="line">    </span><br><span class="line">        for (Map.Entry entry:entries)&#123;</span><br><span class="line">            System.out.println(&quot;key:&quot;+entry.getKey()+&quot; &quot;</span><br><span class="line">                    +&quot;value:&quot;+entry.getValue());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h1 id="打印日志输出到本地文件"><a href="#打印日志输出到本地文件" class="headerlink" title="打印日志输出到本地文件"></a>打印日志输出到本地文件</h1><p><a href="https://blog.csdn.net/MengDiL_yl/article/details/86648197?spm=1001.2101.3001.6650.7&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-7.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-7.no_search_link">https://blog.csdn.net/MengDiL_yl/article/details/86648197?spm=1001.2101.3001.6650.7&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-7.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-7.no_search_link</a></p>
<h1 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h1><p><a href="https://blog.csdn.net/xsp_happyboy/article/details/80987484?spm=1001.2101.3001.6650.9&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-9.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-9.no_search_link">https://blog.csdn.net/xsp_happyboy/article/details/80987484?spm=1001.2101.3001.6650.9&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-9.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-9.no_search_link</a></p>
<p><img src="/../img/image-20211123174753114.png" alt="image-20211123174753114"></p>
<h1 id="springboot自启动方法"><a href="#springboot自启动方法" class="headerlink" title="springboot自启动方法"></a>springboot自启动方法</h1><p><img src="/../img/image-20211022085446005.png" alt="image-20211022085446005"></p>
<p>controller+ implements ApplicationRunner</p>
<p>这样启动后此方法就自动执行了</p>
<p>或者直接放在spring启动类里</p>
<p><img src="/../img/image-20211212140002107.png" alt="image-20211212140002107"></p>
<h1 id="自定义application-yml属性并获取"><a href="#自定义application-yml属性并获取" class="headerlink" title="自定义application.yml属性并获取"></a>自定义application.yml属性并获取</h1><h2 id="第一种，指定前缀，并使用-value注解，可以自定义属性名"><a href="#第一种，指定前缀，并使用-value注解，可以自定义属性名" class="headerlink" title="第一种，指定前缀，并使用@value注解，可以自定义属性名"></a>第一种，指定前缀，并使用@value注解，可以自定义属性名</h2><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kafka:</span></span><br><span class="line">  <span class="attr">zookeeper-url:</span> <span class="number">10.12</span><span class="number">.1</span><span class="number">.50</span><span class="string">:9092</span></span><br><span class="line">  <span class="attr">topic-name:</span> <span class="string">test1</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">NBD_NT</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;kafka&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaBO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;kafka.zookeeper-url&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String kafkaServer;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;kafka.topic-name&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String topic;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;kafka.group&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String group;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">KafkaBO kafkaBO;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(kafkaBO.getxxxx());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20210726093024506.png" alt="image-20210726093024506"></p>
<h2 id="第二种方法，直接在类中使用"><a href="#第二种方法，直接在类中使用" class="headerlink" title="第二种方法，直接在类中使用"></a>第二种方法，直接在类中使用</h2><p><img src="/../img/image-20210822131414193.png" alt="image-20210822131414193"></p>
<h2 id="想要在获取类中直接使用"><a href="#想要在获取类中直接使用" class="headerlink" title="想要在获取类中直接使用"></a>想要在获取类中直接使用</h2><p><img src="/../img/image-20211021125957183.png" alt="image-20211021125957183"></p>
<p>比如下方，在controller里注入，就可以使用了</p>
<p><img src="/../img/image-20211021130029410.png" alt="image-20211021130029410"></p>
<h1 id="获取文件路径，内容"><a href="#获取文件路径，内容" class="headerlink" title="获取文件路径，内容"></a>获取文件路径，内容</h1><h2 id="1-main获取"><a href="#1-main获取" class="headerlink" title="1.main获取"></a>1.main获取</h2><p><img src="/../img/image-20210910085056032.png" alt="image-20210910085056032"></p>
<p>要获取resources/static/a.txt文件</p>
<p><img src="/../img/image-20210910085315281.png" alt="image-20210910085315281"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String absolutePath = file.getAbsolutePath();</span><br></pre></td></tr></table></figure>

<h2 id="2-springboot获取"><a href="#2-springboot获取" class="headerlink" title="2.springboot获取"></a>2.springboot获取</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.websocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jiang.websocket.entity.ProjectConstant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/01/04  16:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:路径工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathUtil</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> PathUtil pathUtil = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 实例化</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> PathUtil <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">null</span> == pathUtil) &#123;</span><br><span class="line">         pathUtil = <span class="keyword">new</span> PathUtil();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> pathUtil;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span>  String <span class="title">getFileContent</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">      String path = <span class="keyword">this</span>.getClass().getResource(<span class="string">&quot;/&quot;</span>).getPath();</span><br><span class="line">      <span class="keyword">boolean</span> areJar = path.contains(ProjectConstant.JAR_SUFFIX);</span><br><span class="line">      System.out.println(areJar);</span><br><span class="line">      String resourcePath = areJar ? getDefaultPathToJar(path) : getDefaultPath(path);</span><br><span class="line">      System.out.println(resourcePath);</span><br><span class="line">      resourcePath = resourcePath.concat(fileName);</span><br><span class="line">      System.out.println(resourcePath);</span><br><span class="line">      String str = readFile(resourcePath, <span class="keyword">false</span>);</span><br><span class="line">      <span class="keyword">return</span> str;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取jar方式的默认路径，，默认加了config</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> String <span class="title">getDefaultPathToJar</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">      path = path.substring(<span class="number">0</span>, path.toLowerCase().indexOf(ProjectConstant.JAR_SUFFIX));</span><br><span class="line">      path = path.substring(path.indexOf(ProjectConstant.SPLIT_CHAR) + <span class="number">1</span>, path.lastIndexOf(ProjectConstant.SPLIT_CHAR) + <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (!path.contains(ProjectConstant.COLON_CHAR)) &#123;</span><br><span class="line">         path = ProjectConstant.SPLIT_CHAR + path;</span><br><span class="line">      &#125;</span><br><span class="line">      path = path.concat(ProjectConstant.CONFIG_FILE_PATH);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> path;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取默认路径-非jar方式本地测试，，默认加了config</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> String <span class="title">getDefaultPath</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">      path = path.substring(path.indexOf(ProjectConstant.SPLIT_CHAR) + <span class="number">1</span>, path.indexOf(ProjectConstant.TARGET_SUFFIX) + <span class="number">1</span>);</span><br><span class="line">      path = path.concat(ProjectConstant.CONFIG_FILE_PATH);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> path;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取文件内容</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> filePath</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> areJar:是否jar内文件</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> String <span class="title">readFile</span><span class="params">(String filePath, <span class="keyword">boolean</span> areJar)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         InputStream input = areJar ? getInstance().getClass().getResourceAsStream(ProjectConstant.SPLIT_CHAR.concat(filePath))</span><br><span class="line">               : <span class="keyword">new</span> FileInputStream(filePath);</span><br><span class="line">         <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[input.available()];</span><br><span class="line">         input.read(bytes);</span><br><span class="line">         String str = <span class="keyword">new</span> String(bytes, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">         ex.printStackTrace();</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/getPath2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPath2</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   String fileContext = PathUtil.getInstance().getFileContent(<span class="string">&quot;a.txt&quot;</span>);</span><br><span class="line">   System.out.println(fileContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意需要jar包同级目录config下，config路径是可配置的，可以改名"><a href="#注意需要jar包同级目录config下，config路径是可配置的，可以改名" class="headerlink" title="注意需要jar包同级目录config下，config路径是可配置的，可以改名"></a>注意需要jar包同级目录config下，config路径是可配置的，可以改名</h3><p><img src="/../img/image-20220104171638460.png" alt="image-20220104171638460"></p>
<h3 id="如果jar内的，跟src同级的config下，config路径是可配置的，可以改名"><a href="#如果jar内的，跟src同级的config下，config路径是可配置的，可以改名" class="headerlink" title="如果jar内的，跟src同级的config下，config路径是可配置的，可以改名"></a>如果jar内的，跟src同级的config下，config路径是可配置的，可以改名</h3><p><img src="/../img/image-20220104171700722.png" alt="image-20220104171700722"></p>
<h1 id="读取json字符串中的某一个属性"><a href="#读取json字符串中的某一个属性" class="headerlink" title="读取json字符串中的某一个属性"></a>读取json字符串中的某一个属性</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		String result=<span class="string">&quot;&#123;\&quot;payOrderId\&quot;:\&quot;EPP10320190820709190\&quot;,\&quot;subOrderId\&quot;:null,\&quot;resultCode\&quot;:\&quot;0000\&quot;,\&quot;sign\&quot;:\&quot;bwVmGWv0q_7HRtbE\&quot;,\&quot;merchantOrderId\&quot;:\&quot;7000001393\&quot;,\&quot;resultMsg\&quot;:\&quot;受理成功\&quot;&#125;&quot;</span>;	</span><br><span class="line">	<span class="comment">// 字符串转换为JSON</span></span><br><span class="line">	JSONObject jsonObject = JSON.parseObject(result);	<span class="comment">// result数据源：JSON格式字符串</span></span><br><span class="line">	<span class="comment">// 获取值</span></span><br><span class="line">	String s = jsonObject.getString(<span class="string">&quot;resultMsg&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	System.out.println(s);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="拼接字符串Joiner-on-File-separator-join-list"><a href="#拼接字符串Joiner-on-File-separator-join-list" class="headerlink" title="拼接字符串Joiner.on(File.separator).join(list);"></a>拼接字符串Joiner.on(File.separator).join(list);</h1><p><img src="/../img/image-20220105101428068.png" alt="image-20220105101428068"></p>
<h1 id="集合框架"><a href="#集合框架" class="headerlink" title="集合框架"></a>集合框架</h1><p><a href="https://blog.csdn.net/jiang458572759/article/details/115006327?spm=1001.2014.3001.5501">https://blog.csdn.net/jiang458572759/article/details/115006327?spm=1001.2014.3001.5501</a></p>
<h1 id="try-catch-finally"><a href="#try-catch-finally" class="headerlink" title="try-catch-finally"></a>try-catch-finally</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(a());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">a</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>finally里最终都会执行</p>
<p><img src="/../img/image-20220105104720705.png" alt="image-20220105104720705"></p>
<p>并且，如果finally有return了，那么就不能在往下写代码了，并且最终返回值为4</p>
<p><img src="/../img/image-20220105104752162.png" alt="image-20220105104752162"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(a());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">如果需要往下走，那么finally里不能有return，并且走到fianlly之前都不能走return</span></span><br><span class="line"><span class="comment">的分支</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">a</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</span><br><span class="line">                System.out.println(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>通过包.类路径获取类对象</span><br><span class="line">       Class c1 <span class="operator">=</span> Class.forName(&quot;com.example.demo.demo.A&quot;);</span><br><span class="line">       Class c2 <span class="operator">=</span> Class.forName(&quot;com.example.demo.demo.A&quot;);</span><br><span class="line">       <span class="operator">/</span><span class="operator">/</span>一个类在内存中只有一个class对象</span><br><span class="line">       System.out.println(c1<span class="operator">=</span><span class="operator">=</span>c2);<span class="operator">/</span><span class="operator">/</span><span class="literal">true</span></span><br><span class="line">       <span class="operator">/</span><span class="operator">/</span>一个类被加载后，类的整个结构都会被封装在class对象中</span><br></pre></td></tr></table></figure>

<h2 id="1-获取Class类的方法"><a href="#1-获取Class类的方法" class="headerlink" title="1.获取Class类的方法"></a>1.获取Class类的方法</h2><p>Class clazz=Person.class;</p>
<p>Class clazz=person.getClass();</p>
<p>Class clazz=Class.forName(“包.类路径&quot;);</p>
<h2 id="2-类的加载过程"><a href="#2-类的加载过程" class="headerlink" title="2.类的加载过程"></a>2.类的加载过程</h2><p>类的加载：把class文件读入内存,并创建一个java.lang.class对象。此过程由类加载器完成</p>
<p>类的链接：将类的二进制数据合并jvm的运行状态</p>
<p>初始化：对类进行初始化</p>
<h2 id="3-反射调用方法"><a href="#3-反射调用方法" class="headerlink" title="3.反射调用方法"></a>3.反射调用方法</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//调用无参函数</span><br><span class="line">Object c  调用方法在哪个类的对象   User user那么c=user</span><br><span class="line">methodName要调用的方法名</span><br><span class="line">c.getClass().getMethod(methodName, null).invoke(c, null);</span><br><span class="line"></span><br><span class="line">Object obj 参数和参数类型</span><br><span class="line"></span><br><span class="line">c.getClass().getMethod(methodName, obj.getClass()).invoke(c, obj);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Service(&quot;jiang&quot;)</span><br><span class="line">public class testService &#123;</span><br><span class="line">    public String haha(int age,String name)&#123;</span><br><span class="line">        String a=age+&quot;&quot;;</span><br><span class="line">        return name+a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RequestMapping(&quot;/aaa&quot;)</span><br><span class="line">public String aaa() throws Exception&#123;</span><br><span class="line">    ApplicationContext appCtx = SpringContextUtil.getApplicationContext();</span><br><span class="line">    Object c = (testService)SpringContextUtil.getBean(&quot;jiang&quot;);</span><br><span class="line">    //Object str = c.getClass().getMethod(&quot;haha&quot;, String.class).invoke(c, &quot;nihaoa&quot;);</span><br><span class="line">    Object str = c.getClass().getMethod(&quot;haha&quot;, new Class[]&#123;int.class,String.class&#125;).invoke(c, 16,&quot;nihaoa&quot;);</span><br><span class="line">    return (String)str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-根据属性获取属性值"><a href="#4-根据属性获取属性值" class="headerlink" title="4.根据属性获取属性值"></a>4.根据属性获取属性值</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">         * 根据属性获取属性值</span><br><span class="line">         * @param fieldName</span><br><span class="line">         * @param object</span><br><span class="line">         * @return</span><br><span class="line">         */</span><br><span class="line">        public static Double getFieldValueByFieldName(String fieldName,Object object) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Field field = object.getClass().getDeclaredField(fieldName);</span><br><span class="line">                if(field!=null)&#123;</span><br><span class="line">                    //对private的属性的访问</span><br><span class="line">                    field.setAccessible(true);</span><br><span class="line">                    return (Double) field.get(object);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    return null;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h1 id="application-bootstrap"><a href="#application-bootstrap" class="headerlink" title="application-bootstrap"></a>application-bootstrap</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">加载顺序</span><br><span class="line">若application.yml 和bootstrap.yml 在同一目录下：</span><br><span class="line"></span><br><span class="line">bootstrap.yml 先加载 application.yml后加载</span><br><span class="line"></span><br><span class="line">bootstrap.yml 用于应用程序上下文的引导阶段。bootstrap.yml 由父Spring ApplicationContext加载。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">配置区别</span><br><span class="line">bootstrap.yml 和 application.yml 都可以用来配置参数。</span><br><span class="line"></span><br><span class="line">bootstrap.yml 用来程序引导时执行，应用于更加早期配置信息读取。可以理解成系统级别的一些参数配置，这些参数一般是不会变动的。一旦bootStrap.yml 被加载，则内容不会被覆盖。</span><br><span class="line"></span><br><span class="line">application.yml 可以用来定义应用级别的， 应用程序特有配置信息，可以用来配置后续各个模块中需使用的公共参数等。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">属性覆盖问题</span><br><span class="line">启动上下文时，Spring Cloud 会创建一个 Bootstrap Context，作为 Spring 应用的 Application Context 的父上下文。</span><br><span class="line"></span><br><span class="line">application.yml 的内容标签与 bootstrap 的标签一致，application 会覆盖 bootstrap，而 application.yml 里面的内容可以动态替换。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bootstrap.yml典型的应用场景</span><br><span class="line">当使用 Spring Cloud Config Server 配置中心时，这时需要在 bootstrap.yml 配置文件中指定 spring.application.name 和 spring.cloud.config.server.git.uri，添加连接到配置中心的配置属性来加载外部配置中心的配置信息</span><br><span class="line">一些固定的不能被覆盖的属性</span><br><span class="line">一些加密/解密的场景</span><br></pre></td></tr></table></figure>

<h1 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1、基本使用</span><br><span class="line">public class TestAtomic &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        AtomicInteger i = new AtomicInteger(0);</span><br><span class="line"></span><br><span class="line">        System.out.println(i.incrementAndGet());    //++i;</span><br><span class="line">        System.out.println(i.getAndIncrement());    //i++;</span><br><span class="line"></span><br><span class="line">        System.out.println(i.getAndAdd(5));  //先获取i，再加5</span><br><span class="line">        System.out.println(i.addAndGet(5));  //先加5，在获取i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果展示：</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">12</span><br><span class="line"></span><br><span class="line">2、进阶用法 - 函数式编程</span><br><span class="line">AtomicInteger方法：</span><br><span class="line">public final int updateAndGet(IntUnaryOperator updateFunction)</span><br><span class="line"></span><br><span class="line">实现方式 – CAS</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line">import java.util.function.IntUnaryOperator;</span><br><span class="line"></span><br><span class="line">public class TestAtomic &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        AtomicInteger i = new AtomicInteger(0);</span><br><span class="line">        i.updateAndGet(x -&gt; x + 5);</span><br><span class="line">        </span><br><span class="line">        //自定义实现的</span><br><span class="line">        int i1 = TestAtomic.updateAndGet(i, x -&gt; x + 5);</span><br><span class="line"></span><br><span class="line">        System.out.println(i1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 手写实现一个updateAndSet方法</span><br><span class="line">     * @param i</span><br><span class="line">     * @param operator</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static int updateAndGet(AtomicInteger i,IntUnaryOperator operator)&#123;</span><br><span class="line">        while(true)&#123;</span><br><span class="line">            int prev = i.get();</span><br><span class="line">            int next = operator.applyAsInt(prev);</span><br><span class="line">            if(i.compareAndSet(prev,next))&#123;</span><br><span class="line">                return i.get();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="获取一个文件下所有的文件夹与文件"><a href="#获取一个文件下所有的文件夹与文件" class="headerlink" title="获取一个文件下所有的文件夹与文件"></a>获取一个文件下所有的文件夹与文件</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 使用递归的方法调用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> path 文件夹路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fileList  集合列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> java.util.List&lt;java.io.File&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://blog.csdn.net/chen_2890</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/6/14 17:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;File&gt; <span class="title">traverseFolder2</span><span class="params">(String path,List&lt;File&gt; fileList)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   File file = <span class="keyword">new</span> File(path);</span><br><span class="line">   <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">      File[] files = file.listFiles();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">null</span> == files || files.length == <span class="number">0</span>) &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;文件夹是空的!&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">for</span> (File file2 : files) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file2.isDirectory()) &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;文件夹:&quot;</span> + file2.getAbsolutePath());</span><br><span class="line">               traverseFolder2(file2.getAbsolutePath(),fileList);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               fileList.add(file2);</span><br><span class="line">               System.out.println(<span class="string">&quot;文件:&quot;</span> + file2.getAbsolutePath());</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;文件不存在!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> fileList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>stream流</title>
    <url>/2021/11/30/java8%E4%BB%A5%E5%8F%8Astream%E6%B5%81/</url>
    <content><![CDATA[<h1 id="通用的业务流程，设备展示"><a href="#通用的业务流程，设备展示" class="headerlink" title="通用的业务流程，设备展示"></a>通用的业务流程，设备展示</h1><h2 id="创建一个ResourceBo"><a href="#创建一个ResourceBo" class="headerlink" title="创建一个ResourceBo"></a>创建一个ResourceBo</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceBO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;序号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer no;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;标识&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;故障标识&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String proId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;标签名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;总数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;故障总数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer proCount;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一个Enum枚举类，注意create类"><a href="#一个Enum枚举类，注意create类" class="headerlink" title="一个Enum枚举类，注意create类"></a>一个Enum枚举类，注意create类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.boco.nbd.nantong.traffic.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.boco.nbd.nantong.traffic.entity.bo.ResourceBO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> GantryEquipmentEnum</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 门架设备弹窗统计 枚举类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> jiangjiaxu@boco.com.cn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/1/12 14:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> V1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">GantryEquipmentEnum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 门架总数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    COUNT(<span class="string">&quot;门架总数&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;1&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 门架设备总数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DEVICE_COUNT(<span class="string">&quot;门架设备总数&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String proId;</span><br><span class="line"></span><br><span class="line">    GantryEquipmentEnum(String name, String proId, String id) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.proId = proId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> proId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProId</span><span class="params">(String proId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.proId = proId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;ResourceBO&gt; <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        GantryEquipmentEnum[] enums = GantryEquipmentEnum.values();</span><br><span class="line">        List&lt;ResourceBO&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; enums.length; i++) &#123;</span><br><span class="line">            ResourceBO bo = <span class="keyword">new</span> ResourceBO();</span><br><span class="line">            bo.setNo(i + <span class="number">1</span>);</span><br><span class="line">            bo.setId(enums[i].getId());</span><br><span class="line">            bo.setProId(enums[i].getProId());</span><br><span class="line">            bo.setName(enums[i].getName());</span><br><span class="line">            bo.setCount(<span class="number">0</span>);</span><br><span class="line">            bo.setProCount(<span class="number">0</span>);</span><br><span class="line">            list.add(bo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="设置Resource的字段"><a href="#设置Resource的字段" class="headerlink" title="设置Resource的字段"></a>设置Resource的字段</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;ResourceBO&gt; <span class="title">getResourceList</span><span class="params">(<span class="keyword">int</span> initNum, String roadId, String roadSectionId)</span> </span>&#123;</span><br><span class="line">    List&lt;ResourceBO&gt; resource = initEnum(initNum);</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; list = initMapper(initNum, roadId, roadSectionId);</span><br><span class="line">    <span class="keyword">if</span> (!list.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (ResourceBO item : resource) &#123;</span><br><span class="line">            Optional&lt;Map&lt;String, Object&gt;&gt; optional = list.stream().filter(s -&gt; s.get(<span class="string">&quot;flag&quot;</span>).equals(item.getId())).findFirst();</span><br><span class="line">            <span class="keyword">if</span> (optional.isPresent()) &#123;</span><br><span class="line">                item.setCount(Convert.toInt(optional.get().get(<span class="string">&quot;totalNumber&quot;</span>), <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            Optional&lt;Map&lt;String, Object&gt;&gt; optional1 = list.stream().filter(s -&gt; s.get(<span class="string">&quot;flag&quot;</span>).equals(item.getProId())).findFirst();</span><br><span class="line">            <span class="keyword">if</span> (optional1.isPresent()) &#123;</span><br><span class="line">                item.setProCount(Convert.toInt(optional1.get().get(<span class="string">&quot;totalNumber&quot;</span>), <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">基础语法：</span><br><span class="line"></span><br><span class="line">- 操作符：-&gt;</span><br><span class="line">- 左侧：参数列表</span><br><span class="line">- 右侧：执行代码块 / Lambda 体</span><br></pre></td></tr></table></figure>

<h2 id="1-无参数无返回值"><a href="#1-无参数无返回值" class="headerlink" title="1.无参数无返回值"></a>1.无参数无返回值</h2><h3 id="1-只有一段代码-gt-b"><a href="#1-只有一段代码-gt-b" class="headerlink" title="1.只有一段代码() -&gt;  b;"></a>1.只有一段代码() -&gt;  b;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="comment">//语法糖</span></span><br><span class="line">   Runnable runnable = () -&gt; System.out.println(<span class="string">&quot;Hello Lambda&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-多段代码-gt"><a href="#2-多段代码-gt" class="headerlink" title="2.多段代码 () -&gt; {};"></a>2.多段代码 () -&gt; {};</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//语法糖</span></span><br><span class="line">		Runnable runnable = () -&gt; &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;aaaa&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;Hello Lambda&quot;</span>);</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-有一个参数无返回值-a-gt-b"><a href="#2-有一个参数无返回值-a-gt-b" class="headerlink" title="2.有一个参数无返回值 a -&gt; b;"></a>2.有一个参数无返回值 a -&gt; b;</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Consumer&lt;String&gt; consumer = (a) -&gt; System.out.println(a);</span><br><span class="line">    consumer.accept(<span class="string">&quot;我觉得还行！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//(小括号可以省略不写）</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Consumer&lt;String&gt; consumer = a -&gt; System.out.println(a);</span><br><span class="line">    consumer.accept(<span class="string">&quot;我觉得还行！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-两个及以上的参数，有返回值，并且-Lambda-体中有多条语句"><a href="#3-两个及以上的参数，有返回值，并且-Lambda-体中有多条语句" class="headerlink" title="3.两个及以上的参数，有返回值，并且 Lambda 体中有多条语句"></a>3.两个及以上的参数，有返回值，并且 Lambda 体中有多条语句</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Comparator&lt;Integer&gt; comparator = (a, b) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;比较接口&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Integer.compare(a, b);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//（大括号 与 return 都可以省略不写）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Comparator&lt;Integer&gt; comparator = (a, b) -&gt; Integer.compare(b, a);</span><br><span class="line">		<span class="keyword">int</span> compare = comparator.compare(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">		System.out.println(compare);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="Lambda-表达式-参数的数据类型可以省略不写-Jvm可以自动进行-“类型推断”"><a href="#Lambda-表达式-参数的数据类型可以省略不写-Jvm可以自动进行-“类型推断”" class="headerlink" title="Lambda 表达式 参数的数据类型可以省略不写 Jvm可以自动进行 “类型推断”"></a>Lambda 表达式 参数的数据类型可以省略不写 Jvm可以自动进行 “类型推断”</h2></li>
</ul>
<h1 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h1><p>接口中只有一个抽象方法的接口 @FunctionalIterface<br>测试：</p>
<p>定义一个函数式接口：</p>
<pre><code>@FunctionalInterface
public interface MyFun &#123;
Integer count(Integer a, Integer b);
&#125;
</code></pre>
<p>用一下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test05()&#123;</span><br><span class="line">    MyFun myFun1 = (a, b) -&gt; a + b;</span><br><span class="line">    System.out.println(myFun1.count(1,1));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再用一下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public Integer operation(Integer a, Integer b, MyFun myFun)&#123;</span><br><span class="line">    return myFun.count(a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test06()&#123;</span><br><span class="line">    Integer result = operation(1, 2, (x, y) -&gt; x + y);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="案例一："><a href="#案例一：" class="headerlink" title="案例一："></a><strong>案例一：</strong></h3><p>调用 Collections.sort() 方法，通过定制排序 比较两个 Employee (先按照年龄比，年龄相同按照姓名比)，使用 Lambda 表达式作为参数传递</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">   List&lt;Employee&gt; emps = Arrays.asList(</span><br><span class="line">         <span class="keyword">new</span> Employee(<span class="number">101</span>, <span class="string">&quot;Z3&quot;</span>, <span class="number">19</span>, <span class="number">9999.99</span>),</span><br><span class="line">         <span class="keyword">new</span> Employee(<span class="number">102</span>, <span class="string">&quot;L4&quot;</span>, <span class="number">20</span>, <span class="number">7777.77</span>),</span><br><span class="line">         <span class="keyword">new</span> Employee(<span class="number">103</span>, <span class="string">&quot;W5&quot;</span>, <span class="number">35</span>, <span class="number">6666.66</span>),</span><br><span class="line">         <span class="keyword">new</span> Employee(<span class="number">104</span>, <span class="string">&quot;Tom&quot;</span>, <span class="number">44</span>, <span class="number">1111.11</span>),</span><br><span class="line">         <span class="keyword">new</span> Employee(<span class="number">105</span>, <span class="string">&quot;Jerry&quot;</span>, <span class="number">60</span>, <span class="number">4444.44</span>)</span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">   Collections.sort(emps, (e1, e2) -&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (e1.getAge() == e2.getAge())&#123;</span><br><span class="line">         <span class="keyword">return</span> e2.getName().compareTo(e1.getName());</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> Integer.compare(e2.getAge(), e1.getAge());</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (Employee emp : emps) &#123;</span><br><span class="line">      System.out.println(emp);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Java内置四大核心函数式接口："><a href="#Java内置四大核心函数式接口：" class="headerlink" title="Java内置四大核心函数式接口："></a>Java内置四大核心函数式接口：</h2><p><img src="/../img/image-20220119090538225.png" alt="image-20220119090538225"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3.1 消费型接口</span><br><span class="line">@Test</span><br><span class="line">public void test01()&#123;</span><br><span class="line">    //Consumer</span><br><span class="line">    Consumer&lt;Integer&gt; consumer = (x) -&gt; System.out.println(&quot;消费型接口&quot; + x);</span><br><span class="line">    //test</span><br><span class="line">    consumer.accept(100);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3.2 提供型接口</span><br><span class="line">@Test</span><br><span class="line">public void test02()&#123;</span><br><span class="line">    List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">		List&lt;Integer&gt; integers = Arrays.asList(1,2,3);</span><br><span class="line">		//list  --》 1,2,3</span><br><span class="line">		list.addAll(integers);</span><br><span class="line">		//Supplier&lt;T&gt;</span><br><span class="line">		Supplier&lt;Integer&gt; supplier = () -&gt; (int)(Math.random() * 10);</span><br><span class="line">		//list--》1,2,3,+一个随机数</span><br><span class="line">		list.add(supplier.get());</span><br><span class="line">		for (Integer integer : list) &#123;</span><br><span class="line">			System.out.println(integer);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3.3 函数型接口</span><br><span class="line">@Test</span><br><span class="line">public void test03()&#123;</span><br><span class="line">    //Function&lt;T, R&gt;</span><br><span class="line">		String oldStr = &quot;abc123456xyz&quot;;</span><br><span class="line">		Function&lt;String, String&gt; function = (s) -&gt; s.substring(1, s.length()-1);</span><br><span class="line">		//test</span><br><span class="line">		System.out.println(function.apply(oldStr));</span><br><span class="line">		//Function&lt;T, R&gt;,参数类型为第一个，返回值类型为第2个</span><br><span class="line">		Function&lt;String, Integer&gt; function1 = (s) -&gt; s.indexOf(&quot;x&quot;);</span><br><span class="line">		System.out.println(function1.apply(oldStr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3.4 断言型接口</span><br><span class="line">@Test</span><br><span class="line">public void test04()&#123;</span><br><span class="line">    //Predicate&lt;T&gt;</span><br><span class="line">    Integer age = 35;</span><br><span class="line">    Predicate&lt;Integer&gt; predicate = (i) -&gt; i &gt;= 35;</span><br><span class="line">    if (predicate.test(age))&#123;</span><br><span class="line">        System.out.println(&quot;你该退休了&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        System.out.println(&quot;我觉得还OK啦&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">4.1</span> 方法引用</span><br><span class="line">**定义：**若 Lambda 表达式体中的内容已有方法实现，则我们可以使用“方法引用”</span><br><span class="line"></span><br><span class="line">语法格式：</span><br><span class="line"></span><br><span class="line">对象 :: 实例方法</span><br><span class="line">类 :: 静态方法</span><br><span class="line">类 :: 实例方法</span><br><span class="line">对象::实例方法</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">    PrintStream ps = System.out;</span><br><span class="line">    Consumer&lt;String&gt; con1 = (s) -&gt; ps.println(s);</span><br><span class="line">    con1.accept(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Consumer&lt;String&gt; con2 = ps::println;</span><br><span class="line">    con2.accept(<span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">**注意：**Lambda 表达实体中调用方法的参数列表、返回类型必须和函数式接口中抽象方法保持一致</span><br><span class="line"></span><br><span class="line">类::静态方法</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Comparator&lt;Integer&gt; com1 = (x, y) -&gt; Integer.compare(x, y);</span><br><span class="line">    System.out.println(com1.compare(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    Comparator&lt;Integer&gt; com2 = Integer::compare;</span><br><span class="line">    System.out.println(com2.compare(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">类::实例方法</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span></span>&#123;</span><br><span class="line">    BiPredicate&lt;String, String&gt; bp1 = (x, y) -&gt; x.equals(y);</span><br><span class="line">    System.out.println(bp1.test(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>));</span><br><span class="line"></span><br><span class="line">    BiPredicate&lt;String, String&gt; bp2 = String::equals;</span><br><span class="line">    System.out.println(bp2.test(<span class="string">&quot;c&quot;</span>,<span class="string">&quot;c&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="number">8</span></span><br><span class="line">**条件：**Lambda 参数列表中的第一个参数是方法的调用者，第二个参数是方法的参数时，才能使用 ClassName :: Method</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="StreamAPI"><a href="#StreamAPI" class="headerlink" title="StreamAPI"></a>StreamAPI</h1><p><img src="/../img/image-20220119144127483.png" alt="image-20220119144127483"></p>
<h2 id="stream流应用"><a href="#stream流应用" class="headerlink" title="stream流应用"></a>stream流应用</h2><p>请看以下博客</p>
<p><a href="https://blog.csdn.net/mu_wind/article/details/109516995">https://blog.csdn.net/mu_wind/article/details/109516995</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h2 id="广铁大屏获取数据时"><a href="#广铁大屏获取数据时" class="headerlink" title="广铁大屏获取数据时"></a>广铁大屏获取数据时</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public List&lt;ResourceBO&gt; getCountLoadCabinet() &#123;</span><br><span class="line">    List&lt;ResourceBO&gt; result = LoadCabinetEnum.create();</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; list = cabinetMonitorMapper.selectCountLoadCabinet();</span><br><span class="line">    if (list.isEmpty()) &#123;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    for (ResourceBO item : result) &#123;</span><br><span class="line">        Optional&lt;Map&lt;String, Object&gt;&gt; optional = list.stream().filter(s -&gt; Convert.toInt(s.get(&quot;type&quot;)) == 1).filter(s -&gt; s.get(&quot;objectId&quot;).toString().equals(item.getId())).findFirst();</span><br><span class="line">        optional.ifPresent(stringObjectMap -&gt; item.setCount(Convert.toInt(stringObjectMap.get(&quot;totalNumber&quot;), 0)));</span><br><span class="line"></span><br><span class="line">        Optional&lt;Map&lt;String, Object&gt;&gt; optional1 = list.stream().filter(s -&gt; Convert.toInt(s.get(&quot;type&quot;)) == 0).filter(s -&gt; s.get(&quot;objectId&quot;).toString().equals(item.getId())).findFirst();</span><br><span class="line">        optional1.ifPresent(stringObjectMap -&gt; item.setProCount(Convert.toInt(stringObjectMap.get(&quot;totalNumber&quot;), 0)));</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="比较经典的例子，递归获取菜单树"><a href="#比较经典的例子，递归获取菜单树" class="headerlink" title="比较经典的例子，递归获取菜单树"></a>比较经典的例子，递归获取菜单树</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public List&lt;CategoryEntity&gt; listWithTree() &#123;</span><br><span class="line">        //1.查出所有分类</span><br><span class="line">        List&lt;CategoryEntity&gt; entities = baseMapper.selectList(null);</span><br><span class="line"></span><br><span class="line">        //2.组装成父子树形结构</span><br><span class="line">            //找到所有的1级分类，父id是0</span><br><span class="line"></span><br><span class="line">//        List&lt;CategoryEntity&gt; level1Menus = entities.stream().filter((categoryEntity) -&gt; &#123;</span><br><span class="line">//            return categoryEntity.getParentCid() == 0;</span><br><span class="line">//        &#125;).collect(Collectors.toList());</span><br><span class="line">        //只有一个参数，只有一个语句优化，参数外的括号去掉，return和分号，大括号，都去掉</span><br><span class="line">        List&lt;CategoryEntity&gt; levelMenus = entities.stream().filter( categoryEntity -&gt;</span><br><span class="line">             categoryEntity.getParentCid() == 0</span><br><span class="line">        ).map((menu)-&gt;&#123;</span><br><span class="line">            menu.setChildren(getChildrens(menu,entities));</span><br><span class="line">            return menu;</span><br><span class="line">        &#125;).sorted((menu1,menu2)-&gt;&#123;</span><br><span class="line">            return (menu1.getSort()==null?0:menu1.getSort())-(menu2.getSort()==null?0:menu2.getSort());</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        return levelMenus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> private List&lt;CategoryEntity&gt; getChildrens(CategoryEntity root,List&lt;CategoryEntity&gt; all)&#123;</span><br><span class="line">    List&lt;CategoryEntity&gt; children = all.stream().filter(categoryEntity -&gt; &#123;</span><br><span class="line">        return categoryEntity.getParentCid() == root.getCatId();</span><br><span class="line">    &#125;).map(categoryEntity-&gt;&#123;</span><br><span class="line">        //1.找到子菜单</span><br><span class="line">        categoryEntity.setChildren(getChildrens(categoryEntity,all));</span><br><span class="line">        return categoryEntity;</span><br><span class="line">    &#125;).sorted((menu1,menu2)-&gt;&#123;</span><br><span class="line">        //2.菜单的排序</span><br><span class="line">        return (menu1.getSort()==null?0:menu1.getSort())-(menu2.getSort()==null?0:menu2.getSort());</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    return children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="流排序-由小到大"><a href="#流排序-由小到大" class="headerlink" title="流排序,由小到大"></a>流排序,由小到大</h2><p>需要有一个int排序字段</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list.stream().sorted(Comparator.comparing(s-&gt;s.getOrderBy())).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">list.stream().sorted((a,b)-&gt;Integer.compare(b.getAge(),a.getAge())).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<h2 id="流遍历list，设置字段"><a href="#流遍历list，设置字段" class="headerlink" title="流遍历list，设置字段"></a>流遍历list，设置字段</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AtomicInteger i = new AtomicInteger(0);</span><br><span class="line">list.forEach(a -&gt; a.setOrder(i.getAndIncrement()));</span><br><span class="line"></span><br><span class="line">forEach中使用的Consumer函数</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="1-创建流"><a href="#1-创建流" class="headerlink" title="1.创建流"></a>1.创建流</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">   * 集合流</span><br><span class="line">   *  - Collection.stream() 穿行流</span><br><span class="line">   *  - Collection.parallelStream() 并行流</span><br><span class="line">   */</span><br><span class="line">   List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">   Stream&lt;String&gt; stream1 = list.stream();</span><br></pre></td></tr></table></figure>

<h3 id="2-筛选-切片"><a href="#2-筛选-切片" class="headerlink" title="2.筛选 / 切片"></a>2.筛选 / 切片</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">中间操作：</span><br><span class="line"></span><br><span class="line">filter：接收 Lambda ，从流中排除某些元素</span><br><span class="line">limit：截断流，使其元素不超过给定数量</span><br><span class="line">skip(n)：跳过元素，返回一个舍弃了前n个元素的流；若流中元素不足n个，则返回一个空流；与 limit(n) 互补</span><br><span class="line">distinct：筛选，通过流所生成的 hashCode() 与 equals() 取除重复元素</span><br><span class="line"></span><br><span class="line">List&lt;Employee&gt; emps = Arrays.asList(</span><br><span class="line">				new Employee(101, &quot;Z3&quot;, 19, 9999.99),</span><br><span class="line">				new Employee(102, &quot;L4&quot;, 20, 7777.77),</span><br><span class="line">				new Employee(103, &quot;W5&quot;, 44, 6666.66),</span><br><span class="line">				new Employee(104, &quot;Tom&quot;, 44, 1111.11),</span><br><span class="line">				new Employee(105, &quot;Jerry&quot;, 60, 4444.44)</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			emps.stream()</span><br><span class="line">					.filter((x) -&gt; x.getAge() &gt; 35)</span><br><span class="line">					.limit(3) //只要前三个</span><br><span class="line">					.distinct()//删除所有属性都一样的数据</span><br><span class="line">					.skip(1)//删除第一个数据</span><br><span class="line">					.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-映射"><a href="#3-映射" class="headerlink" title="3.映射"></a>3.映射</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">map：接收 Lambda ，将元素转换为其他形式或提取信息；接受一个函数作为参数，该函数会被应用到每个元素上，并将其映射成一个新的元素</span><br><span class="line">flatMap：接收一个函数作为参数，将流中每一个值都换成另一个流，然后把所有流重新连接成一个流</span><br><span class="line">map：</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test02()&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);</span><br><span class="line">    list.stream()</span><br><span class="line">        .map((str) -&gt; str.toUpperCase())</span><br><span class="line">        .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-排序"><a href="#4-排序" class="headerlink" title="4.排序"></a>4.排序</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sorted()：自然排序</span><br><span class="line">sorted(Comparator c)：定制排序</span><br><span class="line">Comparable：自然排序</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test04()&#123;</span><br><span class="line">    List&lt;Integer&gt; list = Arrays.asList(1,2,3,4,5);</span><br><span class="line">    list.stream()</span><br><span class="line">        .sorted() //comparaTo()</span><br><span class="line">        .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Comparator：定制排序</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test05()&#123;</span><br><span class="line">    emps.stream()</span><br><span class="line">        .sorted((e1, e2) -&gt; &#123; //compara()</span><br><span class="line">            if (e1.getAge().equals(e2.getAge()))&#123;</span><br><span class="line">                return e1.getName().compareTo(e2.getName());</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return e1.getAge().compareTo(e2.getAge());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-查找-匹配"><a href="#5-查找-匹配" class="headerlink" title="5.查找 / 匹配"></a>5.查找 / 匹配</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">终止操作：</span><br><span class="line">allMatch：检查是否匹配所有元素</span><br><span class="line">anyMatch：检查是否至少匹配一个元素</span><br><span class="line">noneMatch：检查是否没有匹配所有元素</span><br><span class="line">findFirst：返回第一个元素</span><br><span class="line">findAny：返回当前流中的任意元素</span><br><span class="line">count：返回流中元素的总个数</span><br><span class="line">max：返回流中最大值</span><br><span class="line">min：返回流中最小值</span><br><span class="line">public enum Status &#123;</span><br><span class="line">    FREE, BUSY, VOCATION;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test01()&#123;</span><br><span class="line">    List&lt;Status&gt; list = Arrays.asList(Status.FREE, Status.BUSY, Status.VOCATION);</span><br><span class="line"></span><br><span class="line">    boolean flag1 = list.stream()</span><br><span class="line">        .allMatch((s) -&gt; s.equals(Status.BUSY));</span><br><span class="line">    System.out.println(flag1);</span><br><span class="line"></span><br><span class="line">    boolean flag2 = list.stream()</span><br><span class="line">        .anyMatch((s) -&gt; s.equals(Status.BUSY));</span><br><span class="line">    System.out.println(flag2);</span><br><span class="line"></span><br><span class="line">    boolean flag3 = list.stream()</span><br><span class="line">        .noneMatch((s) -&gt; s.equals(Status.BUSY));</span><br><span class="line">    System.out.println(flag3);</span><br><span class="line"></span><br><span class="line">    // 避免空指针异常</span><br><span class="line">    Optional&lt;Status&gt; op1 = list.stream()</span><br><span class="line">        .findFirst();</span><br><span class="line">    // 如果Optional为空 找一个替代的对象</span><br><span class="line">    Status s1 = op1.orElse(Status.BUSY);</span><br><span class="line">    System.out.println(s1);</span><br><span class="line"></span><br><span class="line">    Optional&lt;Status&gt; op2 = list.stream()</span><br><span class="line">        .findAny();</span><br><span class="line">    System.out.println(op2);</span><br><span class="line"></span><br><span class="line">    long count = list.stream()</span><br><span class="line">        .count();</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-归约-收集"><a href="#6-归约-收集" class="headerlink" title="6.归约 / 收集"></a>6.归约 / 收集</h3><p>归约：reduce(T identity, BinaryOperator) / reduce(BinaryOperator) 可以将流中的数据反复结合起来，得到一个值<br>收集：collect 将流转换成其他形式；接收一个 Collector 接口的实现，用于给流中元素做汇总的方法</p>
<h4 id="reduce："><a href="#reduce：" class="headerlink" title="reduce："></a>reduce：</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Java：</span></span><br><span class="line"><span class="comment">*  - reduce：需提供默认值（初始值）</span></span><br><span class="line"><span class="comment">* Kotlin：</span></span><br><span class="line"><span class="comment">*  - fold：不需要默认值（初始值）</span></span><br><span class="line"><span class="comment">*  - reduce：需提供默认值（初始值）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//把这10个数加起来加上默认值</span></span><br><span class="line">    List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>);</span><br><span class="line">    Integer integer = list.stream()</span><br><span class="line">        .reduce(<span class="number">0</span>, (x, y) -&gt; x + y);</span><br><span class="line">        <span class="comment">//.reduce(Integer::sum);Optional&lt;Integer&gt;</span></span><br><span class="line">    System.out.println(integer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="collect："><a href="#collect：" class="headerlink" title="collect："></a>collect：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Employee&gt; emps = Arrays.asList(</span><br><span class="line">				new Employee(101, &quot;Z3&quot;, 24, 9999.99),</span><br><span class="line">				new Employee(102, &quot;L4&quot;, 20, 7777.77),</span><br><span class="line">				new Employee(103, &quot;W5&quot;, 35, 6666.66),</span><br><span class="line">				new Employee(104, &quot;Tom&quot;, 44, 1111.11),</span><br><span class="line">				new Employee(105, &quot;Jerry&quot;, 60, 4444.44)</span><br><span class="line">		);</span><br><span class="line">		</span><br><span class="line">		//放入List</span><br><span class="line">		List&lt;String&gt; list = emps.stream()</span><br><span class="line">				.map(Employee::getName)</span><br><span class="line">				.collect(Collectors.toList());</span><br><span class="line">		list.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">		//放入Set</span><br><span class="line">		Set&lt;String&gt; set = emps.stream()</span><br><span class="line">				.map(Employee::getName)</span><br><span class="line">				.collect(Collectors.toSet());</span><br><span class="line">		set.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">		//放入LinkedHashSet</span><br><span class="line">		LinkedHashSet&lt;String&gt; linkedHashSet = emps.stream()</span><br><span class="line">				.map(Employee::getName)</span><br><span class="line">				.collect(Collectors.toCollection(LinkedHashSet::new));</span><br><span class="line">		linkedHashSet.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		//总数</span><br><span class="line">		Long count = emps.stream()</span><br><span class="line">				.collect(Collectors.counting());</span><br><span class="line">		System.out.println(count);</span><br><span class="line"></span><br><span class="line">		//平均值</span><br><span class="line">		Double avg = emps.stream()</span><br><span class="line">				.collect(Collectors.averagingDouble(Employee::getSalary));</span><br><span class="line">		System.out.println(avg);</span><br><span class="line"></span><br><span class="line">		//总和</span><br><span class="line">		Double sum = emps.stream()</span><br><span class="line">				.collect(Collectors.summingDouble(Employee::getSalary));</span><br><span class="line">		System.out.println(sum);</span><br><span class="line"></span><br><span class="line">		//最大值</span><br><span class="line">		Optional&lt;Employee&gt; max = emps.stream()</span><br><span class="line">				.collect(Collectors.maxBy((e1, e2) -&gt; Double.compare(e1.getSalary(), e2.getSalary())));</span><br><span class="line">		System.out.println(max.get());</span><br><span class="line"></span><br><span class="line">		//最小值</span><br><span class="line">		Optional&lt;Double&gt; min = emps.stream()</span><br><span class="line">				.map(Employee::getSalary)</span><br><span class="line">				.collect(Collectors.minBy(Double::compare));</span><br><span class="line">		System.out.println(min.get());</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">**定义：**Optional 类 (java.util.Optional) 是一个容器类，代表一个值存在或不存在，原来用 null 表示一个值不存在，现在用 Optional 可以更好的表达这个概念；并且可以避免空指针异常</span><br><span class="line"></span><br><span class="line">常用方法：</span><br><span class="line"></span><br><span class="line">Optional.of(T t)：创建一个 Optional 实例</span><br><span class="line">Optional.empty(T t)：创建一个空的 Optional 实例</span><br><span class="line">Optional.ofNullable(T t)：若 t 不为 null，创建 Optional 实例，否则空实例</span><br><span class="line">isPresent()：判断是否包含某值</span><br><span class="line">orElse(T t)：如果调用对象包含值，返回该值，否则返回 t</span><br><span class="line">orElseGet(Supplier s)：如果调用对象包含值，返回该值，否则返回 s 获取的值</span><br><span class="line">map(Function f)：如果有值对其处理，并返回处理后的 Optional，否则返回 Optional.empty()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Optional.of(T t)：</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test01()&#123;</span><br><span class="line">    Optional&lt;Employee&gt; op = Optional.of(new Employee());</span><br><span class="line">    Employee employee = op.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Optional.empty(T t)：</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test02()&#123;</span><br><span class="line">    Optional&lt;Employee&gt; op = Optional.empty();</span><br><span class="line">    Employee employee = op.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Optional.ofNullable(T t)：</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test03()&#123;</span><br><span class="line">    Optional&lt;Employee&gt; op = Optional.ofNullable(new Employee());</span><br><span class="line">    Employee employee = op.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">isPresent()：</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test03()&#123;</span><br><span class="line">    Optional&lt;Employee&gt; op = Optional.ofNullable(new Employee());</span><br><span class="line">    if (op.isPresent()) &#123;</span><br><span class="line">        Employee employee = op.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>stream流</tag>
      </tags>
  </entry>
  <entry>
    <title>linux单机与集群</title>
    <url>/2021/11/30/linux%E5%8D%95%E6%9C%BA%E4%B8%8E%E9%9B%86%E7%BE%A4/</url>
    <content><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>1.宁杭出差，发现同事安装软件比较顺利，自己也没有完整的搭建过一套，所以决心安装单机和集群</p>
<p>2.用的虚拟机，centos7，最小安装，所以需要一些前置安装</p>
<h1 id="前置安装"><a href="#前置安装" class="headerlink" title="前置安装"></a>前置安装</h1><h2 id="1-ifconfig命令"><a href="#1-ifconfig命令" class="headerlink" title="1.ifconfig命令"></a>1.ifconfig命令</h2><p>yum install net-tools.x86_64</p>
<h2 id="2-vim"><a href="#2-vim" class="headerlink" title="2.vim"></a>2.vim</h2><p>yum -y install vim*</p>
<h2 id="3-修改静态IP"><a href="#3-修改静态IP" class="headerlink" title="3.修改静态IP"></a>3.修改静态IP</h2><p>cd /etc/sysconfig/network-scripts</p>
<p>找ifcfg-ens？？</p>
<p>vim ifcfg-ens??</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IPADDR=&quot;192.168.25.160&quot; # 改成需要的ip，注意网段</span><br><span class="line">GATEWAY=&quot;192.168.25.2&quot; # 网关，可以先查下网关</span><br><span class="line">NETMASK=&quot;255.255.255.0&quot; # 不用动</span><br><span class="line">DNS1=&quot;114.114.114.114&quot; # dns自己配置能用的</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211209204032394.png" alt="image-20211209204032394"></p>
<p>重启网络</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>

<p>如果报错Failed to start LSB: Bring up/down networking RTNETLINK answers: File exists</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">关闭 NetworkManger 服务， systemct stop NetworkManager，并且禁止开机启动 systemctl disable NetworkManager</span><br><span class="line">systemctl stop NetworkManager &amp;&amp; systemctl restart network.service</span><br></pre></td></tr></table></figure>

<h2 id="4-安装gcc与g"><a href="#4-安装gcc与g" class="headerlink" title="4.安装gcc与g++"></a>4.安装gcc与g++</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ autoconf pcre pcre-devel make automake</span><br><span class="line">yum -y install wget httpd-tools vim</span><br></pre></td></tr></table></figure>

<p>验证</p>
<p>gcc -v</p>
<p>g++ -v </p>
<p>如果yum不下来，找到依赖包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">移动整个文件夹1，装gcc，gcc -v 如果有 跳过</span><br><span class="line">rpm -Uvh *.rpm --nodeps --force</span><br><span class="line">移动整个文件夹2，装gcc-c++ g++ -v 如果有 跳过</span><br><span class="line">rpm -Uvh *.rpm --nodeps --force</span><br></pre></td></tr></table></figure>

<h1 id="单机"><a href="#单机" class="headerlink" title="单机"></a>单机</h1><h2 id="1-JDK"><a href="#1-JDK" class="headerlink" title="1.JDK"></a>1.JDK</h2><p>1.卸载CentOS自带的openJDK（自己配置不生效的话再卸载）</p>
<p>查看是否已安装<br>rpm -qa|grep java<br>卸载<br>rpm -e –nodeps   jdk-xxx</p>
<p>2.把jdk的包移动到/usr/local/java</p>
<p>cd /usr/local</p>
<p>mkdir java</p>
<p>cd java</p>
<p>tar  -zxvf jdk-8u131-linux-x64.tar.gz</p>
<p>3.环境变量<br>vim /etc/profile<br>在后面追加</p>
<p>export JAVA_HOME=/usr/local/java/jdk1.8.0_131<br>export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar<br>export PATH=$PATH:$JAVA_HOME/bin</p>
<p>4.使配置文件生效<br>source /etc/profile</p>
<p>5.验证是否安装完成<br>java -version</p>
<h2 id="2-redis"><a href="#2-redis" class="headerlink" title="2.redis"></a>2.redis</h2><p>cd /opt</p>
<p>mkdir redis</p>
<p>cd redis</p>
<p>把redis-4.0.10.tar.gz移动到当前目录解压</p>
<p>tar -zvxf redis-4.0.10.tar.gz</p>
<p>cd redis-4.0.10</p>
<p>make install PREFIX=/opt/redis/redis-4.0.10</p>
<p>4.开启6379tcp端口<br>firewall-cmd –zone=public –add-port=6379/tcp –permanent</p>
<p>5.重启防火墙验证<br>systemctl reload firewalld<br>firewall-cmd –list-ports</p>
<p>3.启动<br>cd src ./redis-server</p>
<p>下图成功</p>
<p><img src="/../img/image-20211210153157348.png" alt="image-20211210153157348"></p>
<h3 id="修改redis配置文件"><a href="#修改redis配置文件" class="headerlink" title="修改redis配置文件"></a>修改redis配置文件</h3><p>在这个路径下 /opt/redis/redis-4.0.10</p>
<p>vim redis.conf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#bind 127.0.0.1 //允许远程连接</span><br><span class="line">远程连接，不用绑定ip</span><br><span class="line">protected-mode no</span><br><span class="line">持久化</span><br><span class="line">appendonly yes</span><br><span class="line">后台启动</span><br><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>

<p>cd src</p>
<p>./redis-server ../redis.conf</p>
<p>ps -ef|grep redis查看是否启动</p>
<p>7.redis命令行带密码</p>
<p><img src="/../img/image-20211210154959902.png" alt="image-20211210154959902"></p>
<p>这个图是没有密码，设置密码123456</p>
<p>config set requirepass 12345</p>
<p>exit退出</p>
<p>./redis-cli -p 6379 -a 123456<br>也可以进去后输入auth 123456完成认证</p>
<h2 id="3-nacos"><a href="#3-nacos" class="headerlink" title="3.nacos"></a>3.nacos</h2><p>cd /opt</p>
<p>mkdir nacos</p>
<p>cd nacos</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">把下载好的nacos安装包解压放到该目录</span><br><span class="line">tar xvfz nacos-server-2.0.1.tar.gz</span><br></pre></td></tr></table></figure>



<h3 id="配置MySQL-数据库"><a href="#配置MySQL-数据库" class="headerlink" title="配置MySQL 数据库"></a>配置MySQL 数据库</h3><h4 id="3-1-初始化数据库"><a href="#3-1-初始化数据库" class="headerlink" title="3.1 初始化数据库"></a><strong>3.1 初始化数据库</strong></h4><p>初始化数据库，导入nacos解压目录下conf/nacos-mysql.sql 文件</p>
<p><img src="/../img/wps1.jpg" alt="img"> </p>
<p>cd nacos/conf/</p>
<h4 id="3-2-配置数据库"><a href="#3-2-配置数据库" class="headerlink" title="3.2 配置数据库"></a><strong>3.2</strong> 配置数据库</h4><p>新建nacos_config</p>
<p><img src="/../img/image-20211212144106526.png" alt="image-20211212144106526"></p>
<p><img src="/../img/wps2.jpg" alt="img"></p>
<p>执行sql脚本</p>
<p><img src="/../img/image-20211212144134857.png" alt="image-20211212144134857"></p>
<h5 id="修改conf-application-properties-增加-mysql-数据源配置"><a href="#修改conf-application-properties-增加-mysql-数据源配置" class="headerlink" title="修改conf/application.properties,增加 mysql 数据源配置"></a>修改conf/application.properties,增加 mysql 数据源配置</h5><p>输入指令：vim /opt/nacos/nacos/conf/application.properties</p>
<p>按住shift+g, 在文件末尾添加： 注意自己的ip地址</p>
<p>spring.datasource.platform=mysql</p>
<p>db.num=1</p>
<p>db.url.0=jdbc:mysql://自己ip:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=10000&amp;socketTimeout=30000&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</p>
<p>db.user=root</p>
<p>db.password=Boco.123</p>
<h3 id="4、启动"><a href="#4、启动" class="headerlink" title="4、启动"></a><strong>4、启动</strong></h3><ol>
<li>进入nacos目录bin下：cd /opt/nacos/nacos/bin/</li>
</ol>
<p>启动命令：sh startup.sh -m standalone</p>
<p>查看运行日志： tail -500f /opt/nacos/nacos/logs/start.out</p>
<p><img src="/../img/image-20211212145000748.png" alt="image-20211212145000748"></p>
<p>2．界面控制台</p>
<p>注意打开8848端口</p>
<p>firewall-cmd –zone=public –add-port=8848/tcp –permanent</p>
<p>systemctl reload firewalld</p>
<p>启动完毕后。登录到界面控制台（用户名密码默认都是nacos）<a href="http://ip:8848/nacos">http://ip:8848/nacos</a></p>
<h3 id="5-Nacos关闭"><a href="#5-Nacos关闭" class="headerlink" title="5.Nacos关闭"></a>5.Nacos关闭</h3><p>进入 nacos/bin/目录下运行:  ./shutdown.sh </p>
<h2 id="4-mysql"><a href="#4-mysql" class="headerlink" title="4.mysql"></a>4.mysql</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.先查看是否已安装</span><br><span class="line">yum list installed | grep mysql</span><br><span class="line">有的话就卸载：yum remove mysql mysql-*</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/mysql/server </span><br><span class="line">mkdir -p /opt/mysql/client</span><br><span class="line"></span><br><span class="line">server.rpm文件移动到server</span><br><span class="line">client.rpm文件移动到client</span><br><span class="line"></span><br><span class="line">2.安装server</span><br><span class="line">rpm -ivh mysql-community-server-5.7.29-1.el6.x86_64.rpm --force --nodeps</span><br><span class="line">3.安装client</span><br><span class="line">rpm -ivh mysql-community-client-5.7.29-1.el6.x86_64.rpm --force --nodeps</span><br><span class="line"></span><br><span class="line">### errmsg.sys此步一定要在第4步之前做</span><br><span class="line"></span><br><span class="line">把errmsg.sys移动到 /usr/share/mysql/目录下</span><br><span class="line"></span><br><span class="line">修改配置文件my.cnf,根据情况定</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">4.启动mysql</span><br><span class="line">service mysqld start</span><br><span class="line">5.查看默认密码</span><br><span class="line">grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line">6.复制默认密码，进入mysql</span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">7.修改密码</span><br><span class="line">set global validate_password_policy=LOW;</span><br><span class="line">set global validate_password_length=8; #8为密码的长度</span><br><span class="line">alter user root@localhost identified by &#x27;Boco.123&#x27;;</span><br><span class="line"></span><br><span class="line">8.使用新密码进入</span><br><span class="line">quit</span><br><span class="line">mysql -uroot -pBoco.123</span><br><span class="line"></span><br><span class="line">9.开启允许远程访问</span><br><span class="line">9.1 使用mysql库</span><br><span class="line">use mysql;</span><br><span class="line">9.2 查看默认情况，通常应该都是只允许localhost访问</span><br><span class="line">select User,authentication_string,Host from user;</span><br><span class="line">9.3 允许远程访问</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;Boco.123&#x27;;</span><br><span class="line">9.4 刷新权限</span><br><span class="line">flush privileges;</span><br><span class="line">9.5 检测是否成功，这步报错也没关系，没啥用</span><br><span class="line">select User,authentication_string,Host from user;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10 开放3306端口</span><br><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line">11 重启防火墙</span><br><span class="line">systemctl reload firewalld</span><br><span class="line">12 验证</span><br><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>

<p>9.5 检测是否成功</p>
<p><img src="/../img/image-20211211210627808.png" alt="image-20211211210627808"></p>
<p>第6步：这个是默认密码</p>
<p><img src="/../img/image-20211210171746098.png" alt="image-20211210171746098"></p>
<h3 id="查看mysql服务启没启动"><a href="#查看mysql服务启没启动" class="headerlink" title="查看mysql服务启没启动"></a>查看mysql服务启没启动</h3><p>systemctl status mysqld.service</p>
<h3 id="启动mysql"><a href="#启动mysql" class="headerlink" title="启动mysql"></a>启动mysql</h3><p>service mysqld start</p>
<p>如果报错</p>
<p><img src="/../img/image-20211211181158347.png" alt="image-20211211181158347"></p>
<p>vim /var/log/mysqld.log 查看具体信息</p>
<p>rm -rf /var/log/mysqld.log</p>
<h3 id="停止mysql"><a href="#停止mysql" class="headerlink" title="停止mysql"></a>停止mysql</h3><p>service mysqld stop</p>
<p><img src="/../img/image-20211212145805338.png" alt="image-20211212145805338"></p>
<h3 id="没有解决就卸载重装"><a href="#没有解决就卸载重装" class="headerlink" title="没有解决就卸载重装"></a>没有解决就卸载重装</h3><h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">卸载旧版本的mysql：yum remove mysql mysql-*</span><br><span class="line"></span><br><span class="line">检查有没有卸载干净：yum list installed | grep mysql</span><br></pre></td></tr></table></figure>

<h4 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h4><p><strong>一、使用以下命令查看当前安装mysql情况，查找以前是否装有mysql</strong></p>
<p>rpm -qa|grep -i mysql </p>
<p><strong>二、停止mysql服务、删除之前安装的mysql</strong></p>
<p>　　删除命令：**<code>rpm -e –nodeps 包名</code>**</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">　　rpm -ev MySQL-client-5.5.25a-1.rhel5</span><br><span class="line">　　rpm -ev MySQL-server-5.5.25a-1.rhel5</span><br></pre></td></tr></table></figure>

<p>　　如果提示依赖包错误，则使用以下命令尝试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rpm -ev MySQL-client-5.5.25a-1.rhel5 --nodeps</span><br></pre></td></tr></table></figure>

<p>　　如果提示错误：<code>error: %preun(xxxxxx) scriptlet failed, exit status 1</code></p>
<p>　　则用以下命令尝试：</p>
<p><code>rpm -e --noscripts MySQL-client-``5.5``.25a-``1``.rhel5</code></p>
<p><strong>三、查找之前老版本mysql的目录、并且删除老版本mysql的文件和库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find / -name mysql</span><br></pre></td></tr></table></figure>

<p> 查找结果如下：  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/var/lib/mysql</span><br><span class="line">/var/lib/mysql/mysql</span><br><span class="line">/usr/lib64/mysql</span><br><span class="line">/usr/share/mysql</span><br></pre></td></tr></table></figure>

<p>删除对应的mysql目录</p>
<p>rm -rf /var/lib/mysql<br>rm -rf /var/lib/mysql/mysql<br>rm -rf /usr/lib64/mysql<br>rm -rf /usr/share/mysql</p>
<p>具体的步骤如图：查找目录并删除</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTIxMTM1NS8yMDE4MDYvMTIxMTM1NS0yMDE4MDYyOTIxMDU1OTMyMy0xMTM1MjA4MDI1LnBuZw?x-oss-process=image/format,png" alt="img"></p>
<p><strong>注意：</strong>卸载后/etc/my.cnf不会删除，需要进行手工删除</p>
<p>rm -rf /etc/my.cnf </p>
<p><strong>四、再次查找机器是否安装mysql</strong></p>
<p>rpm -qa|grep -i mysql</p>
<p> 无结果，说明已经卸载彻底，接下来直接安装mysql即可。</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p><img src="/../img/image-20211212143624575.png" alt="image-20211212143624575"></p>
<p>vim /var/log/mysqld.log 查看具体信息以后发现</p>
<p><img src="/../img/image-20211212143639947.png" alt="image-20211212143639947"></p>
<h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><p>mkdir -p /var/run/mysqld</p>
<p>chown mysql.mysql /var/run/mysqld/ </p>
<p>systemctl start mysqld</p>
<h2 id="5-zk-2181"><a href="#5-zk-2181" class="headerlink" title="5.zk-2181"></a>5.zk-2181</h2><p>cd /opt</p>
<p>mkdir zookeeper</p>
<p>cd zookeeper</p>
<p>tar  -zxvf zookeeper-3.4.9.tar.gz</p>
<p>cd zookeeper-3.4.9</p>
<p>cd conf/</p>
<p>入conf目录下，将zoo_sample.cfg，名字为zoo.cfg</p>
<p>mv zoo_sample.cfg zoo.cfg</p>
<h3 id="vim-zoo-cfg"><a href="#vim-zoo-cfg" class="headerlink" title="vim zoo.cfg"></a>vim zoo.cfg</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/opt/zookeeper/zookeeper-3.4.9/data</span><br><span class="line">datalogDir=/opt/zookeeper/zookeeper-3.4.9/logs</span><br><span class="line">clientPort=2181</span><br></pre></td></tr></table></figure>

<p>mkdir /opt/zookeeper/zookeeper-3.4.9/data<br>mkdir /opt/zookeeper/zookeeper-3.4.9/logs</p>
<h3 id="启动bin目录下"><a href="#启动bin目录下" class="headerlink" title="启动bin目录下"></a>启动bin目录下</h3><p>cd /opt/zookeeper/zookeeper-3.4.9/bin/</p>
<p>./zkServer.sh start<br>./zkServer.sh stop<br>./zkServer.sh restart<br>./zkServer.sh status</p>
<p>可以看到status是standlone单机</p>
<p><img src="/../img/image-20211210162347839.png" alt="image-20211210162347839"></p>
<h2 id="6-kafka-9092-D-kafka-kafka-txt"><a href="#6-kafka-9092-D-kafka-kafka-txt" class="headerlink" title="6.kafka-9092(D:\kafka\kafka.txt)"></a>6.kafka-9092(D:\kafka\kafka.txt)</h2><p>cd /opt</p>
<p>mkdir kafka</p>
<p>1.解压到/opt/kafka使用kafka_2.12-0.10.2.1.tgz这个包</p>
<p>tar -vxzf kafka_2.12-0.10.2.1.tgz</p>
<p>2.开启9092tcp端口<br>firewall-cmd –zone=public –add-port=9092/tcp –permanent</p>
<p>systemctl reload firewalld</p>
<p>cd /opt/kafka/kafka_2.12-0.10.2.1/config</p>
<h3 id="vim-server-properties"><a href="#vim-server-properties" class="headerlink" title="vim server.properties"></a>vim server.properties</h3><p><img src="/../img/image-20211022175625401-1639125434743.png" alt="image-20211022175625401"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#broler全局唯一编号，不能重复</span><br><span class="line">broker.id=0</span><br><span class="line">#打开删除topic功能</span><br><span class="line">delete.topic.enable=true</span><br><span class="line">#访问kafka的地址</span><br><span class="line">listeners=PLAINTEXT://ip:9092</span><br><span class="line">advertised.listeners=PLAINTEXT://ip:9092</span><br><span class="line">#kafka运行日志存放的路径</span><br><span class="line">log.dirs=/opt/kafka/logs</span><br><span class="line">#配置连接Zookeeper</span><br><span class="line">zookeeper.connect=192.168.214.130:2181</span><br><span class="line">#更改默认过期时间，可以不设置，默认7天168h</span><br><span class="line">log.retention.hours=24</span><br></pre></td></tr></table></figure>

<p>如果想修改kafka端口号</p>
<p>添加port即可，默认是没有的</p>
<p><img src="/../img/image-20211215194509842.png" alt="image-20211215194509842"></p>
<p>mkdir /opt/kafka/logs</p>
<p>启动kafka bin目录下</p>
<p>cd /opt/kafka/kafka_2.12-0.10.2.1/bin</p>
<p>sh kafka-server-start.sh -daemon ../config/server.properties</p>
<p>停止</p>
<p>kafka-server-stop.sh stop 或者</p>
<p>sh kafka-server-stop.sh</p>
<p>#查看zookeeper<br>ps -ef|grep zookeeper</p>
<p>验证Kafka是否启动成功：</p>
<p>输入jps命令回车查看，有Kafka进程，说明启动成功</p>
<p><img src="/../img/image-20211210164417297.png" alt="image-20211210164417297"></p>
<p>注意kafka是在bin目录的外层，不是内层</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.查看主题列表</span><br><span class="line">bin/kafka-topics.sh --zookeeper localhost:2181 --list</span><br><span class="line"></span><br><span class="line">2.创建topic  test</span><br><span class="line">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</span><br><span class="line"></span><br><span class="line">5.启动生产者</span><br><span class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br><span class="line"></span><br><span class="line">6.启动消费者，新窗口</span><br><span class="line">./bin/kafka-console-consumer.sh --zookeeper localhost:2181 -topic test --from-beginning</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发送</p>
<p><img src="/../img/image-20211210165030872.png" alt="image-20211210165030872"></p>
<p>新窗口接受</p>
<p><img src="/../img/image-20211210165045375.png" alt="image-20211210165045375"></p>
<p>QuorumPeerMain-zookeeper</p>
<p>Kafka-kafka</p>
<p><img src="/../img/image-20211210165135500.png" alt="image-20211210165135500"></p>
<h2 id="7-nginx"><a href="#7-nginx" class="headerlink" title="7.nginx"></a>7.nginx</h2><p>mkdir -p /usr/local/nginx</p>
<p>cd /usr/local/nginx</p>
<p>把3下面的所有文件移动到/usr/local/nginx下</p>
<p>把nginx的tar.gz包也移动到/usr/local/nginx下</p>
<p>解压并安装pcre<br>cd /usr/local/nginx<br>tar -zxvf pcre-8.37.tar.gz<br>cd /usr/local/nginx/pcre-8.37<br>./configure<br>make<br>make install</p>
<p>解压并安装zlib<br>cd /usr/local/nginx<br>tar -zxvf zlib-1.2.11.tar.gz<br>cd /usr/local/nginx/zlib-1.2.11<br>./configure<br>make<br>make install</p>
<p>解压并安装openssl（需要perl5依赖）<br>cd /usr/local/nginx<br>tar -zxvf openssl-1.1.0i.tar.gz<br>cd /usr/local/nginx/openssl-1.1.0i<br>./config<br>make<br>make install</p>
<p>编译完成后，使用 openssl version 来查看一下当前 openssl 版本号时<br>echo “/usr/local/lib64/“ &gt;&gt; /etc/ld.so.conf<br>ldconfig<br>再次使用 openssl version 验证版本就可以了</p>
<p>解压并安装nginx<br>cd /usr/local/nginx<br>tar -zxvf nginx-1.18.0.tar.gz<br>cd /usr/local/nginx/nginx-1.18.0<br>./configure –prefix=/usr/local/nginx –with-http_ssl_module –with-pcre=/usr/local/nginx/pcre-8.37 –with-zlib=/usr/local/nginx/zlib-1.2.11 –with-openssl=/usr/local/nginx/openssl-1.1.0i</p>
<p>make<br>make install</p>
<p>最后开放指定端口</p>
<p>开放指定端口<br>查看80端口是否开启<br>firewall-cmd –query-port=80/tcp</p>
<p>如果没开启，开启80端口<br>firewall-cmd –zone=public –add-port=80/tcp –permanent</p>
<p>最后刷新配置：systemctl reload firewalld</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>cd /usr/local/nginx/sbin</p>
<p>./nginx</p>
<h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><p><strong>ps -ef | grep nginx</strong></p>
<p><img src="/../img/image-20211212152819121.png" alt="image-20211212152819121"></p>
<p>或者</p>
<p><strong>netstat -anp | grep :80</strong>命令来通过占用端口判断Nginx是否启动</p>
<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><p>./nginx -s reload</p>
<h3 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h3><p>./nginx -s stop</p>
<h3 id="后端收不到token"><a href="#后端收不到token" class="headerlink" title="后端收不到token"></a>后端收不到token</h3><p>原因：前端header中加token的时候字段为<code>sso_token</code>，但是nginx默认带下划线的字段他不转发，所以要手动开启<code>underscores_in_headers on;</code></p>
<p><code>nginx.conf</code>添加<code>underscores_in_headers on;</code>即可</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line">    # 加上这个，nginx代理的时候就会带token了</span><br><span class="line">    underscores_in_headers on;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-nexus私服"><a href="#8-nexus私服" class="headerlink" title="8.nexus私服"></a>8.nexus私服</h2><h3 id="3版本，可能有问题，未解决"><a href="#3版本，可能有问题，未解决" class="headerlink" title="3版本，可能有问题，未解决"></a>3版本，可能有问题，未解决</h3><p>上传包到</p>
<p>mkdir /opt/nexus</p>
<p>cd /opt/nexus</p>
<p>tar -zxvf nexus-3.19.1-01-unix.tar.gz</p>
<h4 id="配置环境变量和端口号"><a href="#配置环境变量和端口号" class="headerlink" title="配置环境变量和端口号"></a>配置环境变量和端口号</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export MAVEN_HOME=/opt/nexus/nexus<span class="literal">-3</span>.<span class="number">19.1</span><span class="literal">-01</span>/</span><br><span class="line">export PATH=<span class="variable">$PATH:</span><span class="variable">$MAVEN_HOME</span>/bin</span><br><span class="line">export RUN_AS_USER=root</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h4 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h4><p>进到bin目录下 执行命令</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/nexus/nexus<span class="literal">-3</span>.<span class="number">19.1</span><span class="literal">-01</span>/bin</span><br><span class="line"></span><br><span class="line">./nexus run &amp;</span><br><span class="line">./nexus <span class="built_in">start</span></span><br><span class="line">./nexus restart</span><br><span class="line">./nexus stop</span><br></pre></td></tr></table></figure>

<p>成功截图</p>
<p><img src="/../img/image-20220101195653841.png" alt="image-20220101195653841"></p>
<h4 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h4><p>cd /opt/nexus/sonatype-work/nexus3</p>
<p>下有个admin.password</p>
<p>vim 看一下，这就是初始密码</p>
<p>然后输入会让你重置密码</p>
<p>最终为admin/admin123</p>
<h4 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h4><p>cd /opt/nexus/sonatype-work/nexus3/log/</p>
<p>tail -2000f nexus.log</p>
<h3 id="2版本"><a href="#2版本" class="headerlink" title="2版本"></a>2版本</h3><p>mkdir -p /usr/local/nexus</p>
<p>cd /usr/local/nexus</p>
<p>tar -zxvf nexus-2.14.5-02-bundle.tar.gz</p>
<h4 id="配置文件nexus-properties"><a href="#配置文件nexus-properties" class="headerlink" title="配置文件nexus.properties"></a>配置文件nexus.properties</h4><p>修改端口在这里改</p>
<p>vim /usr/local/nexus/nexus-2.14.5-02/conf/nexus.properties</p>
<h4 id="修改使用用户账号"><a href="#修改使用用户账号" class="headerlink" title="修改使用用户账号"></a>修改使用用户账号</h4><p>vim bin/nexus</p>
<p>#将RUN_AS_USER= 注解放开，并改成”root”</p>
<p><img src="/../img/image-20220101210353171.png" alt="image-20220101210353171"></p>
<h4 id="启动-2"><a href="#启动-2" class="headerlink" title="启动"></a>启动</h4><p>进到bin目录下 执行命令</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/nexus/nexus<span class="literal">-2</span>.<span class="number">14.5</span><span class="literal">-02</span>/bin</span><br><span class="line"></span><br><span class="line">./nexus <span class="built_in">start</span></span><br><span class="line">./nexus restart</span><br><span class="line">./nexus stop</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">默认账号：</span><br><span class="line">admin/admin123</span><br><span class="line">deployment/deployment123</span><br></pre></td></tr></table></figure>

<h4 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h4><p>tail -2000f /usr/local/nexus/nexus-2.14.5-02/logs/wrapper.log</p>
<h4 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h4><p><a href="http://192.168.214.130:8081/nexus/#welcome">http://192.168.214.130:8081/nexus/#welcome</a></p>
<h4 id="修改中央仓库镜像为阿里云"><a href="#修改中央仓库镜像为阿里云" class="headerlink" title="修改中央仓库镜像为阿里云"></a>修改中央仓库镜像为阿里云</h4><p><img src="/../img/image-20220101212006777.png" alt="image-20220101212006777"></p>
<p><img src="/../img/image-20220101212111179.png" alt="image-20220101212111179"></p>
<p>阿里云镜像：<a href="http://maven.aliyun.com/nexus/content/groups/public/">http://maven.aliyun.com/nexus/content/groups/public/</a></p>
<h1 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h1><h2 id="1-redis集群必须6个节点"><a href="#1-redis集群必须6个节点" class="headerlink" title="1.redis集群必须6个节点"></a>1.redis集群必须6个节点</h2><p>注意redis与nginx都需要openssl，安装一个即可</p>
<h3 id="Redis集群依赖安装"><a href="#Redis集群依赖安装" class="headerlink" title="Redis集群依赖安装"></a>Redis集群依赖安装</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">安装Ruby和gem安装和修改</span><br><span class="line">1、Ruby安装</span><br><span class="line">检查ruby的版本</span><br><span class="line">ruby -v </span><br><span class="line">本次安装ruby-2.2.2版本,将下载好的软件上传到服务器上/usr/local</span><br><span class="line">执行指令：</span><br><span class="line">cd /usr/local</span><br><span class="line">tar -zxvf ruby-2.2.2.tar.gz</span><br><span class="line">cd ruby-2.2.2</span><br><span class="line">./configure</span><br><span class="line">make </span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">如果报错-bash: /usr/bin/ruby: 没有那个文件或目录</span><br><span class="line">ln -s /usr/local/ruby-2.2.2/ruby /usr/bin/ruby</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">检查ruby的版本</span><br><span class="line">ruby -v </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2、安装redis的redis-3.3.5.gem，</span><br><span class="line">gem install -l redis-3.3.5.gem</span><br></pre></td></tr></table></figure>

<p>如果报错</p>
<p><img src="/../img/image-20211215200212651.png" alt="image-20211215200212651"></p>
<p>yum -y install zlib zlib-devel</p>
<p>cd /usr/local/ruby-2.2.2/ext/zlib/<br>ruby extconf.rb<br>sed -i s#$(top_srcdir)#../..# Makefile<br>make<br>make install</p>
<p>再次 gem install -l redis-3.3.5.gem即可</p>
<p>3)安装完毕，提示”1 gem installed”，并且输入：gem list，有红框提示，截图如下</p>
<p><img src="/../img/image-20211212212510719.png" alt="image-20211212212510719"></p>
<h3 id="开始安装伪集群"><a href="#开始安装伪集群" class="headerlink" title="开始安装伪集群"></a>开始安装伪集群</h3><p>cd /usr/local</p>
<p>mkdir redis</p>
<p>cd redis</p>
<p>把redis-4.0.10.tar.gz移动到当前目录解压</p>
<p>tar -zvxf redis-4.0.10.tar.gz</p>
<p>cd redis-4.0.10</p>
<p>make install PREFIX=/usr/local/redis/redis-4.0.10</p>
<p>cd /usr/local/redis</p>
<p>mkdir cluster-config</p>
<p>cd cluster-config</p>
<p>mkdir 7001</p>
<p>mkdir 7002</p>
<p>mkdir 7003</p>
<p>mkdir 7004</p>
<p>mkdir 7005</p>
<p>mkdir 7006</p>
<p>复制bin文件到700*中</p>
<p>cp -r /usr/local/redis/redis-4.0.10/bin /usr/local/redis/cluster-config/7001</p>
<p>cp -r /usr/local/redis/redis-4.0.10/bin /usr/local/redis/cluster-config/7002</p>
<p>cp -r /usr/local/redis/redis-4.0.10/bin /usr/local/redis/cluster-config/7003</p>
<p>cp -r /usr/local/redis/redis-4.0.10/bin /usr/local/redis/cluster-config/7004</p>
<p>cp -r /usr/local/redis/redis-4.0.10/bin /usr/local/redis/cluster-config/7005</p>
<p>cp -r /usr/local/redis/redis-4.0.10/bin /usr/local/redis/cluster-config/7006</p>
<p>redis.conf文件先不全部复制过去，先只复制到7001，等改完7001在复制</p>
<p>cp -r /usr/local/redis/redis-4.0.10/redis.conf  /usr/local/redis/cluster-config/7001/</p>
<h4 id="修改7001文件夹的配置信息，redis-conf"><a href="#修改7001文件夹的配置信息，redis-conf" class="headerlink" title="修改7001文件夹的配置信息，redis.conf"></a>修改7001文件夹的配置信息，redis.conf</h4><p>文件如下内容：</p>
<p>vim /usr/local/redis/cluster-config/7001/redis.conf</p>
<p>7001：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">port 7001</span><br><span class="line">protected-mode no</span><br><span class="line">daemonize yes</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-7001.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br><span class="line">masterauth Boco123 这个找到以后在下面自己写</span><br><span class="line">requirepass Boco123</span><br><span class="line">bind 10.12.1.33</span><br><span class="line">logfile &quot;/usr/local/redis/cluster-config/7001/redis.log&quot;</span><br><span class="line">dir /usr/local/redis/cluster-config/7001/</span><br><span class="line">pidfile cluster-config/7001.pid/</span><br></pre></td></tr></table></figure>

<p>把reds.conf复制 到另外5个文件夹</p>
<p>cp -r /usr/local/redis/cluster-config/7001/redis.conf /usr/local/redis/cluster-config/7002</p>
<p>cp -r /usr/local/redis/cluster-config/7001/redis.conf /usr/local/redis/cluster-config/7003</p>
<p>cp -r /usr/local/redis/cluster-config/7001/redis.conf /usr/local/redis/cluster-config/7004</p>
<p>cp -r /usr/local/redis/cluster-config/7001/redis.conf /usr/local/redis/cluster-config/7005</p>
<p>cp -r /usr/local/redis/cluster-config/7001/redis.conf /usr/local/redis/cluster-config/7006</p>
<p>vim /usr/local/redis/cluster-config/7002/redis.conf</p>
<p>vim /usr/local/redis/cluster-config/7003/redis.conf</p>
<p>vim /usr/local/redis/cluster-config/7004/redis.conf</p>
<p>vim /usr/local/redis/cluster-config/7005/redis.conf</p>
<p>vim /usr/local/redis/cluster-config/7006/redis.conf</p>
<p>替换每一个端口</p>
<p>:%s/7001/7002/g</p>
<p>:%s/7001/7003/g</p>
<p>:%s/7001/7004/g</p>
<p>:%s/7001/7005/g</p>
<p>:%s/7001/7006/g</p>
<h4 id="防火墙，每台机器都要改"><a href="#防火墙，每台机器都要改" class="headerlink" title="防火墙，每台机器都要改"></a>防火墙，每台机器都要改</h4><p>firewall-cmd –zone=public –add-port=700*/tcp –permanent</p>
<p>注意也要开始1700*，这是一个问题因为集群端口时10000+</p>
<p><img src="/../img/image-20211214104015438.png" alt="image-20211214104015438"></p>
<p>firewall-cmd –zone=public –add-port=1700*/tcp –permanent</p>
<p>systemctl reload firewalld</p>
<p>把下图的三个文件粘到/usr/local/redis/cluster-config/下</p>
<p><img src="/../img/image-20211213085657656.png" alt="image-20211213085657656"></p>
<p>chmod +x start-all.sh<br>chmod +x stop-all.sh</p>
<h4 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h4><p>find / -name “redis-trib.rb”</p>
<p>vim /usr/local/redis/redis-4.0.10/src/redis-trib.rb</p>
<p>第99行添加密码</p>
<p>, :password =&gt; “Boco123”</p>
<p><img src="/../img/image-20211213090142016.png" alt="image-20211213090142016"></p>
<h4 id="集群启动和停止，"><a href="#集群启动和停止，" class="headerlink" title="集群启动和停止，"></a>集群启动和停止，</h4><p>cd /usr/local/redis/cluster-config</p>
<p>sh start-all.sh</p>
<p>ps -ef|grep redis     验证一下</p>
<h4 id="stop-all-sh文件里有需要的话更改密码，并且更换ip地址"><a href="#stop-all-sh文件里有需要的话更改密码，并且更换ip地址" class="headerlink" title="stop-all.sh文件里有需要的话更改密码，并且更换ip地址"></a>stop-all.sh文件里有需要的话更改密码，并且更换ip地址</h4><p>sh stop-all.sh</p>
<h4 id="创造节点"><a href="#创造节点" class="headerlink" title="创造节点"></a>创造节点</h4><p>cd /usr/local/redis/redis-4.0.10/src/</p>
<p>./redis-trib.rb create –replicas 1 192.168.214.132:7001 192.168.214.132:7002 192.168.214.132:7003 192.168.214.132:7004 192.168.214.132:7005 192.168.214.132:7006 </p>
<p><img src="/../img/image-20211213090519363.png" alt="image-20211213090519363"></p>
<h4 id="测试redis"><a href="#测试redis" class="headerlink" title="测试redis"></a><strong>测试redis</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">需要输入认证密码（Boco123），如下所示：</span><br><span class="line"></span><br><span class="line">cd /usr/local/redis/cluster-config/7001/bin</span><br><span class="line"></span><br><span class="line">./redis-cli -c -h 192.168.214.132 -p 7001 -a Boco123</span><br><span class="line"></span><br><span class="line">192.168.214.132:7001&gt; set a 1</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">另开一个session</span><br><span class="line">cd /usr/local/redis/cluster-config/7002/bin</span><br><span class="line"></span><br><span class="line">./redis-cli -c -h 192.168.214.132 -p 7002 -a Boco123</span><br><span class="line"></span><br><span class="line">192.168.214.132:7001&gt; get a 1</span><br><span class="line">&quot;1&quot;</span><br><span class="line"></span><br><span class="line">到这里，只要看到set进去的值能够get出来，这就说明redis已经安装成功了，测试结束。</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211213095757637.png" alt="image-20211213095757637"></p>
<p><img src="/../img/image-20211213095803837.png" alt="image-20211213095803837"></p>
<h3 id="真集群"><a href="#真集群" class="headerlink" title="真集群"></a>真集群</h3><p>每个机器都一样，只是没有7003~7006</p>
<p>将文件复制到其他机器上，如果2个机器，那么每个机器3个，如果3个机器，那么每个机器2个</p>
<p>cd /usr/local/redis</p>
<p>scp -r cluster-config root@另一个服务器ip:/usr/local/redis/cluster-config</p>
<p>scp -r cluster-config root@另一个服务器ip:/usr/local/redis/cluster-config</p>
<p><img src="/../img/image-20211212185231903.png" alt="image-20211212185231903"></p>
<h4 id="在第一个有redis-4-0-10的机器上，其余机器可能没有redis-4-0-10"><a href="#在第一个有redis-4-0-10的机器上，其余机器可能没有redis-4-0-10" class="headerlink" title="在第一个有redis-4.0.10的机器上，其余机器可能没有redis-4.0.10"></a>在第一个有redis-4.0.10的机器上，其余机器可能没有redis-4.0.10</h4><h5 id="设置密码-1"><a href="#设置密码-1" class="headerlink" title="设置密码"></a>设置密码</h5><p>find / -name “redis-trib.rb”</p>
<p>vim /usr/local/redis/redis-4.0.10/src/redis-trib.rb</p>
<p>第99行添加密码</p>
<p><img src="/../img/image-20211213090142016.png" alt="image-20211213090142016"></p>
<h5 id="集群启动和停止，在每一个机器上都复制start-all-sh和stop-all-sh分别启动"><a href="#集群启动和停止，在每一个机器上都复制start-all-sh和stop-all-sh分别启动" class="headerlink" title="集群启动和停止，在每一个机器上都复制start-all.sh和stop-all.sh分别启动"></a>集群启动和停止，在每一个机器上都复制start-all.sh和stop-all.sh分别启动</h5><p>sh start-all.sh</p>
<p>停止</p>
<p>sh stop-all.sh</p>
<p>其中sh文件应该比伪集群的sh少了4行，只有7001,7002</p>
<h5 id="创造节点-1"><a href="#创造节点-1" class="headerlink" title="创造节点"></a>创造节点</h5><p>cd /usr/local/redis/redis-4.0.10/src/</p>
<p>./redis-trib.rb create –replicas 1 192.168.214.132:7001 192.168.214.132:7002 服务器1:7001 服务器1:7002 服务器2:7001 服务器2:7002</p>
<p>选项–replicas 1 表示我们希望为集群中的每个主节点创建一个从节点。</p>
<p>看到如下界面就证明启动成功了，看到I set the above configuration?时，输入yes即可</p>
<p><img src="/../img/image-20211212215816226.png" alt="image-20211212215816226"></p>
<h2 id="2-zk（最少需要三台服务器）"><a href="#2-zk（最少需要三台服务器）" class="headerlink" title="2.zk（最少需要三台服务器）"></a>2.zk（最少需要三台服务器）</h2><p>与单机其余都一样</p>
<h3 id="vim-zoo-cfg-1"><a href="#vim-zoo-cfg-1" class="headerlink" title="vim zoo.cfg"></a>vim zoo.cfg</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/opt/zookeeper/zookeeper-3.4.9/data</span><br><span class="line">datalogDir=/opt/zookeeper/zookeeper-3.4.9/logs</span><br><span class="line">clientPort=2181</span><br><span class="line">#以下配置与单机不一致，注意ip，本机的ip用0.0.0.0</span><br><span class="line">server.1=10.12.1.50:2888:3888</span><br><span class="line">server.2=10.12.1.34:2888:3888</span><br><span class="line">server.3=10.12.1.33:2888:3888</span><br></pre></td></tr></table></figure>

<p>mkdir /opt/zookeeper/zookeeper-3.4.9/data<br>mkdir /opt/zookeeper/zookeeper-3.4.9/logs</p>
<p>firewall-cmd –zone=public –add-port=3888/tcp –permanent</p>
<p>firewall-cmd –zone=public –add-port=2888/tcp –permanent</p>
<p>firewall-cmd –zone=public –add-port=2181/tcp –permanent</p>
<p>systemctl reload firewalld</p>
<p>cd /opt/zookeeper/zookeeper-3.4.9/data</p>
<p>vim myid     第一1，第二2，第三3</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure>

<p>退出</p>
<h3 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h3><p>cd /opt/zookeeper/zookeeper-3.4.9/bin</p>
<p>./zkServer.sh start<br>./zkServer.sh stop<br>./zkServer.sh restart<br>./zkServer.sh status</p>
<p>第一个服务器</p>
<p><img src="/../img/image-20211214205318046.png" alt="image-20211214205318046"></p>
<p>第二个服务器</p>
<p><img src="/../img/image-20211214205342980.png" alt="image-20211214205342980"></p>
<p>第三个服务器</p>
<p><img src="/../img/image-20211214205349339.png" alt="image-20211214205349339"></p>
<h2 id="3-kafka"><a href="#3-kafka" class="headerlink" title="3.kafka"></a>3.kafka</h2><p>如果集群报错，看下是不是端口写错了，2181,9092</p>
<p>cd /opt/kafka/kafka_2.12-0.10.2.1/config/</p>
<p>vim server.properties</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#broler全局唯一编号，不能重复,1,2,3</span><br><span class="line">broker.id=1</span><br><span class="line">#打开删除topic功能</span><br><span class="line">delete.topic.enable=true</span><br><span class="line">#内网访问kafka的地址</span><br><span class="line">listeners=PLAINTEXT://ip:9092</span><br><span class="line">advertised.listeners=PLAINTEXT://ip:9092</span><br><span class="line">#kafka运行日志存放的路径</span><br><span class="line">log.dirs=/opt/kafka/logs</span><br><span class="line">#配置连接Zookeeper</span><br><span class="line">zookeeper.connect=10.12.1.50:2181,10.12.1.34:2181,10.12.1.33:2181</span><br><span class="line">#更改默认过期时间，可以不设置，默认7天168h</span><br><span class="line">log.retention.hours=24</span><br></pre></td></tr></table></figure>

<p>mkdir /opt/kafka/logs</p>
<h3 id="启动kafka-bin目录下"><a href="#启动kafka-bin目录下" class="headerlink" title="启动kafka bin目录下"></a>启动kafka bin目录下</h3><p>cd /opt/kafka/kafka_2.12-0.10.2.1/bin</p>
<p>sh kafka-server-start.sh -daemon ../config/server.properties</p>
<p>停止</p>
<p>kafka-server-stop.sh stop 或者</p>
<p>sh kafka-server-stop.sh</p>
<p>#查看zookeeper<br>ps -ef|grep zookeeper</p>
<p>验证Kafka是否启动成功：</p>
<p>输入jps命令回车查看，有Kafka进程，说明启动成功</p>
<p><img src="/../img/image-20211210164417297.png" alt="image-20211210164417297"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.查看主题列表</span><br><span class="line">bin/kafka-topics.sh --zookeeper localhost:2181 --list</span><br><span class="line"></span><br><span class="line">2.创建topic  test</span><br><span class="line">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</span><br><span class="line"></span><br><span class="line">5.启动生产者</span><br><span class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br><span class="line"></span><br><span class="line">6.启动消费者，新窗口</span><br><span class="line">./bin/kafka-console-consumer.sh --zookeeper localhost:2181 -topic test --from-beginning</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>在131上创建了test</p>
<p><img src="/../img/image-20211215094559262.png" alt="image-20211215094559262"></p>
<p>在132上查，发现有test</p>
<p><img src="/../img/image-20211215094627263.png" alt="image-20211215094627263"></p>
<h2 id="4-nacos"><a href="#4-nacos" class="headerlink" title="4.nacos"></a>4.nacos</h2><p>进入nacos目录下conf目录，有配置文件cluster.conf.example，复制成cluster.conf</p>
<p>mv cluster.conf.example cluster.conf</p>
<p>vim cluster.conf</p>
<p>设置三个端口ip</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">192.168.214.131:8848</span><br><span class="line">192.168.214.132:8848</span><br><span class="line">192.168.214.133:8848</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="配置-MySQL-数据库-与单机一致"><a href="#配置-MySQL-数据库-与单机一致" class="headerlink" title="配置 MySQL 数据库(与单机一致)"></a>配置 MySQL 数据库(与单机一致)</h3><h5 id="修改conf-application-properties-增加-mysql-数据源配置-1"><a href="#修改conf-application-properties-增加-mysql-数据源配置-1" class="headerlink" title="修改conf/application.properties,增加 mysql 数据源配置"></a>修改conf/application.properties,增加 mysql 数据源配置</h5><p>输入指令：vim /opt/nacos/nacos/conf/application.properties</p>
<p>按住shift+g, 在文件末尾添加： 注意自己的ip地址</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.datasource.platform=mysql</span><br><span class="line">db.num=1</span><br><span class="line">db.url.0=jdbc:mysql://自己ip:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=10000&amp;socketTimeout=30000&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span><br><span class="line">db.user=root</span><br><span class="line">db.password=Boco.123</span><br></pre></td></tr></table></figure>

<h3 id="三台都启动"><a href="#三台都启动" class="headerlink" title="三台都启动"></a>三台都<strong>启动</strong></h3><ol>
<li>进入nacos目录bin下：cd /opt/nacos/nacos/bin/</li>
</ol>
<p>启动命令：sh startup.sh</p>
<p>查看运行日志： tail -500f /opt/nacos/nacos/logs/start.out</p>
<p><img src="/../img/image-20211212145000748.png" alt="image-20211212145000748"></p>
<p>2．界面控制台</p>
<p>注意打开8848端口</p>
<p>firewall-cmd –zone=public –add-port=8848/tcp –permanent</p>
<p>systemctl reload firewalld</p>
<p>启动完毕后。登录到界面控制台（用户名密码默认都是nacos）<a href="http://ip:8848/nacos">http://ip:8848/nacos</a></p>
<p>查看集群管理，发现成功了</p>
<p><img src="/../img/image-20211215103115196.png" alt="image-20211215103115196"></p>
<h3 id="三台都关闭"><a href="#三台都关闭" class="headerlink" title="三台都关闭"></a>三台都关闭</h3><p>进入 nacos/bin/目录下运行:  ./shutdown.sh</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux单机与集群</tag>
      </tags>
  </entry>
  <entry>
    <title>Socket</title>
    <url>/2021/11/30/socket/</url>
    <content><![CDATA[<p>使用的流为DataInput(Out)Stream</p>
<h1 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.demo.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> port=<span class="number">4001</span>;</span><br><span class="line">        <span class="comment">//首先直接创建serversocket</span></span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(port);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用服务器的accept（）进行阻塞（程序会在这等待），当有申请连接时会打开阻塞并返回一个socket</span></span><br><span class="line">        System.out.println(<span class="string">&quot;服务器端已启动&quot;</span>);</span><br><span class="line">        Socket socket = server.accept();</span><br><span class="line">        <span class="comment">//获取输入流和输出流</span></span><br><span class="line">        DataInputStream dis= <span class="keyword">new</span> DataInputStream(socket.getInputStream());</span><br><span class="line">        DataOutputStream dos= <span class="keyword">new</span> DataOutputStream(socket.getOutputStream());</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(socket.isClosed())&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;关闭程序&quot;</span>);</span><br><span class="line">                System.exit(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            String str=dis.readUTF();</span><br><span class="line">            System.out.println(<span class="string">&quot;客户端发送的数据为：&quot;</span>+str);</span><br><span class="line">            dos.writeUTF(<span class="string">&quot;服务器端收到了：&quot;</span>+str);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//CloseUtil.closeAll(dos,dis,server,socket);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.demo.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ExecutorBuilder;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ThreadUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> port=<span class="number">4001</span>;</span><br><span class="line">        <span class="comment">//首先直接创建socket对象</span></span><br><span class="line">        Socket client = <span class="keyword">new</span> Socket(<span class="string">&quot;localhost&quot;</span>, port);</span><br><span class="line">        <span class="comment">//设置连接超时时间</span></span><br><span class="line">        client.setSoTimeout(<span class="number">3000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端已启动&quot;</span>);</span><br><span class="line">        ExecutorService executor = ExecutorBuilder.create()<span class="comment">//</span></span><br><span class="line">                .setCorePoolSize(<span class="number">2</span>)<span class="comment">//</span></span><br><span class="line">                .setMaxPoolSize(<span class="number">2</span>)<span class="comment">//</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">//创建发送的线程</span></span><br><span class="line">        Send send =<span class="keyword">new</span> Send(client);</span><br><span class="line">        <span class="comment">//创建接受的线程</span></span><br><span class="line">        Receive receive=<span class="keyword">new</span> Receive(client);</span><br><span class="line">        executor.submit(send);</span><br><span class="line">        executor.submit(receive);</span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="客户端又分为两类"><a href="#客户端又分为两类" class="headerlink" title="客户端又分为两类"></a>客户端又分为两类</h2><h3 id="1-发送"><a href="#1-发送" class="headerlink" title="1.发送"></a>1.发送</h3><p>发送从键盘获取数据，使用BufferedReader流</p>
<p>发送给服务端，DataOutputStream</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.demo.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/01/20  8:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">   <span class="comment">//从键盘获取数据</span></span><br><span class="line">   BufferedReader br;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//发送数据的数据流</span></span><br><span class="line">   <span class="comment">//PrintWriter socketOut = new PrintWriter(socket.getOutputStream());</span></span><br><span class="line">   DataOutputStream dos;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Send</span><span class="params">()</span></span>&#123;</span><br><span class="line">      br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Send</span><span class="params">(Socket client)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>();<span class="comment">//调用本类无参构造方法</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         dos = <span class="keyword">new</span> DataOutputStream(client.getOutputStream());</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         flag=<span class="keyword">false</span>;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">         CloseUtil.closeAll(br,client,dos);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//获取消息</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> String <span class="title">getMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">      String str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         str = br.readLine();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         flag=<span class="keyword">false</span>;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">         CloseUtil.closeAll(br);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> str;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//发送消息</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         dos.writeUTF(str);</span><br><span class="line">         <span class="comment">//清空缓存，输出</span></span><br><span class="line">         dos.flush();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         CloseUtil.closeAll(dos);</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">         String message = getMessage();</span><br><span class="line">         <span class="keyword">if</span>(message.equals(<span class="string">&quot;bye&quot;</span>))&#123;</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">this</span>.sendMessage(message);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-接受"><a href="#2-接受" class="headerlink" title="2.接受"></a>2.接受</h3><p>DataInputStream，输入流</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.demo.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/01/20  9:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Receive</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   <span class="comment">//接收数据的数据流</span></span><br><span class="line">   <span class="comment">//BufferedReader socketIn = new BufferedReader(new InputStreamReader(client.getInputStream()));</span></span><br><span class="line">   DataInputStream dis;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Receive</span><span class="params">(Socket client)</span></span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         dis = <span class="keyword">new</span> DataInputStream(client.getInputStream());</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         flag=<span class="keyword">false</span>;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">         CloseUtil.closeAll(dis,client);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取消息</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> String <span class="title">getMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">      String str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         str = dis.readUTF();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         flag=<span class="keyword">false</span>;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">         CloseUtil.closeAll(dis);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> str;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">         System.out.println(getMessage());</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="基于socket的网络聊天室"><a href="#基于socket的网络聊天室" class="headerlink" title="基于socket的网络聊天室"></a>基于socket的网络聊天室</h1><h2 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h2><p>客户端代码不变，多开几个main方法就是多个客户</p>
<p><img src="/../img/image-20220120150119854.png" alt="image-20220120150119854"></p>
<h2 id="服务端-1"><a href="#服务端-1" class="headerlink" title="服务端"></a>服务端</h2><p>也变成多线程的模式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.demo.socket.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jiang.demo.socket.CloseUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/01/20  14:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyChannel</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 每一个客户端都是一条道路</span></span><br><span class="line"><span class="comment">    * 1.输入流</span></span><br><span class="line"><span class="comment">    * 2.输出流</span></span><br><span class="line"><span class="comment">    * 3.接收数据</span></span><br><span class="line"><span class="comment">    * 4.发送数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> DataInputStream dis;</span><br><span class="line">   <span class="keyword">private</span> DataOutputStream dos;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyChannel</span><span class="params">(Socket client)</span></span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         dis=<span class="keyword">new</span> DataInputStream(client.getInputStream());</span><br><span class="line">         dos=<span class="keyword">new</span> DataOutputStream(client.getOutputStream());</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         flag=<span class="keyword">false</span>;</span><br><span class="line">         CloseUtil.closeAll(dis,dos);</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">         Server.list.remove(<span class="keyword">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//接受数据的方法</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> String <span class="title">receive</span><span class="params">()</span></span>&#123;</span><br><span class="line">      String str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         str=dis.readUTF();</span><br><span class="line">      &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">         flag=<span class="keyword">false</span>;</span><br><span class="line">         CloseUtil.closeAll(dis,dos);</span><br><span class="line">         Server.list.remove(<span class="keyword">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> str;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//发送数据方法</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(str!=<span class="keyword">null</span> &amp;&amp; str.length()!=<span class="number">0</span>)&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            dos.writeUTF(str);</span><br><span class="line">            <span class="comment">//清空缓存，输出</span></span><br><span class="line">            dos.flush();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            flag=<span class="keyword">false</span>;</span><br><span class="line">            CloseUtil.closeAll(dos);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            Server.list.remove(<span class="keyword">this</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//转发方法</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendOther</span><span class="params">()</span></span>&#123;</span><br><span class="line">      String str=<span class="keyword">this</span>.receive();</span><br><span class="line">      List&lt;MyChannel&gt; list=Server.list;</span><br><span class="line">      <span class="keyword">for</span> (MyChannel other : list) &#123;</span><br><span class="line">         <span class="keyword">if</span>(other==<span class="keyword">this</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;<span class="comment">//不发送给自己</span></span><br><span class="line">         &#125;</span><br><span class="line">         other.sendMessage(str);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span>(flag)&#123;</span><br><span class="line"><span class="comment">//       String message = receive();</span></span><br><span class="line"><span class="comment">//       if(message.equals(&quot;bye&quot;))&#123;</span></span><br><span class="line"><span class="comment">//          System.exit(1);</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"><span class="comment">//       this.sendMessage(message);</span></span><br><span class="line">         <span class="keyword">this</span>.sendOther();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.demo.socket.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ExecutorBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.security.auth.Subject;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建集合对象，存储每一个连接进来的客户端</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;MyChannel&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> port=<span class="number">4001</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//首先直接创建serversocket</span></span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(port);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用服务器的accept（）进行阻塞（程序会在这等待），当有申请连接时会打开阻塞并返回一个socket</span></span><br><span class="line">        System.out.println(<span class="string">&quot;服务器端已启动&quot;</span>);</span><br><span class="line">        <span class="comment">//线程数量要大于用户数，如果为1个线程，那么只能1个客户向其他客户发送消息，</span></span><br><span class="line">        <span class="comment">// 只有当这个客户进程关闭了，其他客户进程才能占用线程</span></span><br><span class="line">        ExecutorService executor = ExecutorBuilder.create()<span class="comment">//</span></span><br><span class="line">                .setCorePoolSize(<span class="number">1</span>)<span class="comment">//</span></span><br><span class="line">                .setMaxPoolSize(<span class="number">1</span>)<span class="comment">//</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            Socket socket = server.accept();</span><br><span class="line">            <span class="comment">//每当有一个socket进来，就会创建一个新的channel，就是一个新的客户端</span></span><br><span class="line">            MyChannel channel=<span class="keyword">new</span> MyChannel(socket);</span><br><span class="line">            <span class="comment">//添加到集合中</span></span><br><span class="line">            list.add(channel);</span><br><span class="line">            executor.submit(channel);</span><br><span class="line">            <span class="comment">//这块需要注释掉，因为不能关闭线程池，随时都可能有新的用户加入</span></span><br><span class="line">            <span class="comment">//executor.shutdown();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//CloseUtil.closeAll(dos,dis,server,socket);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="1-WebSocket介绍"><a href="#1-WebSocket介绍" class="headerlink" title="1.WebSocket介绍"></a>1.WebSocket介绍</h1><p><img src="/../img/image-20211228194155741.png" alt="image-20211228194155741"></p>
<h2 id="http协议："><a href="#http协议：" class="headerlink" title="http协议："></a>http协议：</h2><p><img src="/../img/image-20211228194221640.png" alt="image-20211228194221640"></p>
<h2 id="websocket："><a href="#websocket：" class="headerlink" title="websocket："></a>websocket：</h2><p><img src="/../img/image-20211228194447047.png" alt="image-20211228194447047"></p>
<h3 id="握手：两次连接即可"><a href="#握手：两次连接即可" class="headerlink" title="握手：两次连接即可"></a>握手：两次连接即可</h3><p>基于http协议，注意是基于，而不是http</p>
<p>客户端请求头</p>
<p><img src="/../img/image-20211228195548524.png" alt="image-20211228195548524"></p>
<p>ws是websocket的</p>
<p>而http的话就是http协议</p>
<p><img src="/../img/image-20211228195823658.png" alt="image-20211228195823658"></p>
<p>服务器响应头</p>
<p><img src="/../img/image-20211228195608891.png" alt="image-20211228195608891"></p>
<h3 id="数据交互：可以客户端主动发，可以服务器主动发"><a href="#数据交互：可以客户端主动发，可以服务器主动发" class="headerlink" title="数据交互：可以客户端主动发，可以服务器主动发"></a>数据交互：可以客户端主动发，可以服务器主动发</h3><h2 id="websocket对象创建以及事件"><a href="#websocket对象创建以及事件" class="headerlink" title="websocket对象创建以及事件"></a>websocket对象创建以及事件</h2><p><img src="/../img/image-20211228200352396.png" alt="image-20211228200352396"></p>
<h2 id="给服务端发送数据"><a href="#给服务端发送数据" class="headerlink" title="给服务端发送数据"></a>给服务端发送数据</h2><p><img src="/../img/image-20211228203502511.png" alt="image-20211228203502511"></p>
<h2 id="服务实现"><a href="#服务实现" class="headerlink" title="服务实现"></a>服务实现</h2><p><img src="/../img/image-20211228211852580.png" alt="image-20211228211852580"></p>
<p><img src="/../img/image-20211228212102159.png" alt="image-20211228212102159"></p>
<p><img src="/../img/image-20211228212704049.png" alt="image-20211228212704049"></p>
<p><img src="/../img/image-20211228212731840.png" alt="image-20211228212731840"></p>
<h1 id="2-需求"><a href="#2-需求" class="headerlink" title="2.需求"></a>2.需求</h1><p>一个浏览器看做一个客户端，服务器只有一个，浏览器1想给2发送消息，先发送给服务端，服务端解析，然后由服务端发送给2</p>
<p><img src="/../img/image-20211228213257906.png" alt="image-20211228213257906"></p>
<p><img src="/../img/image-20211228214415754.png" alt="image-20211228214415754"></p>
<h1 id="3-功能实现"><a href="#3-功能实现" class="headerlink" title="3.功能实现"></a>3.功能实现</h1><p>config</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.websocket.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.standard.ServerEndpointExporter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/01/25  14:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 注入一个ServerEndpointExporter,该Bean会自动注册使用</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@ServerEndpoint</span>注解声明的websocket endpoint</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ServerEndpointExporter <span class="title">serverEndpointExporter</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ServerEndpointExporter();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>写websocket的核心代码</p>
<p><img src="/../img/image-20220125152430261.png" alt="image-20220125152430261"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.websocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.PathParam;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/01/25  14:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:webSocket服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ServerEndpoint(value = &quot;/imserver/&#123;username&#125;&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录当前在线用户数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Session&gt; SESSION_MAP=<span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 连接成功调用的方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@OnOpen</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span></span>&#123;</span><br><span class="line">		SESSION_MAP.put(username,session);</span><br><span class="line">		log.info(<span class="string">&quot;有新用户加入，username=&#123;&#125;，当前在线人数:&#123;&#125;&quot;</span>,username,SESSION_MAP.size());</span><br><span class="line">		JSONObject result = <span class="keyword">new</span> JSONObject();</span><br><span class="line">		JSONArray array = <span class="keyword">new</span> JSONArray();</span><br><span class="line">		result.set(<span class="string">&quot;users&quot;</span>,array);</span><br><span class="line">		<span class="keyword">for</span>(Object key : SESSION_MAP.keySet())&#123;</span><br><span class="line">			JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">			<span class="comment">//把所有的用户名放入users这个数据json中</span></span><br><span class="line">			<span class="comment">//&#123;&quot;username&quot;:&quot;a&quot;,&quot;username&quot;:&quot;b&quot;&#125;</span></span><br><span class="line">			jsonObject.set(<span class="string">&quot;username&quot;</span>,key);</span><br><span class="line">			array.add(jsonObject);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//最终结果,注意多了中间的&#123;&#125;，是一个个的对象了</span></span><br><span class="line">		<span class="comment">//&#123;&quot;users&quot;:[&#123;&quot;username&quot;:&quot;a&quot;&#125;,&#123;&quot;username&quot;:&quot;b&quot;&#125;]&#125;</span></span><br><span class="line">		sendAllMessage(JSONUtil.toJsonStr(result));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 连接关闭调用的方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@OnClose</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span></span>&#123;</span><br><span class="line">		SESSION_MAP.remove(username);</span><br><span class="line">		log.info(<span class="string">&quot;有一连接关闭，移除username=&#123;&#125;，当前在线人数：&#123;&#125;&quot;</span>,username,SESSION_MAP.size());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 收到客户端消息调用的方法</span></span><br><span class="line"><span class="comment">	 * 后台收到消息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@OnMessage</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message,Session session, <span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span></span>&#123;</span><br><span class="line">		log.info(<span class="string">&quot;服务端收到用户username=&#123;&#125;的消息&#123;&#125;&quot;</span>,username,message);</span><br><span class="line">		JSONObject obj = JSONUtil.parseObj(message);</span><br><span class="line">		String toUsername= obj.getStr(<span class="string">&quot;to&quot;</span>);</span><br><span class="line">		String text=obj.getStr(<span class="string">&quot;text&quot;</span>);</span><br><span class="line">		Session toSession=SESSION_MAP.get(toUsername);</span><br><span class="line">		<span class="keyword">if</span>(toSession!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">			jsonObject.set(<span class="string">&quot;from&quot;</span>,username);</span><br><span class="line">			jsonObject.set(<span class="string">&quot;text&quot;</span>,text);</span><br><span class="line">			<span class="keyword">this</span>.sendAllMessage(jsonObject.toString(),toSession);</span><br><span class="line">			log.info(<span class="string">&quot;发送给用户username=&#123;&#125;，消息:&#123;&#125;&quot;</span>,toUsername,jsonObject.toString());</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			log.info(<span class="string">&quot;发送失败，未找到用户&#123;&#125;的session&quot;</span>,toUsername);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@OnError</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Session session,Throwable error)</span></span>&#123;</span><br><span class="line">		log.error(<span class="string">&quot;发送失败&quot;</span>);</span><br><span class="line">		error.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 服务端发送给客户端</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> toSession</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendAllMessage</span><span class="params">(String message,Session toSession)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			log.info(<span class="string">&quot;服务端发送给用户&#123;&#125;,消息为&#123;&#125;&quot;</span>,toSession.getId(),message);</span><br><span class="line">			<span class="comment">//发送到session</span></span><br><span class="line">			toSession.getBasicRemote().sendText(message);</span><br><span class="line">		&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">			log.error(<span class="string">&quot;服务端发送客户端失败&quot;</span>,e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 服务端群发给客户端</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendAllMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">for</span>(Session session:SESSION_MAP.values())&#123;</span><br><span class="line">				log.info(<span class="string">&quot;服务端发送给客户端[&#123;&#125;]，消息&#123;&#125;&quot;</span>,session.getId(),message);</span><br><span class="line">				session.getBasicRemote().sendText(message);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">			log.error(<span class="string">&quot;服务端发送客户端失败&quot;</span>,e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="4-前端"><a href="#4-前端" class="headerlink" title="4.前端"></a>4.前端</h1><p>vue里关键页面</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div style=&quot;padding: 10px; margin-bottom: 50px&quot;&gt;</span><br><span class="line">    &lt;el-row&gt;</span><br><span class="line">      &lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">        &lt;el-card style=&quot;width: 300px; height: 300px; color: #333&quot;&gt;</span><br><span class="line">         &lt;div style=&quot;padding-bottom: 10px; border-bottom: 1px solid #ccc&quot;&gt;在线用户&lt;span style=&quot;font-size: 12px&quot;&gt;（点击聊天气泡开始聊天）&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">          &lt;div style=&quot;padding: 10px 0&quot; v-for=&quot;user in users&quot; :key=&quot;user.username&quot;&gt;</span><br><span class="line">            &lt;span&gt;&#123;&#123; user.username &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;i class=&quot;el-icon-chat-dot-round&quot; style=&quot;margin-left: 10px; font-size: 16px; cursor: pointer&quot;</span><br><span class="line">               @click=&quot;chatUser = user.username&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;span style=&quot;font-size: 12px;color: limegreen; margin-left: 5px&quot; v-if=&quot;user.username === chatUser&quot;&gt;chatting...&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-col :span=&quot;20&quot;&gt;</span><br><span class="line">        &lt;div style=&quot;width: 800px; margin: 0 auto; background-color: white;</span><br><span class="line">                    border-radius: 5px; box-shadow: 0 0 10px #ccc&quot;&gt;</span><br><span class="line">          &lt;div style=&quot;text-align: center; line-height: 50px;&quot;&gt;</span><br><span class="line">            Web聊天室（&#123;&#123; chatUser &#125;&#125;）</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div style=&quot;height: 350px; overflow:auto; border-top: 1px solid #ccc&quot; v-html=&quot;content&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;div style=&quot;height: 200px&quot;&gt;</span><br><span class="line">            &lt;textarea v-model=&quot;text&quot; style=&quot;height: 160px; width: 760px; padding: 20px; border: none; border-top: 1px solid #ccc;</span><br><span class="line">             border-bottom: 1px solid #ccc; outline: none&quot;</span><br><span class="line">             @keyup.enter=&quot;send&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">            &lt;div style=&quot;text-align: right; padding-right: 10px; position:relative; top:-40px; &quot;&gt;</span><br><span class="line">              &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;send&quot;&gt;发送&lt;/el-button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let socket;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Im&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      circleUrl: &#x27;https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png&#x27;,</span><br><span class="line">      user: &#123;&#125;,</span><br><span class="line">      isCollapse: false,</span><br><span class="line">      users: [],</span><br><span class="line">      chatUser: &#x27;&#x27;,</span><br><span class="line">      text: &quot;&quot;,</span><br><span class="line">      messages: [],</span><br><span class="line">      content: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.init()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    send() &#123;</span><br><span class="line">      if (!this.chatUser) &#123;</span><br><span class="line">        this.$message(&#123;type: &#x27;warning&#x27;, message: &quot;请选择聊天对象&quot;&#125;)</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      if (!this.text) &#123;</span><br><span class="line">        this.$message(&#123;type: &#x27;warning&#x27;, message: &quot;请输入内容&quot;&#125;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        if (typeof (WebSocket) == &quot;undefined&quot;) &#123;</span><br><span class="line">          console.log(&quot;您的浏览器不支持WebSocket&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          console.log(&quot;您的浏览器支持WebSocket&quot;);</span><br><span class="line">          // 组装待发送的消息 json</span><br><span class="line">          // &#123;&quot;from&quot;: &quot;zhang&quot;, &quot;to&quot;: &quot;admin&quot;, &quot;text&quot;: &quot;聊天文本&quot;&#125;</span><br><span class="line">          </span><br><span class="line">          let message = &#123;from: this.user.username, to: this.chatUser, text: this.text&#125;</span><br><span class="line">          socket.send(JSON.stringify(message));  // 将组装好的json发送给服务端，由服务端进行转发</span><br><span class="line">          this.messages.push(&#123;user: this.user.username, text: this.text&#125;)</span><br><span class="line">          // 构建消息内容，本人消息</span><br><span class="line">          let msg=this.text</span><br><span class="line">          this.createContent(null, window.sessionStorage.getItem(&quot;user&quot;), msg)</span><br><span class="line">          this.text = &#x27;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    createContent(remoteUser, nowUser, text) &#123;  // 这个方法是用来将 json的聊天消息数据转换成 html的。</span><br><span class="line">      let html;</span><br><span class="line">      // 当前用户消息</span><br><span class="line">      if (nowUser) &#123; // nowUser 表示是否显示当前用户发送的聊天消息，绿色气泡</span><br><span class="line">        html = &quot;&lt;div class=\&quot;el-row\&quot; style=\&quot;padding: 5px 0\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;div class=\&quot;el-col el-col-22\&quot; style=\&quot;text-align: right; padding-right: 10px\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;    &lt;div class=\&quot;tip left\&quot;&gt;&quot; + text + &quot;&lt;/div&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;/div&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;div class=\&quot;el-col el-col-2\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;span class=\&quot;el-avatar el-avatar--circle\&quot; style=\&quot;height: 40px; width: 40px; line-height: 40px;\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;    &lt;img src=\&quot;https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\&quot; style=\&quot;object-fit: cover;width:40px; height:40px\&quot; &gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;/span&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;/div&gt;\n&quot; +</span><br><span class="line">            &quot;&lt;/div&gt;&quot;;</span><br><span class="line">      &#125; else if (remoteUser) &#123;   // remoteUser表示远程用户聊天消息，蓝色的气泡</span><br><span class="line">        html = &quot;&lt;div class=\&quot;el-row\&quot; style=\&quot;padding: 5px 0\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;div class=\&quot;el-col el-col-2\&quot; style=\&quot;text-align: right\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;span class=\&quot;el-avatar el-avatar--circle\&quot; style=\&quot;height: 40px; width: 40px; line-height: 40px;\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;    &lt;img src=\&quot;https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\&quot; style=\&quot;object-fit: cover;width:40px; height:40px\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;/span&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;/div&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;div class=\&quot;el-col el-col-22\&quot; style=\&quot;text-align: left; padding-left: 10px\&quot;&gt;\n&quot; +</span><br><span class="line">            &quot;    &lt;div class=\&quot;tip right\&quot;&gt;&quot; + text + &quot;&lt;/div&gt;\n&quot; +</span><br><span class="line">            &quot;  &lt;/div&gt;\n&quot; +</span><br><span class="line">            &quot;&lt;/div&gt;&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">      this.content += html;</span><br><span class="line">    &#125;,</span><br><span class="line">    init() &#123;</span><br><span class="line">      let username = sessionStorage.getItem(&quot;user&quot;);</span><br><span class="line">      console.info(username);</span><br><span class="line">      let _this = this;</span><br><span class="line">      if (typeof (WebSocket) == &quot;undefined&quot;) &#123;</span><br><span class="line">        console.log(&quot;您的浏览器不支持WebSocket&quot;);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        console.log(&quot;您的浏览器支持WebSocket&quot;);</span><br><span class="line">        let socketUrl = &quot;ws://10.50.12.8:8082/imserver/&quot; + username;</span><br><span class="line">        if (socket != null) &#123;</span><br><span class="line">          socket.close();</span><br><span class="line">          socket = null;</span><br><span class="line">        &#125;</span><br><span class="line">        // 开启一个websocket服务</span><br><span class="line">        socket = new WebSocket(socketUrl);</span><br><span class="line">        </span><br><span class="line">        //打开事件</span><br><span class="line">        socket.onopen = function () &#123;</span><br><span class="line">          console.log(&quot;websocket已打开&quot;);</span><br><span class="line">        &#125;;</span><br><span class="line">        //  浏览器端收消息，获得从服务端发送过来的文本消息</span><br><span class="line">        socket.onmessage = function (msg) &#123;</span><br><span class="line">          console.log(&quot;收到数据====&quot; + msg.data)</span><br><span class="line">          let data = JSON.parse(msg.data)  // 对收到的json数据进行解析， 类似这样的： &#123;&quot;users&quot;: [&#123;&quot;username&quot;: &quot;zhang&quot;&#125;,&#123; &quot;username&quot;: &quot;admin&quot;&#125;]&#125;</span><br><span class="line">          if (data.users) &#123;  // 获取在线人员信息</span><br><span class="line">            _this.users = data.users.filter(user =&gt; user.username !== username)  // 获取当前连接的所有用户信息，并且排除自身，自己不会出现在自己的聊天列表里</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            // 如果服务器端发送过来的json数据 不包含 users 这个key，那么发送过来的就是聊天文本json数据</span><br><span class="line">            //  // &#123;&quot;from&quot;: &quot;zhang&quot;, &quot;text&quot;: &quot;hello&quot;&#125;</span><br><span class="line">            if (data.from === _this.chatUser) &#123;</span><br><span class="line">              _this.messages.push(data)</span><br><span class="line">              // 构建消息内容</span><br><span class="line">              _this.createContent(data.from, null, data.text)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        //关闭事件</span><br><span class="line">        socket.onclose = function () &#123;</span><br><span class="line">          console.log(&quot;websocket已关闭&quot;);</span><br><span class="line">        &#125;;</span><br><span class="line">        //发生了错误事件</span><br><span class="line">        socket.onerror = function () &#123;</span><br><span class="line">          console.log(&quot;websocket发生了错误&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.tip &#123;</span><br><span class="line">  color: white;</span><br><span class="line">  text-align: center;</span><br><span class="line">  border-radius: 10px;</span><br><span class="line">  font-family: sans-serif;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  width:auto;</span><br><span class="line">  display:inline-block !important;</span><br><span class="line">  display:inline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.right &#123;</span><br><span class="line">  background-color: deepskyblue;</span><br><span class="line">&#125;</span><br><span class="line">.left &#123;</span><br><span class="line">  background-color: forestgreen;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Socket</category>
      </categories>
      <tags>
        <tag>Socket</tag>
      </tags>
  </entry>
  <entry>
    <title>springcloud-alibaba</title>
    <url>/2021/11/30/spring-cloud-alibaba/</url>
    <content><![CDATA[<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211022105939305.png" alt="image-20211022105939305"></p>
<p><a href="https://blog.csdn.net/zhongzk69/article/details/105095834/">https://blog.csdn.net/zhongzk69/article/details/105095834/</a></p>
<h1 id="springcloud-alibaba"><a href="#springcloud-alibaba" class="headerlink" title="springcloud-alibaba"></a>springcloud-alibaba</h1><p>在公共依赖common里引入依赖</p>
<p>注意版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>



<p>中文文档</p>
<p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p>
<p><a href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025191043897.png" alt="image-20211025191043897"></p>
<h1 id="1-nacos注册中心"><a href="#1-nacos注册中心" class="headerlink" title="1.nacos注册中心"></a>1.nacos注册中心</h1><h2 id="1-pom"><a href="#1-pom" class="headerlink" title="1.pom"></a>1.pom</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h2><p>在应用的 /src/main/resources/application.properties 配置文件中配置 Nacos Server 地址，以及spring名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848</span><br></pre></td></tr></table></figure>

<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025195219412.png" alt="image-20211025195219412"></p>
<h2 id="3-下载nacos-server"><a href="#3-下载nacos-server" class="headerlink" title="3.下载nacos server"></a>3.下载nacos server</h2><p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025193113285.png" alt="image-20211025193113285"></p>
<h3 id="windos下zip"><a href="#windos下zip" class="headerlink" title="windos下zip"></a>windos下zip</h3><p>下载解压，bin双击startup.cmd</p>
<p>如果报错</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025195934257.png" alt="image-20211025195934257"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025195550728.png" alt="image-20211025195550728"></p>
<h3 id="Linux下tar-gz"><a href="#Linux下tar-gz" class="headerlink" title="Linux下tar.gz"></a>Linux下tar.gz</h3><h2 id="4-使用-EnableDiscoveryClient"><a href="#4-使用-EnableDiscoveryClient" class="headerlink" title="4.使用 @EnableDiscoveryClient"></a>4.使用 @EnableDiscoveryClient</h2><p>注解开启服务注册与发现功能</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">public class ProviderApplication &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(ProviderApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-访问http-localhost-8848-nacos"><a href="#5-访问http-localhost-8848-nacos" class="headerlink" title="5.访问http://localhost:8848/nacos"></a>5.访问<a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a></h2><p>账号密码</p>
<p>nacos/nacos</p>
<h1 id="2-openFegin远程调用"><a href="#2-openFegin远程调用" class="headerlink" title="2.openFegin远程调用"></a>2.openFegin远程调用</h1><h2 id="1-pom-1"><a href="#1-pom-1" class="headerlink" title="1.pom"></a>1.pom</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-远程调用步骤"><a href="#2-远程调用步骤" class="headerlink" title="2.远程调用步骤"></a>2.远程调用步骤</h2><p>编写一个接口，告诉springcloud这个接口需要调用远程服务，把这种接口都放在fegin包下</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025201021518.png" alt="image-20211025201021518"></p>
<p>member想要远程调用coupon服务</p>
<p>coupon在controller里有这样一个方法</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025201053269.png" alt="image-20211025201053269"></p>
<p>而member想要调用，首先在fegin包下创建service</p>
<p>加上@FeignClient()注解</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025201515603.png" alt="image-20211025201515603"></p>
<p>方法mapping要是coupon在controller里全路径，返回值和方法名不变，</p>
<p>注释是interface</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025201411302.png" alt="image-20211025201411302"></p>
<h2 id="3-开启远程调用功能"><a href="#3-开启远程调用功能" class="headerlink" title="3.开启远程调用功能"></a>3.开启远程调用功能</h2><p>在member</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025201816108.png" alt="image-20211025201621844"></p>
<h2 id="4-错误"><a href="#4-错误" class="headerlink" title="4.错误"></a>4.错误</h2><h3 id="No-Feign-Client-for-loadBalancing-defined-错误"><a href="#No-Feign-Client-for-loadBalancing-defined-错误" class="headerlink" title="No Feign Client for loadBalancing defined.错误"></a>No Feign Client for loadBalancing defined.错误</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">解决方法：</span><br><span class="line">加入spring-cloud-loadbalancer依赖 并且在nacos中排除ribbon依赖，不然loadbalancer无效</span><br><span class="line"></span><br><span class="line">排除ribbon依赖</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;com.netflix.ribbon&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;ribbon&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">添加依赖</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-loadbalancer&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为版本，可以</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">项目springboot 2.1.8.RELEASE</span><br><span class="line"></span><br><span class="line">springcloud  2.1.0.RELEASE</span><br></pre></td></tr></table></figure>

<h1 id="3-nacos配置中心"><a href="#3-nacos配置中心" class="headerlink" title="3.nacos配置中心"></a>3.nacos配置中心</h1><h2 id="1-pom-2"><a href="#1-pom-2" class="headerlink" title="1.pom"></a>1.pom</h2><p>首先，修改 pom.xml 文件，引入 Nacos Config Starter。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-bootstrap-yml"><a href="#2-bootstrap-yml" class="headerlink" title="2.bootstrap.yml"></a>2.bootstrap.yml</h2><p>优先于application.yml加载</p>
<p>在应用的 /src/main/resources/bootstrap.properties 配置文件中配置 Nacos Config 元数据</p>
<p><strong>需要配置spring.application.name=服务名，所以当有cloud的config配置时， spring.application.name配置在bootstrap中</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.application.name=服务名</span><br><span class="line">spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span><br></pre></td></tr></table></figure>

<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211025205034397.png" alt="image-20211025205034397"></p>
<p>现在自定义了两个属性</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026084030493.png" alt="image-20211026084030493"></p>
<p>controller里获取</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026084153941.png" alt="image-20211026084153941"></p>
<p>如果想更改值，只能修改yml，然后重新打包部署</p>
<h3 id="but有了nacos！"><a href="#but有了nacos！" class="headerlink" title="but有了nacos！"></a>but有了nacos！</h3><p>可以修改配置中心动态修改，添加dataid，默认为应用名.properties</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026084437847.png" alt="image-20211026084437847"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026084535844.png" alt="image-20211026084535844"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026085753939.png" alt="image-20211026085753939"></p>
<p>在属性的类上添加注解@RefreshScope</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026090142252.png" alt="image-20211026090142252"></p>
<p>原来是zhangsan18</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026085900976.png" alt="image-20211026085900976"></p>
<p>现在修改一下</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026085933419.png" alt="image-20211026085933419"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026090001730.png" alt="image-20211026090001730"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026090322799.png" alt="image-20211026090322799"></p>
<h3 id="修改properties为yml"><a href="#修改properties为yml" class="headerlink" title="修改properties为yml"></a>修改properties为yml</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      config:</span><br><span class="line">        file-extension: yml  #指定配置文件为服务名.yml格式</span><br></pre></td></tr></table></figure>

<h2 id="3-细节都在bootstrap-yml里配置"><a href="#3-细节都在bootstrap-yml里配置" class="headerlink" title="3.细节都在bootstrap.yml里配置"></a>3.细节都在bootstrap.yml里配置</h2><h3 id="1-命名空间"><a href="#1-命名空间" class="headerlink" title="1.命名空间"></a>1.命名空间</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">默认空间public，默认新增的所有配置都在public空间</span><br><span class="line">开发，测试，生产，不同环境需要不同配置，就可以创建多个空间</span><br></pre></td></tr></table></figure>

<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026090946436.png" alt="image-20211026090946436"></p>
<p>现在在public和prop里都创建dataid为gulimall.properties</p>
<p>name：zhangsan</p>
<p>public   age：22    prop  age：24</p>
<p>发现最终获取为22，说明默认使用public空间</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026091233561.png" alt="image-20211026091233561"></p>
<p>想要使用其他命名空间</p>
<p>spring.cloud.nacos.config.namespace</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026091518002.png" alt="image-20211026091518002"></p>
<p>值为prop下的类似uuid的字符串</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026091559011.png" alt="image-20211026091559011"></p>
<p>每一个微服务之前互相隔离，都创建自己的命名空间，只加载自己的命名空间</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026091943440.png" alt="image-20211026091943440"></p>
<p>可以克隆配置到别的命名空间</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026092052521.png" alt="image-20211026092052521"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026092113919.png" alt="image-20211026092113919"></p>
<h3 id="2-配置集"><a href="#2-配置集" class="headerlink" title="2.配置集"></a>2.配置集</h3><p>所有的配置集合</p>
<h3 id="3-配置集id"><a href="#3-配置集id" class="headerlink" title="3.配置集id"></a>3.配置集id</h3><p>Data ID：默认服务名.properties</p>
<h3 id="4-配置分组"><a href="#4-配置分组" class="headerlink" title="4.配置分组"></a>4.配置分组</h3><p>默认所有配置集都属于DEFULT_GROUP：</p>
<p>使用别的组</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026092640401.png" alt="image-20211026092640401"></p>
<p>每个微服务创建自己的命名空间，使用配置分组区别环境，dev，test，prod</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026093234345.png" alt="image-20211026093234345"></p>
<p>想切换环境，更改bootstrap.yml里的group属性即可</p>
<h2 id="4-同时加载多个配置集"><a href="#4-同时加载多个配置集" class="headerlink" title="4.同时加载多个配置集"></a>4.同时加载多个配置集</h2><p>现在application.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">ROOT</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.56.10:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span></span><br></pre></td></tr></table></figure>

<p>拆分成三个</p>
<p>datasource.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">ROOT</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.56.10:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br></pre></td></tr></table></figure>

<p>mybatis.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br></pre></td></tr></table></figure>

<p>other.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span></span><br></pre></td></tr></table></figure>

<p>bootstrap不变</p>
<p>再次注意</p>
<p>application里的是服务注册与发现</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br></pre></td></tr></table></figure>

<p>bootstrap里的是配置中心</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      config:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br><span class="line">        namespace: 5c2579c3-b6ad-406c-81b7-dbef6ee5142c</span><br><span class="line">        group:</span><br><span class="line">  application:</span><br><span class="line">    name: gulimall-coupon</span><br></pre></td></tr></table></figure>

<p>回归</p>
<p>现在拆分了三个到配置中心</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026094345791.png" alt="image-20211026094345791"></p>
<p>修改bootstrap.yml</p>
<p>添加数据集，refresh自动刷新true</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026094619239.png" alt="image-20211026094619239"></p>
<h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><p>以前springboot从配置文件获取使用</p>
<p>@value @configurationproperties</p>
<p>现在都可以配置到配置中心，在bootstrap中指定id，group即可</p>
<h1 id="4-gateway网关"><a href="#4-gateway网关" class="headerlink" title="4.gateway网关"></a>4.gateway网关</h1><p><a href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a></p>
<p>请求到网关，网关先断言，是否符合某个路由规则，经过一系列的filter进行过滤，最终到达目标服务器，并且<strong>最终到达的地址一定是要可以访问的</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="1-开启服务注册发现并排除数据源自动配置"><a href="#1-开启服务注册发现并排除数据源自动配置" class="headerlink" title="1.开启服务注册发现并排除数据源自动配置"></a>1.开启服务注册发现并排除数据源自动配置</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.jiang.gulimall.gateway;</span><br><span class="line"></span><br><span class="line">        import org.springframework.boot.SpringApplication;</span><br><span class="line">        import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">        import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line">        import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span><br><span class="line">public class GulimallGatewayApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(GulimallGatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-添加配置"><a href="#2-添加配置" class="headerlink" title="2.添加配置"></a>2.添加配置</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br><span class="line">        locator:</span><br><span class="line">          enabled: true  # 让gateway可以发现nacos中的微服务</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">        - id: baidu_rout</span><br><span class="line">          uri: https://www.baidu.com</span><br><span class="line">          predicates:</span><br><span class="line">            - Query=url,baidu</span><br><span class="line">        - id: qq_route</span><br><span class="line">          uri: https://www.qq.com</span><br><span class="line">          predicates:</span><br><span class="line">            - Query=url,qq</span><br><span class="line">            #也可以写成path，只要以/brand开头都会跳转到这里</span><br><span class="line">            - Path=/brand**</span><br><span class="line">          filters:</span><br><span class="line">  			 - StripPrefix=2 </span><br><span class="line">server:</span><br><span class="line">  port: 88</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>断言</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Query=url  表示请求中待url参数即可，才会转到url</span><br><span class="line">Query=url,qq   请求中待url参数并必须等于qq才会转到url</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">配置转发路径：Path= /anji-open/user/**，但是controller中并没有以/anji-open/user/**开头，这样能找到具体接口吗，是可以的，原理是通过这个配置实现：</span><br><span class="line">filters:</span><br><span class="line">   - StripPrefix=2，</span><br><span class="line">转发到具体服务，自动去掉/anji-open/user，如下</span><br><span class="line">原始访问路径:</span><br><span class="line">http://www.aa.com/anji-open/user/jobuser/pageList?sort=id&amp;order=DESC&amp;pageNumber=1&amp;pageSize=10</span><br><span class="line"> </span><br><span class="line">处理后路径：</span><br><span class="line">http://www.aa.com/jobuser/pageList?sort=id&amp;order=DESC&amp;pageNumber=1&amp;pageSize=10</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>#webconfig<br>        - id: FRAMEWORK-WEBCONFIG-SERVER<br>          uri: lb://FRAMEWORK-WEBCONFIG-SERVER<br>          predicates:<br>            - Path=/api/webconfig/**<br>          filters:<br>            - StripPrefix=2</p>
<pre><code>    #flow
    - id: FRAMEWORK-FLOW-MICROSERVICE
      uri: lb://FRAMEWORK-FLOW-MICROSERVICE
      predicates:
        - Path=/api/flow/**
      filters: 
        - StripPrefix=2

    #component
    - id: FRAMEWORK-COMPONENT-MICROSERVICE
      uri: lb://FRAMEWORK-COMPONENT-MICROSERVICE
      predicates:
        - Path=/api/component/**
      filters: 
        - StripPrefix=2

    #test
    - id: SERVER-CONSUMER
      uri: lb://SERVER-CONSUMER
      predicates:
        - Path=/cusumer/**
      filters: 
        - StripPrefix=1

如果请求路径是/cusumer开头，就会找uri里SERVER-CONSUMER服务路径，并且- StripPrefix=1，去掉一层，也就是去掉/cusumer这一层
比如，SERVER-CONSUMER的路径是1.1.1.1:3001,当请求/cusumer/a/b,路径不是1.1.1.1:3001/cusumer/a/b
而是1.1.1.1:3001/a/b
</code></pre>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>访问<a href="http://localhost:88/hello?url=qq">http://localhost:88/hello?url=qq</a></p>
<p>参数中待url并且等于qq，就会转到<a href="https://www.qq.com/hello%EF%BC%8C%E6%B3%A8%E6%84%8F%E4%BC%9A%E8%87%AA%E5%8A%A8%E6%8B%BC%E6%8E%A5%E4%B8%8Alocalhost:88/%E5%90%8E%E9%9D%A2%E7%9A%84%E8%B7%AF%E5%BE%84">https://www.qq.com/hello，注意会自动拼接上localhost:88/后面的路径</a></p>
<p>访问<a href="http://localhost:88/?url=baidu">http://localhost:88/?url=baidu</a></p>
<p>就不会待hello路径</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026111146862.png" alt="image-20211026111146862"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026203254610.png" alt="image-20211026203254610"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- Path=/foo/&#123;segment&#125;,/bar/&#123;segment&#125;</span><br><span class="line">路径是/foo/1 or /foo/bar/ or /bar/22都会转到uri中</span><br></pre></td></tr></table></figure>

<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026203427498.png" alt="image-20211026203427498"></p>
<p>lb负载均衡策略</p>
<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- id: qq1_route</span><br><span class="line">  uri: https://www.baidu.com</span><br><span class="line">  predicates:</span><br><span class="line">    - Path=/more</span><br></pre></td></tr></table></figure>

<p>访问localhost:88/more会转到<a href="http://www.baidu.com/more">www.baidu.com/more</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- id: qq2_route</span><br><span class="line">  uri: https://blog.csdn.net</span><br><span class="line">  predicates:</span><br><span class="line">    - Path=/jiang458572759/&#123;segment&#125;</span><br></pre></td></tr></table></figure>

<p>访问localhost:88/jiang458572759/article</p>
<p>转到<a href="https://blog.csdn.net/jiang458572759/article">https://blog.csdn.net/jiang458572759/article</a></p>
<p>注意只能在jiang458572759/后添加一个/，不能有多级目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- id: qq2_route</span><br><span class="line">  uri: https://blog.csdn.net</span><br><span class="line">  predicates:</span><br><span class="line">    - Path=/jiang458572759/**</span><br></pre></td></tr></table></figure>

<p>这样就可以有多级目录了</p>
<p>例子：访问<a href="http://localhost:88/jiang458572759/article/details/115283615?spm=1001.2014.3001.5502">http://localhost:88/jiang458572759/article/details/115283615?spm=1001.2014.3001.5502</a></p>
<p>转到<a href="https://blog.csdn.net/jiang458572759/article/details/115283615?spm=1001.2014.3001.5502">https://blog.csdn.net/jiang458572759/article/details/115283615?spm=1001.2014.3001.5502</a></p>
<h2 id="3-前端项目发送axios"><a href="#3-前端项目发送axios" class="headerlink" title="3.前端项目发送axios"></a>3.前端项目发送axios</h2><p>向网关发送的都带上api</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026204659897.png" alt="image-20211026204659897"></p>
<p>后端，lb负载均衡到renren-fast</p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211026204730089.png" alt="image-20211026204730089"></p>
<h2 id="4-路径重写"><a href="#4-路径重写" class="headerlink" title="4.路径重写"></a>4.路径重写</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id: qq2_route</span><br><span class="line"> uri: https://blog.csdn.net</span><br><span class="line"> predicates:</span><br><span class="line">   - Path=/jiang458572759/**</span><br><span class="line"> filters:</span><br><span class="line">   - RewritePath=/jiang458572759/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span><br></pre></td></tr></table></figure>

<p>当访问<a href="http://localhost:88/jiang458572759/hh%E6%97%B6">http://localhost:88/jiang458572759/hh时</a></p>
<p>会转到<a href="https://blog.csdn.net/hh,%E8%87%AA%E5%8A%A8%E5%8E%BB%E6%8E%89/jiang458572759">https://blog.csdn.net/hh,自动去掉/jiang458572759</a></p>
<h2 id="5-在网关里统一配置跨域问题"><a href="#5-在网关里统一配置跨域问题" class="headerlink" title="5.在网关里统一配置跨域问题"></a>5.在网关里统一配置跨域问题</h2><p>创建config文件夹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class GulimallCorsConfiguration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">    public CorsWebFilter corsWebFilter()&#123;</span><br><span class="line">        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();</span><br><span class="line">        CorsConfiguration config=new CorsConfiguration();</span><br><span class="line">        //配置跨域</span><br><span class="line">        //允许所有域名进行跨域调用</span><br><span class="line">        config.addAllowedOrigin(&quot;*&quot;);</span><br><span class="line">        //允许跨越发送cookie</span><br><span class="line">        config.setAllowCredentials(true);</span><br><span class="line">        //放行全部原始头信息</span><br><span class="line">        config.addAllowedHeader(&quot;*&quot;);</span><br><span class="line">        //允许所有请求方法跨域调用</span><br><span class="line">        config.addAllowedMethod(&quot;*&quot;);</span><br><span class="line">        source.registerCorsConfiguration(&quot;/**&quot;,config);</span><br><span class="line">        return new CorsWebFilter(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-精确的网关应该放在模糊的网关上面"><a href="#6-精确的网关应该放在模糊的网关上面" class="headerlink" title="6.精确的网关应该放在模糊的网关上面"></a>6.精确的网关应该放在模糊的网关上面</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- id: admin_route</span><br><span class="line">  uri: lb://gulimall-product</span><br><span class="line">  predicates:</span><br><span class="line">    - Path=/api/product/**</span><br><span class="line">  filters:</span><br><span class="line">    - RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span><br><span class="line"></span><br><span class="line">- id: admin_route</span><br><span class="line">  uri: lb://renren-fast</span><br><span class="line">  predicates:</span><br><span class="line">    - Path=/api/**</span><br><span class="line">  filters:</span><br><span class="line">    - RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\&#123;segment&#125;</span><br></pre></td></tr></table></figure>





<h1 id="5-springcloud-alibaba-oss"><a href="#5-springcloud-alibaba-oss" class="headerlink" title="5.springcloud-alibaba-oss"></a>5.springcloud-alibaba-oss</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alicloud-oss&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">    alicloud:</span><br><span class="line">      access-key: LTAI5t6Tc8civonnHH6QpHQh</span><br><span class="line">      secret-key: 3iIUKRaiwYyx51p0BfmvBCBMpJDb1y</span><br><span class="line">      oss:</span><br><span class="line">        endpoint: oss-cn-beijing.aliyuncs.com</span><br></pre></td></tr></table></figure>

<h2 id="测试简单上传"><a href="#测试简单上传" class="headerlink" title="测试简单上传"></a>测试简单上传</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class GulimallThirdPartyApplicationTests &#123;</span><br><span class="line">    public GulimallThirdPartyApplicationTests()&#123;&#125;</span><br><span class="line">    @Autowired</span><br><span class="line">    OSSClient ossClient;</span><br><span class="line">    @Test</span><br><span class="line">    public void contextLoads() throws FileNotFoundException &#123;</span><br><span class="line">        InputStream inputStream = new FileInputStream(&quot;D:/a.jpg&quot;);</span><br><span class="line">        SimpleDateFormat sdf=new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">        String date = sdf.format(new Date());</span><br><span class="line">        // 依次填写Bucket名称（例如examplebucket）和Object完整路径（例如exampledir/exampleobject.txt）。Object完整路径中不能包含Bucket名称。</span><br><span class="line">        ossClient.putObject(&quot;jiang-oss&quot;, date+&quot;/a.jpg&quot;, inputStream);</span><br><span class="line"></span><br><span class="line">        // 关闭OSSClient。</span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        System.out.println(&quot;上传成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="整合controller"><a href="#整合controller" class="headerlink" title="整合controller"></a>整合controller</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    alicloud:</span><br><span class="line">      access-key: LTAI5t6Tc8civonnHH6QpHQh</span><br><span class="line">      secret-key: 3iIUKRaiwYyx51p0BfmvBCBMpJDb1y</span><br><span class="line">      oss:</span><br><span class="line">        endpoint: oss-cn-beijing.aliyuncs.com</span><br><span class="line">        bucket: jiang-oss</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.jiang.gulimall.thirdparty.controller;</span><br><span class="line"></span><br><span class="line">import com.aliyun.oss.OSS;</span><br><span class="line">import com.aliyun.oss.OSSClient;</span><br><span class="line">import com.aliyun.oss.OSSClientBuilder;</span><br><span class="line">import com.aliyun.oss.common.utils.BinaryUtil;</span><br><span class="line">import com.aliyun.oss.model.MatchMode;</span><br><span class="line">import com.aliyun.oss.model.PolicyConditions;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author:jiangjiaxu</span><br><span class="line"> * @date 2021/10/28  20:09</span><br><span class="line"> * @version:V1.0</span><br><span class="line"> * @description:</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">public class OssController &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;spring.cloud.alicloud.oss.endpoint&#125;&quot;)</span><br><span class="line">    private String endpoint;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;spring.cloud.alicloud.oss.bucket&#125;&quot;)</span><br><span class="line">    private String bucket;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;spring.cloud.alicloud.access-key&#125;&quot;)</span><br><span class="line">    private String accessId;</span><br><span class="line"></span><br><span class="line">    //@Autowired</span><br><span class="line">    //OSSClient ossClient;</span><br><span class="line">    @Autowired</span><br><span class="line">    OSS ossClient;</span><br><span class="line">    @RequestMapping(&quot;/oss/policy&quot;)</span><br><span class="line">    public Map&lt;String, String&gt; policy()&#123;</span><br><span class="line">        String host = &quot;https://&quot; + bucket + &quot;.&quot; + endpoint; // host的格式为 bucketname.endpoint</span><br><span class="line">        SimpleDateFormat sdf=new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">        String date = sdf.format(new Date());</span><br><span class="line">        //上传服务器回调的URL</span><br><span class="line">        //String callbackUrl=&quot;http://&quot;;</span><br><span class="line">        String dir = date+&quot;/&quot;; // 用户上传文件时指定的前缀。</span><br><span class="line">        Map&lt;String, String&gt; respMap =null;</span><br><span class="line">        // 创建OSSClient实例。</span><br><span class="line">        try &#123;</span><br><span class="line">            long expireTime = 30;</span><br><span class="line">            long expireEndTime = System.currentTimeMillis() + expireTime * 1000;</span><br><span class="line">            Date expiration = new Date(expireEndTime);</span><br><span class="line">            // PostObject请求最大可支持的文件大小为5 GB，即CONTENT_LENGTH_RANGE为5*1024*1024*1024。</span><br><span class="line">            PolicyConditions policyConds = new PolicyConditions();</span><br><span class="line">            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, 0, 1048576000);</span><br><span class="line">            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);</span><br><span class="line"></span><br><span class="line">            String postPolicy = ossClient.generatePostPolicy(expiration, policyConds);</span><br><span class="line">            byte[] binaryData = postPolicy.getBytes(&quot;utf-8&quot;);</span><br><span class="line">            String encodedPolicy = BinaryUtil.toBase64String(binaryData);</span><br><span class="line">            String postSignature = ossClient.calculatePostSignature(postPolicy);</span><br><span class="line"></span><br><span class="line">             respMap = new LinkedHashMap&lt;String, String&gt;();</span><br><span class="line">            respMap.put(&quot;accessid&quot;, accessId);</span><br><span class="line">            respMap.put(&quot;policy&quot;, encodedPolicy);</span><br><span class="line">            respMap.put(&quot;signature&quot;, postSignature);</span><br><span class="line">            respMap.put(&quot;dir&quot;, dir);</span><br><span class="line">            respMap.put(&quot;host&quot;, host);</span><br><span class="line">            respMap.put(&quot;expire&quot;, String.valueOf(expireEndTime / 1000));</span><br><span class="line">            // respMap.put(&quot;expire&quot;, formatISO8601Date(expiration));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            // Assert.fail(e.getMessage());</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">        return respMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211028202853057.png" alt="image-20211028202853057"></p>
<p><img src="/C:/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211028203706082.png" alt="image-20211028203706082"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>springcloud-alibaba</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络</title>
    <url>/2021/11/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
    <content><![CDATA[<p>我小姜一定要弄懂计算机网络！！！！！我认为是重点，工作能用的前面加个<em>，大标题全部都要看的加个</em>*</p>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">网络由结点和链路组成</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211202094000046.png" alt="image-20211202094000046"></p>
<h1 id="私有网络（内网）"><a href="#私有网络（内网）" class="headerlink" title="私有网络（内网）"></a>私有网络（内网）</h1><p><img src="/../img/image-20211225214601067.png" alt="image-20211225214601067"></p>
<h1 id="因特网"><a href="#因特网" class="headerlink" title="因特网"></a>因特网</h1><p><img src="/../img/image-20211202094035178.png" alt="image-20211202094035178"></p>
<p>直接连接因特网的成为主机</p>
<h1 id="以太网"><a href="#以太网" class="headerlink" title="以太网"></a>以太网</h1><p>以太网是应用最广泛的局域网技术。电脑上的以太网接口，Wi-Fi接口，以太网交换机、路由器上的千兆，万兆以太网口，还有网线，它们都是以太网的组成部分，以太网可以用在局域网、广域网、也可以用在互联网上，现在网络有以太网化的趋势，因为简单易用，所以很普及。</p>
<h1 id="路由器"><a href="#路由器" class="headerlink" title="*路由器"></a>*路由器</h1><p>1.连接两个网络</p>
<p>2.找出最快通信路径</p>
<p>通过分配给自己的IP地址和子网掩码，相与可以得出该路由器其中一个接口的网络地址</p>
<p>注意路由器的路由表目的网络都是网络地址，不是IP地址</p>
<p>聚合路由</p>
<p><img src="/../img/image-20211225153234290.png" alt="image-20211225153234290"></p>
<h1 id="路由器与交换机的区别"><a href="#路由器与交换机的区别" class="headerlink" title="*路由器与交换机的区别"></a>*路由器与交换机的区别</h1><p><img src="/../img/image-20211224230517419.png" alt="image-20211224230517419"></p>
<p>路由器在网络层使用，而交换机是链路层</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMDIxMTY1ODQ3NTk5?x-oss-process=image/format,png" alt="这里写图片描述"></p>
<p>通过拓扑图我们应该知道：<br><strong>每一个路由器与其之下连接的设备，其实构成一个局域网</strong><br>交换机工作在路由器之下，就是也就是<strong>交换机工作在局域网内</strong><br>交换机用于<strong>局域网内网的数据转发</strong><br>路由器用于<strong>连接局域网和外网</strong></p>
<h2 id="路由器网络层用于转发IP，在数据链路层通过交换机转发，一个路由器有多个MAC地址，交换机最终找到转发的MAC地址给路由器，路由器通过MAC地址找到IP（高速缓存表），通过IP地址找到对应的主机"><a href="#路由器网络层用于转发IP，在数据链路层通过交换机转发，一个路由器有多个MAC地址，交换机最终找到转发的MAC地址给路由器，路由器通过MAC地址找到IP（高速缓存表），通过IP地址找到对应的主机" class="headerlink" title="路由器网络层用于转发IP，在数据链路层通过交换机转发，一个路由器有多个MAC地址，交换机最终找到转发的MAC地址给路由器，路由器通过MAC地址找到IP（高速缓存表），通过IP地址找到对应的主机"></a>路由器网络层用于转发IP，在数据链路层通过交换机转发，一个路由器有多个MAC地址，交换机最终找到转发的MAC地址给路由器，路由器通过MAC地址找到IP（高速缓存表），通过IP地址找到对应的主机</h2><h1 id="用户是如何接入到因特网的？"><a href="#用户是如何接入到因特网的？" class="headerlink" title="*用户是如何接入到因特网的？"></a>*用户是如何接入到因特网的？</h1><p>用户通过ISP（下图解释），ISP可以申请到成块的IP地址，用户得到ip地址</p>
<p>我国的ISP，电信，联通，移动</p>
<p><img src="/../img/image-20211202094631636.png" alt="image-20211202094631636"></p>
<h1 id="三种交换方式"><a href="#三种交换方式" class="headerlink" title="*三种交换方式"></a>*三种交换方式</h1><h2 id="电路交换"><a href="#电路交换" class="headerlink" title="电路交换"></a>电路交换</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">两个电话需要一根链路，多个电话需要更多的链路</span><br><span class="line">使用交换机如第3个图所示</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211202095517204.png" alt="image-20211202095517204"></p>
<h3 id="电路交换的三个步骤"><a href="#电路交换的三个步骤" class="headerlink" title="电路交换的三个步骤"></a>电路交换的三个步骤</h3><p><img src="/../img/image-20211202095849231.png" alt="image-20211202095849231"></p>
<h2 id="分组交换（重点）"><a href="#分组交换（重点）" class="headerlink" title="*分组交换（重点）"></a>*分组交换（重点）</h2><p><strong>分组交换机就是路由器</strong>，负责连接各个网络，接收到分组转发</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1现在H6用户想发送信息到H2，把该消息成为报文</span><br><span class="line">2发送报文之前，把报文划分成一个个更小的等长数据段</span><br><span class="line">3在每一个数据段前，加上必要的控制信息组成的首部，就构成了一个分组（注意是一个分组），也叫“包”</span><br><span class="line">4那么添加首部的作用是什么？</span><br><span class="line">	包含了分组的目的地址，否则分组交换机（路由器）不知道怎么转发分组了</span><br><span class="line">5分组交换机接收到一个分组后，暂时储存起来，检查首部，按照首部的目的地址进行查表转发，找到合适的转发接口，通过该接口转发给下一个分组交换机</span><br><span class="line">6注意，每个等长数据段走的分组交换机的链路可能是不同的，但是最终都会走到目的地址H2，并去掉每段的首部，组合还原成原始报文</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211202101949086.png" alt="image-20211202101949086"></p>
<p><img src="/../img/image-20211202102011364.png" alt="image-20211202102011364"></p>
<h2 id="报文交换"><a href="#报文交换" class="headerlink" title="报文交换"></a>报文交换</h2><p>基本不用了</p>
<h1 id="计算机网络定义"><a href="#计算机网络定义" class="headerlink" title="计算机网络定义"></a>计算机网络定义</h1><p><img src="/../img/image-20211202102504119.png" alt="image-20211202102504119"></p>
<p>下图是不是一个计算机网络？</p>
<p>不是，因为只有显示和输入设备，只是一个大型机系统</p>
<p><img src="/../img/image-20211202102348560.png" alt="image-20211202102348560"></p>
<h1 id="网络分类"><a href="#网络分类" class="headerlink" title="*网络分类"></a>*网络分类</h1><p><img src="/../img/image-20211202102759243.png" alt="image-20211202102759243"></p>
<p>公用网：所有愿意按电信公司（电信，联通，移动）规定交纳费用的人都可以使用这个网络</p>
<p>专用网：某个部门为本单位建造的网络（内网）</p>
<p>广域网：覆盖国家，地区</p>
<p>城域网：覆盖城市，互联企业，机构，校园局域网</p>
<p>局域网：一个校园或者企业，拥有多数互联的局域网（内网）</p>
<p>个域网：无线鼠标，耳机，热点</p>
<h1 id="性能指标"><a href="#性能指标" class="headerlink" title="*性能指标"></a>*性能指标</h1><h2 id="比特"><a href="#比特" class="headerlink" title="*比特"></a>*比特</h2><p><img src="/../img/image-20211202104209140.png" alt="image-20211202104209140"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1字节=8比特</span><br><span class="line">1KB=2的10次方字节</span><br><span class="line">MB=2的20次方字节</span><br><span class="line">GB=2的30次方字节</span><br><span class="line">TB=2的40次方字节</span><br></pre></td></tr></table></figure>

<h4 id="为什么买的盘显示容量和实际容量不一致？"><a href="#为什么买的盘显示容量和实际容量不一致？" class="headerlink" title="为什么买的盘显示容量和实际容量不一致？"></a>为什么买的盘显示容量和实际容量不一致？</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">固态硬盘：厂家保留了一部分空间不让用户使用</span><br><span class="line"></span><br><span class="line">机械硬盘：单位不一致，厂家单位G为10的9次方，操作系统G为2的30次方</span><br></pre></td></tr></table></figure>

<h2 id="度量性能"><a href="#度量性能" class="headerlink" title="度量性能"></a>度量性能</h2><h3 id="速率"><a href="#速率" class="headerlink" title="*速率"></a>*速率</h3><p><img src="/../img/image-20211202104826032.png" alt="image-20211202104826032"></p>
<h5 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h5><p><img src="/../img/image-20211202105452758.png" alt="image-20211202105452758"></p>
<p>100MB=100*2的23次方bit</p>
<p>100Mbps=100*10的6次方bit</p>
<p>2的23次方/10的6次方</p>
<h3 id="带宽"><a href="#带宽" class="headerlink" title="带宽"></a>带宽</h3><p><img src="/../img/image-20211202110442124.png" alt="image-20211202110442124"></p>
<p><strong>带宽和速率有关联，带宽是速率的最大值，而速率就是速率</strong></p>
<h3 id="吞吐量"><a href="#吞吐量" class="headerlink" title="吞吐量"></a>吞吐量</h3><p><img src="/../img/image-20211202110839266.png" alt="image-20211202110839266"></p>
<h3 id="时延"><a href="#时延" class="headerlink" title="时延"></a>时延</h3><p><img src="/../img/image-20211202111314116.png" alt="image-20211202111314116"></p>
<p>其中发送时延计算中的分母，发送速率，为短板效应中最小的速率</p>
<h3 id="时延带宽积"><a href="#时延带宽积" class="headerlink" title="时延带宽积"></a>时延带宽积</h3><p>可以理解为面积，长*宽</p>
<p><img src="/../img/image-20211202121726035.png" alt="image-20211202121726035"></p>
<h3 id="往返时间"><a href="#往返时间" class="headerlink" title="往返时间"></a>往返时间</h3><p><img src="/../img/image-20211202121957534.png" alt="image-20211202121957534"></p>
<h3 id="利用率"><a href="#利用率" class="headerlink" title="利用率"></a>利用率</h3><p>信道利用率 信道有百分之几是被利用的（有数据通过）</p>
<p>​                    并非越高越好，一般要控制不超过50%</p>
<p>​                    也不能过低，造成资源浪费</p>
<h3 id="丢包率"><a href="#丢包率" class="headerlink" title="丢包率"></a>丢包率</h3><p><img src="/../img/image-20211202122412998.png" alt="image-20211202122412998"></p>
<h1 id="体系结构"><a href="#体系结构" class="headerlink" title="*体系结构"></a>*体系结构</h1><p><img src="/../img/image-20211202123126010.png" alt="image-20211202123126010"></p>
<p>我们用第三个图，五层协议</p>
<p><img src="/../img/image-20211202123922913.png" alt="image-20211202123922913"></p>
<h2 id="目前的协议举例"><a href="#目前的协议举例" class="headerlink" title="目前的协议举例"></a>目前的协议举例</h2><p><img src="/../img/image-20211225223838323.png" alt="image-20211225223838323"></p>
<h1 id="物理层"><a href="#物理层" class="headerlink" title="*物理层"></a>*物理层</h1><h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h3><p><img src="/../img/image-20211220102247543.png" alt="image-20211220102247543"></p>
<h3 id="2-传输媒体"><a href="#2-传输媒体" class="headerlink" title="2.传输媒体"></a>2.传输媒体</h3><p><img src="/../img/image-20211220102922354.png" alt="image-20211220102922354"></p>
<h3 id="3-传输方式"><a href="#3-传输方式" class="headerlink" title="3.传输方式"></a>3.传输方式</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><p><img src="/../img/image-20211220103124324.png" alt="image-20211220103124324"></p>
<p>计算机网路之间是串行的</p>
<p>计算机内部传输信号是并行的</p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><p><img src="/../img/image-20211220111041303.png" alt="image-20211220111041303"></p>
<p><img src="/../img/image-20211220111057594.png" alt="image-20211220111057594"></p>
<p>同步传输会产生时钟误差，</p>
<h4 id="3"><a href="#3" class="headerlink" title="3"></a>3</h4><p><img src="/../img/image-20211220111939875.png" alt="image-20211220111939875"></p>
<p>1.天线2对讲机3手机</p>
<h3 id="4-编码与调制"><a href="#4-编码与调制" class="headerlink" title="*4.编码与调制"></a>*4.编码与调制</h3><p>计算机只能处理2进制数据，比特0和比特1</p>
<p><img src="/../img/image-20211224190959029.png" alt="image-20211224190959029"></p>
<p><img src="/../img/image-20211224191007739.png" alt="image-20211224191007739"></p>
<p>10Mb/s，10兆比特/秒就是曼彻斯特编码</p>
<h2 id="数据链路层"><a href="#数据链路层" class="headerlink" title="*数据链路层"></a>*数据链路层</h2><p><img src="/../img/image-20211224194744060.png" alt="image-20211224194744060"></p>
<p>主机有五层网络协议，而中间的只有三层即可</p>
<p>主机H1加待发送的数据逐层封装，通过物理层将各比特转化为电信号发送到传输媒体，数据包进入路由器，由下往上逐层解析到网络层，路由器根据数据包的目的网络地址和自身转发表，确定数据包的转发端口，然后从网络层向下逐层封装成数据包，通过物理层发送到传输媒体，数据包最终到达主机H2时，还要由下往上逐层解封，最终解封出H1发出的数据</p>
<p><img src="/../img/image-20211224201711785.png" alt="image-20211224201711785"></p>
<p><img src="/../img/image-20211224202312063.png" alt="image-20211224202312063"></p>
<p>以太网V2的MAC帧</p>
<p>发送给物理层加上前导码，不需要帧定界，有帧间间隔</p>
<p><img src="/../img/image-20211224203532696.png" alt="image-20211224203532696"></p>
<p>PPP帧，前后各有一个字节表示帧定界</p>
<p><img src="/../img/image-20211224203436243.png" alt="image-20211224203436243"></p>
<p>我们知道，接收方通过帧开始flag，到帧结束flag判定为一个帧，如果消息内带有flag怎么办，在每一个帧发送前，会扫描消息，如果消息体有flag，就会添加一个转义字符在前面，这样先读到转义符以后，就知道后一个flag就不是帧结束</p>
<h3 id="点对点协议PPP"><a href="#点对点协议PPP" class="headerlink" title="点对点协议PPP"></a>点对点协议PPP</h3><p>是目前使用最广泛的点对点数据链路层协议</p>
<h1 id="MAC地址"><a href="#MAC地址" class="headerlink" title="MAC地址"></a>MAC地址</h1><p>以太网的mac子层所使用的的地址（数据链路层）</p>
<p>每个主机发送的帧中必须携带发送主机和接受主机的地址，用于媒体接入控制MAC（MediaAccessControl）这类地址叫MAC地址</p>
<p>MAC地址是硬件地址</p>
<p>平板，手机，笔记本，都会有最少一个（无线局域网适配器）MAC地址，路由器有更多的MAC地址</p>
<p><img src="/../img/image-20211224215319865.png" alt="image-20211224215319865"></p>
<h1 id="IP地址"><a href="#IP地址" class="headerlink" title="*IP地址"></a>*IP地址</h1><p>tcp/ip体系结构网际层所使用的的地址（网际层）</p>
<p><img src="/../img/image-20211224220506443.png" alt="image-20211224220506443"></p>
<p>在网络N8上，同一个网路上的主机，网络号相同，主机编号不同</p>
<p>各个网络的网络号必须不同</p>
<p><img src="/../img/image-20211224220701504.png" alt="image-20211224220701504"></p>
<p>自上而下</p>
<p><img src="/../img/image-20211224220750490.png" alt="image-20211224220750490"></p>
<p>应用层报文，发送给运输层，运输层无需看懂，添加一个运输层首部继续传输即可</p>
<p>ip地址在网络层首部</p>
<p>MAC地址在数据链路层首部<img src="/../img/image-20211224221103235.png" alt="image-20211224221103235"></p>
<p><img src="/../img/image-20211224221123913.png" alt="image-20211224221123913"></p>
<h1 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h1><p>通过ip地址找到对应的MAC地址（网际层）</p>
<p><img src="/../img/image-20211224214237506.png" alt="image-20211224214237506"></p>
<p><img src="/../img/image-20211224224250955.png" alt="image-20211224224250955"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">知道C的ip地址，但是不知道c的MAC地址</span><br><span class="line">每个主机都有ARP高速缓存表</span><br><span class="line">B先查表，发现没有对应的C的ip地址</span><br><span class="line">那么会在同一个网络，或者同一个链路上发送广播请求，内容为</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211224224434337.png" alt="image-20211224224434337"></p>
<p>其他主机收到该广播，交给上层ARP进程处理解析，A发现要请求的不是自己的ip丢弃，C发现是请求自己的，首先将B的ip地址和B的MAC地址记录到C的高速缓存表总，并发送响应数据（单播，目的地址为B的地址），A收到单播帧发现目的地址不是自己的，丢弃，主机B发现是自己的ip地址，交给上层处理，解析，将C的ip地址和MAC地址记录到自己的ARP告诉缓存表中</p>
<p><img src="/../img/image-20211224224808855.png" alt="image-20211224224808855"></p>
<p><img src="/../img/image-20211224224817585.png" alt="image-20211224224817585"></p>
<p>是否定的，ARP协议想在不同的网络上使用，需要有交换机，图中是没有交换机的</p>
<h1 id="以太网交换机"><a href="#以太网交换机" class="headerlink" title="**以太网交换机"></a>**以太网交换机</h1><p><img src="/../img/image-20211224233825497.png" alt="image-20211224233825497"></p>
<h2 id="自学习"><a href="#自学习" class="headerlink" title="自学习"></a>自学习</h2><p><img src="/../img/image-20211224230247111.png" alt="image-20211224230247111"></p>
<p><img src="/../img/image-20211224230415924.png" alt="image-20211224230415924"></p>
<p>前提是无需ARP协议去缓存各个主机的MAC地址</p>
<p>A发送帧到B，在交换机1的帧交换表中先登记A的MAC地址和对应A的接口。然后在帧交换表中找B，现在是没有的，就会盲目转发，除了接口1向其他接口都发送此帧。主机B接受帧解析发现目的地址是B的MAC地址，就接受该帧。该帧通过交换机1的接口4，通过交换机2的接口2进入到交换机2，交换机2首先记录主机A的MAC地址和进入交换机2的接口2，然后进行转发查找B，发现没有B的MAC地址，于是再一次盲目转发到DEF主机，解析发现都不止发送个自己的帧，都会丢弃。</p>
<p>B发送帧到A，先登记，然后查找A的MAC地址，发现有，通过接口1转发出去。</p>
<p>E到A，登记自己，查找并发现有A，通过A的接口2，转发到交换机1的4的接口进入交换机1，登记E，查找A的MAC地址，发现有，于是通过接口1发送到主机A。</p>
<h2 id="生成树协议STP"><a href="#生成树协议STP" class="headerlink" title="生成树协议STP"></a>生成树协议STP</h2><p><img src="/../img/image-20211224233710422.png" alt="image-20211224233710422"></p>
<h1 id="虚拟局域网VLAN概念"><a href="#虚拟局域网VLAN概念" class="headerlink" title="虚拟局域网VLAN概念"></a>虚拟局域网VLAN概念</h1><h2 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h2><p>广播风暴概念：</p>
<p><img src="/../img/image-20211224234341814.png" alt="image-20211224234341814"></p>
<p>为了防止广播风暴，需要隔离广播域，可以使用路由器，一个广播只能在同一个路由器中转发，因为路由器默认不对广播进行转发</p>
<p><img src="/../img/image-20211224234259269.png" alt="image-20211224234259269"></p>
<p>但是又因为路由器成本过高，此时，虚拟局域网VLAN出现了</p>
<p>一个交换机可以划分一个局域网</p>
<p><img src="/../img/image-20211224234636887.png" alt="image-20211224234636887"></p>
<p>通过一个交换机互联原来的3个交换机，那么原来的3个局域网变为现在大的局域网的3个网段，网络中的各主机属于同一个广播域，一个主机发送广播，其他都可以收到</p>
<p><img src="/../img/image-20211224234825658.png" alt="image-20211224234825658"></p>
<p>使用VLAN技术，可以自定义划分区域，这样广播只会在特定的区域广播</p>
<p><img src="/../img/image-20211224235207730.png" alt="image-20211224235207730"></p>
<h2 id="VLAN的实现机制"><a href="#VLAN的实现机制" class="headerlink" title="VLAN的实现机制"></a>VLAN的实现机制</h2><p>是在交换机上实现的</p>
<p><img src="/../img/image-20211224235444105.png" alt="image-20211224235444105"></p>
<h3 id="交换机端口"><a href="#交换机端口" class="headerlink" title="交换机端口"></a>交换机端口</h3><h4 id="1-Access端口"><a href="#1-Access端口" class="headerlink" title="1.Access端口"></a>1.Access端口</h4><p>需要修改交换机的配置</p>
<p><img src="/../img/image-20211225001110858.png"></p>
<h4 id="2-Trunk端口"><a href="#2-Trunk端口" class="headerlink" title="2.Trunk端口"></a>2.Trunk端口</h4><p><img src="/../img/image-20211225002513933.png" alt="image-20211225002513933"></p>
<p>因此，连接主机的端口应设置为Access类型，交换机之间互联的端口设置为Trunk类型</p>
<h4 id="3-Hybrid端口"><a href="#3-Hybrid端口" class="headerlink" title="3.Hybrid端口"></a>3.Hybrid端口</h4><p>可以看出VID有了组的概念</p>
<p><img src="/../img/image-20211225003444416.png" alt="image-20211225003444416"></p>
<h1 id="网络层"><a href="#网络层" class="headerlink" title="**网络层"></a>**网络层</h1><p><img src="/../img/image-20211225115724966.png" alt="image-20211225115724966"></p>
<h1 id="IPV4地址"><a href="#IPV4地址" class="headerlink" title="*IPV4地址"></a>*IPV4地址</h1><p><img src="/../img/image-20211225120327232.png" alt="image-20211225120327232"></p>
<h3 id="分类编址的IPv4地址"><a href="#分类编址的IPv4地址" class="headerlink" title="分类编址的IPv4地址"></a>分类编址的IPv4地址</h3><p>最高固定为0,10,110,1110,1111</p>
<p><img src="/../img/image-20211225120642582.png" alt="image-20211225120642582"></p>
<p>主机号全为0为某类的网络地址，不是可分配的IP地址</p>
<p>主机号全为1的为某类的广播地址，不是可分配的IP地址</p>
<p>一个网络有一个网络地址，主机号全0,</p>
<h4 id="A类"><a href="#A类" class="headerlink" title="A类"></a>A类</h4><p><img src="/../img/image-20211225121016450.png" alt="image-20211225121016450"></p>
<h4 id="B类"><a href="#B类" class="headerlink" title="B类"></a>B类</h4><p><img src="/../img/image-20211225121304106.png" alt="image-20211225121304106"></p>
<h4 id="C类"><a href="#C类" class="headerlink" title="C类"></a>C类</h4><p><img src="/../img/image-20211225121426919.png" alt="image-20211225121426919"></p>
<p><img src="/../img/image-20211225122004636.png" alt="image-20211225122004636"></p>
<p><img src="/../img/image-20211225122500350.png" alt="image-20211225122500350"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">上图的题的解析：</span><br><span class="line">1.先找出需要几个网络，注意路由器之间也需要一个网络，一共4个网络</span><br><span class="line">2.查看每个网络主机需要分配的IP个数</span><br><span class="line">黄色网络，65534个IP+路由器端口需要1个IP=65535个，因为B类一个网络最多只能分配65534个IP，所以只能是A类网络。</span><br><span class="line">网络号：1-126</span><br><span class="line">主机号：不能全1广播地址，不能全0网络地址</span><br><span class="line"></span><br><span class="line">蓝色网络，254+1=255，因为C类只能分配254个IP，所以可以A可以B，根据题目节约，B类网络</span><br><span class="line">网络号：128.0-191.255</span><br><span class="line">主机号：不能全1广播地址，不能全0网络地址</span><br><span class="line"></span><br><span class="line">绿色网络，16+24=40个主机加上一个路由器接口IP=41个，注意交换机不需要分配IP，41个IP，C类即可</span><br><span class="line">网络号：192.0.0-223.255.255</span><br><span class="line">主机号：不能全1广播地址，不能全0网络地址</span><br><span class="line"></span><br><span class="line">粉色网络，2个路由器接口IP，C类</span><br><span class="line">网络号：192.0.0-223.255.255，注意不能跟绿色网络的网络号一致</span><br><span class="line">主机号：不能全1广播地址，不能全0网络地址</span><br></pre></td></tr></table></figure>

<h4 id="划分子网的IPv4地址"><a href="#划分子网的IPv4地址" class="headerlink" title="划分子网的IPv4地址"></a>划分子网的IPv4地址</h4><p>从主机号中借用几位，就可以划分2的几次方个子网（网络）</p>
<p><img src="/../img/image-20211225141023183.png" alt="image-20211225141023183"></p>
<p><img src="/../img/image-20211225130830763.png" alt="image-20211225130830763"></p>
<h5 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h5><p><img src="/../img/image-20211225132408269.png" alt="image-20211225132408269"></p>
<p><img src="/../img/image-20211225132559094.png" alt="image-20211225132559094"></p>
<p>划分子网0和子网1了</p>
<p><img src="/../img/image-20211225132836923.png" alt="image-20211225132836923"></p>
<p><img src="/../img/image-20211225133717999.png" alt="image-20211225133717999"></p>
<p><img src="/../img/image-20211225133822210.png" alt="image-20211225133822210"></p>
<h3 id="无分类编制的IPv4地址"><a href="#无分类编制的IPv4地址" class="headerlink" title="无分类编制的IPv4地址"></a>无分类编制的IPv4地址</h3><p><img src="/../img/image-20211225140233860.png" alt="image-20211225140233860"></p>
<h2 id="IPv4地址的应用规划"><a href="#IPv4地址的应用规划" class="headerlink" title="IPv4地址的应用规划"></a>IPv4地址的应用规划</h2><p><img src="/../img/image-20211225141115420.png" alt="image-20211225141115420"></p>
<p><img src="/../img/image-20211225141133766.png" alt="image-20211225141133766"></p>
<p>字长子网掩码划分了8个网络，但是只需要5个网络，并且举例N5只需要4个IP即可，但是每个子网30多个IP，造成了严重的浪费</p>
<p><img src="/../img/image-20211225141346604.png" alt="image-20211225141346604"></p>
<p><img src="/../img/image-20211225143240691.png" alt="image-20211225143240691"></p>
<h2 id="IP数据报的发送和转发过程"><a href="#IP数据报的发送和转发过程" class="headerlink" title="IP数据报的发送和转发过程"></a>IP数据报的发送和转发过程</h2><p><img src="/../img/image-20211225144457222.png" alt="image-20211225144457222"></p>
<h2 id="静态路由配置"><a href="#静态路由配置" class="headerlink" title="静态路由配置"></a>静态路由配置</h2><p>静态的就是手工配置的</p>
<p><img src="/../img/image-20211225150007813.png" alt="image-20211225150007813"></p>
<h3 id="特定主机路由，直接32位主机号的地址"><a href="#特定主机路由，直接32位主机号的地址" class="headerlink" title="特定主机路由，直接32位主机号的地址"></a>特定主机路由，直接32位主机号的地址</h3><h3 id="默认路由：未找到指定的路由，走这个路由"><a href="#默认路由：未找到指定的路由，走这个路由" class="headerlink" title="默认路由：未找到指定的路由，走这个路由"></a>默认路由：未找到指定的路由，走这个路由</h3><p><img src="/../img/image-20211225151245334.png" alt="image-20211225151245334"></p>
<h3 id="最长前缀路由匹配原则"><a href="#最长前缀路由匹配原则" class="headerlink" title="最长前缀路由匹配原则"></a>最长前缀路由匹配原则</h3><p>匹配度最长的优先，可以理解为网络前缀长的</p>
<h3 id="黑洞路由"><a href="#黑洞路由" class="headerlink" title="黑洞路由"></a>黑洞路由</h3><p>下一跳为空null0，可以自动生效，失效</p>
<h1 id="IPv4数据包的首部格式"><a href="#IPv4数据包的首部格式" class="headerlink" title="IPv4数据包的首部格式"></a>IPv4数据包的首部格式</h1><p><img src="/../img/image-20211225174237460.png" alt="image-20211225174237460"></p>
<p><img src="/../img/image-20211225174253012.png" alt="image-20211225174253012"></p>
<p>数据长度=总长度-首部长度</p>
<p><img src="/../img/image-20211225174327498.png" alt="image-20211225174327498"></p>
<h1 id="网际控制报文协议ICMP"><a href="#网际控制报文协议ICMP" class="headerlink" title="网际控制报文协议ICMP"></a>网际控制报文协议ICMP</h1><h2 id="差错报告报文"><a href="#差错报告报文" class="headerlink" title="差错报告报文"></a>差错报告报文</h2><p><img src="/../img/image-20211225213330268.png" alt="image-20211225213330268"></p>
<h2 id="ICMP询问报文-回送请求和回答"><a href="#ICMP询问报文-回送请求和回答" class="headerlink" title="ICMP询问报文-回送请求和回答"></a>ICMP询问报文-回送请求和回答</h2><p><img src="/../img/image-20211225213051929.png" alt="image-20211225213051929"></p>
<p><img src="/../img/image-20211225213315378.png" alt="image-20211225213315378"></p>
<p>跟踪路由原理，逐步添加TTL的数值从1开始，经过R1TTL-1变0，返回给H1差错报告报文，TTL=2，R2发送差错，TTL=3，H2发送ICMP回送请求和回答报文，就知道中途经过了哪些路由器</p>
<p><img src="/../img/image-20211225213515179.png" alt="image-20211225213515179"></p>
<h1 id="虚拟专用网VPN和网络地址转换NAT"><a href="#虚拟专用网VPN和网络地址转换NAT" class="headerlink" title="*虚拟专用网VPN和网络地址转换NAT"></a>*虚拟专用网VPN和网络地址转换NAT</h1><p><img src="/../img/image-20211225214120272.png" alt="image-20211225214120272"></p>
<p><img src="/../img/image-20211225214403066.png" alt="image-20211225214403066"></p>
<h2 id="NAT路由器"><a href="#NAT路由器" class="headerlink" title="NAT路由器"></a>NAT路由器</h2><p><img src="/../img/image-20211225214959005.png" alt="image-20211225214959005"></p>
<h2 id="现在家用的路由器基本都是NAPT路由器"><a href="#现在家用的路由器基本都是NAPT路由器" class="headerlink" title="现在家用的路由器基本都是NAPT路由器"></a>现在家用的路由器基本都是NAPT路由器</h2><p><img src="/../img/image-20211225215104372.png" alt="image-20211225215104372"></p>
<p><img src="/../img/image-20211225215348202.png" alt="image-20211225215348202"></p>
<h2 id="使用私有地址的主机不能直接充当因特网服务器"><a href="#使用私有地址的主机不能直接充当因特网服务器" class="headerlink" title="使用私有地址的主机不能直接充当因特网服务器"></a>使用私有地址的主机不能直接充当因特网服务器</h2><p><img src="/../img/image-20211225215720146.png" alt="image-20211225215720146"></p>
<p>比如内网穿透技术，把内网转为外网ip</p>
<h1 id="运输层"><a href="#运输层" class="headerlink" title="运输层"></a>运输层</h1><p><img src="/../img/image-20211225221851718.png" alt="image-20211225221851718"></p>
<p><img src="/../img/image-20211225222503633.png" alt="image-20211225222503633"></p>
<p><img src="/../img/image-20211225223230198.png" alt="image-20211225223230198"></p>
<p><img src="/../img/image-20211225223316035.png" alt="image-20211225223316035"></p>
<h2 id="TCP和UDP"><a href="#TCP和UDP" class="headerlink" title="TCP和UDP"></a>TCP和UDP</h2><p>TCP面向字节流</p>
<p>UDP面向应用层报文</p>
<p><img src="/../img/image-20211225224642911.png" alt="image-20211225224642911"></p>
<h2 id="TCP流量控制"><a href="#TCP流量控制" class="headerlink" title="TCP流量控制"></a>TCP流量控制</h2><p><img src="/../img/image-20211225231321297.png" alt="image-20211225231321297"></p>
<h2 id="TCP拥塞控制"><a href="#TCP拥塞控制" class="headerlink" title="TCP拥塞控制"></a>TCP拥塞控制</h2><p>输入多少，就应该输出多少，可以理解为车道的车，正常是车来车过，但是车越来越多，过得越来越慢，最终造成堵车</p>
<p><img src="/../img/image-20211225232212847.png" alt="image-20211225232212847"></p>
<h2 id="TCP的连接建立"><a href="#TCP的连接建立" class="headerlink" title="TCP的连接建立"></a>TCP的连接建立</h2><p><img src="/../img/image-20211226002124119.png" alt="image-20211226002124119"></p>
<h2 id="连接流程"><a href="#连接流程" class="headerlink" title="连接流程"></a>连接流程</h2><p>3次握手</p>
<p>SYN：TCP连接请求报文段首部中的同步位，不懈怠数据也要消耗一个序号</p>
<p>seq：序号字段</p>
<p>ack:对序号字段的确认，需要+1操作</p>
<p>ACK：确认位</p>
<p><img src="/../img/image-20211226003845925.png" alt="image-20211226003845925"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.一开始，两个TCP服务都是关闭状态</span><br><span class="line">TCP服务器先创建传输控制块，创建一些信息如TCP链接表，当前发送和接收序号等，进入监听状态，等待客户端的连接请求，此时是被动等待，不是主动发起</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211226004128283.png" alt="image-20211226004128283"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TCP客户端创建传输控制块，创建一些信息如TCP链接表，当前发送和接收序号等</span><br><span class="line">向TCP服务器进程发送连接请求报文段仅，进入同步已发送状态</span><br><span class="line">TCP连接请求报文段首部中的同步位SYN被设置为1，表名这是一个TCP连接请求报文段</span><br><span class="line">序号字段seq设置初始值x，SYN为1的报文段，不能携带数据，但要消耗一个序号</span><br><span class="line">2.TCP服务器接收到连接请求，如果同意连接，向客户端进程发送TCP连接请求确认报文段，进入同步已接受状态，同步位SYN=1,确认位ACK=1，序号字段seq初始值y，确认号字段设置为x+1，是对tcp客户进程所选择的初始序号的确认，也不能携带数据，要消耗一个序号</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211226004930633.png" alt="image-20211226004930633"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3.tcp客户端向服务器发送普通的连接请求确认的确认报文段，进入连接已建立状态</span><br><span class="line">ACK=1,seq=x+1，ack=y+1，注意seq+1是因为第一次发送的seq=x，消耗一个序号+1，并且普通的报文段如果不携带数据，就不消耗序号，下次还是seq=x+1,</span><br><span class="line">ack=y+1是对服务器序号y的确认</span><br><span class="line">tcp服务器接收到此报文段后，进入连接已建立状态</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211226005353601.png" alt="image-20211226005353601"></p>
<h3 id="问题？为什么是3次，而不是2次，最后一次普通的请求报文有什么用？"><a href="#问题？为什么是3次，而不是2次，最后一次普通的请求报文有什么用？" class="headerlink" title="问题？为什么是3次，而不是2次，最后一次普通的请求报文有什么用？"></a>问题？为什么是3次，而不是2次，最后一次普通的请求报文有什么用？</h3><p><img src="/../img/image-20211226005745725.png" alt="image-20211226005745725"></p>
<p><img src="/../img/image-20211226005926506.png" alt="image-20211226005926506"></p>
<h2 id="TCP连接释放"><a href="#TCP连接释放" class="headerlink" title="TCP连接释放"></a>TCP连接释放</h2><p>四次挥手</p>
<p>FIN：首部中的终止位，不懈怠数据也要消耗一个序号</p>
<p>ACK：首部中的确认位，等于1表示普通的确认报文</p>
<p>seq：序号</p>
<p>客户端发送请求时：等于客户进程之前已经传送过的数据的最后一个字节的序号+1</p>
<p>服务端发送确认时：等于服务进程之前已经传送过的数据的最后一个字节的序号+1</p>
<p>ack：确认号</p>
<p>客户端发送请求时：等于客户进程之前已经收到过的数据的最后一个字节的序号+1</p>
<p>服务端发送确认时：等于服务进程之前已经收到过的数据的最后一个字节的序号+1</p>
<p><img src="/../img/image-20211226115809885.png" alt="image-20211226115809885"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.TCP客户端主动发送释放报文，进入终止等待1状态，FIN=1,ACK=1，seq=u，ack=v</span><br><span class="line">2.服务进程收到tcp连接释放报文段后，发送一个普通的tcp确认报文，进入关闭等待状态，ACK=1，seq=v，ack=u+1，此时客户端到服务端的连接关闭，但是服务端到客户端的连接没有关闭，会持续一段时间，tcp客户进程收到服务进程的确认报文后，进入终止等待2状态，等待服务器发送tcp连接释放报文段</span><br><span class="line">3.tcp服务如果没有要发送的数据了，会通知应用进程发送TCP普通确认的连接释放报文段，FIN=1,ACK=1,seq=w，上一次是V，这一次是W是因为服务器可能会继续发送一部分，ack=u+1是对第一次tcp客户发起的报文请求的重复确认，服务进程进入最后确认状态</span><br><span class="line">4.tcp客户收到请求报文后，发送确认报文，进入时间等待状态，ACK=1，seq=u+1，ack=w+1</span><br><span class="line">5.tcp服务进程收到确认报文后进入关闭状态</span><br><span class="line">6.tcp客户进程进过2MSL才进入关闭状态</span><br><span class="line">MSL：最长报文段寿明</span><br></pre></td></tr></table></figure>

<h3 id="问题：为什么有第4步，不是直接关闭而是进入时间等待状态，2MSL后才关闭？"><a href="#问题：为什么有第4步，不是直接关闭而是进入时间等待状态，2MSL后才关闭？" class="headerlink" title="问题：为什么有第4步，不是直接关闭而是进入时间等待状态，2MSL后才关闭？"></a>问题：为什么有第4步，不是直接关闭而是进入时间等待状态，2MSL后才关闭？</h3><p>如果tcp客户发送的最后一个确认报文丢失了，但是也进入关闭状态了，服务器没有接收到确认报文，就会超时重发，而客户已经关闭了，不理睬此报文，就会一直重发</p>
<p>并且，2MSL会使本次连接所产生的所有报文都从网络中消失</p>
<h2 id="tcp服务端保活计时器"><a href="#tcp服务端保活计时器" class="headerlink" title="tcp服务端保活计时器"></a>tcp服务端保活计时器</h2><p><img src="/../img/image-20211226121743374.png" alt="image-20211226121743374"></p>
<h2 id="TCP报文的首部格式"><a href="#TCP报文的首部格式" class="headerlink" title="TCP报文的首部格式"></a>TCP报文的首部格式</h2><p><img src="/../img/image-20211226122837569.png" alt="image-20211226122837569"></p>
<p><img src="/../img/image-20211226122928408.png" alt="image-20211226122928408"></p>
<p><img src="/../img/image-20211226122956985.png" alt="image-20211226122956985"></p>
<p><img src="/../img/image-20211226123016556.png" alt="image-20211226123016556"></p>
<p><img src="/../img/image-20211226123246207.png" alt="image-20211226123246207"></p>
<p><img src="/../img/image-20211226123341152.png" alt="image-20211226123341152"></p>
<h1 id="应用层"><a href="#应用层" class="headerlink" title="**应用层"></a>**应用层</h1><p><img src="/../img/image-20211226123846402.png" alt="image-20211226123846402"></p>
<p><img src="/../img/image-20211226124026454.png" alt="image-20211226124026454"></p>
<h2 id="C-S方式"><a href="#C-S方式" class="headerlink" title="C/S方式"></a>C/S方式</h2><p><img src="/../img/image-20211226124537410.png" alt="image-20211226124537410"></p>
<h2 id="P2P方式"><a href="#P2P方式" class="headerlink" title="P2P方式"></a>P2P方式</h2><p><img src="/../img/image-20211226124746190.png" alt="image-20211226124746190"></p>
<h2 id="动态主机配置协议DHCP"><a href="#动态主机配置协议DHCP" class="headerlink" title="动态主机配置协议DHCP"></a>动态主机配置协议DHCP</h2><h2 id="DHCP客户机端口68"><a href="#DHCP客户机端口68" class="headerlink" title="DHCP客户机端口68"></a>DHCP客户机端口68</h2><h2 id="DHCP服务器短裤67"><a href="#DHCP服务器短裤67" class="headerlink" title="DHCP服务器短裤67"></a>DHCP服务器短裤67</h2><p><img src="/../img/image-20211226130008487.png" alt="image-20211226130008487"></p>
<h3 id="自己网络上没有DHCP服务器，如何通过其他网络上的DHCP服务器自动获取到ip"><a href="#自己网络上没有DHCP服务器，如何通过其他网络上的DHCP服务器自动获取到ip" class="headerlink" title="自己网络上没有DHCP服务器，如何通过其他网络上的DHCP服务器自动获取到ip"></a>自己网络上没有DHCP服务器，如何通过其他网络上的DHCP服务器自动获取到ip</h3><p><img src="/../img/image-20211226134607354.png" alt="image-20211226134607354"></p>
<p>首先路由器不会转发广播报文，但是给路由器配置DHCP服务器的IP地址，使路由器成为DHCP中继代理，当路由器发现DHCP发现报文，就会去找DHCP服务器了</p>
<h2 id="DNS服务器用于解析域名对应的IP"><a href="#DNS服务器用于解析域名对应的IP" class="headerlink" title="DNS服务器用于解析域名对应的IP"></a>DNS服务器用于解析域名对应的IP</h2><h2 id="端口默认53"><a href="#端口默认53" class="headerlink" title="端口默认53"></a>端口默认53</h2><p>当使用域名访问网站时，先在本地DNS主机的DNS高速缓存中查找IP地址</p>
<p>如果没有找到，向网络中的某台DNS服务器查询，该服务器存在对应域名与ip地址的数据库。</p>
<p>当DNS服务器收到DNS查询报文后，会从库中查询，结果返回给主机</p>
<p><img src="/../img/image-20211226141455559.png" alt="image-20211226141455559"></p>
<h2 id="域名结构"><a href="#域名结构" class="headerlink" title="域名结构"></a>域名结构</h2><p><img src="/../img/image-20211226141645062.png" alt="image-20211226141645062"></p>
<p><img src="/../img/image-20211226142118259.png" alt="image-20211226142118259"></p>
<p><img src="/../img/image-20211226142432763.png" alt="image-20211226142432763"></p>
<p><img src="/../img/image-20211226142555522.png" alt="image-20211226142555522"></p>
<p><img src="/../img/image-20211226142625373.png"></p>
<p><img src="/../img/image-20211226142913374.png" alt="image-20211226142913374"></p>
<h2 id="文件传输协议FTP"><a href="#文件传输协议FTP" class="headerlink" title="文件传输协议FTP"></a>文件传输协议FTP</h2><p><img src="/../img/image-20211226143234122.png" alt="image-20211226143234122"></p>
<h3 id="搭建FTP"><a href="#搭建FTP" class="headerlink" title="搭建FTP"></a>搭建FTP</h3><p><img src="/../img/image-20211226143315605.png" alt="image-20211226143315605"></p>
<h3 id="工作原理-主动模式"><a href="#工作原理-主动模式" class="headerlink" title="工作原理-主动模式"></a>工作原理-主动模式</h3><p><img src="/../img/image-20211226143558506.png" alt="image-20211226143558506"></p>
<h3 id="被动模式"><a href="#被动模式" class="headerlink" title="被动模式"></a>被动模式</h3><p><img src="/../img/image-20211226143645902.png" alt="image-20211226143645902"></p>
<p><img src="/../img/image-20211226143708476.png" alt="image-20211226143708476"></p>
<p><img src="/../img/image-20211226143808601.png" alt="image-20211226143808601"></p>
<h1 id="电子邮件"><a href="#电子邮件" class="headerlink" title="电子邮件"></a>电子邮件</h1><p>邮件发送协议SMTP协议</p>
<p>邮件读取协议POP3，IMAP</p>
<p><img src="/../img/image-20211226144146374.png" alt="image-20211226144146374"></p>
<p><img src="/../img/image-20211226144252739.png" alt="image-20211226144252739"></p>
<h2 id="SMTP协议"><a href="#SMTP协议" class="headerlink" title="SMTP协议"></a>SMTP协议</h2><p>默认端口25</p>
<p>传输内容必须是ASCII文本</p>
<h2 id="POP3"><a href="#POP3" class="headerlink" title="POP3"></a>POP3</h2><p>端口110</p>
<h2 id="IMAP4"><a href="#IMAP4" class="headerlink" title="IMAP4"></a>IMAP4</h2><p>端口143</p>
<p><img src="/../img/image-20211226144913128.png" alt="image-20211226144913128"></p>
<h1 id="万维网WWW"><a href="#万维网WWW" class="headerlink" title="万维网WWW"></a>万维网WWW</h1><p><img src="/../img/image-20211226145302390.png" alt="image-20211226145302390"></p>
<h2 id="超文本传输协议HTTP"><a href="#超文本传输协议HTTP" class="headerlink" title="超文本传输协议HTTP"></a>超文本传输协议HTTP</h2><p><img src="/../img/image-20211226145620217.png" alt="image-20211226145620217"></p>
<p><img src="/../img/image-20211226145815152.png" alt="image-20211226145815152"></p>
<h2 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h2><h4 id="请求报文"><a href="#请求报文" class="headerlink" title="请求报文"></a>请求报文</h4><p><img src="/../img/image-20211226150019348.png" alt="image-20211226150019348"></p>
<h3 id="响应报文"><a href="#响应报文" class="headerlink" title="响应报文"></a>响应报文</h3><p><img src="/../img/image-20211226151227172.png" alt="image-20211226151227172"></p>
<h2 id="HTTP是无状态的"><a href="#HTTP是无状态的" class="headerlink" title="HTTP是无状态的"></a>HTTP是无状态的</h2><h2 id="Cookie是一种对无状态的HTTP进行状态化的技术"><a href="#Cookie是一种对无状态的HTTP进行状态化的技术" class="headerlink" title="Cookie是一种对无状态的HTTP进行状态化的技术"></a>Cookie是一种对无状态的HTTP进行状态化的技术</h2><p><img src="/../img/image-20211226151434062.png" alt="image-20211226151434062"></p>
<h2 id="万维网缓存与代理服务器"><a href="#万维网缓存与代理服务器" class="headerlink" title="万维网缓存与代理服务器"></a>万维网缓存与代理服务器</h2><p>代理服务器有缓存</p>
<p><img src="/../img/image-20211226151556374.png" alt="image-20211226151556374"></p>
<p>代理服务器没有缓存</p>
<p><img src="/../img/image-20211226151615674.png" alt="image-20211226151615674"></p>
<h2 id="问题：如果原始服务器改变了，而代理服务器还是原来的缓存，怎么办呢？"><a href="#问题：如果原始服务器改变了，而代理服务器还是原来的缓存，怎么办呢？" class="headerlink" title="问题：如果原始服务器改变了，而代理服务器还是原来的缓存，怎么办呢？"></a>问题：如果原始服务器改变了，而代理服务器还是原来的缓存，怎么办呢？</h2><p>代理服务器首先获取原始服务器的文本都会有一个last-modified字段（上次修改时间）的缓存时间</p>
<p>本地主机访问代理服务器时，发现有last-modified字段缓存并且时间未过期，就不去原始服务器查</p>
<p>如果过期，代理服务器向原始服务器发送一个请求报文，包含一个首部字段为if-modified-since的首部行，值为last-modified的值，原始服务器根据此字段与自己服务器的对比，如果没有修改，返回304响应码，修改代理服务器的有效日期，如果有修改，原始服务器发送封装有该文档的响应报文，代理服务器更新了文档，发回给主机</p>
<p><img src="/../img/image-20211226152454790.png" alt="image-20211226152454790"></p>
<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p><a href="https://blog.csdn.net/ailunlee/article/details/90600174?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164137983516780261954159%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=164137983516780261954159&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-90600174.pc_search_result_cache&amp;utm_term=http%E8%AF%B7%E6%B1%82&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/ailunlee/article/details/90600174?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164137983516780261954159%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=164137983516780261954159&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-90600174.pc_search_result_cache&amp;utm_term=http%E8%AF%B7%E6%B1%82&amp;spm=1018.2226.3001.4187</a></p>
<h2 id="几种常见的Content-Type类型"><a href="#几种常见的Content-Type类型" class="headerlink" title="几种常见的Content-Type类型"></a>几种常见的Content-Type类型</h2><p>服务端根据请求头中的Content-Type字段来获取消息主体的编码方式，进而进行解析数据。</p>
<h3 id="1、application-x-www-form-urlencoded"><a href="#1、application-x-www-form-urlencoded" class="headerlink" title="1、application/x-www-form-urlencoded"></a>1、application/x-www-form-urlencoded</h3><p>最常见的 POST 提交数据的方式，原生Form表单，如果不设置 enctype 属性，默认为application/x-www-form-urlencoded 方式提交数据。</p>
<h3 id="2、multipart-form-data"><a href="#2、multipart-form-data" class="headerlink" title="2、multipart/form-data"></a>2、multipart/form-data</h3><p>用于文件上传</p>
<h3 id="3、application-json"><a href="#3、application-json" class="headerlink" title="3、application/json"></a>3、application/json</h3><h3 id="4、text-xml"><a href="#4、text-xml" class="headerlink" title="4、text/xml"></a>4、text/xml</h3>]]></content>
      <categories>
        <category>计算机网络</category>
      </categories>
      <tags>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>多线程</title>
    <url>/2021/11/30/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BB%A5%E5%8F%8A%E7%BA%BF%E7%A8%8B%E7%9B%91%E5%90%AC/</url>
    <content><![CDATA[<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><h2 id="1-继承Thread类（它也实现了Runnable接口）"><a href="#1-继承Thread类（它也实现了Runnable接口）" class="headerlink" title="1.继承Thread类（它也实现了Runnable接口）"></a>1.继承Thread类（它也实现了Runnable接口）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span> ; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;我在看代码--&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//主线程main</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        B b=<span class="keyword">new</span> B();</span><br><span class="line">        b.start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程--&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="同步下载图片例子"><a href="#同步下载图片例子" class="headerlink" title="同步下载图片例子"></a>同步下载图片例子</h3><p>org.apache.commons.io.FileUtils  阿帕奇的图片下载工具包</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    String url;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">B</span><span class="params">(String url, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            DownLoad downLoad=<span class="keyword">new</span> DownLoad();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            downLoad.Down(url,name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//主线程main</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        B b1=<span class="keyword">new</span> B(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;a.png&quot;</span>);</span><br><span class="line">        B b2=<span class="keyword">new</span> B(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;b.png&quot;</span>);</span><br><span class="line">        B b3=<span class="keyword">new</span> B(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;c.png&quot;</span>);</span><br><span class="line">        b1.start();</span><br><span class="line">        b2.start();</span><br><span class="line">        b3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下载器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownLoad</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Down</span><span class="params">(String url,String name)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        FileUtils.copyURLToFile(<span class="keyword">new</span> URL(url),<span class="keyword">new</span> File(name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-实现Runnable接口-建议使用"><a href="#2-实现Runnable接口-建议使用" class="headerlink" title="2.实现Runnable接口(建议使用)"></a>2.实现Runnable接口(建议使用)</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">模板：new Thread().start();</span><br></pre></td></tr></table></figure>

<h3 id="同步下载图片例子-1"><a href="#同步下载图片例子-1" class="headerlink" title="同步下载图片例子"></a>同步下载图片例子</h3><p>org.apache.commons.io.FileUtils  阿帕奇的图片下载工具包</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span> ; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;我在看代码--&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//主线程main</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建实现类对象</span></span><br><span class="line">        B b=<span class="keyword">new</span> B();</span><br><span class="line">        <span class="comment">//创建线程对象，代理</span></span><br><span class="line">        <span class="keyword">new</span> Thread(b).start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程--&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    String url;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">B</span><span class="params">(String url, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DownLoad downLoad=<span class="keyword">new</span> DownLoad();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            downLoad.Down(url,name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//主线程main</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        B b1=<span class="keyword">new</span> B(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;a.png&quot;</span>);</span><br><span class="line">        B b2=<span class="keyword">new</span> B(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;b.png&quot;</span>);</span><br><span class="line">        B b3=<span class="keyword">new</span> B(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;c.png&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(b1).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(b2).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(b3).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下载器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownLoad</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Down</span><span class="params">(String url,String name)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        FileUtils.copyURLToFile(<span class="keyword">new</span> URL(url),<span class="keyword">new</span> File(name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-初识并发问题"><a href="#3-初识并发问题" class="headerlink" title="3.初识并发问题"></a>3.初识并发问题</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//多个线程操作同一个对象，买火车票例子</span></span><br><span class="line">    <span class="comment">//发现，线程不安全，数据乱</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket=<span class="number">10</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ticket&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//Thread.currentThread().getName()可以获得当前线程的信息</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;--第&quot;</span>+ticket+<span class="string">&quot;张票&quot;</span>);</span><br><span class="line">            ticket--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个线程对象</span></span><br><span class="line">        B b=<span class="keyword">new</span> B();</span><br><span class="line">        <span class="comment">//开启三个线程</span></span><br><span class="line">        <span class="keyword">new</span> Thread(b,<span class="string">&quot;a1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(b,<span class="string">&quot;a2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(b,<span class="string">&quot;a3&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="龟兔赛跑"><a href="#龟兔赛跑" class="headerlink" title="龟兔赛跑"></a>龟兔赛跑</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//龟兔赛跑</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String winner;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">boolean</span> flag=gameOver(i);</span><br><span class="line">            <span class="keyword">if</span> (flag==<span class="keyword">true</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;跑了&quot;</span>+i+<span class="string">&quot;步&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断是否完成比赛</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">gameOver</span><span class="params">(<span class="keyword">int</span> step)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(winner!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(step==<span class="number">10</span>)&#123;</span><br><span class="line">            <span class="comment">//查看胜利者是乌龟还是兔子</span></span><br><span class="line">            winner=Thread.currentThread().getName();</span><br><span class="line">            System.out.println(<span class="string">&quot;winner is&quot;</span>+winner);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        C c=<span class="keyword">new</span> C();</span><br><span class="line">       <span class="keyword">new</span> Thread(c,<span class="string">&quot;兔子&quot;</span>).start();</span><br><span class="line">       <span class="keyword">new</span> Thread(c,<span class="string">&quot;乌龟&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Callable接口"><a href="#4-Callable接口" class="headerlink" title="4.Callable接口"></a>4.Callable接口</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//有返回值</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Callable</span> </span>&#123;</span><br><span class="line">    String url;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">(String url, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//主线程main</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        A b1=<span class="keyword">new</span> A(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;a.png&quot;</span>);</span><br><span class="line">        A b2=<span class="keyword">new</span> A(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;b.png&quot;</span>);</span><br><span class="line">        A b3=<span class="keyword">new</span> A(<span class="string">&quot;https://123p4.sogoucdn.com/imgu/2021/06/20210623151042_241.png&quot;</span>,<span class="string">&quot;c.png&quot;</span>);</span><br><span class="line">        <span class="comment">//创建执行服务:</span></span><br><span class="line">        ExecutorService ser= Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//提交执行</span></span><br><span class="line">        Future&lt;Boolean&gt; r1=ser.submit(b1);</span><br><span class="line">        Future&lt;Boolean&gt; r2=ser.submit(b2);</span><br><span class="line">        Future&lt;Boolean&gt; r3=ser.submit(b3);</span><br><span class="line">        <span class="comment">//获取结果</span></span><br><span class="line">        <span class="keyword">boolean</span> rs1=r1.get();</span><br><span class="line">        <span class="keyword">boolean</span> rs2=r2.get();</span><br><span class="line">        <span class="keyword">boolean</span> rs3=r3.get();</span><br><span class="line">        <span class="comment">//关闭服务</span></span><br><span class="line">        ser.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        DownLoad downLoad=<span class="keyword">new</span> DownLoad();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            downLoad.Down(url,name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下载器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownLoad</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Down</span><span class="params">(String url,String name)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        FileUtils.copyURLToFile(<span class="keyword">new</span> URL(url),<span class="keyword">new</span> File(name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="尚硅谷，多线程"><a href="#尚硅谷，多线程" class="headerlink" title="尚硅谷，多线程"></a>尚硅谷，多线程</h2><h3 id="Volatile关键字"><a href="#Volatile关键字" class="headerlink" title="Volatile关键字"></a>Volatile关键字</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/09/10  14:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestVolatile</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ThreadDemo td=<span class="keyword">new</span> ThreadDemo();</span><br><span class="line">        <span class="keyword">new</span> Thread(td).start();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(td.isFlag())&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;=========&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//此线程在200毫秒后把flag变量变为true，然后主线程td.isFlag判断，按道理来说应该是打印====，</span></span><br><span class="line"><span class="comment">//但是结果发现一直运行，疑问？不是应该共享变量吗，为什么主线程的flag没有变呢？</span></span><br><span class="line"><span class="comment">//因为，jvm会为每一个线程，分配一个独立的缓存，共享变量不可见</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag=<span class="keyword">false</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        flag=<span class="keyword">true</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;flag为true了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/../img/image-20210910144837052.png" alt="image-20210910144837052"></p>
<p>1.共享数据flag在主存（可以理解为堆内存中）</p>
<p>2.线程1先从主存读取flag=false到自己的内存，然后在改值，把值写回到主存中</p>
<p>3.main线程也是从主存读取flag=false到自己的内存，然后一直while(true),在自己的内存中flag一直等于false</p>
<p><img src="/../img/image-20210910145815330.png" alt="image-20210910145815330"></p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><h4 id="1-加锁"><a href="#1-加锁" class="headerlink" title="1.加锁"></a>1.加锁</h4><p>以一个任意对象为锁</p>
<p><img src="/../img/image-20210910150152487.png" alt="image-20210910150152487"></p>
<p>推荐下图的加锁</p>
<p><img src="/../img/image-20210910150221542.png" alt="image-20210910150221542"></p>
<p>但是这样的话效率极低，每个线程都需要判断是否可以获取锁</p>
<h4 id="2-用volatile关键字"><a href="#2-用volatile关键字" class="headerlink" title="2.用volatile关键字"></a>2.用volatile关键字</h4><p>当多个线程进行操作共享数据时，可以保证内存中的数据可见</p>
<p>可以理解时时刻刻刷新每个线程的缓存，使与主存中的数据一致，每个变量都是在主存进行交互的，不是在各自的线程里</p>
<p><img src="/../img/image-20210910150746812.png" alt="image-20210910150746812"></p>
<p><img src="/../img/image-20210910150916536.png" alt="image-20210910150916536"></p>
<h3 id="原子性"><a href="#原子性" class="headerlink" title="原子性"></a>原子性</h3><p><img src="/../img/image-20210910151347593.png" alt="image-20210910151347593"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/09/10  14:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAtomic</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AtomicDemo ad=<span class="keyword">new</span> AtomicDemo();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(ad).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//正常应该打印0-9，但是发现不止一个0，发现不能保证原子性，</span></span><br><span class="line"><span class="comment">// 比如i++的操作，为先int temp=i，i=i+1,这应该是原子的不能分割的，</span></span><br><span class="line"><span class="comment">//但是在此程序中被分割了。</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AtomicDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> serialNumber=<span class="number">0</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(getSerialNumber());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSerialNumber</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialNumber++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/../img/image-20210910152502461.png" alt="image-20210910152502461"></p>
<h4 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h4><h5 id="1-原子变量"><a href="#1-原子变量" class="headerlink" title="1.原子变量"></a>1.原子变量</h5><p>既保证了内存可见性，又保证了数据的原子性</p>
<p><img src="/../img/image-20210910153150677.png" alt="image-20210910153150677"></p>
<p><img src="/../img/image-20210910153713862.png" alt="image-20210910153713862"></p>
<p><img src="/../img/image-20210910153945269.png" alt="image-20210910153945269"></p>
<h3 id="CAS算法模拟"><a href="#CAS算法模拟" class="headerlink" title="CAS算法模拟"></a>CAS算法模拟</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/09/10  14:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCompareAndSwap</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> CompareAndSwap cas=<span class="keyword">new</span> CompareAndSwap();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">int</span> expectedValue = cas.get();</span><br><span class="line">                    <span class="keyword">boolean</span> a=cas.compareAndSet(expectedValue,(<span class="keyword">int</span>)(Math.random()*<span class="number">101</span>));</span><br><span class="line">                    System.out.println(a);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompareAndSwap</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line">    <span class="comment">//获取</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//比较</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">compareAndSwap</span><span class="params">(<span class="keyword">int</span> expectedValue,<span class="keyword">int</span> newValue)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> oldValue=value;</span><br><span class="line">        <span class="keyword">if</span>(oldValue==expectedValue)&#123;</span><br><span class="line">            value=newValue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expectedValue,<span class="keyword">int</span> newValue)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> expectedValue==compareAndSwap(expectedValue,newValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConcurrentHashMap锁分段机制"><a href="#ConcurrentHashMap锁分段机制" class="headerlink" title="ConcurrentHashMap锁分段机制"></a>ConcurrentHashMap锁分段机制</h3><p>hashmap线程不安全</p>
<p>hashtable线程安全，锁住整个hash表，效率极低</p>
<h2 id="Executor"><a href="#Executor" class="headerlink" title="Executor"></a>Executor</h2><p><a href="https://blog.csdn.net/weixin_40304387/article/details/80508236?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163149502516780274112604%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163149502516780274112604&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-80508236.first_rank_v2_pc_rank_v29&amp;utm_term=Executors&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/weixin_40304387/article/details/80508236?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163149502516780274112604%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163149502516780274112604&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-80508236.first_rank_v2_pc_rank_v29&amp;utm_term=Executors&amp;spm=1018.2226.3001.4187</a></p>
<h2 id="ExecutorService"><a href="#ExecutorService" class="headerlink" title="ExecutorService"></a>ExecutorService</h2><p>Executor：一般来说，Runnable任务开辟在新线程中的使用方法为：new Thread(new RunnableTask())).start()，但在Executor中，可以使用Executor而不用显示地创建线程：Executor.execute(new RunnableTask()); // 异步执行</p>
<p>ExecutorService：是一个比Executor使用更广泛的子类接口，返回 Future 对象，可以调用ExecutorService的shutdown（）方法来关闭 ExecutorService，调用该方法后，将导致ExecutorService停止接受任何新的任务且等待已经提交的任务执行完成(已经提交的任务会分两类：一类是已经在执行的，另一类是还没有开始执行的)，当所有已经提交的任务执行完毕后将会关ExecutorService。因此我们一般用该接口来实现和管理多线程。</p>
<p>通过 ExecutorService.submit() 方法返回的 Future 对象，可以调用isDone（）方法查询Future是否已经完成。当任务完成时，它具有一个结果，你可以调用get()方法来获取该结果。你也可以不用isDone（）进行检查就直接调用get()获取结果，在这种情况下，get()将阻塞，直至结果准备就绪，还可以取消任务的执行。Future 提供了 cancel() 方法用来取消执行 pending 中的任务。</p>
<h2 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h2><p>Executors类： 主要用于提供线程池相关的操作<br>Executors类，提供了一系列工厂方法用于创建线程池，返回的线程池都实现了ExecutorService接口。</p>
<h4 id="1、public-static-ExecutorService-newFiexedThreadPool-int-Threads"><a href="#1、public-static-ExecutorService-newFiexedThreadPool-int-Threads" class="headerlink" title="1、public static ExecutorService newFiexedThreadPool(int Threads)"></a>1、public static ExecutorService newFiexedThreadPool(int Threads)</h4><p> 创建固定数目线程的线程池。</p>
<p>①-newFixedThreadPool与cacheThreadPool差不多，也是能就用，但不能随时建新的线程<br>其独特之处:任意时间点，最多只能有固定数目的活动线程存在，此时如果有新的线程要建立，只能放在另外的队列中等待，直到当前的线程中某个线程终止直接被移出池子<br>②-和cacheThreadPool不同，FixedThreadPool多数针对一些很稳定很固定的正规并发线程，多用于服务器<br>③-从方法的源代码看，cache池和fixed 池调用的是同一个底层 池，只不过参数不同:<br>fixed池线程数固定，并且是0秒超时<br>cache池线程数支持0-Integer.MAX_VALUE(显然完全没考虑主机的资源承受能力），60秒超时</p>
<h4 id="2、public-static-ExecutorService-newCachedThreadPool"><a href="#2、public-static-ExecutorService-newCachedThreadPool" class="headerlink" title="2、public static ExecutorService newCachedThreadPool()"></a>2、public static ExecutorService newCachedThreadPool()</h4><p>①创建一个可缓存的线程池，调用execute 将重用以前构造的线程（如果线程可用）。如果没有可用的线程，则创建一个新线程并添加到池中。终止并从缓存中移除那些已有 60 秒钟未被使用的线程。-缓存型池子，先查看池中有没有以前建立的线程，如果有，就 使用.如果没有，就建一个新的线程加入池中<br>②缓存型池子通常用于执行一些生存期很短的异步型任务<br> 因此在一些面向连接的服务中用得不多。但对于生存期短的异步任务，它是Executor的首选。<br>③能用的线程，必须是timeout 规定内的池中线程，缺省     timeout是60s,超过这个时长，线程实例将被终止及移出池。<br>④注意，放入CachedThreadPool的线程不必担心其结束，超过TIMEOUT不活动，其会自动被终止。</p>
<h4 id="3、public-static-ExecutorService-newSingleThreadExecutor"><a href="#3、public-static-ExecutorService-newSingleThreadExecutor" class="headerlink" title="3、public static ExecutorService newSingleThreadExecutor()"></a>3、public static ExecutorService newSingleThreadExecutor()</h4><p>创建一个单线程化的Executor。</p>
<p> -单例线程，任意时间池中只能有一个线程<br>-用的是和cache池和fixed池相同的底层池，但线程数目是1，0秒超时时长</p>
<h4 id="4、public-static-ScheduledExecutorService-newScheduledThreadPool-int-corePoolSize"><a href="#4、public-static-ScheduledExecutorService-newScheduledThreadPool-int-corePoolSize" class="headerlink" title="4、public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize)"></a>4、public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize)</h4><p>创建一个支持定时及周期性的任务执行的线程池，多数情况下可用来替代Timer类。</p>
<p>-调度型线程池<br>-这个池子里的线程可以按schedule依次delay执行，或周期执行</p>
<h2 id="Executor-和-ExecutorService-这两个接口主要的区别是"><a href="#Executor-和-ExecutorService-这两个接口主要的区别是" class="headerlink" title="Executor 和 ExecutorService 这两个接口主要的区别是"></a>Executor 和 ExecutorService 这两个接口主要的区别是</h2><p>①ExecutorService 接口继承了 Executor 接口，是 Executor 的子接口<br>②Executor 接口定义了 execute()方法用来接收一个Runnable接口的对象，而 ExecutorService 接口中的 submit()方法可以接受Runnable和Callable接口的对象。<br>③Executor 中的 execute() 方法不返回任何结果，而 ExecutorService 中的 submit()方法可以通过一个 Future 对象返回运算结果。<br>④除了允许客户端提交一个任务，ExecutorService 还提供用来控制线程池的方法。比如：调用 shutDown() 方法终止线程池。<br>⑤Executors 类提供工厂方法用来创建不同类型的线程池。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableDemo</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//1.通过Executors类创建缓存型线程池，用ExecutorService接受，因为返回结果都实现了ExecutorService</span></span><br><span class="line">        ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line">        <span class="comment">//2.ExecutorService返回future对象</span></span><br><span class="line">        List&lt;Future&lt;String&gt;&gt; resultList = <span class="keyword">new</span> ArrayList&lt;Future&lt;String&gt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建10个任务并执行</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            <span class="comment">//3.使用ExecutorService执行Callable类型的任务，并将结果保存在future变量中</span></span><br><span class="line">            Future&lt;String&gt; future = executorService.submit(<span class="keyword">new</span> TaskWithResult(i));</span><br><span class="line">            <span class="comment">//将任务执行结果存储到List中</span></span><br><span class="line">            resultList.add(future);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历任务的结果</span></span><br><span class="line">        <span class="keyword">for</span> (Future&lt;String&gt; fs : resultList)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="keyword">while</span>(!fs.isDone())&#123;&#125;;<span class="comment">//Future返回如果没有完成，则一直循环等待，直到Future返回完成</span></span><br><span class="line">                    System.out.println(fs.get());     <span class="comment">//打印各个线程（任务）执行的结果</span></span><br><span class="line">                &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(ExecutionException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">                    <span class="comment">//启动一次顺序关闭，执行以前提交的任务，但不接受新任务</span></span><br><span class="line">                    executorService.shutdown();</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskWithResult</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskWithResult</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 任务的具体过程，一旦任务传给ExecutorService的submit方法，</span></span><br><span class="line"><span class="comment">     * 则该方法自动在一个线程上执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//设置线程名字</span></span><br><span class="line">        Thread.currentThread().setName(<span class="string">&quot;线程&quot;</span>+id);</span><br><span class="line">        <span class="comment">//该返回结果将被Future的get方法得到</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;call()方法被自动调用，任务返回的结果是：&quot;</span> + id + <span class="string">&quot;    &quot;</span> + Thread.currentThread().getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20210913153725913.png" alt="image-20210913153725913"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/12/27  11:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">		ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//3.使用ExecutorService执行Callable类型的任务，并将结果保存在future变量中</span></span><br><span class="line">		Future&lt;String&gt; future = executorService.submit(<span class="keyword">new</span> MyTask(<span class="number">1</span>));</span><br><span class="line">		<span class="comment">//future.cancel(true);</span></span><br><span class="line">		String result = future.get();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		executorService.shutdown();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyTask</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 任务的具体过程，一旦任务传给ExecutorService的submit方法，</span></span><br><span class="line"><span class="comment">	 * 则该方法自动在一个线程上执行</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//设置线程名字</span></span><br><span class="line">		Thread.currentThread().setName(<span class="string">&quot;线程&quot;</span>+id);</span><br><span class="line"><span class="comment">//        System.out.println(&quot;call()方法被自动调用！！！    &quot; + Thread.currentThread().getName());</span></span><br><span class="line">		<span class="comment">//该返回结果将被Future的get方法得到</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;call()方法被自动调用，任务返回的结果是：&quot;</span> + id + <span class="string">&quot;    &quot;</span> + Thread.currentThread().getName();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="自定义线程池"><a href="#自定义线程池" class="headerlink" title="自定义线程池"></a>自定义线程池</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolTest</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//创建等待队列</span></span><br><span class="line">        BlockingQueue&lt;Runnable&gt; bqueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">20</span>);</span><br><span class="line">        <span class="comment">//创建线程池，池中保存的线程数为3，允许的最大线程数为5</span></span><br><span class="line">        ThreadPoolExecutor pool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">3</span>,<span class="number">5</span>,<span class="number">50</span>, TimeUnit.MILLISECONDS,bqueue);</span><br><span class="line">        <span class="comment">//创建七个任务</span></span><br><span class="line">        Runnable t1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        Runnable t2 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        Runnable t3 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        Runnable t4 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        Runnable t5 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        Runnable t6 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        Runnable t7 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        <span class="comment">//每个任务会在一个线程上执行</span></span><br><span class="line">        pool.execute(t1);</span><br><span class="line">        pool.execute(t2);</span><br><span class="line">        pool.execute(t3);</span><br><span class="line">        pool.execute(t4);</span><br><span class="line">        pool.execute(t5);</span><br><span class="line">        pool.execute(t6);</span><br><span class="line">        pool.execute(t7);</span><br><span class="line">        <span class="comment">//关闭线程池</span></span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;正在执行。。。&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20210913153700073.png" alt="image-20210913153700073"></p>
<p>发现只有三个线程在使用！</p>
<p>ThreadPoolExecuror类的构造方法中各个参数的含义</p>
<p>public ThreadPoolExecutor (int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit,BlockingQueue<Runnable> workQueue)</Runnable></p>
<p>corePoolSize：线程池中所保存的核心线程数，包括空闲线程。</p>
<p>maximumPoolSize：池中允许的最大线程数。</p>
<p>keepAliveTime：线程池中的空闲线程所能持续的最长时间。</p>
<p>unit：持续时间的单位。</p>
<p>workQueue：任务执行前保存任务的队列，仅保存由execute方法提交的Runnable任务。</p>
<p>1、如果线程池中的线程数量少于corePoolSize，即使线程池中有空闲线程，也会创建一个新的线程来执行新添加的任务；<br>    2、如果线程池中的线程数量大于等于corePoolSize，但缓冲队列workQueue未满，则将新添加的任务放到workQueue中，按照FIFO的原则依次等待执行（线程池中有线程空闲出来后依次将缓冲队列中的任务交付给空闲的线程执行）；</p>
<p>   3、如果线程池中的线程数量大于等于corePoolSize，且缓冲队列workQueue已满，但线程池中的线程数量小于maximumPoolSize，则会创建新的线程来处理被添加的任务；</p>
<pre><code>总结起来，也即是说，当有新的任务要处理时，先看线程池中的线程数量是否大于corePoolSize，再看缓冲队列workQueue是否满，最后看线程池中的线程数量是否大于maximumPoolSize。
</code></pre>
<h1 id="多线程监听"><a href="#多线程监听" class="headerlink" title="多线程监听"></a>多线程监听</h1><p>一个继承Callable的多线程类</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.jiang.multithread;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line">public class TestThread implements Callable&lt;String&gt; &#123;</span><br><span class="line">@Override</span><br><span class="line">public String call() &#123;</span><br><span class="line">   System.out.println(System.currentTimeMillis() + &quot;进来了&quot; + this.hashCode());</span><br><span class="line"></span><br><span class="line">   try &#123;</span><br><span class="line">      Thread.sleep(5000);</span><br><span class="line">   &#125; catch (InterruptedException e) &#123;&#125;</span><br><span class="line"></span><br><span class="line">   return System.currentTimeMillis() + &quot;出来了&quot; + this.hashCode();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20211227124033425.png" alt="image-20211227124033425"></p>
<h2 id="监听单线程超时"><a href="#监听单线程超时" class="headerlink" title="监听单线程超时"></a>监听单线程超时</h2><p>调用get方式是一个阻塞方法，不能在多线程中使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	FutureTask&lt;String&gt; task = <span class="keyword">new</span> FutureTask&lt;String&gt;(<span class="keyword">new</span> TestThread());</span><br><span class="line">	<span class="keyword">new</span> Thread(task).start();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//3000就是超时时间</span></span><br><span class="line">		String result = task.get(<span class="number">3000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;线程已经停止了&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">		System.out.println(System.currentTimeMillis() + <span class="string">&quot;线程超时了，打死他&quot;</span>);</span><br><span class="line">		task.cancel(<span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来看看控制台的输出</p>
<p>1524559858691进来了1893883033<br>1524559861691线程超时了，打死他</p>
<h2 id="监听多线程超时"><a href="#监听多线程超时" class="headerlink" title="监听多线程超时"></a>监听多线程超时</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//线程池</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ExecutorService pool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      FutureTask&lt;String&gt; task = <span class="keyword">new</span> FutureTask&lt;String&gt;(<span class="keyword">new</span> TestThread());</span><br><span class="line">      <span class="keyword">new</span> Thread(task).start();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">      <span class="keyword">while</span> (!task.isDone()) &#123;<span class="comment">//关键在这</span></span><br><span class="line">         <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">         <span class="keyword">if</span> ((now - start) &gt;= <span class="number">3000</span>) &#123;<span class="comment">//超时时间3000毫秒</span></span><br><span class="line">            task.cancel(<span class="keyword">true</span>);</span><br><span class="line">            System.out.println(System.currentTimeMillis() + <span class="string">&quot;线程超时了，打死他&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5</span>);<span class="comment">//记得加个sleep，不然搞坏你cpu</span></span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">         pool.execute(<span class="keyword">new</span> Main());</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ListeningExecutorService的使用"><a href="#ListeningExecutorService的使用" class="headerlink" title="ListeningExecutorService的使用"></a>ListeningExecutorService的使用</h2><p>监听缓存池，时间到了自动执行一个方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiang.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.cache.CacheUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.cache.impl.TimedCache;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ThreadUtil;</span><br><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.MessageFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:jiangjiaxu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/12/22  13:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>:V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:hutool时间缓存时间到了以后，监听可以自动做事</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimedCacheUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 时间缓存，默认5s过期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> TimedCache&lt;String, String&gt; TIMED_CACHE = CacheUtil.newTimedCache(<span class="number">5000</span>);</span><br><span class="line">  <span class="comment">/** 线程池 */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听类，监听线程池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ListeningExecutorService listeningExecutorService =</span><br><span class="line">      MoreExecutors.listeningDecorator(executorService);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存入键值对，添加过期时间，和消费回调</span></span><br><span class="line"><span class="comment">     * consumer是java8的一个类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> consumer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, String value, Long timeout, Consumer&lt;String&gt; consumer)</span> </span>&#123;</span><br><span class="line">        TIMED_CACHE.put(key, value, timeout);</span><br><span class="line">        addListen(key, consumer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取缓存值</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> TIMED_CACHE.get(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 删除缓存</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    TIMED_CACHE.remove(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 添加监听器</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> consumer</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addListen</span><span class="params">(String key, Consumer&lt;String&gt; consumer)</span> </span>&#123;</span><br><span class="line">    ListenableFuture&lt;String&gt; listenableFuture =</span><br><span class="line">        listeningExecutorService.submit(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">              <span class="keyword">while</span> (TIMED_CACHE.containsKey(key)) &#123;</span><br><span class="line">                ThreadUtil.sleep(<span class="number">500</span>);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> key;</span><br><span class="line">            &#125;);</span><br><span class="line">    Futures.addCallback(</span><br><span class="line">        listenableFuture,</span><br><span class="line">        <span class="keyword">new</span> FutureCallback&lt;String&gt;() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(<span class="meta">@Nullable</span> String s)</span> </span>&#123;</span><br><span class="line">            consumer.accept(s);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        listeningExecutorService);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    put(<span class="string">&quot;haha&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="number">3000L</span>, x -&gt; System.out.println(MessageFormat.format(<span class="string">&quot;[&#123;0&#125;] - 缓存消逝&quot;</span>, x)));</span><br><span class="line">    ThreadUtil.sleep(<span class="number">2000</span>);</span><br><span class="line">    System.out.println(get(<span class="string">&quot;haha&quot;</span>));</span><br><span class="line">    ThreadUtil.sleep(<span class="number">2000</span>);</span><br><span class="line">    System.out.println(get(<span class="string">&quot;haha&quot;</span>));</span><br><span class="line">    ThreadUtil.sleep(<span class="number">5000</span>);</span><br><span class="line">    System.out.println(get(<span class="string">&quot;haha&quot;</span>));</span><br><span class="line">    <span class="comment">// 关闭监听线程池</span></span><br><span class="line">    listeningExecutorService.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="CountDownLatch使用"><a href="#CountDownLatch使用" class="headerlink" title="CountDownLatch使用"></a>CountDownLatch使用</h1><h2 id="1、类介绍"><a href="#1、类介绍" class="headerlink" title="1、类介绍"></a>1、类介绍</h2><p>一个同步辅助类，在完成一组正在其他线程中执行的操作之前，它允许一个或多个线程一直等待。用给定的计数 初始化 CountDownLatch。由于调用了 countDown() 方法，所以在当前计数到达零之前，await 方法会一直受阻塞。之后，会释放所有等待的线程，await 的所有后续调用都将立即返回。这种现象只出现一次——计数无法被重置。 一个线程(或者多个)， 等待另外N个线程完成某个事情之后才能执行</p>
<h2 id="2、使用场景"><a href="#2、使用场景" class="headerlink" title="2、使用场景"></a>2、使用场景</h2><p>在一些应用场合中，需要等待某个条件达到要求后才能做后面的事情；同时当线程都完成后也会触发事件，以便进行后面的操作。 这个时候就可以使用CountDownLatch。CountDownLatch最重要的方法是countDown()和await()，前者主要是倒数一次，后者是等待倒数到0，如果没有到达0，就只有阻塞等待了。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void countDown()</span><br><span class="line"></span><br><span class="line">public boolean await(long timeout, TimeUnit unit) throws InterruptedException</span><br></pre></td></tr></table></figure>

<h2 id="3-实例"><a href="#3-实例" class="headerlink" title="3.实例"></a>3.实例</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟了100米赛跑，10名选手已经准备就绪，只等裁判一声令下。当所有人都到达终点时，比赛结束。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开始的倒数锁 </span></span><br><span class="line">        <span class="keyword">final</span> CountDownLatch begin = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);  </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 结束的倒数锁 </span></span><br><span class="line">        <span class="keyword">final</span> CountDownLatch end = <span class="keyword">new</span> CountDownLatch(<span class="number">10</span>);  </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 十名选手 </span></span><br><span class="line">        <span class="keyword">final</span> ExecutorService exec = Executors.newFixedThreadPool(<span class="number">10</span>);  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; <span class="number">10</span>; index++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> NO = index + <span class="number">1</span>;  </span><br><span class="line">            Runnable run = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                    <span class="keyword">try</span> &#123;  </span><br><span class="line">                        <span class="comment">// 如果当前计数为零，则此方法立即返回。</span></span><br><span class="line">                        <span class="comment">// 等待</span></span><br><span class="line">                        begin.await();  </span><br><span class="line">                        Thread.sleep((<span class="keyword">long</span>) (Math.random() * <span class="number">10000</span>));  </span><br><span class="line">                        System.out.println(<span class="string">&quot;No.&quot;</span> + NO + <span class="string">&quot; arrived&quot;</span>);  </span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;  </span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">                        <span class="comment">// 每个选手到达终点时，end就减一</span></span><br><span class="line">                        end.countDown();</span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;;  </span><br><span class="line">            exec.submit(run);</span><br><span class="line">        &#125;  </span><br><span class="line">        System.out.println(<span class="string">&quot;Game Start&quot;</span>);  </span><br><span class="line">        <span class="comment">// begin减一，开始游戏</span></span><br><span class="line">        begin.countDown();  </span><br><span class="line">        <span class="comment">// 等待end变为0，即所有选手到达终点</span></span><br><span class="line">        end.await();  </span><br><span class="line">        System.out.println(<span class="string">&quot;Game Over&quot;</span>);  </span><br><span class="line">        exec.shutdown();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4、输出结果"><a href="#4、输出结果" class="headerlink" title="4、输出结果"></a><strong>4、输出结果</strong></h2><p>Game Start<br>No.9 arrived<br>No.6 arrived<br>No.8 arrived<br>No.7 arrived<br>No.10 arrived<br>No.1 arrived<br>No.5 arrived<br>No.4 arrived<br>No.2 arrived<br>No.3 arrived<br>Game Over</p>
<h1 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h1><p>Semaphore也是一个线程同步的辅助类，可以维护当前访问自身的线程个数，并提供了同步机制。使用Semaphore可以控制同时访问资源的线程个数，例如，实现一个文件允许的并发访问数。</p>
<p>Semaphore的主要方法摘要：</p>
<p>　　void acquire():从此信号量获取一个许可，在提供一个许可前一直将线程阻塞，否则线程被中断。</p>
<p>　　void release():释放一个许可，将其返回给信号量。</p>
<p>　　int availablePermits():返回此信号量中当前可用的许可数。</p>
<p>　　boolean hasQueuedThreads():查询是否有线程正在等待获取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.boco.nbd.upload.station;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.ExecutorService;</span><br><span class="line">import java.util.concurrent.Executors;</span><br><span class="line">import java.util.concurrent.Semaphore;</span><br><span class="line"></span><br><span class="line">public class SemaphoreTest &#123;</span><br><span class="line">      public static void main(String[] args) &#123;</span><br><span class="line">          ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line">          //同一时刻只能有5个线程并发</span><br><span class="line">          public static final m=5;</span><br><span class="line">         final Semaphore sp = new Semaphore(m);//创建Semaphore信号量，初始化许可大小为m</span><br><span class="line">         for(int i=0;i&lt;5;i++)&#123;</span><br><span class="line">             try &#123;</span><br><span class="line">                 Thread.sleep(100);</span><br><span class="line">             &#125; catch (InterruptedException e2) &#123;</span><br><span class="line">                 e2.printStackTrace();</span><br><span class="line">             &#125;</span><br><span class="line">             Runnable runnable = new Runnable()&#123;</span><br><span class="line">                     public void run()&#123;</span><br><span class="line">                     try &#123;</span><br><span class="line">                         sp.acquire();//请求获得许可，如果有可获得的许可则继续往下执行，许可数减1。否则进入阻塞状态</span><br><span class="line">                     &#125; catch (InterruptedException e1) &#123;</span><br><span class="line">                         e1.printStackTrace();</span><br><span class="line">                     &#125;</span><br><span class="line">                     System.out.println(&quot;线程&quot; + Thread.currentThread().getName() +</span><br><span class="line">                             &quot;进入，当前已有&quot; + (m-sp.availablePermits()) + &quot;个并发&quot;);</span><br><span class="line">                     try &#123;</span><br><span class="line">                         Thread.sleep((long)(Math.random()*10000));</span><br><span class="line">                     &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                         e.printStackTrace();</span><br><span class="line">                     &#125;</span><br><span class="line">                     System.out.println(&quot;线程&quot; + Thread.currentThread().getName() +</span><br><span class="line">                             &quot;即将离开&quot;);</span><br><span class="line">                     sp.release();//释放许可，许可数加1</span><br><span class="line">                     //下面代码有时候执行不准确，因为其没有和上面的代码合成原子单元</span><br><span class="line">                     System.out.println(&quot;线程&quot; + Thread.currentThread().getName() +</span><br><span class="line">                             &quot;已离开，当前已有&quot; + (m-sp.availablePermits()) + &quot;个并发&quot;);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;;</span><br><span class="line">             service.execute(runnable);</span><br><span class="line">         &#125;</span><br><span class="line">         service.shutdown();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="ConcurrencyTester并发测试类"><a href="#ConcurrencyTester并发测试类" class="headerlink" title="ConcurrencyTester并发测试类"></a>ConcurrencyTester并发测试类</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws InterruptedException, ExecutionException, IOException &#123;</span><br><span class="line">   ConcurrencyTester tester = ThreadUtil.concurrencyTest(10, () -&gt; &#123;</span><br><span class="line">//10个线程，执行逻辑</span><br><span class="line">      System.out.println(Thread.currentThread().getName());</span><br><span class="line">   &#125;);</span><br><span class="line">   tester.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../img/image-20220107145912509.png" alt="image-20220107145912509"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>多线程</tag>
      </tags>
  </entry>
</search>
